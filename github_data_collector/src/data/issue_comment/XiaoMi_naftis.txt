æŸ¥çœ‹logæ˜¾ç¤ºï¼š
not ok 1 Testing MySQL Connection
# (in test file /tests/run.sh, line 2)
#   `mysql --host=naftis-mysql --port=3306 -u root -pWlRncGh3UWY5VQ==' failed
# mysql: [Warning] Using a password on the command line interface can be insecure.
# ERROR 2003 (HY000): Can't connect to MySQL server on 'naftis-mysql' (111) 

[root@master naftis]# kubectl apply -n naftis -f mysql.yaml
persistentvolume/naftis-pv unchanged
secret/naftis-mysql unchanged
configmap/naftis-mysql-initialization unchanged
configmap/naftis-mysql-test unchanged
persistentvolumeclaim/naftis-mysql unchanged
service/naftis-mysql unchanged
pod/naftis-mysql-test configured
error: unable to recognize "mysql.yaml": no matches for kind "Deployment" in version "v1"

[35m(/home/travis/gopath/src/github.com/xiaomi/naftis/src/api/storer/db/tasktmpl.go:62)[0m 
[33m[2019-07-04 02:47:52][0m  [36;1m[0.25ms][0m  INSERT INTO task_tmpl_vars (`task_tmpl_id`, `name`, `title`, `comment`, `form_type`, `data_source`, `default`) VALUES   
[36;31m[0 rows affected or returned ][0m 
[naftis] (1) [31m2019-07-04 02:47:52 [ERRO] [0m [service] AddTaskTmplVar fail error:Error 1064: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '' at line 1 
[naftis] (1) [34m2019-07-04 02:47:52 [INFO] [0m [OpFailFn] err:sql executed fail             
[GIN] 2019/07/04 - 02:47:52 | 500 |    4.095471ms |  172.16.101.225 | POST     /api/tasktmpls

[35m(/home/travis/gopath/src/github.com/xiaomi/naftis/src/api/storer/db/tasktmpl.go:44)[0m 
[33m[2019-07-04 02:47:52][0m  [36;1m[0.68ms][0m  INSERT INTO `task_tmpls` (`created_at`,`updated_at`,`deleted_at`,`name`,`content`,`brief`,`revision`,`operator`,`icon`) VALUES ('2019-07-04 02:47:52','2019-07-04 02:47:52',NULL,'test','apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: {{.Host}}
spec:
  hosts:
  - reviews
  http:
  - route:
    - destination:
        host: {{.Host}}
        subset: {{.DestinationSubset1}}
      weight: {{.Weight1}}
    - destination:
        host: {{.Host}}
        subset: {{.DestinationSubset2}}
      weight: {{.Weight2}}

','','1','admin','')  
[36;31m[1 rows affected or returned ][0m 

[35m(/home/travis/gopath/src/github.com/xiaomi/naftis/src/api/storer/db/tasktmpl.go:62)[0m 
[33m[2019-07-04 02:47:52][0m [31;1m Error 1064: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '' at line 1 [0m

[35m(/home/travis/gopath/src/github.com/xiaomi/naftis/src/api/storer/db/tasktmpl.go:62)[0m 
[33m[2019-07-04 02:47:52][0m  [36;1m[0.31ms][0m  INSERT INTO task_tmpl_vars (`task_tmpl_id`, `name`, `title`, `comment`, `form_type`, `data_source`, `default`) VALUES   
[36;31m[0 rows affected or returned ][0m 
[naftis] (1) [31m2019-07-04 02:47:52 [ERRO] [0m [service] AddTaskTmplVar fail error:Error 1064: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '' at line 1 
![TIMæˆªå›¾20190530174342](https://user-images.githubusercontent.com/29921533/58624326-8f5e3580-8302-11e9-9d05-b0e6c559a8aa.png)
 dashboardé¡µé¢æ˜¾ç¤ºçš„Podå’Œserviceæ•°é‡å’Œç”¨apiæ¥å£è·å–åˆ°çš„æ•°é‡äº¤æ¢äº†ï¼Œå¹¶ä¸”ç»Ÿè®¡çš„æ•°é‡å’Œé›†ç¾¤ä¸­Podï¼Œserviceæ•°é‡ä¸ä¸€è‡´
ä½¿ç”¨å®˜æ–¹æœ€æ–°å®‰è£…åŒ…0.1.4-rc6ã€‚
æ“ä½œç³»ç»ŸCentos 7ã€‚
å®‰è£…åæ‹“æ‰‘ç»“æ„å›¾ä¸ºç©ºï¼Œæ˜¾ç¤ºç™½æ¿ã€‚

URLåœ°å€ä¸ºï¼š
http://10.xx.xx.xx:xxx/api/d3graph?source_namespace=monitoring&source_workload=grafana-
å“åº”æ•°æ®ä¸ºç©ºã€‚
{"nodes":[],"links":[]}

è¯·é—®æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ


åˆ›å»ºæ¨¡æ¿ sqlæŠ¥é”™ã€‚ æ¨¡æ¿é‡Œé¢çš„yamlå†…å®¹åœ¨å‘½ä»¤è¡Œæ˜¯å¯ä»¥æ­£å¸¸åˆ›å»ºçš„
naftisæ˜¯è¿è¡Œåœ¨é»˜è®¤åŸŸå cluster.local ä¸‹çš„ã€‚å¦‚æœé›†ç¾¤çš„åŸŸåä¸æ˜¯é»˜è®¤çš„ï¼Œnaftis-uiå°±èµ·ä¸æ¥ã€‚apiè¿˜å¥½ï¼Œå¯ä»¥ä¿®æ”¹å‚æ•°ã€‚
åœ¨å³ä¸Šè§’é€‰æ‹©äº†ä¸­æ–‡ä¹‹åï¼Œæ˜¾ç¤ºçš„è·¯ç”±è§„åˆ™è¿˜æ˜¯è‹±æ–‡ï¼Œå¯ä¸å¯ä»¥ä¿®æ”¹æˆä¸­æ–‡çš„ï¼Ÿå¦‚å›¾ï¼š
![image](https://user-images.githubusercontent.com/44308785/53936374-87686e00-40e4-11e9-97be-72bb0c01293a.png)

å¸Œæœ›ç®¡ç†è€…èƒ½å¤Ÿæä¾›ä¸€äº›å¸®åŠ©ï¼Œæˆ‘æ„¿æ„åšè¿™ä¸ªå·¥ä½œã€‚
çœŸå¿ƒè§‰å¾—naftisæœ‰äº›åŠŸèƒ½æŒºå¥½çš„ï¼Œä½†æ˜¯æ´»è·ƒåº¦å¥½ä½å•Šã€‚ã€‚ã€‚



Describe the bug
æŒ‰ç…§githubä¸Šçš„æ­¥éª¤è¿›è¡Œç«¯å£è½¬å‘å¤±è´¥åï¼Œä½¿ç”¨nodeportæš´éœ²ç«¯å£ï¼Œè®¿é—®åç™»å½•æ—¶æŠ¥é”™ã€‚

To Reproduce
æƒ³è¯•ä¸€ä¸‹naftisçš„åŠŸèƒ½ï¼Œä½†æ˜¯åˆ°è¿™ä¸€æ­¥ï¼Œä¸€ç›´è®¿é—®ä¸äº†ï¼Œæƒ³è¯·å¤§ä½¬ä»¬æŒ‡å¯¼æŒ‡å¯¼ã€‚
Steps :

1. ç«¯å£è½¬å‘å¤±è´¥åï¼Œæˆ‘ä¿®æ”¹äº†naftis.yamlï¼Œå°†LoadBalanceæ”¹ä¸ºäº†NodePortï¼Œç„¶åreplace naftis.yamlï¼›
2. ä¹‹åå°±æ‰§è¡Œæš´éœ²ç«¯å£çš„å‘½ä»¤ï¼š
NAFTIIS_NODEPORT=$(kubectl get svc naftis-ui -n naftis -o jsonpath='{.spec.ports[0].nodePort}')
INGRESS_HOST=$(kubectl get node -o jsonpath='{.items[0].status.addresses[0].address}')
echo "http://$INGRESS_HOST:$NAFTIIS_NODEPORT/naftis-ui/"
3. æ‰§è¡Œåï¼Œè¾“å‡ºåœ°å€ï¼šhttp://192.168.217.100:30326/naftis-ui/ï¼Œç„¶åç”¨googleæµè§ˆå™¨è®¿é—®ï¼›
4. è®¿é—®åå‡ºç°äº†naftisçš„ç™»å½•é¡µé¢ï¼Œè¾“å…¥åˆå§‹ç”¨æˆ·åadminå’Œå¯†ç adminåï¼Œå³ä¸Šè§’å‡ºç°ï¼šNotification
app.common.errOthers(405)!
é”™è¯¯é¡µé¢æˆªå›¾å¦‚ä¸‹ï¼š
![image](https://user-images.githubusercontent.com/44308785/53713919-7ec72c00-3e87-11e9-98be-ce13f2d17c35.png)
æƒ³è¯·å¤§ä½¬ä»¬å¸®æˆ‘çœ‹ä¸€ä¸‹ï¼Œç«¯å£æš´éœ²çš„æ–¹å¼æ˜¯å¦æ­£ç¡®ï¼Œä¸ºä»€ä¹ˆä¸å¯ä»¥ç«¯å£è½¬å‘ï¼Ÿ

![image](https://user-images.githubusercontent.com/15795798/53625428-0f123080-3c3e-11e9-8d3f-0ace60a6bd72.png)
