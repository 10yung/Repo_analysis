### Background

I had a channel that was stuck as pending but it did forward payments in that state.
Don't be alarmed, the payment was forwarded only after the channel opening TX had enough confirmations (3 per my config).
The channel was initiated by the remote party and was in private mode.
(it seems that the connection wasn't stable and kept being reestablished, possibly a mobile client)
Days after the payments were forwarded I noticed the issue, the channel was only showing up on the pending channels. After I restarted the channel was moved to the activated channels.

A short part of the sanitized logs during the opening of the channel. (See lower for fuller logs)
```
= Block 612219
# channel opening initiated
[INF] FNDG: Waiting for funding tx
[INF] NTFN: Historical spend dispatch finishedfor request
= Block 612220
2020-01-10 17:17:45.105 [INF] NTFN: New block: height=612221
2020-01-10 17:17:45.106 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=612221) examining active HTLC's
2020-01-10 17:17:45.106 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=612221) examining active HTLC's
= Block 612221
2020-01-10 17:17:45.111 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): checking chain actions at height=612221
2020-01-10 17:19:54.357 [DBG] FNDG: Received FundingLocked for ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) from peer 022deadbeefbadbabedec0def00d
2020-01-10 17:19:54.357 [INF] FNDG: Already handling fundingLocked for ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d), ignoring.
= Block 612222 (3 confirmations here, chan should become active)
2020-01-10 17:26:41.195 [INF] NTFN: New block: height=612222, sha=00000000000000000010c5faeb3b3683e530109a5e4a28ccacbc872d8ad7b24b
2020-01-10 17:26:41.196 [INF] NTFN: Dispatching 3 confirmation notification for txid=7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26
2020-01-10 17:26:41.197 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=612222) examining active HTLC's
2020-01-10 17:26:41.206 [INF] HSWC: Garbage collected 1 shared secret hashes at height=612222 ##could be irrelevant
2020-01-10 17:26:41.210 [INF] FNDG: ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) is now active: ChannelID(7a5fe432d38f6cba1181b87562b306d2dbeff2daf9d5695a016714d7161e3f4199d381c23f98861610a9647cbcfb7eca5ccbaa94814481ebf6506a6441cee917)
2020-01-10 17:26:41.253 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): checking chain actions at height=612222
2020-01-10 17:26:41.261 [DBG] FNDG: ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) is now fully confirmed! (shortChanID=612220:666:0)
2020-01-10 17:26:41.262 [INF] NTFN: Cancelling epoch notification, epoch_id=670
2020-01-10 17:26:41.280 [ERR] LTND: Unable to lookup witness: no witnesses
2020-01-10 17:26:41.298 [ERR] LTND: Unable to lookup witness: no witnesses
2020-01-10 17:26:41.298 [ERR] LTND: Unable to lookup witness: no witnesses
2020-01-10 17:26:41.308 [INF] HSWC: ChannelLink(0:0:0) Updating to short_chan_id=612220:666:0 for chan_id=4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d
2020-01-10 17:26:41.308 [INF] HSWC: Updated short_chan_id for ChannelLink(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d): old=0:0:0, new=612220:666:0
2020-01-10 17:26:41.308 [INF] CNCT: Attempting to update ContractSignals for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:26:41.311 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0 has opening state 0
2020-01-10 17:26:41.311 [INF] FNDG: Peer(022deadbeefbadbabedec0def00d) is online, sending FundingLocked for ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-10 17:26:41.311 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0: successfully sent FundingLocked
2020-01-10 17:26:41.311 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0 has opening state 1
2020-01-10 17:28:05.405 [TRC] FNDG: Closing chan barrier for ChanID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-10 17:28:05.475 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0: successfully added to router graph
2020-01-10 17:28:05.476 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0 has opening state 2
2020-01-10 17:28:05.476 [DBG] FNDG: Will not announce private channel 654986535166168551.
2020-01-10 17:28:05.476 [DBG] FNDG: Sending our NodeAnnouncement for ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) to 022deadbeefbadbabedec0def00d
2020-01-10 17:28:05.478 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0: successfully announced
2020-01-10 17:28:05.478 [DBG] FNDG: ChannlPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) with chanID=[149 233 67 1 255 239 180 141 162 159 202 162 196 163 254 230 28 141 162 159 202 162 196 163 254 29 148 141 29 30 196 25] not found in opening database, assuming already announced to the network
```



**Note**: I'm attaching below sanitized the relevant parts from the logs, if you want fuller/unsanitized logs I can provided in encrypted form or mail you.

### Your environment

* version of `lnd`
0.8.2
* which operating system (`uname -a` on *Nix)
Ubuntu 16.04 LTS
* version of `btcd`, `bitcoind`, or other backend
bitcoind 0.17.1
* any other relevant environment details
popular node(100s of channels), beefy machine, solid connection, Tor enabled

### Steps to reproduce

Not sure how to reproduce. It seems the case was an unstable remote party initiating a private channel, maybe some extreme edge case.
Below are 2 logs, one from the initial opening of the channel and the second from the restart of lnd and the full activation of the channel.

lnd logs during the initial opening (& problematic full activation) of the channel
```
2020-01-10 17:15:50.033 [INF] SRVR: New inbound connection from THEIR_IP:46586
2020-01-10 17:15:50.033 [INF] SRVR: Finalizing connection to 022deadbeefbadbabedec0def00d@THEIR_IP:46586, inbound=true
2020-01-10 17:15:50.063 [INF] SRVR: Negotiated chan series queries with 022deadbeefbadbabedec0def00d
2020-01-10 17:15:50.063 [INF] DISC: Creating new GossipSyncer for peer=022deadbeefbadbabedec0def00d
2020-01-10 17:15:52.371 [INF] CRTR: Processed channels=0 updates=16 nodes=0 in last 1m0.009764174s
2020-01-10 17:15:54.311 [INF] FNDG: Recv'd fundingRequest(amt=0.00666 BTC, push=0 mSAT, delay=2016, pendingId=4301e61cc03defb4854295e9caa2c4ff941f87246b948da29fa3fe1d1ecdd4e7) from peer(022deadbeefbadbabedec0def00d)
2020-01-10 17:15:54.787 [INF] FNDG: Requiring 3 confirmations for pendingChan(4301e61cc03defb4854295e9caa2c4ff941f87246b948da29fa3fe1d1ecdd4e7): amt=0.00666 BTC, push_amt=0 mSAT, tweakless=false
2020-01-10 17:15:54.787 [INF] FNDG: Sending fundingResp for pendingID(4301e61cc03defb4854295e9caa2c4ff941f87246b948da29fa3fe1d1ecdd4e7)
2020-01-10 17:15:54.787 [DBG] FNDG: Remote party accepted commitment constraints: (channeldb.ChannelConstraints) {
 DustLimit: (btcutil.Amount) 0.00000546 BTC,
 ChanReserve: (btcutil.Amount) 0.0000666 BTC,
 MaxPendingAmount: (lnwire.MilliSatoshi) 659889000 mSAT,
 MinHTLC: (lnwire.MilliSatoshi) 0 mSAT,
 MaxAcceptedHtlcs: (uint16) 483,
 CsvDelay: (uint16) 144
}

2020-01-10 17:15:55.006 [INF] FNDG: completing pendingID(4301e61cc03defb4854295e9caa2c4ff941f87246b948da29fa3fe1d1ecdd4e7) with ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:15:55.029 [DBG] FNDG: Creating chan barrier for ChanID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-10 17:15:55.029 [INF] FNDG: sending FundingSigned for pendingID(4301e61cc03defb4854295e9caa2c4ff941f87246b948da29fa3fe1d1ecdd4e7) over ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:15:55.029 [INF] CNCT: Creating new ChannelArbitrator for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:15:55.036 [DBG] CNCT: New ChainEventSubscription(id=0) for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:15:55.052 [INF] NTFN: New block epoch subscription
2020-01-10 17:15:55.091 [DBG] CNCT: Starting ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0), htlc_set=(map[contractcourt.HtlcSetKey]contractcourt.htlcSet) (len=2) {
 (contractcourt.HtlcSetKey) LocalHtlcSet: (contractcourt.htlcSet) {
  incomingHTLCs: (map[uint64]channeldb.HTLC) {
  },
  outgoingHTLCs: (map[uint64]channeldb.HTLC) {
  }
 },
 (contractcourt.HtlcSetKey) RemoteHtlcSet: (contractcourt.htlcSet) {
  incomingHTLCs: (map[uint64]channeldb.HTLC) {
  },
  outgoingHTLCs: (map[uint64]channeldb.HTLC) {
 }
}

2020-01-10 17:15:55.129 [INF] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): starting state=StateDefault
2020-01-10 17:15:55.131 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=612219) examining active HTLC's
2020-01-10 17:15:55.131 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): checking chain actions at height=612219
2020-01-10 17:15:55.131 [DBG] CNCT: Starting chain watcher for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:15:55.131 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=612219) examining active HTLC's
2020-01-10 17:15:55.131 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): checking chain actions at height=612219
2020-01-10 17:15:55.138 [INF] NTFN: New spend subscription: spend_id=662, outpoint=7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0, script=0 97e97dbe45fcc7269749d1a4ac1b46ac62aa8ad8bf87a70be3ecbda1efc50aa0, height_hint=612219
2020-01-10 17:15:55.138 [INF] NTFN: Dispatching historical spend rescan for outpoint=7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0, script=0 97e97dbe45fcc7269749d1a4ac1b46ac62aa8ad8bf87a70be3ecbda1efc50aa0, start=612219, end=612219
2020-01-10 17:15:55.252 [INF] NTFN: New block epoch subscription
2020-01-10 17:15:55.252 [INF] CNCT: Close observer for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) active
2020-01-10 17:15:55.260 [INF] NTFN: New confirmation subscription: conf_id=30, txid=7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26, num_confs=3 height_hint=612219
2020-01-10 17:15:55.260 [INF] FNDG: Waiting for funding tx (7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26) to reach 3 confirmations
2020-01-10 17:15:55.340 [INF] NTFN: Historical spend dispatch finishedfor request outpoint=7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0, script=0 97e97dbe45fcc7269749d1a4ac1b46ac62aa8ad8bf87a70be3ecbda1efc50aa0 (start=612219 end=612219) with details: <nil>
---
2020-01-10 17:17:18.884 [INF] CRTR: Pruning channel graph using block 00000000000000000002d0f1425e97f211b59138ef75358c1d65b1641f6841b0 (height=612220)
2020-01-10 17:17:18.915 [INF] CRTR: Block 00000000000000000002d0f1425e97f211b59138ef75358c1d65b1641f6841b0 (height=612220) closed 0 channels
2020-01-10 17:17:19.064 [INF] NTFN: New block: height=612220, sha=00000000000000000002d0f1425e97f211b59138ef75358c1d65b1641f6841b0
---
2020-01-10 17:17:19.068 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=612220) examining active HTLC's
---
2020-01-10 17:17:19.145 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): checking chain actions at height=612220
---
2020-01-10 17:17:20.573 [DBG] FNDG: Received FundingLocked for ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) from peer 022deadbeefbadbabedec0def00d
---
2020-01-10 17:17:44.919 [INF] CRTR: Pruning channel graph using block 000000000000000000051ee538a42b59184a48bc5240181848bdba89dabc07f6 (height=612221)
2020-01-10 17:17:44.937 [INF] CRTR: Block 000000000000000000051ee538a42b59184a48bc5240181848bdba89dabc07f6 (height=612221) closed 1 channels
2020-01-10 17:17:45.105 [INF] NTFN: New block: height=612221, sha=000000000000000000051ee538a42b59184a48bc5240181848bdba89dabc07f6
---
2020-01-10 17:17:45.106 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=612221) examining active HTLC's
---
2020-01-10 17:17:45.111 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): checking chain actions at height=612221
---
2020-01-10 17:19:43.645 [INF] PEER: unable to read message from 022deadbeefbadbabedec0def00d@THEIR_IP:46586: EOF
2020-01-10 17:19:43.645 [INF] PEER: Disconnecting 022deadbeefbadbabedec0def00d@THEIR_IP:46586, reason: read handler closed
2020-01-10 17:19:43.745 [DBG] FNDG: Cancelling all reservations for peer 022deadbeefbadbabedec0def00d
2020-01-10 17:19:43.745 [DBG] FNDG: No active reservations for node: 022deadbeefbadbabedec0def00d
2020-01-10 17:19:43.745 [INF] DISC: Removing GossipSyncer for peer=022deadbeefbadbabedec0def00d
2020-01-10 17:19:43.745 [ERR] SRVR: Unable to retrieve advertised address for node 022deadbeefbadbabedec0def00d: unable to find node
---
2020-01-10 17:19:50.572 [ERR] BTCN: Can't accept connection: unable to accept connection from THEIR_IP:46623: read tcp MY_IP:9735->THEIR_IP:46623: i/o timeout
2020-01-10 17:19:52.362 [INF] CRTR: Processed channels=0 updates=21 nodes=2 in last 59.999974779s
2020-01-10 17:19:54.132 [INF] SRVR: New inbound connection from THEIR_IP:46617
2020-01-10 17:19:54.133 [INF] SRVR: Finalizing connection to 022deadbeefbadbabedec0def00d@THEIR_IP:46617, inbound=true
2020-01-10 17:19:54.187 [INF] PEER: NodeKey(022deadbeefbadbabedec0def00d) loading ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:19:54.196 [WRN] PEER: Unable to find our forwarding policy for channel 7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0, using default values
2020-01-10 17:19:54.196 [DBG] CNCT: New ChainEventSubscription(id=1) for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:19:54.196 [INF] HSWC: Removing channel link with ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-10 17:19:54.196 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) is starting
2020-01-10 17:19:54.198 [INF] HSWC: Adding pending link chan_id=4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d, short_chan_id=0:0:0
2020-01-10 17:19:54.198 [INF] SRVR: Negotiated chan series queries with 022deadbeefbadbabedec0def00d
2020-01-10 17:19:54.198 [INF] DISC: Creating new GossipSyncer for peer=022deadbeefbadbabedec0def00d
2020-01-10 17:19:54.198 [INF] HSWC: HTLC manager for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) started, bandwidth=0 mSAT
2020-01-10 17:19:54.198 [INF] HSWC: Attempting to re-resynchronize ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:19:54.290 [INF] HSWC: Received re-establishment message from remote side for channel(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:19:54.357 [DBG] FNDG: Received FundingLocked for ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) from peer 022deadbeefbadbabedec0def00d
2020-01-10 17:19:54.357 [INF] FNDG: Already handling fundingLocked for ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d), ignoring.
---
2020-01-10 17:26:40.684 [INF] CRTR: Block 00000000000000000010c5faeb3b3683e530109a5e4a28ccacbc872d8ad7b24b (height=612222) closed 1 channels
2020-01-10 17:26:41.195 [INF] NTFN: New block: height=612222, sha=00000000000000000010c5faeb3b3683e530109a5e4a28ccacbc872d8ad7b24b
---
2020-01-10 17:26:41.196 [INF] NTFN: Dispatching 3 confirmation notification for txid=7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26
---
2020-01-10 17:26:41.197 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=612222) examining active HTLC's
---
2020-01-10 17:26:41.206 [INF] HSWC: Garbage collected 1 shared secret hashes at height=612222
---
2020-01-10 17:26:41.210 [INF] FNDG: ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) is now active: ChannelID(7a5fe432d38f6cba1181b87562b306d2dbeff2daf9d5695a016714d7161e3f4199d381c23f98861610a9647cbcfb7eca5ccbaa94814481ebf6506a6441cee917)
---
2020-01-10 17:26:41.253 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): checking chain actions at height=612222
---
2020-01-10 17:26:41.261 [DBG] FNDG: ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) is now fully confirmed! (shortChanID=612220:666:0)
2020-01-10 17:26:41.262 [INF] NTFN: Cancelling epoch notification, epoch_id=670
2020-01-10 17:26:41.280 [ERR] LTND: Unable to lookup witness: no witnesses
2020-01-10 17:26:41.298 [ERR] LTND: Unable to lookup witness: no witnesses
2020-01-10 17:26:41.298 [ERR] LTND: Unable to lookup witness: no witnesses
2020-01-10 17:26:41.308 [INF] HSWC: ChannelLink(0:0:0) Updating to short_chan_id=612220:666:0 for chan_id=4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d
2020-01-10 17:26:41.308 [INF] HSWC: Updated short_chan_id for ChannelLink(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d): old=0:0:0, new=612220:666:0
2020-01-10 17:26:41.308 [INF] CNCT: Attempting to update ContractSignals for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:26:41.311 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0 has opening state 0
2020-01-10 17:26:41.311 [INF] FNDG: Peer(022deadbeefbadbabedec0def00d) is online, sending FundingLocked for ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-10 17:26:41.311 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0: successfully sent FundingLocked
2020-01-10 17:26:41.311 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0 has opening state 1
---
2020-01-10 17:26:41.491 [INF] CHBU: Updating on-disk multi SCB backup: num_old_chans=650, num_new_chans=651
2020-01-10 17:26:41.629 [INF] CHBU: Updating backup file at ~/.lnd/data/chain/bitcoin/mainnet/channel.backup
2020-01-10 17:26:41.629 [INF] CHBU: Swapping old multi backup file from ~/.lnd/data/chain/bitcoin/mainnet/temp-dont-use.backup to ~/.lnd/data/chain/bitcoin/mainnet/channel.backup
2020-01-10 17:28:05.313 [INF] CHBU: Updating backup file at ~/.lnd/data/chain/bitcoin/mainnet/channel.backup
2020-01-10 17:28:05.313 [INF] CHBU: Swapping old multi backup file from ~/.lnd/data/chain/bitcoin/mainnet/temp-dont-use.backup to ~/.lnd/data/chain/bitcoin/mainnet/channel.backup
---
2020-01-10 17:28:05.405 [TRC] FNDG: Closing chan barrier for ChanID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-10 17:28:05.475 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0: successfully added to router graph
2020-01-10 17:28:05.476 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0 has opening state 2
2020-01-10 17:28:05.476 [DBG] FNDG: Will not announce private channel 654986535166168551.
2020-01-10 17:28:05.476 [DBG] FNDG: Sending our NodeAnnouncement for ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) to 022deadbeefbadbabedec0def00d
2020-01-10 17:28:05.478 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0: successfully announced
2020-01-10 17:28:05.478 [DBG] FNDG: ChannlPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) with chanID=[149 233 67 1 255 239 180 141 162 159 202 162 196 163 254 230 28 141 162 159 202 162 196 163 254 29 148 141 29 30 196 25] not found in opening database, assuming already announced to the network
---
2020-01-10 17:29:16.239 [INF] PEER: unable to read message from 022deadbeefbadbabedec0def00d@THEIR_IP:46617: EOF
2020-01-10 17:29:16.239 [INF] PEER: Disconnecting 022deadbeefbadbabedec0def00d@THEIR_IP:46617, reason: read handler closed
2020-01-10 17:29:16.439 [DBG] FNDG: Cancelling all reservations for peer 022deadbeefbadbabedec0def00d
2020-01-10 17:29:16.439 [DBG] FNDG: No active reservations for node: 022deadbeefbadbabedec0def00d
2020-01-10 17:29:16.439 [INF] DISC: Removing GossipSyncer for peer=022deadbeefbadbabedec0def00d
2020-01-10 17:29:16.439 [INF] HSWC: Removing channel link with ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-10 17:29:16.439 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) is stopping
2020-01-10 17:29:16.540 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) has exited
2020-01-10 17:29:16.540 [ERR] SRVR: Unable to retrieve advertised address for node 022deadbeefbadbabedec0def00d: no advertised addresses found
2020-01-10 17:29:21.437 [INF] SRVR: New inbound connection from THEIR_IP:46567
2020-01-10 17:29:21.437 [INF] SRVR: Finalizing connection to 022deadbeefbadbabedec0def00d@THEIR_IP:46567, inbound=true
2020-01-10 17:29:21.475 [INF] PEER: NodeKey(022deadbeefbadbabedec0def00d) loading ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:29:21.476 [DBG] CNCT: New ChainEventSubscription(id=2) for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:29:21.476 [INF] HSWC: Removing channel link with ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-10 17:29:21.476 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) is starting
2020-01-10 17:29:21.476 [INF] HSWC: Trimming open circuits for chan_id=612220:666:0, start_htlc_id=0
2020-01-10 17:29:21.476 [INF] HSWC: Adding live link chan_id=4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d, short_chan_id=612220:666:0
2020-01-10 17:29:21.476 [INF] CNCT: Attempting to update ContractSignals for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:29:21.476 [INF] HSWC: HTLC manager for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) started, bandwidth=0 mSAT
2020-01-10 17:29:21.476 [INF] HSWC: Attempting to re-resynchronize ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:29:21.476 [INF] SRVR: Negotiated chan series queries with 022deadbeefbadbabedec0def00d
2020-01-10 17:29:21.476 [INF] DISC: Creating new GossipSyncer for peer=022deadbeefbadbabedec0def00d
2020-01-10 17:29:21.506 [INF] HSWC: Received re-establishment message from remote side for channel(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
---
{seconds later payment going through}
---
2020-01-10 17:32:14.837 [INF] NTFN: New block: height=612223, sha=0000000000000000000452f8c65e876777e9ce7fc9ea5cd87b8fe5e70256bbb7
---
2020-01-10 17:32:14.838 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=612223) examining active HTLC's
---
2020-01-10 17:32:14.862 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): checking chain actions at height=612223
---
2020-01-10 17:36:05.306 [INF] CRTR: Processed channels=0 updates=85 nodes=4 in last 59.999904965s
2020-01-10 17:36:09.242 [INF] PEER: unable to read message from 022deadbeefbadbabedec0def00d@THEIR_IP:46567: read tcp MY_IP:9735->THEIR_IP:46567: read: connection reset by peer
2020-01-10 17:36:09.242 [INF] PEER: Disconnecting 022deadbeefbadbabedec0def00d@THEIR_IP:46567, reason: read handler closed
---
2020-01-10 17:36:09.443 [DBG] FNDG: Cancelling all reservations for peer 022deadbeefbadbabedec0def00d
2020-01-10 17:36:09.443 [DBG] FNDG: No active reservations for node: 022deadbeefbadbabedec0def00d
2020-01-10 17:36:09.443 [INF] DISC: Removing GossipSyncer for peer=022deadbeefbadbabedec0def00d
2020-01-10 17:36:09.443 [INF] HSWC: Removing channel link with ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-10 17:36:09.443 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) is stopping
2020-01-10 17:36:09.545 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) has exited
2020-01-10 17:36:09.546 [ERR] SRVR: Unable to retrieve advertised address for node 022deadbeefbadbabedec0def00d: no advertised addresses found
2020-01-10 17:36:10.899 [INF] SRVR: New inbound connection from THEIR_IP:21542
2020-01-10 17:36:10.899 [INF] SRVR: Finalizing connection to 022deadbeefbadbabedec0def00d@THEIR_IP:21542, inbound=true
2020-01-10 17:36:10.931 [INF] PEER: NodeKey(022deadbeefbadbabedec0def00d) loading ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:36:10.933 [DBG] CNCT: New ChainEventSubscription(id=3) for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:36:10.933 [INF] HSWC: Removing channel link with ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-10 17:36:10.933 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) is starting
2020-01-10 17:36:10.933 [INF] HSWC: Trimming open circuits for chan_id=612220:666:0, start_htlc_id=0
2020-01-10 17:36:10.933 [INF] HSWC: Adding live link chan_id=4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d, short_chan_id=612220:666:0
2020-01-10 17:36:10.933 [INF] SRVR: Negotiated chan series queries with 022deadbeefbadbabedec0def00d
2020-01-10 17:36:10.933 [INF] DISC: Creating new GossipSyncer for peer=022deadbeefbadbabedec0def00d
2020-01-10 17:36:10.933 [INF] HSWC: HTLC manager for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) started, bandwidth=326624173 mSAT
2020-01-10 17:36:10.933 [INF] HSWC: Attempting to re-resynchronize ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:36:10.933 [INF] CNCT: Attempting to update ContractSignals for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:36:11.153 [INF] HSWC: Received re-establishment message from remote side for channel(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
---
2020-01-10 17:39:14.902 [INF] PEER: unable to read message from 022deadbeefbadbabedec0def00d@THEIR_IP:21542: EOF
2020-01-10 17:39:14.902 [INF] PEER: Disconnecting 022deadbeefbadbabedec0def00d@THEIR_IP:21542, reason: read handler closed
2020-01-10 17:39:15.102 [DBG] FNDG: Cancelling all reservations for peer 022deadbeefbadbabedec0def00d
2020-01-10 17:39:15.103 [DBG] FNDG: No active reservations for node: 022deadbeefbadbabedec0def00d
2020-01-10 17:39:15.103 [INF] DISC: Removing GossipSyncer for peer=022deadbeefbadbabedec0def00d
2020-01-10 17:39:15.103 [INF] HSWC: Removing channel link with ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-10 17:39:15.103 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) is stopping
2020-01-10 17:39:15.203 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) has exited
2020-01-10 17:39:15.203 [ERR] SRVR: Unable to retrieve advertised address for node 022deadbeefbadbabedec0def00d: no advertised addresses found
---
2020-01-10 17:39:27.012 [INF] SRVR: New inbound connection from THEIR_IP:46552
2020-01-10 17:39:27.012 [INF] SRVR: Finalizing connection to 022deadbeefbadbabedec0def00d@THEIR_IP:46552, inbound=true
2020-01-10 17:39:27.049 [INF] PEER: NodeKey(022deadbeefbadbabedec0def00d) loading ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:39:27.050 [DBG] CNCT: New ChainEventSubscription(id=4) for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:39:27.050 [INF] HSWC: Removing channel link with ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-10 17:39:27.051 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) is starting
2020-01-10 17:39:27.051 [INF] HSWC: Trimming open circuits for chan_id=612220:666:0, start_htlc_id=0
2020-01-10 17:39:27.051 [INF] HSWC: Adding live link chan_id=4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d, short_chan_id=612220:666:0
2020-01-10 17:39:27.051 [INF] CNCT: Attempting to update ContractSignals for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:39:27.051 [INF] HSWC: HTLC manager for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) started, bandwidth=326624173 mSAT
2020-01-10 17:39:27.051 [INF] HSWC: Attempting to re-resynchronize ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:39:27.051 [INF] SRVR: Negotiated chan series queries with 022deadbeefbadbabedec0def00d
2020-01-10 17:39:27.051 [INF] DISC: Creating new GossipSyncer for peer=022deadbeefbadbabedec0def00d
2020-01-10 17:39:27.247 [INF] HSWC: Received re-establishment message from remote side for channel(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
---
2020-01-10 17:40:13.474 [INF] PEER: unable to read message from 022deadbeefbadbabedec0def00d@THEIR_IP:46552: EOF
2020-01-10 17:40:13.474 [INF] PEER: Disconnecting 022deadbeefbadbabedec0def00d@THEIR_IP:46552, reason: read handler closed
2020-01-10 17:40:13.675 [DBG] FNDG: Cancelling all reservations for peer 022deadbeefbadbabedec0def00d
2020-01-10 17:40:13.675 [DBG] FNDG: No active reservations for node: 022deadbeefbadbabedec0def00d
2020-01-10 17:40:13.675 [INF] DISC: Removing GossipSyncer for peer=022deadbeefbadbabedec0def00d
2020-01-10 17:40:13.675 [INF] HSWC: Removing channel link with ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-10 17:40:13.675 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) is stopping
2020-01-10 17:40:13.775 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) has exited
2020-01-10 17:40:13.775 [ERR] SRVR: Unable to retrieve advertised address for node 022deadbeefbadbabedec0def00d: no advertised addresses found
---
2020-01-10 17:40:33.958 [INF] SRVR: New inbound connection from THEIR_IP:46567
2020-01-10 17:40:33.958 [INF] SRVR: Finalizing connection to 022deadbeefbadbabedec0def00d@THEIR_IP:46567, inbound=true
2020-01-10 17:40:33.997 [INF] PEER: NodeKey(022deadbeefbadbabedec0def00d) loading ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:40:33.999 [DBG] CNCT: New ChainEventSubscription(id=5) for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-10 17:40:33.999 [INF] HSWC: Removing channel link with ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-10 17:40:33.999 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) is starting
```

lnd logs after the restart:
```
2020-01-17 12:59:04.787 [INF] LTND: Active chain: Bitcoin (network=mainnet)
2020-01-17 12:59:05.553 [INF] CHDB: Checking for schema update: latest_version=11, db_version=11
2020-01-17 12:59:05.575 [INF] RPCS: password RPC server listening on 127.0.0.1:10009
2020-01-17 12:59:05.575 [INF] RPCS: password gRPC proxy started at 127.0.0.1:8080
2020-01-17 12:59:05.575 [INF] LTND: Waiting for wallet encryption password. Use `lncli create` to create a wallet, `lncli unlock` to unlock an existing wallet, or `lncli changepassword` to change the password of an existing wallet and unlock it.
2020-01-17 12:59:12.540 [INF] LNWL: Opened wallet
2020-01-17 12:59:12.687 [INF] LTND: Primary chain is set to: bitcoin
2020-01-17 12:59:12.724 [INF] LTND: Initializing bitcoind backed fee estimator
2020-01-17 12:59:12.724 [INF] LNWL: Started listening for bitcoind transaction notifications via ZMQ on 127.0.0.1:18333
2020-01-17 12:59:12.724 [INF] LNWL: Started listening for bitcoind block notifications via ZMQ on 127.0.0.1:18332
2020-01-17 12:59:13.524 [INF] LNWL: The wallet has been unlocked without a time limit
2020-01-17 12:59:13.530 [INF] LTND: LightningWallet opened
2020-01-17 12:59:13.534 [INF] HSWC: Restoring in-memory circuit state from disk
2020-01-17 12:59:13.713 [INF] HSWC: Payment circuits loaded: num_pending=1071, num_open=223
---
2020-01-17 12:59:21.058 [DBG] CNCT: New ChainEventSubscription(id=0) for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-17 12:59:21.058 [INF] NTFN: New block epoch subscription
---
2020-01-17 12:59:21.608 [DBG] CNCT: Starting chain watcher for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
---
2020-01-17 12:59:21.953 [INF] NTFN: New spend subscription: spend_id=280, outpoint=7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0, script=0 97e97dbe45fcc7269749d1a4ac1b46ac62aa8ad8bf87a70be3ecbda1efc50aa0, height_hint=613269
2020-01-17 12:59:21.953 [INF] NTFN: Dispatching historical spend rescan for outpoint=7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0, script=0 97e97dbe45fcc7269749d1a4ac1b46ac62aa8ad8bf87a70be3ecbda1efc50aa0, start=613269, end=613270
---
2020-01-17 12:59:25.256 [INF] CNCT: Close observer for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) active
---
2020-01-17 12:59:30.443 [DBG] CNCT: Starting ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0), htlc_set=(map[contractcourt.HtlcSetKey]contractcourt.htlcSet) (len=2) {
 (contractcourt.HtlcSetKey) LocalHtlcSet: (contractcourt.htlcSet) {
  incomingHTLCs: (map[uint64]channeldb.HTLC) {
  },
  outgoingHTLCs: (map[uint64]channeldb.HTLC) {
  }
 },
 (contractcourt.HtlcSetKey) RemoteHtlcSet: (contractcourt.htlcSet) {
  incomingHTLCs: (map[uint64]channeldb.HTLC) {
  },
  outgoingHTLCs: (map[uint64]channeldb.HTLC) {
  }
 }
}

2020-01-17 12:59:30.443 [INF] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): starting state=StateDefault
---
2020-01-17 12:59:30.443 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=613270) examining active HTLC's
2020-01-17 12:59:30.443 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): checking chain actions at height=613270
---
2020-01-17 12:59:30.443 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=613270) examining active HTLC's
2020-01-17 12:59:30.444 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): checking chain actions at height=613270
---
 (contractcourt.HtlcSetKey) LocalHtlcSet: (contractcourt.htlcSet) {
  incomingHTLCs: (map[uint64]channeldb.HTLC) {
  },
  outgoingHTLCs: (map[uint64]channeldb.HTLC) {
  }
 },
 (contractcourt.HtlcSetKey) RemoteHtlcSet: (contractcourt.htlcSet) {
  incomingHTLCs: (map[uint64]channeldb.HTLC) {
  },
  outgoingHTLCs: (map[uint64]channeldb.HTLC) {
  }
 }
}
---
2020-01-17 12:59:31.513 [INF] DISC: Authenticated Gossiper is starting
2020-01-17 12:59:31.513 [INF] BRAR: Starting contract observer, watching for breaches.
2020-01-17 12:59:31.513 [INF] NTFN: New block epoch subscription
2020-01-17 12:59:31.515 [INF] CRTR: FilteredChainView starting
2020-01-17 12:59:31.696 [INF] CRTR: Filtering chain using 34336 channels active
2020-01-17 12:59:31.698 [INF] CRTR: Prune tip for Channel Graph: height=613269, hash=00000000000000000000fa61663ababba45bd0de40787d969e9f331bdfb7bb3e
2020-01-17 12:59:31.698 [INF] CRTR: Syncing channel graph from height=613269 (hash=00000000000000000000fa61663ababba45bd0de40787d969e9f331bdfb7bb3e) to height=613270 (hash=00000000000000000004ae25b73518e32de4e73f21c12605b373f000658ae107)
2020-01-17 12:59:31.805 [INF] CRTR: Graph pruning complete: 1 channels were closed since height 613269
2020-01-17 12:59:31.817 [TRC] FNDG: Funding manager running
2020-01-17 12:59:31.818 [INF] DISC: Retransmitting 1 outgoing channels
2020-01-17 12:59:32.789 [TRC] FNDG: Loading pending ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0), creating chan barrier
---
2020-01-17 12:59:33.126 [INF] NTFN: New block epoch subscription
2020-01-17 12:59:33.126 [INF] NTFN: New confirmation subscription: conf_id=1, txid=7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26, num_confs=3 height_hint=612220
---
2020-01-17 12:59:33.290 [INF] FNDG: Waiting for funding tx (7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26) to reach 3 confirmations
---
2020-01-17 12:59:33.347 [INF] NTFN: Dispatching 3 confirmation notification for txid=7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26
---
2020-01-17 12:59:33.347 [INF] FNDG: ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) is now active: ChannelID(7a5fe432d38f6cba1181b87562b306d2dbeff2daf9d5695a016714d7161e3f4199d381c23f98861610a9647cbcfb7eca5ccbaa94814481ebf6506a6441cee917)
2020-01-17 12:59:33.347 [DBG] FNDG: ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) is now fully confirmed! (shortChanID=612220:666:0)
2020-01-17 12:59:33.347 [INF] NTFN: Cancelling epoch notification, epoch_id=666
2020-01-17 12:59:33.392 [ERR] FNDG: unable to report short chan id: link 4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d not found
2020-01-17 12:59:33.395 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0 has opening state 0
2020-01-17 12:59:33.603 [INF] CHBU: Starting chanbackup.SubSwapper
2020-01-17 12:59:33.603 [INF] BTCN: Server listening on [::]:9735
---
2020-01-17 12:59:34.468 [INF] SRVR: New inbound connection from THEIR_IP:56146
2020-01-17 12:59:34.469 [INF] SRVR: Finalizing connection to 022deadbeefbadbabedec0def00d@THEIR_IP:56146, inbound=true
---
2020-01-17 12:59:34.480 [INF] PEER: NodeKey(022deadbeefbadbabedec0def00d) loading ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
---
2020-01-17 12:59:34.607 [DBG] CNCT: New ChainEventSubscription(id=1) for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
---
2020-01-17 12:59:34.800 [INF] HSWC: Removing channel link with ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
---
2020-01-17 12:59:34.842 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) is starting
2020-01-17 12:59:34.842 [INF] HSWC: Trimming open circuits for chan_id=612220:666:0, start_htlc_id=0
---
2020-01-17 12:59:34.842 [INF] CNCT: Attempting to update ContractSignals for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
---
2020-01-17 12:59:34.842 [INF] HSWC: Adding live link chan_id=4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d, short_chan_id=612220:666:0
2020-01-17 12:59:34.842 [INF] HSWC: ChannelLink(37436e2ae4b4935516bc5bea0db5a078395c6d1917fe46bd83beda3e700542f0:1) is starting
2020-01-17 12:59:34.842 [INF] FNDG: Peer(022deadbeefbadbabedec0def00d) is online, sending FundingLocked for ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
---
2020-01-17 12:59:34.842 [INF] HSWC: HTLC manager for ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) started, bandwidth=413306128 mSAT
2020-01-17 12:59:34.884 [INF] HSWC: Attempting to re-resynchronize ChannelPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
2020-01-17 12:59:34.842 [INF] SRVR: Negotiated chan series queries with 022deadbeefbadbabedec0def00d
2020-01-17 12:59:34.884 [INF] DISC: Creating new GossipSyncer for peer=022deadbeefbadbabedec0def00d
---
2020-01-17 12:59:34.885 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0: successfully sent FundingLocked
2020-01-17 12:59:34.885 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0 has opening state 1
---
2020-01-17 12:59:34.885 [INF] HSWC: Received re-establishment message from remote side for channel(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0)
---
2020-01-17 12:59:35.527 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0: successfully added to router graph
2020-01-17 12:59:35.528 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0 has opening state 2
2020-01-17 12:59:35.528 [DBG] FNDG: Will not announce private channel 654986535166168551.
2020-01-17 12:59:35.528 [DBG] FNDG: Sending our NodeAnnouncement for ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) to 022deadbeefbadbabedec0def00d
2020-01-17 12:59:35.528 [DBG] FNDG: Channel(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d) with ShortChanID 612220:666:0: successfully announced
2020-01-17 12:59:35.528 [DBG] FNDG: ChannlPoint(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) with chanID=[134 177 157 55 252 41 223 179 254 176 70 58 131 144 244 254 11 240 2 47 252 210 115 120 208 229 204 200 66 176 243 207] not found in opening database, assuming already announced to the network
---
2020-01-17 13:01:33.182 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=613271) examining active HTLC's
---
2020-01-17 13:01:33.406 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): checking chain actions at height=613271
---
2020-01-17 13:03:15.585 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=613272) examining active HTLC's
---
2020-01-17 13:03:15.613 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): checking chain actions at height=613272
---
2020-01-17 13:05:03.168 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=613273) examining active HTLC's
---
2020-01-17 13:05:03.192 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): checking chain actions at height=613273
---
2020-01-17 13:09:09.838 [INF] PEER: unable to read message from 022deadbeefbadbabedec0def00d@THEIR_IP:56146: read tcp MY_IP:9735->THEIR_IP:56146: read: connection reset by peer
2020-01-17 13:09:09.838 [INF] PEER: Disconnecting 022deadbeefbadbabedec0def00d@THEIR_IP:56146, reason: read handler closed
2020-01-17 13:09:10.038 [DBG] FNDG: Cancelling all reservations for peer 022deadbeefbadbabedec0def00d
2020-01-17 13:09:10.038 [DBG] FNDG: No active reservations for node: 022deadbeefbadbabedec0def00d
2020-01-17 13:09:10.039 [INF] DISC: Removing GossipSyncer for peer=022deadbeefbadbabedec0def00d
2020-01-17 13:09:10.039 [INF] HSWC: Removing channel link with ChannelID(4f0d70f9618fc82e4f77f23f74878778c04ae054ad49918806b90246a537387d)
2020-01-17 13:09:10.039 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) is stopping
2020-01-17 13:09:10.139 [INF] HSWC: ChannelLink(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0) has exited
---
2020-01-17 13:11:37.102 [INF] CRTR: Pruning channel graph using block 00000000000000000006c92d87467fb3882c4566c8913523d1897a5b18ae10c7 (height=613274)
2020-01-17 13:11:37.119 [INF] CRTR: Block 00000000000000000006c92d87467fb3882c4566c8913523d1897a5b18ae10c7 (height=613274) closed 0 channels
---
2020-01-17 13:11:37.194 [INF] NTFN: New block: height=613274, sha=00000000000000000006c92d87467fb3882c4566c8913523d1897a5b18ae10c7
---
2020-01-17 13:11:37.195 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): new block (height=613274) examining active HTLC's
2020-01-17 13:11:37.195 [DBG] CNCT: ChannelArbitrator(7148ecd503ed7fa018175eb5deb890425a117311f4bb7fe2d86d3b2db5323f26:0): checking chain actions at height=613274
```

### Expected behaviour

Channel should have been marked as active and shown on the listchannels command.

### Actual behaviour

Channel wasn't marked as active. It wasn't showing on the listchannels. Yet it forwarded payments while in seemingly pending state.

The QueryRoutesRequest parameter `last_hop_pubkey` introduced in https://github.com/lightningnetwork/lnd/pull/3911/files#diff-f6ec8c0f52caccfaec5656028d316c7fR2059 does not match the name pattern used for other parameters (`pub_key` and `source_pub_key`). If possible, rename to `last_hop_pub_key`.


Long term, we'd like to support use cases such as #3585 that allow more secure signing within `lnd` itself. As is today, we have the interfaces in the `keychain` package, as well as the `Signer` which already abstract away things like key derivation and signing. However, in several areas we use [this method to obtain a _raw_ private key for direct manipulation](https://github.com/lightningnetwork/lnd/blob/master/keychain/derivation.go#L179). This is clearly incompatible with something like a hardware wallet, which aims to protect against all types of key exfiltration. Therefore, to support more secure signing, we need to _remove_ all usages of that method, reducing the number of total method in the `SecretKeyRing` interface to one. 

For more details w.r.t our long-term plan to support more secure signing, [please see this post on the lnd-dev mailing list](https://groups.google.com/a/lightning.engineering/d/msg/lnd/3rF65UxvDtM/ktDLAGtlAQAJ). 

We'll need to remove raw private key handling from the following areas:

# Steps To Completion 

- [ ] The brontide handshake. Currently we pass the entire private key into the brontide state machine. However, it can get by with simply being able to perform an ECDH against our long-tern static identity key. From there on, it can carry out the remainder of the handshake using this resulting state, as well as the ephemeral key it generates for the handshake. The current [SecretKeyChain](https://github.com/lightningnetwork/lnd/blob/master/keychain/derivation.go#L170) interface already has a [ScalarMult](https://github.com/lightningnetwork/lnd/blob/master/keychain/derivation.go#L186) method which is meant to be used for ECDH, so we have that base covered already.

- [ ] The watch tower's brontide handshake. Same thing as the above, just uses a distinct key for any created watch towers.

- [ ] SCB blob encryption/decryption. When creating the SCB format, we didn't want to require that some future external singing abstraction had to be aware of the encryption scheme we used. As a result, we ended up obtaining the raw private key, and using that directly for encryption/decryption. Instead, we can start to use the ECDH method from the SecretKeyRing interface to obtain a new shared secret which is then used directly. We can bump the SCB version (the Multi specifically) to handle the transition from the old to the new format.
Since we started to phase out our usage of the `GossipTimestamp` field, propagation of new channel updates, and especially node announcements has suffered. Before the change a node upon connection would receive all the prior updates within the last 24 hours or so. When nodes connect now, they only typically receive updates of channels and node announcements related to new channels created since they were offline. 

There's an extension to the current extended gossip query feature planned to addresses this, namely being able to query for node announcement s independent of any channels. However, we can implement something much simpler that'll address the core issue until that has been widely rolled out in the network. 

At a high level, this issue proposes that we keep a cache of any sort of announcements that _we recently_ generated, and send all new connected peers that cache independent of any other items that we queried. This serves to ensure that we send all nodes our current updates for propagation, without overhelhimg them with all the other updates not related to our node. 

# Steps to Completion 

- [ ] Every-time we send the gossiper a new set of `ChannelUpdates` to query for, we should add the updates to a new _set_ that never shrinks. Similarly, we should also had a set of any new `NodeAnnouncements` as well. 

- [ ] Upon start up, when we update our _on disk_ node announcement with the latest details pulled from the configuration, we should also send this to the gossiper to add to its cache. 

- [ ] Each time a new peer connections, we should send it all the items in the cache. 



Fixes #3919 
With this PR we crank down the scrypt options used by the `btcwallet` to speed up unit tests, especially when running with the race detector.

Results on my machine **before** the change (run with `go clean -testcache && go test ./keychain -race && go test ./walletunlocker -race`):
```
ok      github.com/lightningnetwork/lnd/keychain        150.092s
ok      github.com/lightningnetwork/lnd/walletunlocker  123.689s
```
**After** the change:
```
ok      github.com/lightningnetwork/lnd/keychain        3.834s
ok      github.com/lightningnetwork/lnd/walletunlocker  6.728s
```

If the provided ChainHash in a QueryChannelRange message does not match that of our current chain, then we should send a blank response, rather than reply with channels for the wrong chain.

Fixes https://github.com/lightningnetwork/lnd/issues/3921.
This PR modifies the `aezeed`, `macaroons` and `lnwallet/btcwallet` packages to use fast scrypt options when compiled with the itest build tag to speed up the node creation/startup in the integration tests.
### Background

I opened two channels a few days ago then I closed them normally via the cli using `closechannel`. Both of them are stuck in `pending_force_closing_channels` but I did not force close them. Unfortunately now all my btc is stuck. This is for mainnet. 

```
    "pending_force_closing_channels": [
        {
            "channel": {
                "remote_node_pub": "020e56a13babec99abdc2c4afbe34e1e44230d79b234c059fd4ff1e367765fdb1b",
                "channel_point": "3dd317535b21fee66912860017d70e2cba79588b094d1c41d24206649238cf35:1",
                "capacity": "16777215",
                "local_balance": "16773742",
                "remote_balance": "0",
                "local_chan_reserve_sat": "0",
                "remote_chan_reserve_sat": "0"
            },
            "closing_txid": "d14b171932754fbd8644a85d3f0da77a62dfccb25cb86a7357b6429cd60dd426",
            "limbo_balance": "16773742",
            "maturity_height": 615234,
            "blocks_til_maturity": 1976,
            "recovered_balance": "0",
            "pending_htlcs": [
            ]
        },
        {
            "channel": {
                "remote_node_pub": "02ad6fb8d693dc1e4569bcedefadf5f72a931ae027dc0f0c544b34c1c6f3b9a02b",
                "channel_point": "769d2d197126d2e16cab80850490e97611c2dcc68b2791c9e72cfcf915fe6a82:1",
                "capacity": "13068664",
                "local_balance": "13052263",
                "remote_balance": "0",
                "local_chan_reserve_sat": "0",
                "remote_chan_reserve_sat": "0"
            },
            "closing_txid": "e4de8e3022eb07f00a865d89f5be7b24aae4ecbc48424bcb973c3e3825635688",
            "limbo_balance": "13060036",
            "maturity_height": 614629,
            "blocks_til_maturity": 1371,
            "recovered_balance": "0",
            "pending_htlcs": [
                {
                    "incoming": false,
                    "amount": "7773",
                    "outpoint": "965366e67f9ce459b9575056af6772d79e9be74ace36347c99b823e17ab1d788:0",
                    "maturity_height": 614630,
                    "blocks_til_maturity": 1372,
                    "stage": 2
                }
            ]
        }
    ],
```


### Your environment

* lnd version `Version: 0.9.0-beta commit=v0.9.0-beta-rc2, build=production, logging=default`
* OS:`Linux 3.10.0-957.12.2.el7.x86_64 #1 SMP Tue May 14 21:24:32 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux` (CentOS)
* `bitcoind` `190001`

### Steps to reproduce

* Open a channel
* Run closechannel

### Expected behaviour

* Channel should close normally?

### Actual behaviour

* Channels got stuck in this `pending_force_closing_channels` state

### Log files

Here is the log file when I start the lnd node with `--debuglevel=LNWL=trace,CNCT=trace,FNDG=trace,UTXN=trace` 
[lnd.log](https://github.com/lightningnetwork/lnd/files/4076573/lnd.log)

### Background

If you send a QueryChannelRange message to an LND node with an incorrect (or arbitrary) chain_hash, the LND reply does not appear to respect the requested chain_hash resulting in invalid data in the reply. The ReplyChannelRange message includes short_channel_id information that belongs to the chain that the LND node is executing under instead of one requested in the query message. It also sends a completion flag of 0x1 that indicates that the message was correctly handled and all information has been sent.

The specification states that it should return a completion flag of 0x0 when the chain_hash is not supported by the existing node.

This is not an issue with replies to QueryShortChannelIds. It looks like the `GossipSyncer` code found in `replyShortChanIDs` has a chain_hash guard. https://github.com/lightningnetwork/lnd/blob/master/discovery/syncer.go#L1022

I would expect a similar guard to be in the the `replyChanRangeQuery` method.

### Your environment

* lnd version 0.8.2-beta commit=queue/v1.0.2-214-g658803f51c056fadbc3700708a963c11cb1a5269
* macOS 10.14.6

### Steps to reproduce

This was part of testing for a project I'm working on that was sending gossip traffic to lightning nodes.  I'm not sure of the best way to send/receive raw message using the LND code base. Probably easiest with a unit test on GossipSyncer.  

The message traffic looked like:

query_channel_range (sent to LND)
```
010711111111111111111111111111111111111111111111111111111111111111110018df30000003e8

---
0107 - type (263)
1111111111111111111111111111111111111111111111111111111111111111 - arbitrary chain_hash 
0018df30 - first_blocknum (1630000)
000003e8 - number_of_blocks (1000)
```

reply_channel_range (received from LND)
```
010811111111111111111111111111111111111111111111111111111111111111110018df30000003e80100090018e05c0000010000

---
0108 - type (264)
1111111111111111111111111111111111111111111111111111111111111111 - arbitrary chain_hash
0018df30 - first_blocknum (1630000)
000003e8 - number_of_blocks (1000)
01 - completed (true)
0009 - bytes (9)
00 - encoding (raw)
18e05c0000010000 - short_channel_id (1630300x1x0)
```

### Expected behaviour

Expected a reply with 0x0 completion flag and no short_channel_ids. 

### Actual behaviour

Message above with invalid data from data from Bitcoin testnet instead of the arbitrary chain_hash 1111111111111111111111111111111111111111111111111111111111111111.
