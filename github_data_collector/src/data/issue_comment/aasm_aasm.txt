**Is your feature request related to a problem? Please describe.**
In our project's UI we would like states to look different depending on who is logged in. For example, for user A, the "pending" state should appear as "Pending manager review" and for user B, it should appear as "Pending peer review".

**Describe the solution you'd like**
We would like to be able to use I18n translation interpolation to solve this, e.g. calling 
```
MyClass.aasm(:status).human_name(reviewer: 'peer')
```
given the translation:
```
status/pending: "Pending %{reviewer} review"
```
should return "Pending peer review"

**Describe alternatives you've considered**
For now I am using the much longer and less elegant:
```
MyClass.human_attribute_name("status/#{my_class.aasm(:status).name}")
```

It seems like this addition would be appropriate to me, but maybe I'm missing something?






Here is everything you need to know about this upgrade. Please take a good look at what changed and the test results before merging this pull request.

### What changed?

#### ✳️ rails (5.1.4 → 6.0.2.1) · [Repo](https://github.com/rails/rails)

<details>
<summary>Release Notes</summary>
<h4><a href="https://github.com/rails/rails/releases/tag/v6.0.2.1">6.0.2.1</a></h4>

<blockquote><h2>Active Support</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Model</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Record</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action View</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Pack</h2>
<ul>
<li>
<p>Fix possible information leak / session hijacking vulnerability.</p>
<p>The <code>ActionDispatch::Session::MemcacheStore</code> is still vulnerable given it requires the<br>
gem dalli to be updated as well.</p>
<p><a href="https://bounce.depfu.com/github.com/advisories/GHSA-hrqr-hxpp-chr3">CVE-2019-16782</a>.</p>
</li>
</ul>
<h2>Active Job</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Mailer</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Cable</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Storage</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Mailbox</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Text</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Railties</h2>
<ul>
<li>No changes.</li>
</ul></blockquote>
<h4><a href="https://github.com/rails/rails/releases/tag/v6.0.2">6.0.2</a></h4>

<blockquote><h2>Active Support</h2>
<ul>
<li>
<p>Eager load translations during initialization.</p>
<p><em>Diego Plentz</em></p>
</li>
<li>
<p>Use per-thread CPU time clock on <code>ActiveSupport::Notifications</code>.</p>
<p><em>George Claghorn</em></p>
</li>
</ul>
<h2>Active Model</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Record</h2>
<ul>
<li>
<p>Share the same connection pool for primary and replica databases in the<br>
transactional tests for the same database.</p>
<p><em>Edouard Chin</em></p>
</li>
<li>
<p>Fix the preloader when one record is fetched using <code>after_initialize</code><br>
but not the entire collection.</p>
<p><em>Bradley Price</em></p>
</li>
<li>
<p>Fix collection callbacks not terminating when <code>:abort</code> is thrown.</p>
<p><em>Edouard Chin</em>, <em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Correctly deprecate <code>where.not</code> working as NOR for relations.</p>
<p><a href="https://bounce.depfu.com/github.com/rails/rails/commit/12a9664ff60f0e2712fd1f79f8dbec06e2f004a2"><tt>12a9664</tt></a> deprecated where.not working as NOR, however<br>
doing a relation query like <code>where.not(relation: { ... })</code><br>
wouldn't be properly deprecated and <code>where.not</code> would work as<br>
NAND instead.</p>
<p><em>Edouard Chin</em></p>
</li>
<li>
<p>Fix <code>db:migrate</code> task with multiple databases to restore the connection<br>
to the previous database.</p>
<p>The migrate task iterates and establish a connection over each db<br>
resulting in the last one to be used by subsequent rake tasks.<br>
We should reestablish a connection to the connection that was<br>
established before the migrate tasks was run</p>
<p><em>Edouard Chin</em></p>
</li>
<li>
<p>Fix multi-threaded issue for <code>AcceptanceValidator</code>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
</ul>
<h2>Action View</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Pack</h2>
<ul>
<li>
<p>Allow using mountable engine route helpers in System Tests.</p>
<p><em>Chalo Fernandez</em></p>
</li>
</ul>
<h2>Active Job</h2>
<ul>
<li>
<p>Allow Sidekiq access to the underlying job class.</p>
<p>By having access to the Active Job class, Sidekiq can get access to any <code>sidekiq_options</code> which<br>
have been set on that Active Job type and serialize those options into Redis.</p>
<p><a href="https://bounce.depfu.com/github.com/mperham/sidekiq/blob/master/Changes.md#60">https://github.com/mperham/sidekiq/blob/master/Changes.md#60</a></p>
<p><em>Mike Perham</em></p>
</li>
</ul>
<h2>Action Mailer</h2>
<ul>
<li>
<p>Fix ActionMailer assertions don't work for parameterized mail with legacy delivery job.</p>
<p><em>bogdanvlviv</em></p>
</li>
</ul>
<h2>Action Cable</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Storage</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Mailbox</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Text</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Railties</h2>
<ul>
<li>
<p>Fix the collision check for the scaffold generator.</p>
<p><em>Ryan Robeson</em></p>
</li>
</ul></blockquote>
<h4><a href="https://github.com/rails/rails/releases/tag/v6.0.1">6.0.1</a></h4>

<blockquote><h2>Active Support</h2>
<ul>
<li>
<p><code>ActiveSupport::SafeBuffer</code> supports <code>Enumerator</code> methods.</p>
<p><em>Shugo Maeda</em></p>
</li>
<li>
<p>The Redis cache store fails gracefully when the server returns a "max number of clients reached" error.</p>
<p><em>Brandon Medenwald</em></p>
</li>
<li>
<p>Fixed that mutating a value returned by a memory cache store would unexpectedly change the cached value.</p>
<p><em>Jonathan Hyman</em></p>
</li>
<li>
<p>The default inflectors in <code>zeitwerk</code> mode support overrides:</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-c"><span class="pl-c">#</span> config/initializers/zeitwerk.rb</span>
<span class="pl-c1">Rails</span>.autoloaders.each <span class="pl-k">do</span> |<span class="pl-smi">autoloader</span>|
  autoloader.inflector.inflect(
    <span class="pl-s"><span class="pl-pds">"</span>html_parser<span class="pl-pds">"</span></span> =&gt; <span class="pl-s"><span class="pl-pds">"</span>HTMLParser<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>ssl_error<span class="pl-pds">"</span></span>   =&gt; <span class="pl-s"><span class="pl-pds">"</span>SSLError<span class="pl-pds">"</span></span>
  )
<span class="pl-k">end</span></pre></div>
<p>That way, you can tweak how individual basenames are inflected without touching Active Support inflection rules, which are global. These inflectors fallback to <code>String#camelize</code>, so existing inflection rules are still taken into account for non-overridden basenames.</p>
<p>Please, check the <a href="https://guides.rubyonrails.org/v6.0/autoloading_and_reloading_constants.html#customizing-inflections">autoloading guide for <code>zeitwerk</code> mode</a> if you prefer not to depend on <code>String#camelize</code> at all.</p>
<p><em>Xavier Noria</em></p>
</li>
<li>
<p>Improve <code>Range#===</code>, <code>Range#include?</code>, and <code>Range#cover?</code> to work with beginless (startless) and endless range targets.</p>
<p><em>Allen Hsu</em>, <em>Andrew Hodgkinson</em></p>
</li>
<li>
<p>Don't use <code>Process#clock_gettime(CLOCK_PROCESS_CPUTIME_ID)</code> on Solaris</p>
<p><em>Iain Beeston</em></p>
</li>
</ul>
<h2>Active Model</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Record</h2>
<ul>
<li>
<p>Common Table Expressions are allowed on read-only connections.</p>
<p><em>Chris Morris</em></p>
</li>
<li>
<p>New record instantiation respects <code>unscope</code>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fixed a case where <code>find_in_batches</code> could halt too early.</p>
<p><em>Takayuki Nakata</em></p>
</li>
<li>
<p>Autosaved associations always perform validations when a custom validation context is used.</p>
<p><em>Tekin Suleyman</em></p>
</li>
<li>
<p><code>sql.active_record</code> notifications now include the <code>:connection</code> in their payloads.</p>
<p><em>Eugene Kenny</em></p>
</li>
<li>
<p>A rollback encountered in an <code>after_commit</code> callback does not reset previously-committed record state.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fixed that join order was lost when eager-loading.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p><code>DESCRIBE</code> queries are allowed on read-only connections.</p>
<p><em>Dylan Thacker-Smith</em></p>
</li>
<li>
<p>Fixed that records that had been <code>inspect</code>ed could not be marshaled.</p>
<p><em>Eugene Kenny</em></p>
</li>
<li>
<p>The connection pool reaper thread is respawned in forked processes. This fixes that idle connections in forked processes wouldn't be reaped.</p>
<p><em>John Hawthorn</em></p>
</li>
<li>
<p>The memoized result of <code>ActiveRecord::Relation#take</code> is properly cleared when <code>ActiveRecord::Relation#reset</code> or <code>ActiveRecord::Relation#reload</code> is called.</p>
<p><em>Anmol Arora</em></p>
</li>
<li>
<p>Fixed the performance regression for <code>primary_keys</code> introduced MySQL 8.0.</p>
<p><em>Hiroyuki Ishii</em></p>
</li>
<li>
<p><code>insert</code>, <code>insert_all</code>, <code>upsert</code>, and <code>upsert_all</code> now clear the query cache.</p>
<p><em>Eugene Kenny</em></p>
</li>
<li>
<p>Call <code>while_preventing_writes</code> directly from <code>connected_to</code>.</p>
<p>In some cases application authors want to use the database switching middleware and make explicit calls with <code>connected_to</code>. It's possible for an app to turn off writes and not turn them back on by the time we call <code>connected_to(role: :writing)</code>.</p>
<p>This change allows apps to fix this by assuming if a role is writing we want to allow writes, except in the case it's explicitly turned off.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Improve detection of ActiveRecord::StatementTimeout with mysql2 adapter in the edge case when the query is terminated during filesort.</p>
<p><em>Kir Shatrov</em></p>
</li>
</ul>
<h2>Action View</h2>
<ul>
<li>
<p>UJS avoids <code>Element.closest()</code> for IE 9 compatibility.</p>
<p><em>George Claghorn</em></p>
</li>
</ul>
<h2>Action Pack</h2>
<ul>
<li>
<p><code>ActionDispatch::SystemTestCase</code> now inherits from <code>ActiveSupport::TestCase</code> rather than <code>ActionDispatch::IntegrationTest</code>. This permits running jobs in system tests.</p>
<p><em>George Claghorn</em>, <em>Edouard Chin</em></p>
</li>
<li>
<p>Registered MIME types may contain extra flags:</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-c1">Mime</span>::<span class="pl-c1">Type</span>.register <span class="pl-s"><span class="pl-pds">"</span>text/html; fragment<span class="pl-pds">"</span></span>, <span class="pl-c1">:html_fragment</span></pre></div>
<p><em>Aaron Patterson</em></p>
</li>
</ul>
<h2>Active Job</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Mailer</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Cable</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Storage</h2>
<ul>
<li>
<p><code>ActiveStorage::AnalyzeJob</code>s are discarded on <code>ActiveRecord::RecordNotFound</code> errors.</p>
<p><em>George Claghorn</em></p>
</li>
<li>
<p>Blobs are recorded in the database before being uploaded to the service. This fixes that generated blob keys could silently collide, leading to data loss.</p>
<p><em>Julik Tarkhanov</em></p>
</li>
</ul>
<h2>Action Mailbox</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Text</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Railties</h2>
<ul>
<li>
<p>The <code>zeitwerk:check</code> Rake task reports files outside the app's root directory, as in engines loaded from gems.</p>
<p><em>Xavier Noria</em></p>
</li>
<li>
<p>Fixed a possible error when using the evented file update checker.</p>
<p><em>Yuji Yaginuma</em></p>
</li>
<li>
<p>The sqlite3 database files created by the parallel testing feature are included in the default <code>.gitignore</code> file for newly-generated apps.</p>
<p><em>Yasuo Honda</em></p>
</li>
<li>
<p><code>rails new</code> generates a <code>.keep</code> file in <code>tmp/pids</code>. This fixes starting a server via <code>rackup</code> instead of <code>rails server</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
</ul></blockquote>
<h4><a href="https://github.com/rails/rails/releases/tag/v5.2.4.1">5.2.4.1</a></h4>

<blockquote><h2>Active Support</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Model</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Record</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action View</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Pack</h2>
<ul>
<li>
<p>Fix possible information leak / session hijacking vulnerability.</p>
<p>The <code>ActionDispatch::Session::MemcacheStore</code> is still vulnerable given it requires the<br>
gem dalli to be updated as well.</p>
<p><a href="https://bounce.depfu.com/github.com/advisories/GHSA-hrqr-hxpp-chr3">CVE-2019-16782</a>.</p>
</li>
</ul>
<h2>Active Job</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Mailer</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Cable</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Storage</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Railties</h2>
<ul>
<li>No changes.</li>
</ul></blockquote>
<h4><a href="https://github.com/rails/rails/releases/tag/v5.2.4">5.2.4</a></h4>

<blockquote><h2>Active Support</h2>
<ul>
<li>
<p>Make ActiveSupport::Logger Fiber-safe. Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/36752">#36752</a>.</p>
<p>Use <code>Fiber.current.__id__</code> in <code>ActiveSupport::Logger#local_level=</code> in order<br>
to make log level local to Ruby Fibers in addition to Threads.</p>
<p>Example:</p>
<pre><code>logger = ActiveSupport::Logger.new(STDOUT)
logger.level = 1
p "Main is debug? #{logger.debug?}"

Fiber.new {
  logger.local_level = 0
  p "Thread is debug? #{logger.debug?}"
}.resume

p "Main is debug? #{logger.debug?}"
</code></pre>
<p>Before:</p>
<pre><code>Main is debug? false
Thread is debug? true
Main is debug? true
</code></pre>
<p>After:</p>
<pre><code>Main is debug? false
Thread is debug? true
Main is debug? false
</code></pre>
<p><em>Alexander Varnin</em></p>
</li>
</ul>
<h2>Active Model</h2>
<ul>
<li>
<p>Type cast falsy boolean symbols on boolean attribute as false.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/35676">#35676</a>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
</ul>
<h2>Active Record</h2>
<ul>
<li>
<p>Fix circular <code>autosave: true</code> causes invalid records to be saved.</p>
<p>Prior to the fix, when there was a circular series of <code>autosave: true</code><br>
associations, the callback for a <code>has_many</code> association was run while<br>
another instance of the same callback on the same association hadn't<br>
finished running. When control returned to the first instance of the<br>
callback, the instance variable had changed, and subsequent associated<br>
records weren't saved correctly. Specifically, the ID field for the<br>
<code>belongs_to</code> corresponding to the <code>has_many</code> was <code>nil</code>.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/28080">#28080</a>.</p>
<p><em>Larry Reid</em></p>
</li>
<li>
<p>PostgreSQL: Fix GROUP BY with ORDER BY virtual count attribute.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/36022">#36022</a>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix sqlite3 collation parsing when using decimal columns.</p>
<p><em>Martin R. Schuster</em></p>
</li>
<li>
<p>Make ActiveRecord <code>ConnectionPool.connections</code> method thread-safe.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/36465">#36465</a>.</p>
<p><em>Jeff Doering</em></p>
</li>
<li>
<p>Assign all attributes before calling <code>build</code> to ensure the child record is visible in<br>
<code>before_add</code> and <code>after_add</code> callbacks for <code>has_many :through</code> associations.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/33249">#33249</a>.</p>
<p><em>Ryan H. Kerr</em></p>
</li>
</ul>
<h2>Action View</h2>
<ul>
<li>
<p>Allow programmatic click events to trigger Rails UJS click handlers.<br>
Programmatic click events (eg. ones generated by <code>Rails.fire(link, "click")</code>) don't specify a button. These events were being incorrectly stopped by code meant to ignore scroll wheel and right clicks introduced in <a href="https://bounce.depfu.com/github.com/rails/rails/pull/34573">#34573</a>.</p>
<p><em>Sudara Williams</em></p>
</li>
</ul>
<h2>Action Pack</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Job</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Mailer</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Cable</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Storage</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Railties</h2>
<ul>
<li>
<p>Use original <code>bundler</code> environment variables during the process of generating a new rails project.</p>
<p><em>Marco Costa</em></p>
</li>
<li>
<p>Allow loading seeds without ActiveJob.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/35782">#35782</a></p>
<p><em>Jeremy Weathers</em></p>
</li>
<li>
<p>Only force <code>:async</code> ActiveJob adapter to <code>:inline</code> during seeding.</p>
<p><em>BatedUrGonnaDie</em></p>
</li>
</ul></blockquote>
<h4><a href="https://github.com/rails/rails/releases/tag/v5.2.3">5.2.3</a></h4>

<blockquote><h2>Active Support</h2>
<ul>
<li>
<p>Add <code>ActiveSupport::HashWithIndifferentAccess#assoc</code>.</p>
<p><code>assoc</code> can now be called with either a string or a symbol.</p>
<p><em>Stefan Schüßler</em></p>
</li>
<li>
<p>Fix <code>String#safe_constantize</code> throwing a <code>LoadError</code> for incorrectly cased constant references.</p>
<p><em>Keenan Brock</em></p>
</li>
<li>
<p>Allow Range#=== and Range#cover? on Range</p>
<p><code>Range#cover?</code> can now accept a range argument like <code>Range#include?</code> and<br>
<code>Range#===</code>. <code>Range#===</code> works correctly on Ruby 2.6. <code>Range#include?</code> is moved<br>
into a new file, with these two methods.</p>
<p><em>utilum</em></p>
</li>
<li>
<p>If the same block is <code>included</code> multiple times for a Concern, an exception is no longer raised.</p>
<p><em>Mark J. Titorenko</em>, <em>Vlad Bokov</em></p>
</li>
</ul>
<h2>Active Model</h2>
<ul>
<li>
<p>Fix date value when casting a multiparameter date hash to not convert<br>
from Gregorian date to Julian date.</p>
<p>Before:</p>
<pre><code>Day.new({"day(1i)"=&gt;"1", "day(2i)"=&gt;"1", "day(3i)"=&gt;"1"})
=&gt; #&lt;Day id: nil, day: "0001-01-03", created_at: nil, updated_at: nil&gt;
</code></pre>
<p>After:</p>
<pre><code>Day.new({"day(1i)"=&gt;"1", "day(2i)"=&gt;"1", "day(3i)"=&gt;"1"})
=&gt; #&lt;Day id: nil, day: "0001-01-01", created_at: nil, updated_at: nil&gt;
</code></pre>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/28521">#28521</a>.</p>
<p><em>Sayan Chakraborty</em></p>
</li>
<li>
<p>Fix numericality equality validation of <code>BigDecimal</code> and <code>Float</code><br>
by casting to <code>BigDecimal</code> on both ends of the validation.</p>
<p><em>Gannon McGibbon</em></p>
</li>
</ul>
<h2>Active Record</h2>
<ul>
<li>
<p>Fix different <code>count</code> calculation when using <code>size</code> with manual <code>select</code> with DISTINCT.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/35214">#35214</a>.</p>
<p><em>Juani Villarejo</em></p>
</li>
<li>
<p>Fix prepared statements caching to be enabled even when query caching is enabled.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Don't allow <code>where</code> with invalid value matches to nil values.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/33624">#33624</a>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Restore an ability that class level <code>update</code> without giving ids.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/34743">#34743</a>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix join table column quoting with SQLite.</p>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Ensure that <code>delete_all</code> on collection proxy returns affected count.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Reset scope after delete on collection association to clear stale offsets of removed records.</p>
<p><em>Gannon McGibbon</em></p>
</li>
</ul>
<h2>Action View</h2>
<ul>
<li>
<p>Prevent non-primary mouse keys from triggering Rails UJS click handlers.<br>
Firefox fires click events even if the click was triggered by non-primary mouse keys such as right- or scroll-wheel-clicks.<br>
For example, right-clicking a link such as the one described below (with an underlying ajax request registered on click) should not cause that request to occur.</p>
<pre><code>&lt;%= link_to 'Remote', remote_path, class: 'remote', remote: true, data: { type: :json } %&gt;
</code></pre>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/34541">#34541</a></p>
<p><em>Wolfgang Hobmaier</em></p>
</li>
</ul>
<h2>Action Pack</h2>
<ul>
<li>
<p>Allow using combine the Cache Control <code>public</code> and <code>no-cache</code> headers.</p>
<p>Before this change, even if <code>public</code> was specified for Cache Control header,<br>
it was excluded when <code>no-cache</code> was included. This fixed to keep <code>public</code><br>
header as is.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/34780">#34780</a>.</p>
<p><em>Yuji Yaginuma</em></p>
</li>
<li>
<p>Allow <code>nil</code> params for <code>ActionController::TestCase</code>.</p>
<p><em>Ryo Nakamura</em></p>
</li>
</ul>
<h2>Active Job</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Mailer</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Cable</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Storage</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Railties</h2>
<ul>
<li>
<p>Seed database with inline ActiveJob job adapter.</p>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Fix boolean interaction in scaffold system tests.</p>
<p><em>Gannon McGibbon</em></p>
</li>
</ul></blockquote>
<h4><a href="https://github.com/rails/rails/releases/tag/v5.2.2">5.2.2</a></h4>

<blockquote><h2>Active Support</h2>
<ul>
<li>
<p>Fix bug where <code>#to_options</code> for <code>ActiveSupport::HashWithIndifferentAccess</code><br>
would not act as alias for <code>#symbolize_keys</code>.</p>
<p><em>Nick Weiland</em></p>
</li>
<li>
<p>Improve the logic that detects non-autoloaded constants.</p>
<p><em>Jan Habermann</em>, <em>Xavier Noria</em></p>
</li>
<li>
<p>Fix bug where <code>URI.unescape</code> would fail with mixed Unicode/escaped character input:</p>
<pre><code>URI.unescape("\xe3\x83\x90")  # =&gt; "バ"
URI.unescape("%E3%83%90")  # =&gt; "バ"
URI.unescape("\xe3\x83\x90%E3%83%90")  # =&gt; Encoding::CompatibilityError
</code></pre>
<p><em>Ashe Connor</em>, <em>Aaron Patterson</em></p>
</li>
</ul>
<h2>Active Model</h2>
<ul>
<li>
<p>Fix numericality validator to still use value before type cast except Active Record.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/33651">#33651</a>, <a href="https://bounce.depfu.com/github.com/rails/rails/issues/33686">#33686</a>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
</ul>
<h2>Active Record</h2>
<ul>
<li>
<p>Do not ignore the scoping with query methods in the scope block.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Allow aliased attributes to be used in <code>#update_columns</code> and <code>#update</code>.</p>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Allow spaces in postgres table names.</p>
<p>Fixes issue where "user post" is misinterpreted as ""user"."post"" when quoting table names with the postgres<br>
adapter.</p>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Cached columns_hash fields should be excluded from ResultSet#column_types</p>
<p>PR <a href="https://bounce.depfu.com/github.com/rails/rails/pull/34528">#34528</a> addresses the inconsistent behaviour when attribute is defined for an ignored column. The following test<br>
was passing for SQLite and MySQL, but failed for PostgreSQL:</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">DeveloperName<span class="pl-e"> &lt; ActiveRecord::Type::String</span></span>
  <span class="pl-k">def</span> <span class="pl-en">deserialize</span>(<span class="pl-smi">value</span>)
    <span class="pl-s"><span class="pl-pds">"</span>Developer: <span class="pl-pse">#{</span><span class="pl-s1">value</span><span class="pl-pse">}</span><span class="pl-pds">"</span></span>
  <span class="pl-k">end</span>
<span class="pl-k">end</span>

<span class="pl-k">class</span> <span class="pl-en">AttributedDeveloper<span class="pl-e"> &lt; ActiveRecord::Base</span></span>
  <span class="pl-c1">self</span>.table_name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>developers<span class="pl-pds">"</span></span>

  attribute <span class="pl-c1">:name</span>, <span class="pl-c1">DeveloperName</span>.<span class="pl-k">new</span>

  <span class="pl-c1">self</span>.ignored_columns <span class="pl-k">+=</span> [<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>]
<span class="pl-k">end</span>

developer <span class="pl-k">=</span> <span class="pl-c1">AttributedDeveloper</span>.create
developer.update_column <span class="pl-c1">:name</span>, <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>

loaded_developer <span class="pl-k">=</span> <span class="pl-c1">AttributedDeveloper</span>.where(<span class="pl-c1">id:</span> developer.id).<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">"</span>*<span class="pl-pds">"</span></span>).first
<span class="pl-c1">puts</span> loaded_developer.name <span class="pl-c"><span class="pl-c">#</span> should be "Developer: name" but it's just "name"</span></pre></div>
<p><em>Dmitry Tsepelev</em></p>
</li>
<li>
<p>Values of enum are frozen, raising an error when attempting to modify them.</p>
<p><em>Emmanuel Byrd</em></p>
</li>
<li>
<p><code>update_columns</code> now correctly raises <code>ActiveModel::MissingAttributeError</code><br>
if the attribute does not exist.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Do not use prepared statement in queries that have a large number of binds.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix query cache to load before first request.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Fix collection cache key with limit and custom select to avoid ambiguous timestamp column error.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/33056">#33056</a>.</p>
<p><em>Federico Martinez</em></p>
</li>
<li>
<p>Fix duplicated record creation when using nested attributes with <code>create_with</code>.</p>
<p><em>Darwin Wu</em></p>
</li>
<li>
<p>Fix regression setting children record in parent <code>before_save</code> callback.</p>
<p><em>Guo Xiang Tan</em></p>
</li>
<li>
<p>Prevent leaking of user's DB credentials on <code>rails db:create</code> failure.</p>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>Clear mutation tracker before continuing the around callbacks.</p>
<p><em>Yuya Tanaka</em></p>
</li>
<li>
<p>Prevent deadlocks when waiting for connection from pool.</p>
<p><em>Brent Wheeldon</em></p>
</li>
<li>
<p>Avoid extra scoping when using <code>Relation#update</code> that was causing this method to change the current scope.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix numericality validator not to be affected by custom getter.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix bulk change table ignores comment option on PostgreSQL.</p>
<p><em>Yoshiyuki Kinjo</em></p>
</li>
</ul>
<h2>Action View</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Pack</h2>
<ul>
<li>
<p>Reset Capybara sessions if failed system test screenshot raising an exception.</p>
<p>Reset Capybara sessions if <code>take_failed_screenshot</code> raise exception<br>
in system test <code>after_teardown</code>.</p>
<p><em>Maxim Perepelitsa</em></p>
</li>
<li>
<p>Use request object for context if there's no controller</p>
<p>There is no controller instance when using a redirect route or a<br>
mounted rack application so pass the request object as the context<br>
when resolving dynamic CSP sources in this scenario.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/34200">#34200</a>.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Apply mapping to symbols returned from dynamic CSP sources</p>
<p>Previously if a dynamic source returned a symbol such as :self it<br>
would be converted to a string implicity, e.g:</p>
<pre><code>policy.default_src -&gt; { :self }
</code></pre>
<p>would generate the header:</p>
<pre><code>Content-Security-Policy: default-src self
</code></pre>
<p>and now it generates:</p>
<pre><code>Content-Security-Policy: default-src 'self'
</code></pre>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Fix <code>rails routes -c</code> for controller name consists of multiple word.</p>
<p><em>Yoshiyuki Kinjo</em></p>
</li>
<li>
<p>Call the <code>#redirect_to</code> block in controller context.</p>
<p><em>Steven Peckins</em></p>
</li>
</ul>
<h2>Active Job</h2>
<ul>
<li>
<p>Make sure <code>assert_enqueued_with()</code> &amp; <code>assert_performed_with()</code> work reliably with hash arguments.</p>
<p><em>Sharang Dashputre</em></p>
</li>
<li>
<p>Restore <code>ActionController::Parameters</code> support to <code>ActiveJob::Arguments.serialize</code>.</p>
<p><em>Bernie Chiu</em></p>
</li>
<li>
<p>Restore <code>HashWithIndifferentAccess</code> support to <code>ActiveJob::Arguments.deserialize</code>.</p>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Include deserialized arguments in job instances returned from<br>
<code>assert_enqueued_with</code> and <code>assert_performed_with</code></p>
<p><em>Alan Wu</em></p>
</li>
<li>
<p>Increment execution count before deserialize arguments.</p>
<p>Currently, the execution count increments after deserializes arguments.<br>
Therefore, if an error occurs with deserialize, it retries indefinitely.</p>
<p><em>Yuji Yaginuma</em></p>
</li>
</ul>
<h2>Action Mailer</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Cable</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Storage</h2>
<ul>
<li>
<p>Support multiple submit buttons in Active Storage forms.</p>
<p><em>Chrıs Seelus</em></p>
</li>
<li>
<p>Fix <code>ArgumentError</code> when uploading to amazon s3</p>
<p><em>Hiroki Sanpei</em></p>
</li>
<li>
<p>Add a foreign-key constraint to the <code>active_storage_attachments</code> table for blobs.</p>
<p><em>George Claghorn</em></p>
</li>
<li>
<p>Discard <code>ActiveStorage::PurgeJobs</code> for missing blobs.</p>
<p><em>George Claghorn</em></p>
</li>
<li>
<p>Fix uploading Tempfiles to Azure Storage.</p>
<p><em>George Claghorn</em></p>
</li>
</ul>
<h2>Railties</h2>
<ul>
<li>
<p>Disable content security policy for mailer previews.</p>
<p><em>Dylan Reile</em></p>
</li>
<li>
<p>Log the remote IP address of clients behind a proxy.</p>
<p><em>Atul Bhosale</em></p>
</li>
</ul></blockquote>
<h4><a href="https://github.com/rails/rails/releases/tag/v5.1.7">5.1.7</a></h4>

<blockquote><h2>Active Support</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Model</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Record</h2>
<ul>
<li>
<p>Fix <code>touch</code> option to behave consistently with <code>Persistence#touch</code> method.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Back port Rails 5.2 <code>reverse_order</code> Arel SQL literal fix.</p>
<p><em>Matt Jones</em>, <em>Brooke Kuhlmann</em></p>
</li>
<li>
<p><code>becomes</code> should clear the mutation tracker which is created in <code>after_initialize</code>.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/32867">#32867</a>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
</ul>
<h2>Action View</h2>
<ul>
<li>
<p>Fix issue with <code>button_to</code>'s <code>to_form_params</code></p>
<p><code>button_to</code> was throwing exception when invoked with <code>params</code> hash that<br>
contains symbol and string keys. The reason for the exception was that<br>
<code>to_form_params</code> was comparing the given symbol and string keys.</p>
<p>The issue is fixed by turning all keys to strings inside<br>
<code>to_form_params</code> before comparing them.</p>
<p><em>Georgi Georgiev</em></p>
</li>
</ul>
<h2>Action Pack</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Job</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Mailer</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Cable</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Railties</h2>
<ul>
<li>No changes.</li>
</ul></blockquote>
<p><em>Does any of this look wrong? <a href="https://depfu.com/packages/rubygem/rails/feedback">Please let us know.</a></em></p>
</details>

<details>
<summary>Commits</summary>
<p><a href="https://github.com/rails/rails/compare/813af4655f9bf3c712cf50205eebd337070cee52...f33d52c95217212cbacc8d5e44b5a8e3cdc6f5b3">See the full diff on Github</a>. The new version differs by more commits than we can show here.</p>
</details>






---
![Depfu Status](https://depfu.com/badges/d9ee9c670b9439fbe73b5e65573bc717/stats.svg)

[Depfu](https://depfu.com) will automatically keep this PR conflict-free, as long as you don't add any commits to this branch yourself. You can also trigger a rebase manually by commenting with `@depfu rebase`.

<details><summary>All Depfu comment commands</summary>
<blockquote><dl>
<dt>@​depfu rebase</dt><dd>Rebases against your default branch and redoes this update</dd>
<dt>@​depfu recreate</dt><dd>Recreates this PR, overwriting any edits that you've made to it</dd>
<dt>@​depfu merge</dt><dd>Merges this PR once your tests are passing and conflicts are resolved</dd>
<dt>@​depfu close</dt><dd>Closes this PR and deletes the branch</dd>
<dt>@​depfu reopen</dt><dd>Restores the branch and reopens this PR (if it's closed)</dd>
<dt>@​depfu pause</dt><dd>Ignores all future updates for this dependency and closes this PR</dd>
<dt>@​depfu pause [minor|major]</dt><dd>Ignores all future minor/major updates for this dependency and closes this PR</dd>
<dt>@​depfu resume</dt><dd>Future versions of this dependency will create PRs again (leaves this PR as is)</dd>
</dl></blockquote>
</details>







Here is everything you need to know about this upgrade. Please take a good look at what changed and the test results before merging this pull request.

### What changed?

#### ✳️ sqlite3 (~> 1.3.5 → ~> 1.4.2) · [Repo](https://github.com/sparklemotion/sqlite3-ruby) · [Changelog](https://github.com/sparklemotion/sqlite3-ruby/blob/master/CHANGELOG.rdoc)

<details>
<summary>Release Notes</summary>

<h4>1.4.2 (from changelog)</h4>
<blockquote><ul>
<li>
<p>Travis: Drop unused setting “sudo: false”</p>
</li>
<li>
<p>The taint mechanism will be deprecated in Ruby 2.7</p>
</li>
<li>
<p>Fix Ruby 2.7 rb_check_safe_obj warnings</p>
</li>
<li>
<p>Update travis config</p>
</li>
</ul></blockquote>
<p><em>Does any of this look wrong? <a href="https://depfu.com/packages/rubygem/sqlite3/feedback">Please let us know.</a></em></p>
</details>

<details>
<summary>Commits</summary>
<p><a href="https://github.com/sparklemotion/sqlite3-ruby/compare/f132bc59c2511cbc9947ec34fd694da583c65b86...a1407544d9be7845408a908db272d8cfdcf8bcd4">See the full diff on Github</a>. The new version differs by 7 commits:</p>

<ul>
<li><a href="https://github.com/sparklemotion/sqlite3-ruby/commit/a1407544d9be7845408a908db272d8cfdcf8bcd4"><code>Bumping version</code></a></li>
<li><a href="https://github.com/sparklemotion/sqlite3-ruby/commit/4038e8a05bc7860f7d2b0afe64466599964d4698"><code>Merge branch &#39;master&#39; of github.com:sparklemotion/sqlite3-ruby</code></a></li>
<li><a href="https://github.com/sparklemotion/sqlite3-ruby/commit/3a9d52fc578bd02af97682f63959a7e3b9a922a1"><code>Merge pull request #277 from casperisfine/remove_deprecated_taint-followup</code></a></li>
<li><a href="https://github.com/sparklemotion/sqlite3-ruby/commit/19d048647f42750b2a4ff5cc10d889f1f25d78c3"><code>Update travis config</code></a></li>
<li><a href="https://github.com/sparklemotion/sqlite3-ruby/commit/deb56f9a039fa713dad8c31af2fe5ea8e5ed0722"><code>Fix Ruby 2.7 rb_check_safe_obj warnings</code></a></li>
<li><a href="https://github.com/sparklemotion/sqlite3-ruby/commit/0894fba641890521403f54b0fe7645182b991035"><code>The taint mechanism will be deprecated in Ruby 2.7</code></a></li>
<li><a href="https://github.com/sparklemotion/sqlite3-ruby/commit/b6a9d731c2004d96e6b458c661d156b6a94a4f58"><code>Merge pull request #256 from olleolleolle/patch-1</code></a></li>
</ul>
</details>






---
![Depfu Status](https://depfu.com/badges/d9ee9c670b9439fbe73b5e65573bc717/stats.svg)

[Depfu](https://depfu.com) will automatically keep this PR conflict-free, as long as you don't add any commits to this branch yourself. You can also trigger a rebase manually by commenting with `@depfu rebase`.

<details><summary>All Depfu comment commands</summary>
<blockquote><dl>
<dt>@​depfu rebase</dt><dd>Rebases against your default branch and redoes this update</dd>
<dt>@​depfu recreate</dt><dd>Recreates this PR, overwriting any edits that you've made to it</dd>
<dt>@​depfu merge</dt><dd>Merges this PR once your tests are passing and conflicts are resolved</dd>
<dt>@​depfu close</dt><dd>Closes this PR and deletes the branch</dd>
<dt>@​depfu reopen</dt><dd>Restores the branch and reopens this PR (if it's closed)</dd>
<dt>@​depfu pause</dt><dd>Ignores all future updates for this dependency and closes this PR</dd>
<dt>@​depfu pause [minor|major]</dt><dd>Ignores all future minor/major updates for this dependency and closes this PR</dd>
<dt>@​depfu resume</dt><dd>Future versions of this dependency will create PRs again (leaves this PR as is)</dd>
</dl></blockquote>
</details>







Here is everything you need to know about this upgrade. Please take a good look at what changed and the test results before merging this pull request.

### What changed?

#### ✳️ rails (5.1.4 → 5.2.4.1) · [Repo](https://github.com/rails/rails)

<details>
<summary>Release Notes</summary>
<h4><a href="https://github.com/rails/rails/releases/tag/v5.2.4.1">5.2.4.1</a></h4>

<blockquote><h2>Active Support</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Model</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Record</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action View</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Pack</h2>
<ul>
<li>
<p>Fix possible information leak / session hijacking vulnerability.</p>
<p>The <code>ActionDispatch::Session::MemcacheStore</code> is still vulnerable given it requires the<br>
gem dalli to be updated as well.</p>
<p><a href="https://bounce.depfu.com/github.com/advisories/GHSA-hrqr-hxpp-chr3">CVE-2019-16782</a>.</p>
</li>
</ul>
<h2>Active Job</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Mailer</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Cable</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Storage</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Railties</h2>
<ul>
<li>No changes.</li>
</ul></blockquote>
<h4><a href="https://github.com/rails/rails/releases/tag/v5.2.4">5.2.4</a></h4>

<blockquote><h2>Active Support</h2>
<ul>
<li>
<p>Make ActiveSupport::Logger Fiber-safe. Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/36752">#36752</a>.</p>
<p>Use <code>Fiber.current.__id__</code> in <code>ActiveSupport::Logger#local_level=</code> in order<br>
to make log level local to Ruby Fibers in addition to Threads.</p>
<p>Example:</p>
<pre><code>logger = ActiveSupport::Logger.new(STDOUT)
logger.level = 1
p "Main is debug? #{logger.debug?}"

Fiber.new {
  logger.local_level = 0
  p "Thread is debug? #{logger.debug?}"
}.resume

p "Main is debug? #{logger.debug?}"
</code></pre>
<p>Before:</p>
<pre><code>Main is debug? false
Thread is debug? true
Main is debug? true
</code></pre>
<p>After:</p>
<pre><code>Main is debug? false
Thread is debug? true
Main is debug? false
</code></pre>
<p><em>Alexander Varnin</em></p>
</li>
</ul>
<h2>Active Model</h2>
<ul>
<li>
<p>Type cast falsy boolean symbols on boolean attribute as false.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/35676">#35676</a>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
</ul>
<h2>Active Record</h2>
<ul>
<li>
<p>Fix circular <code>autosave: true</code> causes invalid records to be saved.</p>
<p>Prior to the fix, when there was a circular series of <code>autosave: true</code><br>
associations, the callback for a <code>has_many</code> association was run while<br>
another instance of the same callback on the same association hadn't<br>
finished running. When control returned to the first instance of the<br>
callback, the instance variable had changed, and subsequent associated<br>
records weren't saved correctly. Specifically, the ID field for the<br>
<code>belongs_to</code> corresponding to the <code>has_many</code> was <code>nil</code>.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/28080">#28080</a>.</p>
<p><em>Larry Reid</em></p>
</li>
<li>
<p>PostgreSQL: Fix GROUP BY with ORDER BY virtual count attribute.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/36022">#36022</a>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix sqlite3 collation parsing when using decimal columns.</p>
<p><em>Martin R. Schuster</em></p>
</li>
<li>
<p>Make ActiveRecord <code>ConnectionPool.connections</code> method thread-safe.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/36465">#36465</a>.</p>
<p><em>Jeff Doering</em></p>
</li>
<li>
<p>Assign all attributes before calling <code>build</code> to ensure the child record is visible in<br>
<code>before_add</code> and <code>after_add</code> callbacks for <code>has_many :through</code> associations.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/33249">#33249</a>.</p>
<p><em>Ryan H. Kerr</em></p>
</li>
</ul>
<h2>Action View</h2>
<ul>
<li>
<p>Allow programmatic click events to trigger Rails UJS click handlers.<br>
Programmatic click events (eg. ones generated by <code>Rails.fire(link, "click")</code>) don't specify a button. These events were being incorrectly stopped by code meant to ignore scroll wheel and right clicks introduced in <a href="https://bounce.depfu.com/github.com/rails/rails/pull/34573">#34573</a>.</p>
<p><em>Sudara Williams</em></p>
</li>
</ul>
<h2>Action Pack</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Job</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Mailer</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Cable</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Storage</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Railties</h2>
<ul>
<li>
<p>Use original <code>bundler</code> environment variables during the process of generating a new rails project.</p>
<p><em>Marco Costa</em></p>
</li>
<li>
<p>Allow loading seeds without ActiveJob.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/35782">#35782</a></p>
<p><em>Jeremy Weathers</em></p>
</li>
<li>
<p>Only force <code>:async</code> ActiveJob adapter to <code>:inline</code> during seeding.</p>
<p><em>BatedUrGonnaDie</em></p>
</li>
</ul></blockquote>
<h4><a href="https://github.com/rails/rails/releases/tag/v5.2.3">5.2.3</a></h4>

<blockquote><h2>Active Support</h2>
<ul>
<li>
<p>Add <code>ActiveSupport::HashWithIndifferentAccess#assoc</code>.</p>
<p><code>assoc</code> can now be called with either a string or a symbol.</p>
<p><em>Stefan Schüßler</em></p>
</li>
<li>
<p>Fix <code>String#safe_constantize</code> throwing a <code>LoadError</code> for incorrectly cased constant references.</p>
<p><em>Keenan Brock</em></p>
</li>
<li>
<p>Allow Range#=== and Range#cover? on Range</p>
<p><code>Range#cover?</code> can now accept a range argument like <code>Range#include?</code> and<br>
<code>Range#===</code>. <code>Range#===</code> works correctly on Ruby 2.6. <code>Range#include?</code> is moved<br>
into a new file, with these two methods.</p>
<p><em>utilum</em></p>
</li>
<li>
<p>If the same block is <code>included</code> multiple times for a Concern, an exception is no longer raised.</p>
<p><em>Mark J. Titorenko</em>, <em>Vlad Bokov</em></p>
</li>
</ul>
<h2>Active Model</h2>
<ul>
<li>
<p>Fix date value when casting a multiparameter date hash to not convert<br>
from Gregorian date to Julian date.</p>
<p>Before:</p>
<pre><code>Day.new({"day(1i)"=&gt;"1", "day(2i)"=&gt;"1", "day(3i)"=&gt;"1"})
=&gt; #&lt;Day id: nil, day: "0001-01-03", created_at: nil, updated_at: nil&gt;
</code></pre>
<p>After:</p>
<pre><code>Day.new({"day(1i)"=&gt;"1", "day(2i)"=&gt;"1", "day(3i)"=&gt;"1"})
=&gt; #&lt;Day id: nil, day: "0001-01-01", created_at: nil, updated_at: nil&gt;
</code></pre>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/28521">#28521</a>.</p>
<p><em>Sayan Chakraborty</em></p>
</li>
<li>
<p>Fix numericality equality validation of <code>BigDecimal</code> and <code>Float</code><br>
by casting to <code>BigDecimal</code> on both ends of the validation.</p>
<p><em>Gannon McGibbon</em></p>
</li>
</ul>
<h2>Active Record</h2>
<ul>
<li>
<p>Fix different <code>count</code> calculation when using <code>size</code> with manual <code>select</code> with DISTINCT.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/35214">#35214</a>.</p>
<p><em>Juani Villarejo</em></p>
</li>
<li>
<p>Fix prepared statements caching to be enabled even when query caching is enabled.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Don't allow <code>where</code> with invalid value matches to nil values.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/33624">#33624</a>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Restore an ability that class level <code>update</code> without giving ids.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/34743">#34743</a>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix join table column quoting with SQLite.</p>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Ensure that <code>delete_all</code> on collection proxy returns affected count.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Reset scope after delete on collection association to clear stale offsets of removed records.</p>
<p><em>Gannon McGibbon</em></p>
</li>
</ul>
<h2>Action View</h2>
<ul>
<li>
<p>Prevent non-primary mouse keys from triggering Rails UJS click handlers.<br>
Firefox fires click events even if the click was triggered by non-primary mouse keys such as right- or scroll-wheel-clicks.<br>
For example, right-clicking a link such as the one described below (with an underlying ajax request registered on click) should not cause that request to occur.</p>
<pre><code>&lt;%= link_to 'Remote', remote_path, class: 'remote', remote: true, data: { type: :json } %&gt;
</code></pre>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/34541">#34541</a></p>
<p><em>Wolfgang Hobmaier</em></p>
</li>
</ul>
<h2>Action Pack</h2>
<ul>
<li>
<p>Allow using combine the Cache Control <code>public</code> and <code>no-cache</code> headers.</p>
<p>Before this change, even if <code>public</code> was specified for Cache Control header,<br>
it was excluded when <code>no-cache</code> was included. This fixed to keep <code>public</code><br>
header as is.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/34780">#34780</a>.</p>
<p><em>Yuji Yaginuma</em></p>
</li>
<li>
<p>Allow <code>nil</code> params for <code>ActionController::TestCase</code>.</p>
<p><em>Ryo Nakamura</em></p>
</li>
</ul>
<h2>Active Job</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Mailer</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Cable</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Storage</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Railties</h2>
<ul>
<li>
<p>Seed database with inline ActiveJob job adapter.</p>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Fix boolean interaction in scaffold system tests.</p>
<p><em>Gannon McGibbon</em></p>
</li>
</ul></blockquote>
<h4><a href="https://github.com/rails/rails/releases/tag/v5.2.2">5.2.2</a></h4>

<blockquote><h2>Active Support</h2>
<ul>
<li>
<p>Fix bug where <code>#to_options</code> for <code>ActiveSupport::HashWithIndifferentAccess</code><br>
would not act as alias for <code>#symbolize_keys</code>.</p>
<p><em>Nick Weiland</em></p>
</li>
<li>
<p>Improve the logic that detects non-autoloaded constants.</p>
<p><em>Jan Habermann</em>, <em>Xavier Noria</em></p>
</li>
<li>
<p>Fix bug where <code>URI.unescape</code> would fail with mixed Unicode/escaped character input:</p>
<pre><code>URI.unescape("\xe3\x83\x90")  # =&gt; "バ"
URI.unescape("%E3%83%90")  # =&gt; "バ"
URI.unescape("\xe3\x83\x90%E3%83%90")  # =&gt; Encoding::CompatibilityError
</code></pre>
<p><em>Ashe Connor</em>, <em>Aaron Patterson</em></p>
</li>
</ul>
<h2>Active Model</h2>
<ul>
<li>
<p>Fix numericality validator to still use value before type cast except Active Record.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/33651">#33651</a>, <a href="https://bounce.depfu.com/github.com/rails/rails/issues/33686">#33686</a>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
</ul>
<h2>Active Record</h2>
<ul>
<li>
<p>Do not ignore the scoping with query methods in the scope block.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Allow aliased attributes to be used in <code>#update_columns</code> and <code>#update</code>.</p>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Allow spaces in postgres table names.</p>
<p>Fixes issue where "user post" is misinterpreted as ""user"."post"" when quoting table names with the postgres<br>
adapter.</p>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Cached columns_hash fields should be excluded from ResultSet#column_types</p>
<p>PR <a href="https://bounce.depfu.com/github.com/rails/rails/pull/34528">#34528</a> addresses the inconsistent behaviour when attribute is defined for an ignored column. The following test<br>
was passing for SQLite and MySQL, but failed for PostgreSQL:</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">DeveloperName<span class="pl-e"> &lt; ActiveRecord::Type::String</span></span>
  <span class="pl-k">def</span> <span class="pl-en">deserialize</span>(<span class="pl-smi">value</span>)
    <span class="pl-s"><span class="pl-pds">"</span>Developer: <span class="pl-pse">#{</span><span class="pl-s1">value</span><span class="pl-pse">}</span><span class="pl-pds">"</span></span>
  <span class="pl-k">end</span>
<span class="pl-k">end</span>

<span class="pl-k">class</span> <span class="pl-en">AttributedDeveloper<span class="pl-e"> &lt; ActiveRecord::Base</span></span>
  <span class="pl-c1">self</span>.table_name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>developers<span class="pl-pds">"</span></span>

  attribute <span class="pl-c1">:name</span>, <span class="pl-c1">DeveloperName</span>.<span class="pl-k">new</span>

  <span class="pl-c1">self</span>.ignored_columns <span class="pl-k">+=</span> [<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>]
<span class="pl-k">end</span>

developer <span class="pl-k">=</span> <span class="pl-c1">AttributedDeveloper</span>.create
developer.update_column <span class="pl-c1">:name</span>, <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>

loaded_developer <span class="pl-k">=</span> <span class="pl-c1">AttributedDeveloper</span>.where(<span class="pl-c1">id:</span> developer.id).<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">"</span>*<span class="pl-pds">"</span></span>).first
<span class="pl-c1">puts</span> loaded_developer.name <span class="pl-c"><span class="pl-c">#</span> should be "Developer: name" but it's just "name"</span></pre></div>
<p><em>Dmitry Tsepelev</em></p>
</li>
<li>
<p>Values of enum are frozen, raising an error when attempting to modify them.</p>
<p><em>Emmanuel Byrd</em></p>
</li>
<li>
<p><code>update_columns</code> now correctly raises <code>ActiveModel::MissingAttributeError</code><br>
if the attribute does not exist.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Do not use prepared statement in queries that have a large number of binds.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix query cache to load before first request.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Fix collection cache key with limit and custom select to avoid ambiguous timestamp column error.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/33056">#33056</a>.</p>
<p><em>Federico Martinez</em></p>
</li>
<li>
<p>Fix duplicated record creation when using nested attributes with <code>create_with</code>.</p>
<p><em>Darwin Wu</em></p>
</li>
<li>
<p>Fix regression setting children record in parent <code>before_save</code> callback.</p>
<p><em>Guo Xiang Tan</em></p>
</li>
<li>
<p>Prevent leaking of user's DB credentials on <code>rails db:create</code> failure.</p>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>Clear mutation tracker before continuing the around callbacks.</p>
<p><em>Yuya Tanaka</em></p>
</li>
<li>
<p>Prevent deadlocks when waiting for connection from pool.</p>
<p><em>Brent Wheeldon</em></p>
</li>
<li>
<p>Avoid extra scoping when using <code>Relation#update</code> that was causing this method to change the current scope.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix numericality validator not to be affected by custom getter.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix bulk change table ignores comment option on PostgreSQL.</p>
<p><em>Yoshiyuki Kinjo</em></p>
</li>
</ul>
<h2>Action View</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Pack</h2>
<ul>
<li>
<p>Reset Capybara sessions if failed system test screenshot raising an exception.</p>
<p>Reset Capybara sessions if <code>take_failed_screenshot</code> raise exception<br>
in system test <code>after_teardown</code>.</p>
<p><em>Maxim Perepelitsa</em></p>
</li>
<li>
<p>Use request object for context if there's no controller</p>
<p>There is no controller instance when using a redirect route or a<br>
mounted rack application so pass the request object as the context<br>
when resolving dynamic CSP sources in this scenario.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/34200">#34200</a>.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Apply mapping to symbols returned from dynamic CSP sources</p>
<p>Previously if a dynamic source returned a symbol such as :self it<br>
would be converted to a string implicity, e.g:</p>
<pre><code>policy.default_src -&gt; { :self }
</code></pre>
<p>would generate the header:</p>
<pre><code>Content-Security-Policy: default-src self
</code></pre>
<p>and now it generates:</p>
<pre><code>Content-Security-Policy: default-src 'self'
</code></pre>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Fix <code>rails routes -c</code> for controller name consists of multiple word.</p>
<p><em>Yoshiyuki Kinjo</em></p>
</li>
<li>
<p>Call the <code>#redirect_to</code> block in controller context.</p>
<p><em>Steven Peckins</em></p>
</li>
</ul>
<h2>Active Job</h2>
<ul>
<li>
<p>Make sure <code>assert_enqueued_with()</code> &amp; <code>assert_performed_with()</code> work reliably with hash arguments.</p>
<p><em>Sharang Dashputre</em></p>
</li>
<li>
<p>Restore <code>ActionController::Parameters</code> support to <code>ActiveJob::Arguments.serialize</code>.</p>
<p><em>Bernie Chiu</em></p>
</li>
<li>
<p>Restore <code>HashWithIndifferentAccess</code> support to <code>ActiveJob::Arguments.deserialize</code>.</p>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Include deserialized arguments in job instances returned from<br>
<code>assert_enqueued_with</code> and <code>assert_performed_with</code></p>
<p><em>Alan Wu</em></p>
</li>
<li>
<p>Increment execution count before deserialize arguments.</p>
<p>Currently, the execution count increments after deserializes arguments.<br>
Therefore, if an error occurs with deserialize, it retries indefinitely.</p>
<p><em>Yuji Yaginuma</em></p>
</li>
</ul>
<h2>Action Mailer</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Cable</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Storage</h2>
<ul>
<li>
<p>Support multiple submit buttons in Active Storage forms.</p>
<p><em>Chrıs Seelus</em></p>
</li>
<li>
<p>Fix <code>ArgumentError</code> when uploading to amazon s3</p>
<p><em>Hiroki Sanpei</em></p>
</li>
<li>
<p>Add a foreign-key constraint to the <code>active_storage_attachments</code> table for blobs.</p>
<p><em>George Claghorn</em></p>
</li>
<li>
<p>Discard <code>ActiveStorage::PurgeJobs</code> for missing blobs.</p>
<p><em>George Claghorn</em></p>
</li>
<li>
<p>Fix uploading Tempfiles to Azure Storage.</p>
<p><em>George Claghorn</em></p>
</li>
</ul>
<h2>Railties</h2>
<ul>
<li>
<p>Disable content security policy for mailer previews.</p>
<p><em>Dylan Reile</em></p>
</li>
<li>
<p>Log the remote IP address of clients behind a proxy.</p>
<p><em>Atul Bhosale</em></p>
</li>
</ul></blockquote>
<h4><a href="https://github.com/rails/rails/releases/tag/v5.1.7">5.1.7</a></h4>

<blockquote><h2>Active Support</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Model</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Record</h2>
<ul>
<li>
<p>Fix <code>touch</code> option to behave consistently with <code>Persistence#touch</code> method.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Back port Rails 5.2 <code>reverse_order</code> Arel SQL literal fix.</p>
<p><em>Matt Jones</em>, <em>Brooke Kuhlmann</em></p>
</li>
<li>
<p><code>becomes</code> should clear the mutation tracker which is created in <code>after_initialize</code>.</p>
<p>Fixes <a href="https://bounce.depfu.com/github.com/rails/rails/issues/32867">#32867</a>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
</ul>
<h2>Action View</h2>
<ul>
<li>
<p>Fix issue with <code>button_to</code>'s <code>to_form_params</code></p>
<p><code>button_to</code> was throwing exception when invoked with <code>params</code> hash that<br>
contains symbol and string keys. The reason for the exception was that<br>
<code>to_form_params</code> was comparing the given symbol and string keys.</p>
<p>The issue is fixed by turning all keys to strings inside<br>
<code>to_form_params</code> before comparing them.</p>
<p><em>Georgi Georgiev</em></p>
</li>
</ul>
<h2>Action Pack</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Active Job</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Mailer</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Action Cable</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Railties</h2>
<ul>
<li>No changes.</li>
</ul></blockquote>
<p><em>Does any of this look wrong? <a href="https://depfu.com/packages/rubygem/rails/feedback">Please let us know.</a></em></p>
</details>

<details>
<summary>Commits</summary>
<p><a href="https://github.com/rails/rails/compare/813af4655f9bf3c712cf50205eebd337070cee52...ac30e389ecfa0e26e3d44c1eda8488ddf63b3ecc">See the full diff on Github</a>. The new version differs by more commits than we can show here.</p>
</details>






---
![Depfu Status](https://depfu.com/badges/d9ee9c670b9439fbe73b5e65573bc717/stats.svg)

[Depfu](https://depfu.com) will automatically keep this PR conflict-free, as long as you don't add any commits to this branch yourself. You can also trigger a rebase manually by commenting with `@depfu rebase`.

<details><summary>All Depfu comment commands</summary>
<blockquote><dl>
<dt>@​depfu rebase</dt><dd>Rebases against your default branch and redoes this update</dd>
<dt>@​depfu recreate</dt><dd>Recreates this PR, overwriting any edits that you've made to it</dd>
<dt>@​depfu merge</dt><dd>Merges this PR once your tests are passing and conflicts are resolved</dd>
<dt>@​depfu close</dt><dd>Closes this PR and deletes the branch</dd>
<dt>@​depfu reopen</dt><dd>Restores the branch and reopens this PR (if it's closed)</dd>
<dt>@​depfu pause</dt><dd>Ignores all future updates for this dependency and closes this PR</dd>
<dt>@​depfu pause [minor|major]</dt><dd>Ignores all future minor/major updates for this dependency and closes this PR</dd>
<dt>@​depfu resume</dt><dd>Future versions of this dependency will create PRs again (leaves this PR as is)</dd>
</dl></blockquote>
</details>


If suppose my application is in applied state, I need to make a hash where I should know that if I trigger hire, it should move to hired, or if I reject, it should move to rejected state.

So Need to compute execute hash like 
Application.first.aasm.permitted_transitions 
[{event: hire, state: hired}, {event: reject, state: rejected}] 

Hi,

I have some complex logic that is executed in an after callback after a transition. Depending on the outcome of that logic I'd like to trigger a completed or failed event. Is that something that is recommended or will I get to spaghetti callback hell?

Best

Sebastian
**The bug**

I am trying to upgrade from aasm version 5.0.1 to 5.0.6, however this is causing the following rspec model test to fail:

```ruby
describe '#reject' do
  subject { FactoryBot.create :order }
  let(:user) { FactoryBot.create :user }
  let(:params) { some: 'params' }

  it 'changes the state' do
    expect(subject).to receive :update_order
    expect{ subject.reject!(params, user) }.to change{ subject.state }.to 'rejected'
  end
end
```

I get the following error from rspec:

```
Failure/Error: expect{ subject.reject!(params, user) }.to change{ subject.state }.to 'rejected'
ArgumentError: Wrong number of arguments. Expected 0, got 2.
```

However, if I remove the line `expect(subject).to receive(:update_order)` the test passes.



**Additional context**

Gemfile:
```
gem 'rails', '~> 5.0.7'
gem 'aasm', '~> 5.0.6'
gem 'rspec-rails', '~> 3.9'
```

The test passes before upgrading from aasm 5.0.1 to 5.0.6.
When there is a default scope and an initial state on an aasm column, upon initialize it takes the scoped state as initial instead of the initial in the aasm state machine. Is it possible to override this behaviour and make the aasm initial as the default initial state?

I have certain places in my app where I have integrated with an external API. I have the following code
```
event :pause do
  before do
    integration.pause(self)
  end
  transitions from: :live, to: :paused
end
```

This makes an Api request to the service we have integrated with. When this is successful to saves a request log. However when it fails (say a 422), then my request log that is saved to the DB is rolled back.

How do I force these types of logs to be saved when there is a failed event? And if this is not possible what are the common ways people get around this sort of problem?

thanks
Fix for #618 

if an unknown event was fired:
- raise `AASM::UndefinedState` 
- don't trigger callbacks