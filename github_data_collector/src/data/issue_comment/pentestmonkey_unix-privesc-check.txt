
## The `./upc.sh --type all` command leads to the following output:

unix-privesc-check v2.1 ( http://code.google.com/p/unix-privesc-check )

lib/checks/enabled/all/credentials: ../../credentials: not found
./upc.sh: credentials_init: not found
./upc.sh: credentials_main: not found
./upc.sh: credentials_fini: not found
lib/checks/enabled/all/gpg_agent: ../../gpg_agent: not found
./upc.sh: gpg_agent_init: not found
./upc.sh: gpg_agent_main: not found
./upc.sh: gpg_agent_fini: not found
lib/checks/enabled/all/group_writable: ../../group_writable: not found
./upc.sh: group_writable_init: not found
./upc.sh: group_writable_main: not found
./upc.sh: group_writable_fini: not found
lib/checks/enabled/all/history_readable: ../../history_readable: not found
./upc.sh: history_readable_init: not found
./upc.sh: history_readable_main: not found
./upc.sh: history_readable_fini: not found
lib/checks/enabled/all/homedirs_executable: ../../homedirs_executable: not found
./upc.sh: homedirs_executable_init: not found
./upc.sh: homedirs_executable_main: not found
./upc.sh: homedirs_executable_fini: not found
lib/checks/enabled/all/homedirs_writable: ../../homedirs_writable: not found
./upc.sh: homedirs_writable_init: not found
./upc.sh: homedirs_writable_main: not found
./upc.sh: homedirs_writable_fini: not found
lib/checks/enabled/all/jar: ../../jar: not found
./upc.sh: jar_init: not found
./upc.sh: jar_main: not found
./upc.sh: jar_fini: not found
lib/checks/enabled/all/key_material: ../../key_material: not found
./upc.sh: key_material_init: not found
./upc.sh: key_material_main: not found
./upc.sh: key_material_fini: not found
lib/checks/enabled/all/passwd_hashes: ../../passwd_hashes: not found
./upc.sh: passwd_hashes_init: not found
./upc.sh: passwd_hashes_main: not found
./upc.sh: passwd_hashes_fini: not found
lib/checks/enabled/all/privileged_banned: ../../privileged_banned: not found
./upc.sh: privileged_banned_init: not found
./upc.sh: privileged_banned_main: not found
./upc.sh: privileged_banned_fini: not found
lib/checks/enabled/all/privileged_change_privileges: ../../privileged_change_privileges: not found
./upc.sh: privileged_change_privileges_init: not found
./upc.sh: privileged_change_privileges_main: not found
./upc.sh: privileged_change_privileges_fini: not found
lib/checks/enabled/all/privileged_chroot: ../../privileged_chroot: not found
./upc.sh: privileged_chroot_init: not found
./upc.sh: privileged_chroot_main: not found
./upc.sh: privileged_chroot_fini: not found
lib/checks/enabled/all/privileged_dependency: ../../privileged_dependency: not found
./upc.sh: privileged_dependency_init: not found
./upc.sh: privileged_dependency_main: not found
./upc.sh: privileged_dependency_fini: not found
lib/checks/enabled/all/privileged_nx: ../../privileged_nx: not found
./upc.sh: privileged_nx_init: not found
./upc.sh: privileged_nx_main: not found
./upc.sh: privileged_nx_fini: not found
lib/checks/enabled/all/privileged_path: ../../privileged_path: not found
./upc.sh: privileged_path_init: not found
./upc.sh: privileged_path_main: not found
./upc.sh: privileged_path_fini: not found
lib/checks/enabled/all/privileged_pie: ../../privileged_pie: not found
./upc.sh: privileged_pie_init: not found
./upc.sh: privileged_pie_main: not found
./upc.sh: privileged_pie_fini: not found
lib/checks/enabled/all/privileged_random: ../../privileged_random: not found
./upc.sh: privileged_random_init: not found
./upc.sh: privileged_random_main: not found
./upc.sh: privileged_random_fini: not found
lib/checks/enabled/all/privileged_relro: ../../privileged_relro: not found
./upc.sh: privileged_relro_init: not found
./upc.sh: privileged_relro_main: not found
./upc.sh: privileged_relro_fini: not found
lib/checks/enabled/all/privileged_rpath: ../../privileged_rpath: not found
./upc.sh: privileged_rpath_init: not found
./upc.sh: privileged_rpath_main: not found
./upc.sh: privileged_rpath_fini: not found
lib/checks/enabled/all/privileged_ssp: ../../privileged_ssp: not found
./upc.sh: privileged_ssp_init: not found
./upc.sh: privileged_ssp_main: not found
./upc.sh: privileged_ssp_fini: not found
lib/checks/enabled/all/privileged_tmp: ../../privileged_tmp: not found
./upc.sh: privileged_tmp_init: not found
./upc.sh: privileged_tmp_main: not found
./upc.sh: privileged_tmp_fini: not found
lib/checks/enabled/all/privileged_writable: ../../privileged_writable: not found
./upc.sh: privileged_writable_init: not found
./upc.sh: privileged_writable_main: not found
./upc.sh: privileged_writable_fini: not found
lib/checks/enabled/all/setgid: ../../setgid: not found
./upc.sh: setgid_init: not found
./upc.sh: setgid_main: not found
./upc.sh: setgid_fini: not found
lib/checks/enabled/all/setuid: ../../setuid: not found
./upc.sh: setuid_init: not found
./upc.sh: setuid_main: not found
./upc.sh: setuid_fini: not found
lib/checks/enabled/all/shadow_hashes: ../../shadow_hashes: not found
./upc.sh: shadow_hashes_init: not found
./upc.sh: shadow_hashes_main: not found
./upc.sh: shadow_hashes_fini: not found
lib/checks/enabled/all/ssh_agent: ../../ssh_agent: not found
./upc.sh: ssh_agent_init: not found
./upc.sh: ssh_agent_main: not found
./upc.sh: ssh_agent_fini: not found
lib/checks/enabled/all/ssh_key: ../../ssh_key: not found
./upc.sh: ssh_key_init: not found
./upc.sh: ssh_key_main: not found
./upc.sh: ssh_key_fini: not found
lib/checks/enabled/all/system_aslr: ../../system_aslr: not found
./upc.sh: system_aslr_init: not found
./upc.sh: system_aslr_main: not found
./upc.sh: system_aslr_fini: not found
lib/checks/enabled/all/system_configuration: ../../system_configuration: not found
./upc.sh: system_configuration_init: not found
./upc.sh: system_configuration_main: not found
./upc.sh: system_configuration_fini: not found
lib/checks/enabled/all/system_libraries: ../../system_libraries: not found
./upc.sh: system_libraries_init: not found
./upc.sh: system_libraries_main: not found
./upc.sh: system_libraries_fini: not found
lib/checks/enabled/all/system_mmap: ../../system_mmap: not found
./upc.sh: system_mmap_init: not found
./upc.sh: system_mmap_main: not found
./upc.sh: system_mmap_fini: not found
lib/checks/enabled/all/system_nx: ../../system_nx: not found
./upc.sh: system_nx_init: not found
./upc.sh: system_nx_main: not found
./upc.sh: system_nx_fini: not found
lib/checks/enabled/all/system_selinux: ../../system_selinux: not found
./upc.sh: system_selinux_init: not found
./upc.sh: system_selinux_main: not found
./upc.sh: system_selinux_fini: not found
lib/checks/enabled/all/world_writable: ../../world_writable: not found
./upc.sh: world_writable_init: not found
./upc.sh: world_writable_main: not found
./upc.sh: world_writable_fini: not found

```
I'm receiving syntax errors in some of the checks which use 
`binary_matches_string_grep`. For example, running a check from 
lib/checks/privileged_arguments manually:

 sh-4.3$ y="`binary_matches_string_grep \"/tmp/foo\" \"\$[\{]*[[:digit:]][\}]*\"`"
 sh: \{: syntax error: operand expected (error token is "\{")

Patch attached.

It seems to me that the privileged_environment_variables check will alert for 
any script using $-style variables, not necessarily environment variables. So, 
I'm a bit concerned as to how noisy it will be.
```

Original issue reported on code.google.com by `JJC...@googlemail.com` on 2 Mar 2015 at 11:53

Attachments:
- [binary_grep_syntax.diff](https://storage.googleapis.com/google-code-attachments/unix-privesc-check/issue-44/comment-0/binary_grep_syntax.diff)

```
I believe there are a couple of deficiencies in the current implementation of 
the privileged_writable check:

1. I think files writable by a low privileged owner should always be a warning, 
not just if YOU are the current owner. If I'm running the tool as the root user 
for auditing purposes then I want to know if a standard user owns a script 
they're permitted to run as root via sudo.

2. Furthermore, if a low privileged user owns a privileged file then it should 
be reported no matter what the current permissions are. This is because the 
owner can just set it to writable if necessary.

3. Similarly to (1), if an untrusted group can write to a privileged file then 
it should be a warning even if the current user isn't a member of the group.

The attached patch will make these changes. In it's current form it only trusts 
the user with ID zero and the main group of the user with ID zero. Hopefully 
this can be improved with configurable trusts in future, see #20.

I also modified some user and group utilities to support the changes:

* Implemented the group_is_root() function by checking against `id -g -n 0`
* Switched user_is_root() and user_is_user_root() to match other 
user_is_user_*() functions which check the current user rather than a supplied 
user.
* Implemented user_is_root()
```

Original issue reported on code.google.com by `JJC...@googlemail.com` on 25 Feb 2015 at 1:30

Attachments:
- [privileged_writable_logic.diff](https://storage.googleapis.com/google-code-attachments/unix-privesc-check/issue-43/comment-0/privileged_writable_logic.diff)

```
The first argument to printf is often passed directly from the sudoers file. 
This can cause problems because this file commonly contains % characters for 
group definitions. This is noted in the comment in lib/misc/sudo: "# FIXME this 
printf fails when the an entry starts with percentage character (%) which is 
common for sudoers group".

Fixed this by using a simple format string, "%s", as the first argument. In the 
particular case after the comment I also added a new line to the string to fix 
a bug which leaves the final sudoers entry unprocessed.

Similar fixes should be done throughout the code base, but I just targeted code 
affected by the sudoers file here (privileged_writable really).


```

Original issue reported on code.google.com by `JJC...@googlemail.com` on 24 Feb 2015 at 4:20

Attachments:
- [printf.diff](https://storage.googleapis.com/google-code-attachments/unix-privesc-check/issue-41/comment-0/printf.diff)

```

I can't see any mention of cron.d within the code, so I am assuming that the 
/etc/cron.d folder isn't inspected for Cron related issues.
```

Original issue reported on code.google.com by `a.ben.ca...@gmail.com` on 3 Dec 2014 at 10:36

```
Download unix-privsec-check version 1.4 and open the file with an editor.
Go to the line 498. 
-----------------------
world_can_read () {
    O_MESSAGE_STACK=$1
    O_FILE=$2

    P=`ls -lLd $O_FILE | cut -c 8`

    if [ "$P" = "w" ]; then
        echo "WARNING: $O_MESSAGE_STACK World read is set for $O_FILE"
    fi
}
------------
The world_can_read function check for the bit 'w' and not the bit 'r'. 
This is wrong, because in this function we are checking for world readable and 
not world writeable files or directories. 

Regards, 
R.
--
Roberto Martelloni \ boos
http://boos.core-dumped.info
```

Original issue reported on code.google.com by `rmartell...@gmail.com` on 21 Mar 2014 at 10:27

```
What steps will reproduce the problem?
1. chmod o+r /etc/shadow
2. run unix-privesc-check

Expect warning but nothing is noticed by tool but only following output I get:
############################################
Checking if /etc/shadow is readable
############################################
    Checking if anyone except root can read file /etc/shadow


unix-privesc-check 1.4
CentOS 5.10

```

Original issue reported on code.google.com by `ade...@gmail.com` on 12 Dec 2013 at 12:29

```
Add Samba library and security check (e.g. check permissions on AD file)
```

Original issue reported on code.google.com by `bernardo.damele` on 5 Nov 2012 at 3:35

```
Add Oracle library and security check
```

Original issue reported on code.google.com by `bernardo.damele` on 5 Nov 2012 at 3:33
