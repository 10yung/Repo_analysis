I've downloaded the standalone scripts for MNI to fsaverage projection. Can these be used to do the reverse, i.e., project data from fsaverage to MNI space?

Thanks, 
Marta


I am trying to help a researcher set up the CBIG-0.10.2-Schaefer2018_LocalGlobal repository on a server running Ubuntu 18.04.3.  I set up all of the paths for the required software libraries in a copy of the CBIG_gwMRF_tested_config.sh file.  (The researcher is primarily interested in the Schaeffer2018_LocalGlobal stable project.)

After following all of the steps in the README.md, I sourced my .bashrc and was confronted with warnings that all of the versions of the required software that were already installed on the researcher's local server were the incorrect ones:

```
Setting up environment for FreeSurfer/FS-FAST (and FSL)
FREESURFER_HOME   /usr/local/freesurfer
FSFAST_HOME       /usr/local/freesurfer/fsfast
FSF_OUTPUT_FORMAT nii.gz
SUBJECTS_DIR      /usr/local/freesurfer/subjects
MNI_DIR           /usr/local/freesurfer/mni
FSL_DIR           /usr/local/fsl
[WARNING]: This version of CBIG repository's default FREESURFER version is 5.3.0.
You appear to be using FREESURFER 6.0.0 (which may or may not work with current repo). Switch to FREESURFER version 5.3.0 if possible.
Note: stable projects may not follow default setting, refer to the proper config file of the project you use. 

[WARNING]: This version of CBIG repository's default FSL version is 5.0.8.
You appear to be using FSL 6.0.1 (which may or may not work with current repo). Switch to FSL version 5.0.8 if possible.
Note: stable projects may not follow default setting, refer to the proper config file of the project you use. 

[WARNING]: This version of CBIG repository's default WORKBENCH version is 1.1.1.
You appear to be using WORKBENCH 1.3.2 (which may or may not work with current repo). Switch to WORKBENCH version 1.1.1 if possible.
Note: stable projects may not follow default setting, refer to the proper config file of the project you use. 

[WARNING]: This version of CBIG repository's default AFNI version is AFNI_2011_12_21_1014.
You appear to be using AFNI AFNI_19.1.18 'Caligula' (which may or may not work with current repo). Switch to AFNI version AFNI_2011_12_21_1014 if possible.
Note: stable projects may not follow default setting, refer to the proper config file of the project you use. 

ln: failed to create symbolic link '/usr/local/CBIG-0.10.2-Schaefer2018_LocalGlobal/.git/hooks/pre-commit': No such file or directory
ln: failed to create symbolic link '/usr/local/CBIG-0.10.2-Schaefer2018_LocalGlobal/.git/hooks/pre-push': No such file or directory
```
Nowhere previously in any of the documentation do you specify which versions of these dependent softwares are required.  

Given that your tool has such specific requirements, have you considered making a singularity and/or docker container with the correct versions?  Or can I just safely ignore these warnings and continue with the newer versions of the dependent softwares?

Thanks,
suzanne


In step1: CBIG_MSHBM_generate_ini_params

An error occurred:
In an assignment  A(I) = B, the number of elements in B and I
must be the same.

When calling function CBIG_VonmisesSeriesClustering_fix_bessel_randnum_bsxfun
 (line 171: rh_s(l2) = s(length(l1)+1:end);)

My MATLAB version is R2014a in Linux and the data are in HCP format (dtseries.nii). 
I ran the function following the user guide and the first 2 scripts in step1 had already been finished without error.

How should I fix this error?

We are trying to release a few scripts to provide the network label with the network name. 
The only problem might be that the network structure could be very different if you are training from scratch on a different dataset. Here are two cases:

#### Use our estimated group priors to estimate individual parcellation
The group atlas will be utilized to initialize the algorithm, therefore, the network order in the individual parcellation will be the same as the group parcellation.
We provided two group priors which are generated by a group atlas estimated by GSP dataset in fsaverage5 space, and a group atlas estimated by HCP dataset in fsLR_32k space. 
I will provide these group atlases with corresponding network labels. 

#### Use your own data to train the model and estimate group priors
If you train on your own data, then your group atlas will be different from ours, the network ordering will also be different. In this way, you will have to run a Hungarian match algorithm to match the networks in your estimated group atlas with our atlases. 
To do that, you can use the following code:

1) If it's fsaverage5, you can directly use the following command to reorder the color table and visualize it:
```
my_par = load('<output_dir>/group/group.mat');
ref_par = load('/Kong2019_MSHBM/examples/results/estimate_group_priors/group/group.mat');
[output, assign, cost, dice_overlap] = CBIG_HungarianClusterMatch([ref_par.lh_labels; ref_par.rh_labels], [my_par.lh_labels; my_par.rh_labels], 1);
colors_old=ref_par.colors(2:end,:);
colors_new=colors_old(assign,:);
colors_new=[[0,0,0];color_new];
CBIG_DrawSurfaceMaps(my_par.lh_labels, my_par.rh_labels, 'fsaverage5', 'inflated',-Inf,Inf,colors_new);
```

2) If your data is in fslr, sorry, I didn't release the HCP group atlas in the current release (will do it asap), so contact me (roo.cone@gmail.com) to get the group atlas file `HCP_40sub_1000iter_17nets_cen_sm4.mat`.
```
my_par = load(fullfile(output_dir,'group','group.mat'));
ref_par = load('HCP_40sub_1000iter_17nets_cen_sm4.mat');
[output, assign, cost, dice_overlap] = CBIG_HungarianClusterMatch([ref_par.lh_labels; ref_par.rh_labels], [my_par.lh_labels; my_par.rh_labels], 1);
colors_old=ref_par.colors(2:end,:);
colors_new=colors_old(assign,:);
CBIG_DrawSurfaceMaps_fslr(my_par.lh_labels, my_par.rh_labels, 'fs_LR_32k', 'inflated',-Inf,Inf,colors_new);
```
I will try to release all above commands and other useful scripts later.


in stable_projects/brain_parcellation/Kong2019_MSHBM/step1_generate_profiles_and_ini_params

I am running the CBIG_MSHBM_generate_ini_params on my own dataset with 15 subjects, two runs per subject. The inputs are:
```
seed_mesh          = 'fs_LR_900';
targ_mesh           = 'fs_LR_32k';
num_clusters       = 17;
num_initialization = 1000;

```
The program runs fine, but I get the following `Warning` from most iterations. For example:
```
Iter. 145...  Warning: Von mises did not converge after 100 iterations 
> In direcClus_fix_bessel_bsxfun (line 232)
  In CBIG_VonmisesSeriesClustering_fix_bessel_randnum_bsxfun (line 129)
  In CBIG_MSHBM_generate_ini_params (line 59) 
took 19.683137 second.
```

Should I worry about these warnings? Should I increase the default number of iterations to avoid it?


