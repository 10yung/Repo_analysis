ZQCNN mxnettensorflowcaffe CMake Error at toolsconvertersourceMNNCMakeListstxt addlibrary No SOURCES given to target mnnbizcode CMake Error at toolsconvertersourceoptimizerCMakeListstxt addlibrary No SOURCES given to target optimizer CMake Error at toolsconvertersourcetfliteCMakeListstxt addlibrary No SOURCES given to target tflite cmake ZQFaceDetectorMTCNN ZQFaceRecognizerArcFaceZQCNN cpp include QCoreApplication include QDir include iostream include opencv corecorehpp include opencv highguihighguihpp include opencv imgprocimgprochpp include opencv highguihighguich include opencv imgprocimgprocch include ZQFaceDetectorMTCNNh include ZQFaceDetectorLibFaceDetecth include ZQFaceRecognizerArcFaceZQCNNh include ZQCNNCompileConfigh if ZQCNNUSEBLASGEMM include openblascblash elif ZQCNNUSEMKLGEMM include mklmklh endif include vector include string include iostream include algorithm using namespace ZQ using namespace cv using namespace std define THREADNUM int mainint argc char argv if ZQCNNUSEBLASGEMM define USEOPENMP openblassetnumthreadsTHREADNUM elif ZQCNNUSEMKLGEMM mklsetnumthreadsTHREADNUM endif QCoreApplication aargc argv ZQFaceDetectorMTCNN mtcnn NULL ZQFaceRecognizerArcFaceZQCNN recognizer NULL mtcnn new ZQFaceDetectorMTCNN if mtcnnInitmodel THREADNUM printffailed to init mtcnn n return stdstring prototxtfile modelmodelr amzqparams stdstring caffemodelfile modelmodelr amnchwbin stdstring outblobname fc recognizer new ZQFaceRecognizerArcFaceZQCNN if recognizerInit prototxtfile caffemodelfile outblobname printffailed to init arcface n return load image int iFaildCount int iTotalDetect while long t cvgetTickCount iTotalDetect ifiTotalDetect printfiTotalDetectd n iTotalDetect cvMat galleryimgcolor cvimread jpeg cvMat probeimgcolor cvimread jpeg long t cvgetTickCount double secs t t cvgetTickFrequency cout load image takes secs seconds endl Detect faces vectorZQCNNBBox galleryfaces if mtcnnFindFaceROIgalleryimgcolordata galleryimgcolorcols galleryimgcolorrows galleryimgcolorstep ZQPIXELFMTBGR galleryfaces printffailed to find face using MTCNN n continue int t galleryfacenum galleryfacessize vectorZQCNNBBox probefaces if mtcnnFindFaceROIprobeimgcolordata probeimgcolorcols probeimgcolorrows probeimgcolorstep ZQPIXELFMTBGR probefaces printffailed to find face using MTCNN n continue int t probefacenum probefacessize cout galleryfacenum galleryfacenum probefacenum probefacenum endl if galleryfacenum probefacenum stdcout Faces are not detected galleryfacenum galleryfacenum probefacenum probefacenum total failed iFaildCount iTotalDetect iTotalDetect endl continue cout galleryfacenum galleryfacenum x galleryfaces col y galleryfaces row width galleryfaces col galleryfaces col height galleryfaces row galleryfaces row score galleryfaces score endl cout probefacenum probefacenum x probefaces col y probefaces row width probefaces col probefaces col height probefaces row probefaces row score probefaces score endl t cvgetTickCount secs t t cvgetTickFrequency cout Detect faces takes secs seconds endl Detect facial landmarks int cropwidth recognizerGetCropWidth int cropheight recognizerGetCropHeight cvMat cropgallerycropheight cropwidth CVMAKETYPE recognizerCropImagegalleryimgcolordata galleryimgcolorcols galleryimgcolorrows galleryimgcolorstep ZQPIXELFMTBGR galleryfaces ppoint galleryfaces ppoint cropgallerydata cropgallerystep cvMat cropprobecropheight cropwidth CVMAKETYPE recognizerCropImageprobeimgcolordata probeimgcolorcols probeimgcolorrows probeimgcolorstep ZQPIXELFMTBGR probefaces ppoint probefaces ppoint cropprobedata cropprobestep for int i i i cvcirclegalleryimgcolor cvPointintgalleryfaces ppoint i intgalleryfaces ppoint i CVRGB cvcircleprobeimgcolor cvPointintprobefaces ppoint i intprobefaces ppoint i CVRGB cvimwritegallerypointresultjpg galleryimgcolor cvimwriteprobepointresultjpg probeimgcolor t cvgetTickCount secs t t cvgetTickFrequency cout Detect facial landmarks takes secs seconds endl Extract face identity feature int featdim recognizerGetFeatDim float galleryfea new float featdim float probefea new float featdim recognizerExtractFeaturecropgallerydata cropgallerystep ZQPIXELFMTBGR galleryfea true recognizerExtractFeaturecropprobedata cropprobestep ZQPIXELFMTBGR probefea true stdcout feature len featdim endl t cvgetTickCount secs t t cvgetTickFrequency cout Extract face identity feature takes secs seconds endl Caculate similarity of two faces float sim recognizerCalSimilaritygalleryfea probefea stdcout score sim endl t cvgetTickCount secs t t cvgetTickFrequency cout Caculate similarity of two faces takes secs seconds endl endl delete galleryfea delete probefea return aexec Ubantu cmake DBLASTYPEopenblas MNN MNN mxnet onnx mxnet exportonnx batchnorm onnxonnxcpp pyexportcheckerValidationError Unrecognized attribute spatial for operator BatchNormalization mtcnn mxnet onnx exportmodel inputshape PNet inputshape import onnx import mxnet as mx import numpy as np from mxnetcontrib import onnx as onnxmxnet import logging loggingbasicConfiglevelloggingINFO from onnx import checker syms det symboljson params det params inputshape onnxfile mdet onnx Invoke export model API It returns path of the converted onnx model convertedmodelpath mxcontribonnxexportmodelsyms params inputshape npfloat onnxfile Load onnx model modelproto onnxloadmodelconvertedmodelpath Check if converted ONNX protobuf is valid checkercheckgraphmodelprotograph Load onnx model modelproto onnxloadmodelconvertedmodelpath Check if converted ONNX protobuf is valid checkercheckgraphmodelprotograph MTCNN SampleMTCNN face runblur true runblur false demo 