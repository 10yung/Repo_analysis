Ruby Rails Everything working perfactly even response is also correct but didnt get the notification RpushClientActiveRecordApnsNotification id badge nil devicetoken xyz sound default alert New care request has been created by dipak client data test expiry delivered true deliveredat failed false failedat nil errorcode nil errordescription nil deliverafter nil createdat updatedat alertisjson false type RpushClientActiveRecordApnsNotification collapsekey nil delaywhileidle false registrationids nil appid retries uri nil failafter nil processing false priority nil urlargs nil category nil contentavailable false notification nil Please help me for this where I can debug Describe the bug Some notifications incorrectly marked as invalid due to payload size APNS v imposes a validation payload size limit of kb On APNS the payload limit increases to kb When using APNS Rpush is validating the notification payload size based on APNS v size limits kb rather than APNS v size limits kb To Reproduce Steps to reproduce the behavior Create an APNS notification where the recordpayloadbytesize is greater than kb but less than kb The notification is not sent because it has the following validation error APN notification cannot be larger than bytes Try condensing your alert and device attributes Expected behavior The notification payload should be valid because APNS imposes a notification payload size of kb Actual Behavior The notification payload is marked as invalid because the recordpayloadbytesize is greater than kb even though APNS has a size limit of kb Logs and other output NA System configuration please complete the following information OS macOS OS version Ruby version ruby Rails version Rails Rpush version Rpush Additional context Heres a Link to Apples docs describing the payload sizes for APNS v and v This section of the docs might be relevant to the issue Im encountering If you are using the legacy APNs binary interface to send notifications instead of an HTTP request the maximum payload size is KB bytes Is it possible that Im using the legacy APNs binary and thats why the kb limit is being imposed In that case this may not be an Rpush bug at all and Id be curious how to change my Rpush config to stop using the legacy binary interface Workarounds and potential solutions Ive patched my configinitializersrpushrb to override the MAXBYTES constant so its kb RpushClientActiveModelApnsBinaryNotificationValidatorMAXBYTES kilobytes obviously Id prefer not overriding a constant especially one set in a gem Locally Ive tested replacing this line with validateswith RpushClientActiveModelPayloadDataSizeValidator limit This change does seem to resolve the issue If a PR along these lines would be appropriate please let me know Ive experienced an effect where the notification is received by the user minutes after the deliveredat attribute would suggest This seems to only happen when a lot of notification records are created at once and effects the notifications later in the queue After looking in the Rpush docs it seemed like the bottleneck would be the APNs timeout I had previously set Appconnections Ive now set it to in case this is the issue My problem is this after looking into the Rpush source code it looks like deliveredat it set after receiving the ok response from APNs This implies deliveredat should always be correct regardless of the timeout between requests Is there another reason why there could be such a delay in sending the notification after deliveredat is set I have gotten this complaint from a number of users so it seems unlikely to be a user connection issue rpush rails ruby Describe the bug Following instructions for using Redis but while I can create a RpushApnsp App I cannot subsequently call RpushApnsp Appfindbyname per the README To Reproduce Run rails console and call RpushApnsp Appfindbynametest and receive the following error RpushApnsp Appfindbynametest Traceback most recent call last from irb NoMethodError undefined method findbyname for RpushClientRedisApnsp AppClass Did you mean findall Expected behavior Expect findbyname to work just like before using ActiveRecord Logs and other output NA System configuration please complete the following information OS macOS OS version Ruby version Rails version Rpush version Additional context Add any other context about the problem here Describe the bug Seeing the following in several environments DEV INTEGRATION PROD with otherwise successful deliveries but occasionally the following errors and related rpushnotifications records show delivered false failed false ERROR ErrnoECONNRESET Connection reset by peer usrlocallibruby opensslbufferingrb in sysreadnonblock usrlocallibruby opensslbufferingrb in readnonblock usrlocalbundlegemsnethttp libnethttp clientrb in block in socketloop usrlocalbundlegemsnethttp libnethttp clientrb in loop usrlocalbundlegemsnethttp libnethttp clientrb in socketloop usrlocalbundlegemsnethttp libnethttp clientrb in block levels in ensureopen To Reproduce Not sure its intermittent Expected behavior Not sure either finally marking the record as failed or delivered Logs and other output See above System configuration please complete the following information OS ubuntu OS version LTS Ruby version Rails version Rpush version Additional context Using APNS P and FCM only problems w APNS P Fixed Changes Updated rspec version I tried this a few times but even updating from to fails for me and I have no idea why Maybe I was just unlucky and now it will just work bump rubyversion to fix simplecov deprecation warning use shared examples to share tests between specunitclientactiverecord and specunitclientredis fix two bugs in redis client classes use skipped tests to highlight two potential bugs in redis client classes Hello I am working on implementing this gem to send our push notifications but I am running into an issue when trying to get info from rpush running as a daemon The config has a comment saying that info can be retrieved by using this method RpushDaemonAppRunnerrunnerseach do appid runner runnerapp runnerqueuesize end but this returns an error stating NoMethodError undefined method runners for RpushDaemonAppRunnerClass I was wondering what the current method for retrieving this information is 