rb define foo do context params name localrubyblock foo do block do p context end end end foo foo foo bar RBENVVERSION itamae local arb INFO Starting Itamae INFO Recipe homek kubuntmparb bar bar The first bar should be foo shouldnt it Hi there Log INFO Starting Itamae INFO Loading node data from UsersmacuserDevelopmentdeploynodespgyml INFO Recipe UsersmacuserDevelopmentdeploycookbooksappappuserrb ERROR stdout chmod changing permissions of tmpitamaetmp Operation not permitted ERROR Command sudo H u appuser binsh c cd appuser chmod tmpitamaetmp failed exit status ERROR remotefile homeappusersshauthorizedkeys Failed ruby remotefile homeappusersshauthorizedkeys do action create user appuser end shell bundle exec itamae ssh host pgmyappinfo user root i sshided cookbooksappappuserrb y nodespgyml Might be similar to this issue r system option of groupadd Problem notif is confusing when cwd is specified with a directory that does not exist Minimal reproduce code ruby execute echo hello do cwd pathtounknwondir notif true end bash itamae local testrb dryrun INFO Starting Itamae dryrun INFO Recipe tmptmpVzWjtHqt testrb INFO execute echo hello executed will change from false to true It should not be executed always because true command returns But cd pathtounknwondir returns nonzero value so Itamae guesses it should be executed note In this case it will fail without dryrun Actually the directory will be create with another command How should it behave Im not sure I guess warning is a solution Because I was confused by the behaviour but I would not like to make it error But Im not sure what the error message and the condition of the warning message Itamae is dependent by specinfra thats version is or greater currently Specinfra requires netssh gem version or greater and netssh gem requires ruby version or greater Therefore itamae requires ruby or greater as practically This pull request does specify the required ruby version to gemspec for enduser helpful supplement My investigation article jaJP arrowright Context Now integration test files are very large lines lines Future I want to split there into multiple files eg mitamae Context Now CI of Itamae is too complex Ruby Unit test Integration testitamae docker and Integration test itamae local Ruby Unit test Integration testitamae docker and Integration test itamae local Ruby Unit test Integration testitamae docker and Integration test itamae local Ruby Unit test Integration testitamae docker and Integration test itamae local Ruby dev Unit test Integration testitamae docker and Integration test itamae local Problem If ruby test is failed we need to find out where the test failed in Unit test Integration testitamae docker or Integration test itamae local If Integration testitamae docker is failed Integration test itamae local will not be executed We dont know if Integration test itamae local is normal or not Future Migrate to CircleCI and split jobs Ruby Unit test Integration testitamae docker Integration test itamae local Ruby I know the user can set shell option on runtime but whether the recipe necessitates some certain kind of shells or not is usually determined by the recipe itself not by the environment So it is natural for itamae to have a method to set default shell Or has this product been already abandoned and does not have any updates plan more Fixed the problem that LF is replaced to CRLF when file resource is used from windows