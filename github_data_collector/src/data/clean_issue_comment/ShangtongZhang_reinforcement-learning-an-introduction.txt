I think the table plot of the policy need a small correction It needs to be flipped before plotted plttablecellTextnpflipudselfpolicy loc cellLoccenter Otherwise the ylabel and the policy will mismatch hiAs the following algorithmI didnt see the corresponding sentence in the code Unless the pair S t A t appears in S A S A S t A t Initialize pis belongs to As arbitrarily for all s belongs to S Qs a belongs to R arbitrarily for all s belongs to S a belongs to As Returnss aempty list for all s belongs to S a belongs to As Loop forever for each episode Choose S S A AS randomly such that all pairs have probability Generate an episode from S A following pi S A R S T A T R T G Loop for each step of episode t T T GlambdaG R t Unless the pair S t A t appears in S A S A S t A t Append G to ReturnsS t A t QS t A t averageReturnsS t A t piS t argmax a QS t a