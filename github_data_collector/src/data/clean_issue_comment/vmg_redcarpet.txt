Im using redcarpet in a rails app In my markdown I have created code blocks using three backticks When I display the markdown with redcarpet there are no line breaks in my code blocks All of the code block is pushed onto one running line Is there an option to maintain the line breaks in code blocks with redcarpet markdown RedcarpetMarkdownnewRedcarpetRenderHTML prettify true markdownrenderpostbodyhtmlsafe Building native extensions This could take a while ERROR Error installing redcarpet ERROR Failed to build gem native extension current directory homedeployrvmgemsruby gemsredcarpet extredcarpet homedeployrvmrubiesruby binruby I homedeployrvmrubiesruby librubysiteruby r siteconf tycijrb extconfrb creating Makefile current directory homedeployrvmgemsruby gemsredcarpet extredcarpet make DESTDIR clean current directory homedeployrvmgemsruby gemsredcarpet extredcarpet make DESTDIR compiling autolinkc gcc error unrecognized command line option Wduplicatedcond gcc error unrecognized command line option Wmisleadingindentation gcc error unrecognized command line option Wrestrict gcc error unrecognized command line option Wimplicitfallthrough Makefile recipe for target autolinko failed make autolinko Error make failed exit code iscodefence now allows fencepair matching to comply with closing code fence of the same type as the code block began with backticks or tildes and with at least as many backticks or tildes as the opening code fence So the following now works as it does in GitHub otherwise it would be difficult to type this This is some code containing a fence string protected by extending the enclosing fence This is some code containing a fence string protected by using the other fence type Fixes I found a possible bug I think Please feel free to close it if I wrong Btw Amazing library Example input html div titlestrongThis breaks everythingstrong strongThis breaks everythingstrong div Fail ruby text div titlestrongThis breaks everythingstrongstrongThis breaks everythingstrongdiv RedcarpetRenderSmartyPantsrendertext Output html div titlestrongThis breaks everythingstrong lsquostrongThis breaks everythingstrongdiv Expected output I think it lsquo should be Ive tested it with these versions Other markdown parsers eg flexmark XCode documentation parser allow to add a linebreak by prefixing it with backslash This is motivated by downstream bug This is an example that doesnt seem to render properly If bullets dont have an empty line before them they are parsed as stars irbmain markdown RedcarpetMarkdownnewRedcarpetRenderHTML autolink true tables true RedcarpetMarkdown x fe rendererRedcarpetRenderHTML x fe irbmain puts markdownrenderstr ptext bullet bullet p nil irbmain puts str text bullet bullet If I add an extra newline it works fine irbmain puts markdownrenderstr ptextp ul libullet li libullet li ul nil irbmain puts str text bullet bullet nil Im not able to install redcarpet on Mojave tried with xcode Can anybody please help me Building native extensions This could take a while ERROR Error installing redcarpet ERROR Failed to build gem native extension current directory usrlocallibrubygems gemsredcarpet extredcarpet usrlocaloptrubybinruby I usrlocalCellarruby libruby r siteconf i ihaxrb extconfrb creating Makefile current directory usrlocallibrubygems gemsredcarpet extredcarpet make DESTDIR clean current directory usrlocallibrubygems gemsredcarpet extredcarpet make DESTDIR compiling autolinkc dyld Library not loaded usrlocalliblibwep Referenced from usrbinclang Reason no suitable image found Did find usrlocalliblibwep code signature in usrlocalliblibwep not valid for use in process using Library Validation mapped file has no cdhash completely unsigned Code has to be at least adhoc signed usrlocalliblibwep stat failed with errno make autolinko Abort trap make failed exit code Gem files will remain installed in usrlocallibrubygems gemsredcarpet for inspection Results logged to usrlocallibrubygems extensionsx darwin redcarpet gemmakeout Hello Team Am unable to install redcarpet I tried the below commands but still it exits with below error Any help is appreciated roothost gem update system Updating rubygemsupdate roothost gem install redcarpet platformruby verbose HEAD OK GET OK varlibgems gemsredcarpet COPYING varlibgems gemsredcarpet Gemfile varlibgems gemsredcarpet READMEmarkdown usrbinruby extconfrb mkmfrb cant find header files for ruby at usrlibrubyincluderubyh ERROR Error installing redcarpet ERROR Failed to build gem native extension Building has failed See above output for more information on the failure extconf failed exit code Gem files will remain installed in varlibgems gemsredcarpet for inspection Results logged to varlibgems extensionsx linux redcarpet gemmakeout OS NAMEUbuntu VERSION LTS Xenial Xerus IDubuntu IDLIKEdebian PRETTYNAMEUbuntu LTS VERSIONID HOMEURL SUPPORTURL BUGREPORTURL VERSIONCODENAMExenial UBUNTUCODENAMExenial I ran into the same issue as and Ive been trying to think of a good way to fix the issue The solution is not entirely obvious but as far as I can tell there are a few options Update the documentation to say that RedcarpetMarkdown is not thread safe and you should make one per thread Add a global rendering lock Thats what I have here Based on benchmarks on my laptop this has an performance hit for the single threaded case and you get no benefit from concurrency but it doesnt just crash the program Split the state into the fixed state that can be shared between threads and the rendering state that needs to be separate This was the suggestion in that issue I made a rough attempt at that but sdmarkdownworkbufs is used to cache memory buffers between renders This doesnt work in the concurrent world and if we just recreate them for every render theres a noticeable performance hit on subsequent renders using the same RedcarpetMarkdown object Plus the active encoding is stored in the renderer options making that also not thread safe so wed have to split those options in two as well While I could probably implement option Im not sure its possible without at least a minor performance hit So my questions for you are Is this a thing you want fixed Is this a thing you want fixed enough to warrant a performance hit If so how much Do you think theres value in actually making render concurrent Its fairly likely this will speed up the concurrent case but slow down the sequential case Hi I was looking through this code for unrelated reasons and happened to notice that redcarpetstackpush is calling redcarpetstackgrow significantly more often than necessary My assumption from reading the code is that it should only allocate more memory if theirs insufficient space but this is increasing the buffer size on every push so theres always double the space required Your contributing guide says to add a test but as far as I can tell theres no way to test C code directly so Im not sure thats a feasible thing to do in this case Please let me know if there is a way to test this and Id be happy to add it This does not appear to effect the benchmark in any way