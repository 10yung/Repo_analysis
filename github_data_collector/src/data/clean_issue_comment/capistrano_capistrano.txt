 Tasks rake namespace app do desc Confirmation task confirmation do puts WARN WARNING Youre about to deploy the branch fetchbranch Are you sure you want to continue yN WARN ask value N if fetchvalue yesi puts nDeploy cancelled exit end end end Expected behavior When using ask offcial documentation the console should wait for user input Actual behavior On Git Bash Windows When using ask offcial documentation to get user input the console never stops and automatically uses the default value System configuration Windows Terminal app Git Bash cap staging doctor Environment Ruby ruby p revision x mingw Rubygems Bundler NA Command DProgramFilesRuby x bincap staging doctor Gems capistrano airbrussh rake update available sshkit netssh capistranocomposer capistranofilepermissions capistranosymfony prealfa Important GitHub issues are for feature requests or bug reports The Capistrano team recommends you use Stack Overflow for general questions For more details please see our contribution policy Steps to reproduce Deploy an application to a remote host change app repo url in Git update repo url in Capistrano config try to deploy the app It wont deploy Youll get an error see below To resovle the problem you need to ssh onto the remote host and remove repo folder then redeploy It looks like Capistrano relies on repo url from repo folder I am posting this thread as a suggestion for improvement because I think that it would be nice if we didnt have to remove repo folder manually secondly I struggled to figured it out for an hour or two so we could save other peoples lives trying to solve similar problem Expected behavior App should deploy Actual behavior git exit status SSHKitRunnerExecuteError git stdout GitLab The project you were looking for could not be found fatal Could not read from remote repository System configuration Please link to the output of cap stage doctor in a GitHub Gist Thanks for helping improve Capistrano I run cap production deploy and got this error HOMErbenvbinrbenv exec bundle exec rails webpackerclobber Backtrace restricted to imported tasks cap aborted ErrnoENOENT No such file or directory export RBENVROOTHOMErbenv RBENVVERSION RAILSENVproduction RBENVROOTHOMErbenv RBENVVERSION RAILSENVproduction HOMErbenvbinrbenv exec bundle exec rails webpackerclobber Tasks TOP webpackerprecompile See full trace by running task with trace The deploy has failed with an error No such file or directory export RBENVROOTHOMErbenv RBENVVERSION RAILSENVproduction RBENVROOTHOMErbenv RBENVVERSION RAILSENVproduction HOMErbenvbinrbenv exec bundle exec rails webpackerclobber This is my deployrb file lock set application myapp set repourl gitgithubcomgithubusernamemyappgit Deploy to the users home directory set deployto homedeployfetch application append linkeddirs log tmppids tmpcache tmpsockets vendorbundle bundle publicsystem publicuploads Only keep the last releases to save disk space set keepreleases set defaultenv RBENVROOT HOMErbenv RBENVVERSION RAILSENV production before deployassetsprecompile deployyarninstall namespace deploy do desc Run rake yarninstall task yarninstall do on rolesweb do within releasepath do executecd releasepath yarn install end end end end namespace env do desc Print enviroment variables task env do on rolesall do execute env end end end after deployupdated webpackerprecompile I also have a file in server homedeploymyapprbenv and homedeploymyapprbenvvars that contain RAILSMASTERKEYohai SECRETKEYBASE STRIPEPUBLICKEYx STRIPEPRIVATEKEYy RBENVROOTrbenv RBENVVERSION RAILSENVproduction What is the solution Ive posted a similar issue several days ago but I am seeing weird behavior of Capistrano again when deploying different branch I want to test the deploymnet of my maintenance branch I will use it whenever I want to turn off my application for the time of maitenance I pushed the branch and this is my config configstagingmaintenancerb set user apps set stage staging set deployto homefetchuserappshopfetchapplicationproduction set branch maintenance server XXXXXXXXX user apps roles wweb app db sshoptions forwardagent true port namespace npm do task build do on rolesapp do execute cd currentpath npm install npm run build end end task restart do on rolesapp do execute sv restart homeappsrunitserviceshoplauberfrontendweb end end end before deploycleanup npmbuild after deploy npmrestart The latest commit on this branch is ae a e fdc d d cf b eb git log commit ae a e fdc d d cf b eb HEAD maintenance originmaintenance Author J drek Doma ski jedrekdomanskigmailcom Date Tue Jul Add maintenance page In current folder I check it cat REVISION ae a e fdc d d cf b eb In the stacktrace I can see that current folder is symlinked with which is the latest release so I check it in folder cd cat REVISION ae a e fdc d d cf b eb Everything fine But in repo folder I do not see this commit git log commit a ca b c fd a f ccd d aec d Whats going on here This line confirms that the maintenance branch got deployed and the latest revision is at ae a e fdc d d cf b eb Running usrbinenv echo Branch maintenance at ae a e fdc d d cf b eb deployed as release by jedrek homeappsappshoplauberfrontendproductionrevisionslog I tried removing the repo folder and redeploying but that didnt help I shouldnt have to do that when I want to deploy a different branch I think Full stacktrace cap stagingmaintenance deploy trace Invoke stagingmaintenance firsttime Execute stagingmaintenance Invoke loaddefaults firsttime Execute loaddefaults Invoke deploy firsttime Execute deploy Invoke deploystarting firsttime Execute deploystarting Invoke deploycheck firsttime Execute deploycheck Invoke gitcheck firsttime Invoke gitwrapper firsttime Execute gitwrapper INFO ee a Running usrbinenv mkdir p tmp as appslauberstagingapps DEBUG ee a Command usrbinenv mkdir p tmp INFO ee a Finished in seconds with exit status successful DEBUG Uploading tmpgitsshlauberfrontendstagingjedreksh INFO Uploading tmpgitsshlauberfrontendstagingjedreksh INFO a b Running usrbinenv chmod tmpgitsshlauberfrontendstagingjedreksh as appslauberstagingapps DEBUG a b Command usrbinenv chmod tmpgitsshlauberfrontendstagingjedreksh INFO a b Finished in seconds with exit status successful Execute gitcheck INFO cec Running usrbinenv git lsremote heads gitgitlabcomlauberlauberfrontendgit as appslauberstagingapps DEBUG cec Command export GITASKPASSbinecho GITSSHtmpgitsshlauberfrontendstagingjedreksh usrbinenv git lsremote heads gitgitlabcomlauberlauberfrontendgit DEBUG cec c af a e fa d d cee ab ba refsheadsLK Headersoptimizations b b e e c d d fc f f refsheadsLK Addmetatagsandmetadescriptions a d aa d d bccbe a fbab fbde refsheadsLK Friendlyurls cf da b b e fb bb aeea d f e e refsheadsLK Imagesaltdescriptions e d a bb f e f a cbab f d a ba refsheadsLK Richsnippets be ae a ae da effa d ed refsheadsLK Addsubdomainsforlanguages c fbf a ae cdb fd e fff refsheadsLK Listpageforcategories a c f fdd b af b ae e b refsheadsLK Titleandshortdescriptionforpartpage f d b d c cb refsheadscatalog a ca b c fd a f ccd d aec d refsheadsdev ae a e fdc d d cf b eb refsheadsmaintenance f d c bd c df a a refsheadsmaster e f b e ba c c a e a a refsheadsproperties ce ee dfe e d b e dc f refsheadsshop becebcddb d ffcdc a b af c a e db refsheadstestdeploybranch ae ea e c d d e b afe b c b b refsheadsvehicles INFO cec Finished in seconds with exit status successful Invoke deploycheckdirectories firsttime Execute deploycheckdirectories INFO f dc Running usrbinenv mkdir p homeappsappshoplauberfrontendproductionshared homeappsappshoplauberfrontendproductionreleases as appslauberstagingapps DEBUG f dc Command usrbinenv mkdir p homeappsappshoplauberfrontendproductionshared homeappsappshoplauberfrontendproductionreleases INFO f dc Finished in seconds with exit status successful Invoke deploychecklinkeddirs firsttime Execute deploychecklinkeddirs INFO eb b b Running usrbinenv mkdir p homeappsappshoplauberfrontendproductionsharedapptranslations as appslauberstagingapps DEBUG eb b b Command usrbinenv mkdir p homeappsappshoplauberfrontendproductionsharedapptranslations INFO eb b b Finished in seconds with exit status successful Invoke deploycheckmakelinkeddirs firsttime Execute deploycheckmakelinkeddirs INFO e d aad Running usrbinenv mkdir p homeappsappshoplauberfrontendproductionshared as appslauberstagingapps DEBUG e d aad Command usrbinenv mkdir p homeappsappshoplauberfrontendproductionshared INFO e d aad Finished in seconds with exit status successful Invoke deploychecklinkedfiles firsttime Execute deploychecklinkedfiles DEBUG fcdc bc Running f homeappsappshoplauberfrontendproductionsharedenv as appslauberstagingapps DEBUG fcdc bc Command f homeappsappshoplauberfrontendproductionsharedenv DEBUG fcdc bc Finished in seconds with exit status successful Invoke deploysetpreviousrevision firsttime Execute deploysetpreviousrevision DEBUG d fcc Running f homeappsappshoplauberfrontendproductioncurrentREVISION as appslauberstagingapps DEBUG d fcc Command f homeappsappshoplauberfrontendproductioncurrentREVISION DEBUG d fcc Finished in seconds with exit status successful DEBUG f e d Running usrbinenv cat homeappsappshoplauberfrontendproductioncurrentREVISION devnull as appslauberstagingapps DEBUG f e d Command usrbinenv cat homeappsappshoplauberfrontendproductioncurrentREVISION devnull DEBUG f e d ae a e fdc d d cf b eb DEBUG f e d Finished in seconds with exit status successful Invoke deploystarted firsttime Execute deploystarted Invoke deployupdating firsttime Invoke deploynewreleasepath firsttime Execute deploynewreleasepath Execute deployupdating Invoke gitcreaterelease firsttime Invoke gitupdate firsttime Invoke gitclone firsttime Invoke gitwrapper Execute gitclone DEBUG d cb Running f homeappsappshoplauberfrontendproductionrepoHEAD as appslauberstagingapps DEBUG d cb Command f homeappsappshoplauberfrontendproductionrepoHEAD DEBUG d cb Finished in seconds with exit status failed DEBUG c af Running if test d homeappsappshoplauberfrontendproduction then echo Directory does not exist homeappsappshoplauberfrontendproduction false fi as appslauberstagingapps DEBUG c af Command if test d homeappsappshoplauberfrontendproduction then echo Directory does not exist homeappsappshoplauberfrontendproduction false fi DEBUG c af Finished in seconds with exit status successful INFO b Running usrbinenv git clone mirror gitgitlabcomlauberlauberfrontendgit homeappsappshoplauberfrontendproductionrepo as appslauberstagingapps DEBUG b Command cd homeappsappshoplauberfrontendproduction export GITASKPASSbinecho GITSSHtmpgitsshlauberfrontendstagingjedreksh usrbinenv git clone mirror gitgitlabcomlauberlauberfrontendgit homeappsappshoplauberfrontendproductionrepo DEBUG b Cloning into bare repository homeappsappshoplauberfrontendproductionrepo INFO b Finished in seconds with exit status successful Execute gitupdate DEBUG fa Running if test d homeappsappshoplauberfrontendproductionrepo then echo Directory does not exist homeappsappshoplauberfrontendproductionrepo false fi as appslauberstagingapps DEBUG fa Command if test d homeappsappshoplauberfrontendproductionrepo then echo Directory does not exist homeappsappshoplauberfrontendproductionrepo false fi DEBUG fa Finished in seconds with exit status successful INFO adc Running usrbinenv git remote update prune as appslauberstagingapps DEBUG adc Command cd homeappsappshoplauberfrontendproductionrepo export GITASKPASSbinecho GITSSHtmpgitsshlauberfrontendstagingjedreksh usrbinenv git remote update prune DEBUG adc Fetching origin INFO adc Finished in seconds with exit status successful Execute gitcreaterelease DEBUG aafb d Running if test d homeappsappshoplauberfrontendproductionrepo then echo Directory does not exist homeappsappshoplauberfrontendproductionrepo false fi as appslauberstagingapps DEBUG aafb d Command if test d homeappsappshoplauberfrontendproductionrepo then echo Directory does not exist homeappsappshoplauberfrontendproductionrepo false fi DEBUG aafb d Finished in seconds with exit status successful INFO Running usrbinenv mkdir p homeappsappshoplauberfrontendproductionreleases as appslauberstagingapps DEBUG Command cd homeappsappshoplauberfrontendproductionrepo export GITASKPASSbinecho GITSSHtmpgitsshlauberfrontendstagingjedreksh usrbinenv mkdir p homeappsappshoplauberfrontendproductionreleases INFO Finished in seconds with exit status successful INFO ab fb Running usrbinenv git archive maintenance tar x f C homeappsappshoplauberfrontendproductionreleases as appslauberstagingapps DEBUG ab fb Command cd homeappsappshoplauberfrontendproductionrepo export GITASKPASSbinecho GITSSHtmpgitsshlauberfrontendstagingjedreksh usrbinenv git archive maintenance tar x f C homeappsappshoplauberfrontendproductionreleases INFO ab fb Finished in seconds with exit status successful Invoke deploysetcurrentrevision firsttime Execute deploysetcurrentrevision Invoke gitsetcurrentrevision firsttime Execute gitsetcurrentrevision DEBUG e c Running if test d homeappsappshoplauberfrontendproductionrepo then echo Directory does not exist homeappsappshoplauberfrontendproductionrepo false fi as appslauberstagingapps DEBUG e c Command if test d homeappsappshoplauberfrontendproductionrepo then echo Directory does not exist homeappsappshoplauberfrontendproductionrepo false fi DEBUG e c Finished in seconds with exit status successful DEBUG bf d c Running usrbinenv git revlist maxcount maintenance as appslauberstagingapps DEBUG bf d c Command cd homeappsappshoplauberfrontendproductionrepo export GITASKPASSbinecho GITSSHtmpgitsshlauberfrontendstagingjedreksh usrbinenv git revlist maxcount maintenance DEBUG bf d c ae a e fdc d d cf b eb DEBUG bf d c Finished in seconds with exit status successful DEBUG c c Running if test d homeappsappshoplauberfrontendproductionreleases then echo Directory does not exist homeappsappshoplauberfrontendproductionreleases false fi as appslauberstagingapps DEBUG c c Command if test d homeappsappshoplauberfrontendproductionreleases then echo Directory does not exist homeappsappshoplauberfrontendproductionreleases false fi DEBUG c c Finished in seconds with exit status successful INFO c Running usrbinenv echo ae a e fdc d d cf b eb REVISION as appslauberstagingapps DEBUG c Command cd homeappsappshoplauberfrontendproductionreleases usrbinenv echo ae a e fdc d d cf b eb REVISION INFO c Finished in seconds with exit status successful Invoke deploysymlinkshared firsttime Execute deploysymlinkshared Invoke deploysymlinklinkedfiles firsttime Execute deploysymlinklinkedfiles INFO b e Running usrbinenv mkdir p homeappsappshoplauberfrontendproductionreleases as appslauberstagingapps DEBUG b e Command usrbinenv mkdir p homeappsappshoplauberfrontendproductionreleases INFO b e Finished in seconds with exit status successful DEBUG e c df Running L homeappsappshoplauberfrontendproductionreleases env as appslauberstagingapps DEBUG e c df Command L homeappsappshoplauberfrontendproductionreleases env DEBUG e c df Finished in seconds with exit status failed DEBUG ecae Running f homeappsappshoplauberfrontendproductionreleases env as appslauberstagingapps DEBUG ecae Command f homeappsappshoplauberfrontendproductionreleases env DEBUG ecae Finished in seconds with exit status failed INFO a e Running usrbinenv ln s homeappsappshoplauberfrontendproductionsharedenv homeappsappshoplauberfrontendproductionreleases env as appslauberstagingapps DEBUG a e Command usrbinenv ln s homeappsappshoplauberfrontendproductionsharedenv homeappsappshoplauberfrontendproductionreleases env INFO a e Finished in seconds with exit status successful Invoke deploysymlinklinkeddirs firsttime Execute deploysymlinklinkeddirs INFO be af Running usrbinenv mkdir p homeappsappshoplauberfrontendproductionreleases app as appslauberstagingapps DEBUG be af Command usrbinenv mkdir p homeappsappshoplauberfrontendproductionreleases app INFO be af Finished in seconds with exit status successful DEBUG c fae Running L homeappsappshoplauberfrontendproductionreleases apptranslations as appslauberstagingapps DEBUG c fae Command L homeappsappshoplauberfrontendproductionreleases apptranslations DEBUG c fae Finished in seconds with exit status failed DEBUG b b c Running d homeappsappshoplauberfrontendproductionreleases apptranslations as appslauberstagingapps DEBUG b b c Command d homeappsappshoplauberfrontendproductionreleases apptranslations DEBUG b b c Finished in seconds with exit status successful INFO ae a Running usrbinenv rm rf homeappsappshoplauberfrontendproductionreleases apptranslations as appslauberstagingapps DEBUG ae a Command usrbinenv rm rf homeappsappshoplauberfrontendproductionreleases apptranslations INFO ae a Finished in seconds with exit status successful INFO c e a Running usrbinenv ln s homeappsappshoplauberfrontendproductionsharedapptranslations homeappsappshoplauberfrontendproductionreleases apptranslations as appslauberstagingapps DEBUG c e a Command usrbinenv ln s homeappsappshoplauberfrontendproductionsharedapptranslations homeappsappshoplauberfrontendproductionreleases apptranslations INFO c e a Finished in seconds with exit status successful Invoke deployupdated firsttime Execute deployupdated Invoke deploypublishing firsttime Execute deploypublishing Invoke deploysymlinkrelease firsttime Execute deploysymlinkrelease INFO a eb Running usrbinenv ln s homeappsappshoplauberfrontendproductionreleases homeappsappshoplauberfrontendproductionreleasescurrent as appslauberstagingapps DEBUG a eb Command usrbinenv ln s homeappsappshoplauberfrontendproductionreleases homeappsappshoplauberfrontendproductionreleasescurrent INFO a eb Finished in seconds with exit status successful INFO ea db Running usrbinenv mv homeappsappshoplauberfrontendproductionreleasescurrent homeappsappshoplauberfrontendproduction as appslauberstagingapps DEBUG ea db Command usrbinenv mv homeappsappshoplauberfrontendproductionreleasescurrent homeappsappshoplauberfrontendproduction INFO ea db Finished in seconds with exit status successful Invoke deploypublished firsttime Execute deploypublished Invoke deployfinishing firsttime Execute deployfinishing Invoke deploycleanup firsttime Invoke npmbuild firsttime Execute npmbuild INFO f f Running cd homeappsappshoplauberfrontendproductioncurrent npm install npm run build as appslauberstagingapps DEBUG f f Command cd homeappsappshoplauberfrontendproductioncurrent npm install npm run build DEBUG f f multi main bytes built appassetsimagescategories offer png bytes built hidden modules INFO f f Finished in seconds with exit status successful Execute deploycleanup DEBUG fd ea Running usrbinenv ls xtr homeappsappshoplauberfrontendproductionreleases as appslauberstagingapps DEBUG fd ea Command usrbinenv ls xtr homeappsappshoplauberfrontendproductionreleases DEBUG fd ea DEBUG fd ea Finished in seconds with exit status successful INFO Keeping of deployed releases on lauberstagingapps INFO b Running usrbinenv rm rf homeappsappshoplauberfrontendproductionreleases as appslauberstagingapps DEBUG b Command usrbinenv rm rf homeappsappshoplauberfrontendproductionreleases INFO b Finished in seconds with exit status successful Invoke deployfinished firsttime Execute deployfinished Invoke deploylogrevision firsttime Execute deploylogrevision DEBUG d b ab Running if test d homeappsappshoplauberfrontendproductionreleases then echo Directory does not exist homeappsappshoplauberfrontendproductionreleases false fi as appslauberstagingapps DEBUG d b ab Command if test d homeappsappshoplauberfrontendproductionreleases then echo Directory does not exist homeappsappshoplauberfrontendproductionreleases false fi DEBUG d b ab Finished in seconds with exit status successful INFO decb f e Running usrbinenv echo Branch maintenance at ae a e fdc d d cf b eb deployed as release by jedrek homeappsappshoplauberfrontendproductionrevisionslog as appslauberstagingapps DEBUG decb f e Command cd homeappsappshoplauberfrontendproductionreleases usrbinenv echo Branch maintenance at ae a e fdc d d cf b eb deployed as release by jedrek homeappsappshoplauberfrontendproductionrevisionslog INFO decb f e Finished in seconds with exit status successful Invoke npmrestart firsttime Execute npmrestart INFO c fc Running sv restart homeappsrunitserviceshoplauberfrontendweb as appslauberstagingapps DEBUG c fc Command sv restart homeappsrunitserviceshoplauberfrontendweb DEBUG c fc ok run homeappsrunitserviceshoplauberfrontendweb pid s INFO c fc Finished in seconds with exit status successful Here is an error I just got on a cap deploy DEPLOY FAILED Refer to logcapistranolog for details Here are the last lines INFO ce Running bundle exec rake assetsprecompile as digcolkithesciencehistoryorg INFO a b Finished in seconds with exit status successful INFO d cba Running usrbinenv configdeploybinlinkcustomerrorpagesrb html as digcolkithesciencehistoryorg INFO f c a Finished in seconds with exit status successful INFO fba Running usrbinenv configdeploybinlinkcustomerrorpagesrb html as digcolkithesciencehistoryorg INFO cdc a d Finished in seconds with exit status successful INFO d cb Running usrbinenv mkdir p optscihistdigicollreleases assetsmanifestbackup as digcolkithesciencehistoryorg INFO d fce Finished in seconds with exit status successful INFO e c Running usrbinenv cp optscihistdigicollreleases publicassetssprocketsmanifest b bfd ddf a d json optscihistdigicollreleases assetsmanifestbackup as digcolkithesciencehistoryorg INFO ac d Finished in seconds with exit status successful INFO deploymigrate Run rake dbmigrate INFO a ce f Running bundle exec rake dbmigrate as digcolkithesciencehistoryorg INFO cc d Finished in seconds with exit status successful INFO dae Running usrbinenv ln s optscihistdigicollreleases optscihistdigicollreleasescurrent as digcolkithesciencehistoryorg INFO ceb a Finished in seconds with exit status successful INFO bbbae d Running usrbinenv mv optscihistdigicollreleasescurrent optscihistdigicoll as digcolkithesciencehistoryorg INFO ae f Finished in seconds with exit status successful INFO d cc f Running usrbinenv sudo usrsbinservice resquepool restart as digcolkithesciencehistoryorg INFO b f b Finished in seconds with exit status successful INFO cdb Running usrbinenv sudo systemctl restart passenger as digcolkithesciencehistoryorg DEPLOY FAILED is in red and Refer to logcapistranolog is in yellow but neither are actually in my terminal window theyve scrolled out of the current terminal view because of the log lines appended to them Yes the intermediate newlines between log lines are ther ein my output too which doesnt help but even without them I think it would make the failure notice too easy to miss Is there any way to turn off the Here are the last lines feature Should the red DEPLOY FAILED message be REPEATED after the log lines Even if configurable to be different I think this is not a great experience for newbies Its too easy to run a cap deploy and think it ran successfully when it failed Especially because a typical cap deploy has so much logging already the repeated last lines just look like more of it unless you know what the terminal output should end with and realize its not there or think to scroll back to look for an error message it is far too easy to not realize your deploy failed Rebase of See that for discussion Fixes CC signe Steps to reproduce Can not possible to reproduce It happens complete randomly random time random projects random servers We use capistrano with Jenkins to deploy apps to servers Expected behavior bash gitwrapper mkdir p tmpappname deployer s Uploading tmpappnamegitsshsh chmod rx tmpappnamegitsshsh deployer s gitcheck git lsremote heads gitgithubcomorgnameprojectnamegit Actual behavior bash gitwrapper mkdir p tmpappname deployer s Uploading tmpappnamegitsshsh gitcheck git lsremote heads gitgithubcomorgnameprojectnamegit fatal cannot exec tmpappnamegitsshsh Text file busy fatal unable to fork Backtrace restricted to imported tasks cap aborted SSHKitRunnerExecuteError Exception while executing on host git exit status git stdout Nothing written git stderr fatal cannot exec tmpappnamegitsshsh Text file busy fatal unable to fork Caused by SSHKitCommandFailed git exit status git stdout Nothing written git stderr fatal cannot exec tmpappnamegitsshsh Text file busy fatal unable to fork Tasks TOP gitcheck See full trace by running task with trace System configuration cap stage doctor link Additional Info Found solution for similar issue just add bash command sync on remote server right after uploading instruction It flushes all IO buffer to HDD Summary Previously if svnusername or svnpassword contained eg whitespace the SCM commands would fail This PR uses the shellwords library part of stdlib to properly escape them Short checklist x Did you run bundle exec rubocop a to fix linter issues If relevant did you create a test x Did you confirm that the RSpec tests pass x If you are fixing a bug or introducing a new feature did you add a CHANGELOG entry Steps to reproduce configdeployrb set deployto varwwwvhostsfetchapplication configdeployproductionrb set application exampleorg Expected behavior Command cap production deploy p dryrun prints Printing current config variables deployto varwwwvhostsexampleorg application exampleorg Actual behavior Command cap production deploy p dryrun prints Printing current config variables deployto varwwwvhosts application exampleorg System configuration Additional information I read the documentation here And it says The deployrb configuration is executed first and then the stage files from configdeployrb are executed next But for this Im using this lambda lazily loaded thing So I think I made it right but the system understands it wrong I have been using Capistrano for many years now I am facing a strange behavior when I run cap deploy it first ask for the server password I type it and everything works fine then my local passphrase key also it works fine when it asks for the passphrase keys for the remote server keys I need first to type Enter Keys to make it work for the first passphrase key for the second passphrase key any key I press with or without Enter key it is abort the whole process serverID executing command serverID out Enter passphrase for key homedeployersshidrsa Password works with Enter Keys serverID out serverID out Enter passphrase for key homedeployersshidrsa Password Any Key I press it continue and throw permission denied error serverID out serverID out Permission denied publickey serverID out serverID out fatal Could not read from remote repository I am using capistrano I updated it to the latest version and nothing changed ruby p Rails netssh in deployrb file I set these values set pty false defaultrunoptions pty true sshoptions forwardagent true 