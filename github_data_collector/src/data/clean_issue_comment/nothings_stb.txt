assertion failure in stbttcffint can be triggered by user supplied image POC POCzip Command clang fuzzc fsanitizeaddress lm o test test assert Result bash x ffff e e GIraisesig x x ffff e GIabort x ffff e a assertfailbasefmt x ffff fba d sssu ssAssertion s failed nn assertion x d str bits bits file x cfbe str stbimageh line x fc function x d e PRETTYFUNCTIONstbishiftsigned int stbishiftsignedunsigned int int int x ffff e GIassertfailassertion x d str bits bits file x cfbe str stbimageh line x fc function x d e PRETTYFUNCTIONstbishiftsigned int stbishiftsignedunsigned int int int x a ed stbishiftsignedvoptimized out shiftoptimized out bitsoptimized out x bb stbibmploadsoptimized out xoptimized out yoptimized out compoptimized out reqcompoptimized out rioptimized out x bb stbiloadmainsoptimized out xoptimized out yoptimized out compoptimized out reqcompoptimized out ri x bpcoptimized out x f stbiloadandpostprocess bitsoptimized out xoptimized out y x fffffffdef comp x fffffffdf reqcompoptimized out x f b stbiloadfromfilef x x x fffffffdee y x fffffffdef comp x fffffffdf reqcomp x x f ea stbiloadfilenameoptimized out x x fffffffdee y x fffffffdef comp x fffffffdf reqcomp x assertion failure in stbicreatepngimageraw can be triggered by user supplied image POC POCassertzip Command clang fuzzc fsanitizeaddress lm o test test assert result bash x ffff e e GIraisesig x x ffff e GIabort x ffff e a assertfailbasefmt x ffff fba d sssu ssAssertion s failed nn assertion x d f str imgwidthbytes x file x cfc str stbimageh line x function x d e PRETTYFUNCTIONstbicreatepngimageraw int stbicreatepngimagerawstbipng stbiuc stbiuint int stbiuint stbiuint int int x ffff e GIassertfailassertion x d f str imgwidthbytes x file x cfc str stbimageh line x function x d e PRETTYFUNCTIONstbicreatepngimageraw int stbicreatepngimagerawstbipng stbiuc stbiuint int stbiuint stbiuint int int x a fa stbicreatepngimagerawaoptimized out raw x rawlen x c outn x xoptimized out y x depth x color x x a stbicreatepngimagea x fffffffd e imagedata x imagedatalen x c outn x depth x coloroptimized out interlacedoptimized out x a stbiparsepngfilez x fffffffd e scan x reqcomp x x d stbidopngp x fffffffd e x x fffffffdea y x fffffffdeb n x fffffffdec reqcomp x ri x fffffffdb x d stbipngloads x fffffffdc xoptimized out yoptimized out compoptimized out reqcompoptimized out rioptimized out x d stbiloadmainsoptimized out xoptimized out yoptimized out compoptimized out reqcompoptimized out ri x fffffffdb bpcoptimized out reported by email claims all or channel vorbis files generated by reference encoder dont work example included in email check there for details Reported via email since example may be proprietary look there for details relevant code is if fcurrentloc samplenumber return errorf VORBISseekfailed I found a memory leak in stbimageh when using stbiloadfromfile POC memleakzip Command bash clang fsanitizeaddress fuzzc lm o poc poc leak Result bash ERROR LeakSanitizer detected memory leaks Direct leak of bytes in objects allocated from x bac in malloc tmpfinalllvmsrcprojectscompilerrtlibasanasanmalloclinuxcc x e e in stbimalloc homeradcetstbstbimageh x e e in stbimallocmad homeradcetstbstbimageh x e e in stbibmpload homeradcetstbstbimageh x e e in stbiloadmain homeradcetstbstbimageh x f in stbiloadandpostprocess bit homeradcetstbstbimageh x f b in stbiloadfromfile homeradcetstbstbimageh x f ea in stbiload homeradcetstbstbimageh x fb ff in fini homeradcetstbfuzz x fb ff SUMMARY AddressSanitizer bytes leaked in allocations I actually ran into this problem while using tev Just to summarize the issue it seems that stbimageh fails to load pgm images that contain comments some comment I find a heapbufferoverflow in stbitgaload in version poczip Command bash clang fsanitizeaddress fuzzc lm o poc poc crash Result bash ERROR AddressSanitizer heapbufferoverflow on address x at pc x e a bp x ffcf bdd sp x ffcf bdc READ of size at x thread T x e a in stbitgaload homeradcetstbstbimageh x e a in stbiloadmain homeradcetstbstbimageh x f in stbiloadandpostprocess bit homeradcetstbstbimageh x f a in stbiloadfromfile homeradcetstbstbimageh x f e in stbiload homeradcetstbstbimageh x bcc in main homeradcetstbfuzzc x f eeeb in libcstartmain libx linuxgnulibcso x b x a f in start homeradcetstbfuzz x a f x is located bytes to the right of byte region x x allocated by thread T here x bac in malloc tmpfinalllvmsrcprojectscompilerrtlibasanasanmalloclinuxcc x cc f in stbimalloc homeradcetstbstbimageh x cc f in stbimallocmad homeradcetstbstbimageh x f in stbiloadandpostprocess bit homeradcetstbstbimageh x f a in stbiloadfromfile homeradcetstbstbimageh x f e in stbiload homeradcetstbstbimageh x f b unknown module SUMMARY AddressSanitizer heapbufferoverflow homeradcetstbstbimageh in stbitgaload Shadow bytes around the buggy address x c fff fb x c fff fc x c fff fd x c fff fe x c fff ff x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend one shadow byte represents application bytes Addressable Partially addressable Heap left redzone fa Freed heap region fd Stack left redzone f Stack mid redzone f Stack right redzone f Stack after return f Stack use after scope f Global redzone f Global init order f Poisoned by user f Container overflow fc Array cookie ac Intra object redzone bb ASan internal fe Left alloca redzone ca Right alloca redzone cb ABORTING I have the following example code using the latest stbtilemapeditor c include stdioh include stdlibh define STBTILEMAPEDITORIMPLEMENTATION void STBTEDRAWRECTint x int y int x int y unsigned int color void STBTEDRAWTILEint x int y unsigned short id int highlight float data include stbtilemapeditorh int mainvoid return Trying to compile this gives the errors stbtilemapeditorh In function stbtetilepaint stbtilemapeditorh error x undeclared first use in this function STBTEDRAWTILEx y unsigned short data i tmprops mapy mapx stbtilemapeditorh note each undeclared identifier is reported only once for each function it appears in stbtilemapeditorh error y undeclared first use in this function STBTEDRAWTILEx y unsigned short data i tmprops mapy mapx stbtilemapeditorh In function stbtetileinpalette stbtilemapeditorh error t undeclared first use in this function STBTEDRAWTILExytid slot tmcurtile armeabiv a bits debug build O ok armeabiv a bits release build O crash arm v a bits debug build O ok arm v a bits release build O ok build env gradle androidndkr bx armeabiv a test code cpp quick test const char a hello const char b world logwas a logwbs b char buf x stbspsprintfbuf ss a b crash on this line logwresults buf output Wjni ahello Wjni bworld Flibc Fatal signal SIGBUS at x a d code thread main DAEEAED AEEAEEAEE stack backtrace IDEBUG signal SIGBUS code BUSADRALN fault addr a d DKeyguardViewMediator setHidden false DKeyguardUpdateMonitor sendKeyguardVisibilityChangedtrue DKeyguardUpdateMonitor handleKeyguardVisibilityChanged DKeyguardViewMediator handleMessage enter msg nameSETHIDDEN DKeyguardViewMediator handleMessage exit msg nameSETHIDDEN ISurfaceFlinger virtual void androidLayerScreenshotsetGeometryconst androidspconst androidDisplayDevice androidHWComposerHWCLayerInterface add count DSurfaceFlinger doDisplayComposition skip composition for Builtin Screen type dirtyRegion empty ISurfaceFlinger virtual void androidLayerScreenshotsetGeometryconst androidspconst androidDisplayDevice androidHWComposerHWCLayerInterface add count DSurfaceFlinger doDisplayComposition skip composition for Builtin Screen type dirtyRegion empty IDEBUG r bee r a d r r IDEBUG r r r bee r bee c IDEBUG r r bee sl fp IDEBUG ip sp bee e lr pc a a cpsr IDEBUG IDEBUG backtrace IDEBUG pc dataapplibcomcompanyapp libGL JNIso stbspvsprintfcb IDEBUG pc dataapplibcomcompanyapp libGL JNIso stbspsprintf IDEBUG pc ed db dataapplibcomcompanyapp libGL JNIso appAppImplInitchar const char const char const IDEBUG pc d dataapplibcomcompanyapp libGL JNIso JavacomcompanyappGL JNILibnativeOnActivityCreate IDEBUG IDEBUG stack IDEBUG bee dc IDEBUG bee dcc f a IDEBUG bee dd d systemliblibcso IDEBUG bee dd a IDEBUG bee dd d systemliblibcso IDEBUG bee ddc f a systemliblibcso pthreadinternaladd IDEBUG bee de f a IDEBUG bee de f a systemliblibcso initthread IDEBUG bee de IDEBUG bee dec f e systemliblibcso mmap IDEBUG bee df af IDEBUG bee df a f stack heap overflow in stbttbufpeek img width altsource src poc poczip result ERROR AddressSanitizer heapbufferoverflow on address x c at pc x ea bp x fffffffd a sp x fffffffd READ of size at x c thread T x ea homecaspertargetsstructstbdbgfuzzrunttfuzz x ea x ea homecaspertargetsstructstbdbgfuzzrunttfuzz x ea x e bc homecaspertargetsstructstbdbgfuzzrunttfuzz x e bc x e homecaspertargetsstructstbdbgfuzzrunttfuzz x e x e aa homecaspertargetsstructstbdbgfuzzrunttfuzz x e aa x d a homecaspertargetsstructstbdbgfuzzrunttfuzz x d a x e b homecaspertargetsstructstbdbgfuzzrunttfuzz x e b x ffff e b libx linuxgnulibcso x b x ad homecaspertargetsstructstbdbgfuzzrunttfuzz x ad Address x c is a wild pointer SUMMARY AddressSanitizer heapbufferoverflow homecaspertargetsstructstbdbgfuzzrunttfuzz x ea Shadow bytes around the buggy address x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff a fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff b fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff c fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff d fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff e fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff f fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend one shadow byte represents application bytes Addressable Partially addressable Heap left redzone fa Freed heap region fd Stack left redzone f Stack mid redzone f Stack right redzone f Stack after return f Stack use after scope f Global redzone f Global init order f Poisoned by user f Container overflow fc Array cookie ac Intra object redzone bb ASan internal fe Left alloca redzone ca Right alloca redzone cb Shadow gap cc ABORTING Program received signal SIGABRT Aborted registers RAX x RBX x be x RCX x ffff e e GIraise mov rcxQWORD PTR rsp x RDX x RSI x fffffffc e x RDI x RBP x fffffffd x fffffffd a x fffffffd x fffffffd x fffffffd d x fffffffd d RSP x fffffffc e x RIP x ffff e e GIraise mov rcxQWORD PTR rsp x R x R x fffffffc e x R x R x R x fffffffd a x fffffffd x fffffffd x fffffffd d x fffffffd d x fffffffe R x fffffffd x fffffffd a x e e R x fffffffd x fffffff c x R x ce x EFLAGS x carry PARITY adjust ZERO sign trap INTERRUPT direction overflow code x ffff e e b GIraise mov edi x x ffff e e GIraise mov eax xe x ffff e e GIraise syscall x ffff e e GIraise mov rcxQWORD PTR rsp x x ffff e e f GIraise xor rcxQWORD PTR fs x x ffff e ea GIraise mov eaxr d x ffff e eab GIraise jne x ffff e ecc GIraise x ffff e ead GIraise add rsp x stack x fffffffc e x x fffffffc e x c b b x fffffffc f x x fffffffc f x x fffffffc x x fffffffc x x fffffffc x x fffffffc x Legend code data rodata value Stopped reason SIGABRT GIraise sigsigentry x at sysdepsunixsysvlinuxraisec sysdepsunixsysvlinuxraisec No such file or directory gdbpeda bt GIraise sigsigentry x at sysdepsunixsysvlinuxraisec x ffff e in GIabort at abortc x b in sanitizerAbort at tmpfinalllvmsrcprojectscompilerrtlibsanitizercommonsanitizerposixlibcdepcc x af e in sanitizerDie at tmpfinalllvmsrcprojectscompilerrtlibsanitizercommonsanitizerterminationcc x c in ScopedInErrorReport at tmpfinalllvmsrcprojectscompilerrtlibasanasanreportcc x df in ReportGenericError at tmpfinalllvmsrcprojectscompilerrtlibasanasanreportcc x ab in asanreportload at tmpfinalllvmsrcprojectscompilerrtlibasanasanrtlcc x ea in stbttbufpeek b x fffffffd at SRCstbtruetypeh x ea in stbttdictget b x fffffffd key x at SRCstbtruetypeh x e bc in stbttdictgetints b x fffffffd key x outcount x out x fffffffd at SRCstbtruetypeh x e in stbttgetsubrs cff fontdict at SRCstbtruetypeh x e aaa in stbttInitFontinternal info x fffffffe data x OTTO fontstart x at SRCstbtruetypeh x d a in stbttInitFont info x fffffffe data x OTTO offset x at SRCstbtruetypeh x e b in main argc x argv x fffffffe at fuzzsrcttfuzzc x ffff e b in libcstartmain main x e f main argc x argv x fffffffe initoptimized out finioptimized out rtldfinioptimized out stackend x fffffffe at csulibcstartc x ad a in start 