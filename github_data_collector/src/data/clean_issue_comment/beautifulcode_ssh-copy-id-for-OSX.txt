added p for port option and added ability to have no space after i binsh Shell script to install your public key on a remote machine Takes the remote machine name as an argument Obviously the remote machine must accept password authentication or one of the other keys in your sshagent for this to work IDFILEHOMEsshidrsapub for arg in do case arg in i IDFILEecho arg sed sig LASTidfile continue p PORTecho arg sed spg LASTport continue if LAST idfile expr arg then IDFILEarg elif LAST port then PORTarg else REMOTESERVERarg fi LAST esac done echo IDFILE IDFILE echo PORT PORT echo REMOTESERVER REMOTESERVER if n IDFILE then if expr IDFILE pub devnull then IDFILEIDFILE else IDFILEIDFILEpub fi else if xSSHAUTHSOCK x then GETIDGETID sshadd L grep vxF The agent has no identities fi fi if z eval GETID r IDFILE then GETIDcat IDFILE fi if z eval GETID then echo ERROR No identities found exit fi if lt h help z REMOTESERVER then echo Usage i identityfile user machine exit fi if n PORT then PPORTpPORT fi eval GETID ssh REMOTESERVER PPORT umask test d ssh mkdir ssh cat sshauthorizedkeys test x sbinrestorecon sbinrestorecon ssh sshauthorizedkeys exit cat EOF Now try logging into the machine with ssh and check in sshauthorizedkeys to make sure we havent added extra keys that you werent expecting EOF After getting the script working and posting the findings in I ran the script again on a different server one I had never connected to and so I had to accept the server key if that makes a difference I typed the password as requested and it exited with code and no output again I tried to log in with ssh and it prompted me for the password again On logging in I inspected authorizedkeys and saw that it had a bizarre line as follows with my correct public key partially replaced with stars and a seemingly corrupt key or is it the servers key transmountain is part of the hostname partially replaced with hashes sshrsa AAAAB N PHLTOun transmountainrsakey sshrsa AAAAB N eqiY Userstrembysshidrsa I then logged out and ran the script again This time it exited with code again but when I tried to ssh in to the server again it worked Now there is a second line in authorizedkeys identical to the tail section of the above sshrsa AAAAB N eqiY Userstrembysshidrsa No idea what is happening here If you request I could remove my keys and acceptance of the servers key and try again 