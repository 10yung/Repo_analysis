Merkle trees length should be n not n For example when there are leaf nodes it should be append to a length of eight not six Indexes of TXOutput is different in TXOutputs and Transaction use index in utxo to initialize inputs of transaction then put it into block is wrong When I send transaction without mine flag so when I wait for the miner node to mine I get an error on FindTransaction method panic transaction does not exist goroutine running logPanic xc x x usrlocalgosrclogloggo xc blockchainmainblockchainHandle x f xc af homemelianorgosrcblockchainmainblockchainblockgo x blockchainmainblockchainBlockChainVerifyTransaction xc c xc f xc homemelianorgosrcblockchainmainblockchainblockchaingo x e blockchainmainnetworkMineTx xc c homemelianorgosrcblockchainmainnetworknetworkgo x blockchainmainnetworkHandleTx xc e x a x xc c homemelianorgosrcblockchainmainnetworknetworkgo x blockchainmainnetworkHandleConnection x fa xc e xc c homemelianorgosrcblockchainmainnetworknetworkgo x d created by blockchainmainnetworkStartServer homemelianorgosrcblockchainmainnetworknetworkgo x e exit status If a user has a balance of and now he initiates a transaction with a payment of and then a transaction with a payment of when no block is generated is there a dual consumption problem This bug may lead to spend the UTXO which isnt owned by TXInputPubKey In line blockchaingo it seems that TXOutputs has never been declared is it TXOutput or I miss something In branch part blockchaingoL The second judgment condition accumulated amount is not necessary It only works when amount In this case we should check the value of amount at the beginning of the function func bc Blockchain FindSpendableOutputspubKeyHash byte amount int int map string int unspentOutputs makemap string int accumulated Maybe we should check amount at the beginning of the function if amount return accumulatedunspentOutputs unspentTXs bcFindUnspentTransactionspubKeyHash Work for tx range unspentTXs txID hexEncodeToStringtxID for outIdx out range txVout if outIsLockedWithKeypubKeyHash Delete accumulated amount accumulated outValue unspentOutputs txID appendunspentOutputs txID outIdx if accumulated amount break Work return accumulated unspentOutputs acc validOutputs UTXOSetFindSpendableOutputspubKeyHash amount if acc amount logPanicERROR Not enough funds Build a list of inputs for txid outs range validOutputs txID err hexDecodeStringtxid if err nil logPanicerr for out range outs input TXInputtxID out nil walletPublicKey inputs appendinputs input used UTXOset index directly to set TxInputVout was a bug because exist TxOutput has been used the TxOutput index is different from UTXOset index 