Reproducer python pythran export tfloat int float int import numpy as np def tdat datfilter datpoints iterations aggregation for i in rangeiterations aggregation npsumnplinalgnormdat datfilteri datpoints i axis return aggregation launched through shell python m timeit s import numpy as np n d iterations nprandomseed dat nprandomrandomn ddatfilter nprandomrandint n sizen datpoints nprandomrandomn d from t import t tdat datfilter datpoints iterations original code from Notminimalbutworks example python cython boundscheckFalse cython wraparoundFalse cython cdivisionTrue cython infertypesTrue cython nppythranTrue Created on Tue Jan author Chronum import numpy as np cimport cython cimport numpy as np cdef double PI cpdef npndarray createoverlapmatrixdouble inalphaarray cdef double s s npempty cdef double alphaarray alphaarray inalphaarray cdef unsigned int p q for p in range for q in range s p q PI alphaarray p alphaarray q return npasarrays dtype npfloat setuppy python Created on Mon Jan author Chronum from setuptools import setup from setuptoolsextension import Extension from CythonBuild import cythonize import CythonCompilerOptions CythonCompilerOptionsannotate True import numpy as np extensionlist Extensionminimal minimalpyx includedirs npgetinclude setupextmodules cythonizeextensionlist languagelevel force True Compiles fine on Ubuntugcc On Windows the following error Ive pasted it in hastebin since the linebreaks were being weird with a direct paste The following functions show a discrepancy between python and pythran pythran export initint def initx w ii for ii in rangex return w pythran export testint list list def teststate printstate state printstate return state Using with python c from newBug import testinit Ainit testAprintA Pythran output Python output test is passed a list by id in python so modifying elements of the list impacts the original list Not so in pythran The following code behaves differently in python and in pythran pythran export test def test AA for ii in rangelenAA AApop printlenAA In python AA ends up empty not so with pythran This does not compile python MacOS pythran export test def test X tuple B X B printB printX There is nothing on crosscompilation in Pythran documentation I understand that it is a subject in itself but sometimes adding marchnative really speedup computations but then the binary is no longer generalist Would it be possible to compile for different CPU architectures so that the binaries would be both able to run on old machines and able to use advanced instructions where they are available Unfortunately I am already using a file called sitecfg for other purposes It would be good to either choose a different more specific name for pythran A command line option or config option to specify a different name I was trying to compile my module and got the error below even though pythran successfully generates a cpp source from my module Besides it takes very long to generate and compile this module Any thoughts Any other info that I should attach to this issue prefont colorEF bmschappobfontfont colorCC giraneurofontfont color bDropboxpneuromatprogramaspythonbalancednetglbfont pythran GLNetEISimLibpy v INFO sys file exists homemschappolocallibpython sitepackagespythranpythrancfg INFO platform file exists homemschappolocallibpython sitepackagespythranpythranlinuxcfg WARNING user file does not exist homemschappopythranrc INFO pythranrc section pythran is valid and options are correct INFO pythranrc section typing is valid and options are correct INFO pythranrc section compiler is valid and options are correct running buildext font color Anewcompiler returns ltclass aposdistutilsunixccompilerUnixCCompiler apos gtfont building aposGLNetEISimLib apos extension C compiler x linuxgnugcc pthread DNDEBUG g fwrapv O Wall g fstackprotectorstrong Wformat Werrorformatsecurity Wdatetime DFORTIFYSOURCE fPIC creating tmptmph gipw tmp compile options aposDENABLEPYTHONMODULE DPYTHRAN DPYTHRANBLASBLAS Ihomemschappolocallibpython sitepackagespythran Ihomemschappolocallibpython sitepackagesnumpycoreinclude Iusrincludepython m c apos extra options aposstdc fnomatherrno w fvisibilityhidden fnowrapv apos x linuxgnugcc tmptmp xtcn dcpp bx linuxgnugccb font colorEF binternal compiler error bfontKilled program cc plus Please submit a full bug report with preprocessed source if appropriate See ltfileusrsharedocgcc READMEBugs gt for instructions WARNING Compilation error trying hard to find its origin WARNING Nop I aposm going to flood you with C errors CRITICAL Cover me Jack Jack Jaaaaack E error Command quotx linuxgnugcc pthread DNDEBUG g fwrapv O Wall g fstackprotectorstrong Wformat Werrorformatsecurity Wdatetime DFORTIFYSOURCE fPIC DENABLEPYTHONMODULE DPYTHRAN DPYTHRANBLASBLAS Ihomemschappolocallibpython sitepackagespythran Ihomemschappolocallibpython sitepackagesnumpycoreinclude Iusrincludepython m c tmptmp xtcn dcpp o tmptmph gipw tmptmp xtcn do stdc fnomatherrno w fvisibilityhidden fnowrapv quot failed with exit status pre Hi First thanks a lot for your great work Ive started to introduce Pythran in my Python trainings as it is a nice way to speed up Python Im just started with it and Im not really used in exporting functions Ive tried this in a jupyter notebook python pythran fopenmp marchnative import numpy as np pythran export mandelbrotsetfloat float float float float float int float def mandelbrotsetxmin xmax ymin ymax xn yn maxiter horizon X nplinspacexmin xmax intxn dtypenpfloat Y nplinspaceymin ymax intyn dtypenpfloat C X Y None j N npzerosCshape dtypenpint Z npzerosCshape npcomplex for n in rangemaxiter I nplessnpabsZ horizon N I n Z I Z I C I N N maxiter return Z N And Ive got the following output I do not understand I guess it is due to the double returned value but my C is a bit far away Could you help me solving the issue Thanks a lot WARNING Compilation error trying hard to find its origin WARNING Nop Im going to flood you with C errors DistutilsExecError Traceback most recent call last anacondalibpython sitepackagesnumpydistutilsunixccompilerpy in UnixCCompilercompileself obj src ext ccargs extrapostargs ppopts selfspawnselfcompilerso ccargs src o obj deps extrapostargs display display except DistutilsExecError anacondalibpython sitepackagesnumpydistutilsccompilerpy in lambdaself args kw Py k does not have unbound method anymore MethodType does not work m lambda self args kw funcself args kw setattrklass methodname m anacondalibpython sitepackagesnumpydistutilsccompilerpy in CCompilerspawnself cmd display raise DistutilsExecErrorCommand s failed with exit status ds cmd s msg DistutilsExecError Command gcc pthread B homealiquisanacondacompilercompat Wlsysroot Wsigncompare DNDEBUG g fwrapv O Wall fPIC DENABLEPYTHONMODULE DPYTHRAN DPYTHRANBLASBLAS Ihomealiquisanacondalibpython sitepackagespythran Ihomealiquisanacondalibpython sitepackagesnumpycoreinclude Iusrlocalinclude Iusrinclude Ihomealiquisanacondainclude Ihomealiquisanacondaincludepython m c tmptmpvqhbc xbcpp o tmptmpk ptrjztmptmpvqhbc xbo stdc fnomatherrno w fvisibilityhidden fnowrapv fopenmp failed with exit status During handling of the above exception another exception occurred CompileError Traceback most recent call last anacondalibpython distutilscorepy in setupattrs try distruncommands except KeyboardInterrupt anacondalibpython distutilsdistpy in runcommandsself for cmd in selfcommands selfruncommandcmd anacondalibpython distutilsdistpy in runcommandself command cmdobjensurefinalized cmdobjrun selfhaverun command anacondalibpython distutilscommandbuildextpy in runself Now actually compile and link everything selfbuildextensions anacondalibpython distutilscommandbuildextpy in buildextensionsself else selfbuildextensionsserial anacondalibpython distutilscommandbuildextpy in buildextensionsserialself with selffilterbuilderrorsext selfbuildextensionext anacondalibpython sitepackagespythrandistpy in buildextensionself ext try return superPythranBuildExt selfbuildextensionext finally anacondalibpython distutilscommandbuildextpy in buildextensionself ext extrapostargsextraargs dependsextdepends anacondalibpython sitepackagesnumpydistutilsccompilerpy in lambdaself args kw Py k does not have unbound method anymore MethodType does not work m lambda self args kw funcself args kw setattrklass methodname m anacondalibpython sitepackagesnumpydistutilsccompilerpy in CCompilercompileself sources outputdir macros includedirs debug extrapreargs extrapostargs depends for o in builditems singlecompileo anacondalibpython sitepackagesnumpydistutilsccompilerpy in singlecompileargs with jobsemaphore selfcompileobj src ext ccargs extrapostargs ppopts finally anacondalibpython sitepackagesnumpydistutilsccompilerpy in lambdaself args kw Py k does not have unbound method anymore MethodType does not work m lambda self args kw funcself args kw setattrklass methodname m anacondalibpython sitepackagesnumpydistutilsunixccompilerpy in UnixCCompilercompileself obj src ext ccargs extrapostargs ppopts msg strgetexception raise CompileErrormsg CompileError Command gcc pthread B homealiquisanacondacompilercompat Wlsysroot Wsigncompare DNDEBUG g fwrapv O Wall fPIC DENABLEPYTHONMODULE DPYTHRAN DPYTHRANBLASBLAS Ihomealiquisanacondalibpython sitepackagespythran Ihomealiquisanacondalibpython sitepackagesnumpycoreinclude Iusrlocalinclude Iusrinclude Ihomealiquisanacondainclude Ihomealiquisanacondaincludepython m c tmptmpvqhbc xbcpp o tmptmpk ptrjztmptmpvqhbc xbo stdc fnomatherrno w fvisibilityhidden fnowrapv fopenmp failed with exit status During handling of the above exception another exception occurred SystemExit Traceback most recent call last anacondalibpython sitepackagespythrantoolchainpy in compilecxxfilemodulename cxxfile outputbinary kwargs buildlib builddir buildtemp buildtmp anacondalibpython sitepackagesnumpydistutilscorepy in setupattr return oldsetupnewattr anacondalibpython distutilscorepy in setupattrs else raise SystemExiterror strmsg SystemExit error Command gcc pthread B homealiquisanacondacompilercompat Wlsysroot Wsigncompare DNDEBUG g fwrapv O Wall fPIC DENABLEPYTHONMODULE DPYTHRAN DPYTHRANBLASBLAS Ihomealiquisanacondalibpython sitepackagespythran Ihomealiquisanacondalibpython sitepackagesnumpycoreinclude Iusrlocalinclude Iusrinclude Ihomealiquisanacondainclude Ihomealiquisanacondaincludepython m c tmptmpvqhbc xbcpp o tmptmpk ptrjztmptmpvqhbc xbo stdc fnomatherrno w fvisibilityhidden fnowrapv fopenmp failed with exit status During handling of the above exception another exception occurred CompileError Traceback most recent call last ipythoninput b e in module getipythonruncellmagicpythran fopenmp import numpy as np n npythran export mandelbrotsetfloat float float float float float int float ndef mandelbrotsetxmin xmax ymin ymax xn yn maxiter horizon n X nplinspacexmin xmax intxn dtypenpfloat n Y nplinspaceymin ymax intyn dtypenpfloat n C X Y None j n N npzerosCshape dtypenpint n Z npzerosCshape npcomplex n for n in rangemaxiter n I nplessnpabsZ horizon n N I n n Z I Z I C I n N N maxiter n return Z N n anacondalibpython sitepackagesIPythoncoreinteractiveshellpy in runcellmagicself magicname line cell magicargs selfvarexpandline stackdepth with selfbuiltintrap result fnmagicargs cell return result decoratorgen in pythranself line cell anacondalibpython sitepackagesIPythoncoremagicpy in lambdaf a k but its overkill for just that one bit of state def magicdecoarg call lambda f a k fa k if callablearg anacondalibpython sitepackagespythranmagicpy in pythranself line cell mupdatecellencodeutf modulename pythranized mhexdigest modulepath pythrancompilepythrancodemodulename cell kwargs module imploaddynamicmodulename modulepath selfimportallmodule anacondalibpython sitepackagespythrantoolchainpy in compilepythrancodemodulename pythrancode specs opts cpponly pyonly outputfile moduledir kwargs strmodule outputbinaryoutputfile kwargs except CompileError loggerwarnCompilation error trying hard to find its origin anacondalibpython sitepackagespythrantoolchainpy in compilecxxcodemodulename cxxcode outputbinary keeptemp kwargs fdpath writetempcxxcode cpp outputbinary compilecxxfilemodulename fdpath outputbinary kwargs if not keeptemp remove tempfile anacondalibpython sitepackagespythrantoolchainpy in compilecxxfilemodulename cxxfile outputbinary kwargs except SystemExit as e raise CompileErrorstre def copysrcfile destfile CompileError error Command gcc pthread B homealiquisanacondacompilercompat Wlsysroot Wsigncompare DNDEBUG g fwrapv O Wall fPIC DENABLEPYTHONMODULE DPYTHRAN DPYTHRANBLASBLAS Ihomealiquisanacondalibpython sitepackagespythran Ihomealiquisanacondalibpython sitepackagesnumpycoreinclude Iusrlocalinclude Iusrinclude Ihomealiquisanacondainclude Ihomealiquisanacondaincludepython m c tmptmpvqhbc xbcpp o tmptmpk ptrjztmptmpvqhbc xbo stdc fnomatherrno w fvisibilityhidden fnowrapv fopenmp failed with exit status This silly module takes min to compile while this can do it in just one This is not really a big problem for using Pythran but it becomes annoying when trying to debug it I would be perfectly happy if this gets closed with WONTFIX 