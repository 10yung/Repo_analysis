 root app android androidprocess activity getRunningForegroundApps if usageStats null usageStatssize if HavaPermissionForTestcontext false Intent intent new IntentSettingsACTIONUSAGEACCESSSETTINGS intentsetFlagsIntentFLAGACTIVITYNEWTASK contextstartActivityintent ToastmakeTextcontext n App ToastLENGTHSHORTshow false usageStatssize boolean r usageStats null androidutilLogeCurrentusageStatsnullr return false if usageStats null usageStatssize if HavaPermissionForTestcontext false Intent intent new IntentSettingsACTIONUSAGEACCESSSETTINGS intentsetFlagsIntentFLAGACTIVITYNEWTASK contextstartActivityintent Toast Looperprepare ToastmakeTextcontext n App ToastLENGTHSHORTshow Looperloop loop return false true return true public static boolean isAppForegroundRunningfinal Context context ActivityManager activityManager ActivityManager contextgetSystemServiceContextACTIVITYSERVICE if activityManager null return false ListActivityManagerRunningTaskInfo tasks activityManagergetRunningTasks if tasksisEmpty ComponentName topActivity tasksget topActivity if topActivitygetPackageNameequalscontextgetPackageName return true return false Android Galaxy Nexus AndroidProcessesgetRunningForegroundAppscontext AndroidProcessesgetRunningForegroundAppscontext foregroundtrue false xposed proc README onStop onStart appCount activity A B B Activity onStart A Activity onStop 