Please answer these questions before submitting your issue Thanks What did you do If possible provide a simple script for reproducing the error Im trying to split my application workers in batches each doing a specific job ex rented cached page wait for api response process an image Some jobs can take min other can take ms to complete Some need a few MB of RAM other need a few GB Im trying to redirect requests to the first free available worker in the batch but have no way to know which one is free What did you expect to see It would be nice if in the Server object we could have a maparray of workers and their status and maybe a custom variable that can be accessed everywhere dispatchfunc function Server server int fd int type string data Get first free worker eventually with some rules based on data for i i intserversetting workernum i Some way to tell which worker is free or busy if serverworkers i status SWOOLEWORKERBUSY return i All workers busy not sure what will happen return SWOOLEDISPATCHRESULTUSERFUNCFALLBACK What did you see instead There is no way with the built in system to know if a worker is free or busy so requests look like this Two threads processing space idle t t Should see something like this free one gets the work no idle time t t The only way to do this now is to use the swoole map or some external storage to store the state ex redis and that slows everything down an dis very messy when to mark worker as busy and when to mark as free What version of Swoole are you using show your php ri swoole swoole Swoole enabled Author Swoole Team teamswoolecom Version RC Built Jan coroutine enabled epoll enabled eventfd enabled signalfd enabled cpuaffinity enabled spinlock enabled rwlock enabled sockets enabled openssl OpenSSL d Sep http enabled pcre enabled zlib mutextimedlock enabled pthreadbarrier enabled futex enabled mysqlnd enabled asyncredis enabled Directive Local Value Master Value swooleenablecoroutine On On swooleenablelibrary On On swooleenablepreemptivescheduler Off Off swooledisplayerrors On On swooleuseshortname On On swooleunixsockbuffersize What is your machine environment used including version of kernel php gcc Distributor ID Ubuntu Description Ubuntu LTS Release Codename bionic PHP cli built Nov NTS Copyright c The PHP Group Zend Engine v Copyright c Zend Technologies with Zend OPcache v Copyright c by Zend Technologies Thread model posix gcc version Debian roottxmappapi lib php ri swoole swoole Swoole enabled Author Swoole Team teamswoolecom Version Built Jan coroutine enabled epoll enabled eventfd enabled signalfd enabled cpuaffinity enabled spinlock enabled rwlock enabled sockets enabled openssl OpenSSL kfips Jan http enabled pcre enabled zlib mutextimedlock enabled pthreadbarrier enabled futex enabled mysqlnd enabled asyncredis enabled Directive Local Value Master Value swooledisplayerrors On On swooleenablecoroutine On On swooleenablelibrary On On swooleenablepreemptivescheduler Off Off swooleunixsockbuffersize swooleuseshortname Off Off roottxmappapi lib php v PHP cli built Jan NTS Copyright c The PHP Group Zend Engine v Copyright c Zend Technologies with Zend OPcache v Copyright c by Zend Technologies roottxmappapi lib gcc v Using builtin specs COLLECTGCCgcc COLLECTLTOWRAPPERusrlibexecgccx redhatlinux ltowrapper Target x redhatlinux Configured with configure prefixusr mandirusrshareman infodirusrshareinfo withbugurl enablebootstrap enableshared enablethreadsposix enablecheckingrelease withsystemzlib enablecxaatexit disablelibunwindexceptions enablegnuuniqueobject enablelinkerbuildid withlinkerhashstylegnu enablelanguagesccobjcobjcjavafortranadagolto enableplugin enableinitfiniarray disablelibgcj withislbuilddirbuildBUILDgcc objx redhatlinuxislinstall withcloogbuilddirbuildBUILDgcc objx redhatlinuxclooginstall enablegnuindirectfunction withtunegeneric witharch x buildx redhatlinux Thread model posix gcc version Red Hat GCC roottxmappapi lib uname a Linux txmappapi el x SMP Mon Dec UTC x x x GNULinux roottxmappapi API gdb php c core GNU gdb GDB Red Hat Enterprise Linux el Copyright C Free Software Foundation Inc License GPLv GNU GPL version or later This is free software you are free to change and redistribute it There is NO WARRANTY to the extent permitted by law Type show copying and show warranty for details This GDB was configured as x redhatlinuxgnu For bug reporting instructions please see Reading symbols from usrlocalphp binphpdone New LWP Thread debugging using libthreaddb enabled Using host libthreaddb library lib libthreaddbso Core was generated by tianxinMaster Program terminated with signal Segmentation fault zendstringhashval ssentry x fffff at usrlocalsrcphp Zendzendstringh zendinternedstringfindpermanent strstrentry x fffff at usrlocalsrcphp Zendzendstringc x f ae d in accelreplacestringbyprocesspermanent str x fffff at usrlocalsrcphp extopcacheZendAcceleratorc x f ae in accelcopypermanentstrings newinternedstring x f ae accelreplacestringbyprocesspermanent at usrlocalsrcphp extopcacheZendAcceleratorc return ZSTRHs ZSTRHs zendstringhashfuncs Missing separate debuginfos use debuginfoinstall cyrussasllib el x freetype el x glibc el x keyutilslibs el x krb libs el x libcomerr el x libcurl el x libgcc el x libidn el x libjpegturbo el x libpng el x libselinux el x libssh el x libstdc el x libxml el x ncurseslibs el x nspr el x nss el x nsssoftoknfreebl el x nssutil el x openldap el x openssllibs k el x pcre el x readline el x xzlibs el x zlib el x Please answer these questions before submitting your issue Thanks What did you do If possible provide a simple script for reproducing the error serverphp php http new Swoole Http Server httponrequest function request Response response if requestserver requestmethod HEAD responsestatus responseheaderContentLength responseend return responseendh Hello Swoole rand h httpstart clientphp php php use Swoole Coroutine Http Client use Swoole Coroutine Scheduler scheduler new Scheduler scheduleraddfunction client new Client clientsetMethodhead clientexecuteindex vardumpclient schedulerstart Execute serverphp and then execute clientphp What did you expect to see A normal response of http client with http status code What did you see instead When clientsetMethodhead I got status code response but not When clientsetMethodHEAD I got Protocol Error response What version of Swoole are you using show your php ri swoole swoole Swoole enabled Author Swoole Team teamswoolecom Version Built Jan coroutine enabled kqueue enabled rwlock enabled sockets enabled http enabled pcre enabled zlib brotli E D asyncredis enabled Directive Local Value Master Value swooleenablecoroutine On On swooleenablelibrary On On swooleenablepreemptivescheduler Off Off swooledisplayerrors On On swooleuseshortname Off Off swooleunixsockbuffersize What is your machine environment used including version of kernel php gcc Darwin huangzhaohuideMacBookProlocal Darwin Kernel Version Sat Nov PST rootxnu RELEASEX x PHP cli built Jul NTS Copyright c The PHP Group Zend Engine v Copyright c Zend Technologies with Zend OPcache v Copyright c by Zend Technologies Configured with prefixLibraryDeveloperCommandLineToolsusr withgxxincludedirLibraryDeveloperCommandLineToolsSDKsMacOSXsdkusrincludec Apple clang version clang Target x appledarwin Thread model posix InstalledDir LibraryDeveloperCommandLineToolsusrbin Please answer these questions before submitting your issue Thanks What did you do If possible provide a simple script for reproducing the error try context streamcontextcreatearray http array timeout res filegetcontents Loginfosuccess res catch Throwable e Logerrorscoded s getclasse egetCode egetMessage execping c graphqqcomarray Logerrorjsonencodearray What did you expect to see What did you see instead Jan CST error trace TestTaskphp ErrorExceptioncode filegetcontents failed to open stream DNS Lookup resolve timeout Jan CST error trace TestTaskphp PING graphqqcommsftencentcloudcom bytes of data bytes from icmpseq ttl time ms bytes from icmpseq ttl time ms graphqqcommsftencentcloudcom ping statistics packets transmitted received packet loss time msrtt min avg max mdev ms Jan CST error trace TestTaskphp ErrorExceptioncode filegetcontents failed to open stream DNS Lookup resolve timeout What version of Swoole are you using show your php ri swoole swoole Swoole enabled Author Swoole Team teamswoolecom Version Built Sep coroutine enabled epoll enabled eventfd enabled signalfd enabled cpuaffinity enabled spinlock enabled rwlock enabled sockets enabled openssl OpenSSL kfips Jan http enabled pcre enabled zlib enabled mutextimedlock enabled pthreadbarrier enabled futex enabled mysqlnd enabled asyncredis enabled Directive Local Value Master Value swooleenablecoroutine On On swooleenablelibrary On On swooleenablepreemptivescheduler Off Off swooledisplayerrors On On swooleuseshortname On On swooleunixsockbuffersize What is your machine environment used including version of kernel php gcc PHP cli built Oct NTS Copyright c The PHP Group Zend Engine v Copyright c Zend Technologies Please answer these questions before submitting your issue Thanks What did you do If possible provide a simple script for reproducing the error onWorkerStart RuntimeenableCoroutine onClose thrift php try client new DeviceClient clientoffLineuniquemark catch Exception e Logwarning DeviceonClose LINE msg soa error data fd fd msg egetMessage php DeviceClient thrfit TScoket socket new TSocketserviceConfig host serviceConfig port socketsetRecvTimeoutserviceConfig recvtimeout socketsetSendTimeoutserviceConfig sendtimeout socketsetDebugserviceConfig debug false thistransport new TBufferedTransportsocket protocol new TBinaryProtocolAcceleratedthistransport thisinput thisoutput protocol thistransportopen thrift Socket try onClose strace woker connect epollctl epollwait read sendto recvfrom ID offLine swoole Socket socket thrift socket madvise What did you expect to see What did you see instead What version of Swoole are you using show your php ri swoole swoole Swoole enabled Author Swoole Team teamswoolecom Version Built Dec coroutine enabled epoll enabled eventfd enabled signalfd enabled cpuaffinity enabled spinlock enabled rwlock enabled sockets enabled openssl OpenSSL kfips Jan http enabled pcre enabled zlib mutextimedlock enabled pthreadbarrier enabled futex enabled asyncredis enabled Directive Local Value Master Value swooleenablecoroutine On On swooleenablelibrary On On swooleenablepreemptivescheduler Off Off swooledisplayerrors On On swooleuseshortname On On swooleunixsockbuffersize What is your machine environment used including version of kernel php gcc PHP cli built Dec NTS Copyright c The PHP Group Zend Engine v Copyright c Zend Technologies with Zend OPcache v Copyright c by Zend Technologies Please answer these questions before submitting your issue Thanks What did you do If possible provide a simple script for reproducing the error swoolehttp client grpc grpc BidiStreaming What did you expect to see recv write What did you see instead end recv fin DATA frame response What version of Swoole are you using show your php ri swoole master What is your machine environment used including version of kernel php gcc Hi Is there currently a way to track when a coroutine switch occurs Having this will allow for profiling and stats For example profiling code in coroutine context that contains methods that yield to another coroutine can not be done with simple code like php start microtimetrue CoreadFileblatxt end microtimetrue print end start This does not take into account the time which the coroutine waits for the scheduler to give back control to it even if the file reading is done there will be other coroutines I imagine something like php gofunction onEnterfunctioncid fromcid NULL worker is now executing cid onYield functioncid tocid NULL worker has now left cid And these can be invoked multiple times during coroutine execution If possible a second argument can be provided for the previous or next coroutine that is beign executed Problem Swoole setting uploadtmpdir allows to configure a directory containing uploaded files Temporary filenames are generated randomly to protect from unauthorized access to files However randomness of filenames prevents tests from comparing against fixture contents Tests become more complicated as they have to override random filenames with fixture path testsswoolehttpserveruploadfilearraydefaultphpt testsswoolehttpserveruploadfilearrayparsedphpt Solution Introduce configuration for custom filename generation function for example php serverset uploadtmpfunc function path name strtrbase encoderandombytes return pathswooleupfilename Fixture upload filename in tests php count serverset uploadtmpfunc function use count return varswooleupfilefixture count Please answer these questions before submitting your issue Thanks What did you do If possible provide a simple script for reproducing the error Support DTLS example connecting with hue entertainment What did you expect to see DTLS support What did you see instead no support What version of Swoole are you using show your php ri swoole What is your machine environment used including version of kernel php gcc WSL debian php 