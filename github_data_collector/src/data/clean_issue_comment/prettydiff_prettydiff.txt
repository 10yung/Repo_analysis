Im getting this error running a diff between the files in this gist I found this from a local implementation and thought I must have something misconfigured or wrong elsewhere but then I found the same error when providing the two files as input here I use prettydiff as a beautifier as part of atombeautifier I recently encountered an odd behavior and was able to boil it down to the following minimal example This xml xml module namefoo ver encodingRules null type nameHeader len type is beautified to xml module namefoo ver encodingRules null type name Header len type Problem The values now have a leading spacechar and len got an extra As soon as null is removed the beautifier works Since this did not happen with some other beautifiers I thought it might be worth a mention Source testtxttwig testtxt test contacttesttestfoo foo testcom DIRECT testcom DIRECT Output Error Library prettydiffbeautifymarkdown does not exist Whatever the reason may be prettydiff should never delete the source We had to rename the file to testtwigtxt as a workaround Source block content script dataprettydiffignore function var d document s dcreateElementscript script endblock Problem vendorbinprettydiffsh testtwig testnodemodulesprettydiffjsprettydiffjs tagNamedatatoken databegin parsecount toLowerCase TypeError Cannot read property toLowerCase of undefined at lexermarkupcontent testnodemodulesprettydiffjsprettydiffjs at Objectlexermarkup as markup testnodemodulesprettydiffjsprettydiffjs at Objectparseparser as parser testnodemodulesprettydiffjsprettydiffjs at mode testnodemodulesprettydiffjsprettydiffjs at nodeappsreadMethodresolvestatresolveItemfileCallbackdiffrc testnodemodulesprettydiffjsservicesjs at nodeappsreadMethodprettydiffrc testnodemodulesprettydiffjsservicesjs at ObjectnodeappsreadMethodresolvestatresolveItemfileCallback as callback testnodemodulesprettydiffjsservicesjs at nodeappsreadFilefileopenreadread It works as expected after deleting the dataprettydiffignore attribute This works block content script function var d document s dcreateElementscript script endblock The problem is that your XHR requests are made without https With Python fstrings it inserts a space between the f and the quote Example printfHello World gets changed to printf Hello World which is illegal syntax When deploying compressed CSS responsive display is broken Media Query at that time is this media screen andmaxwidth px It worked fine if I cured this Insert a space after and media screen and maxwidth px I didnt know where to report this error and wrote it here I ca n t speak English so I m sorry if I had a rude expression using Google Translate Source div classalwayspresent if withCollapse withcollapse datatogglecollapse else nocollapse endif pThingy here possibly with collapse attachedp div Result after beautify div classalwayspresent if withCollapse withcollapse datatogglecollapse else nocollapsenocollapse Problem The endif and everything afterwards just get stripped away Story I ran into this issue with titles that only sometimes have a collapsed attached To achieve different styling I add different classes depending on some logic Trying to be clever I also wanted to add other HTML attributes using the same logic When wanting a collapse I add the class withcollapse to the classattribute Also I add the datatogglecollapse attribute When not wanting a collapse I add the class nocollapse to the classattribute The datatoggleattribute is omitted in this case I realize this is messy HTML to begin with and it might be bad practice to use ifclauses to split HTML attributes the way I did PHPStorm already warns me that not all tags are claused since it somehow cannot handle the entanglement of attributes and ifclauses too But still I think just deleting stuff is not a sane way to handle this Please excuse me if you find the bug report lacking or peculiar somehow this is my first time PS Turning the logic around makes no difference Source div classalwayspresent if noCollapse nocollapse else withcollapse datatogglecollapse endif pThingy here possibly with collapse attachedp div Result div classalwayspresent if noCollapse nocollapse else withcollapse datatoggle collapsecollapse Edits for layout Example to reproduce on Beautify mode Before twig html headhead body ALL SPACES AND NO TABS MAKES JACK A DULL BOY ALL SPACES AND NO TABS MAKES JACK A DULL BOY p ALL SPACES AND NO TABS MAKES JACK A DULL BOY p div classrows ALL SPACES AND NO TABS MAKES JACK A DULL BOY ALL SPACES AND NO TABS MAKES JACK A DULL BOY p ALL SPACES AND NO TABS MAKES JACK A DULL BOY p also note space introduced in the below div div classrow daterowdiv for person in datapeople div classrow td classname persondisplayName td div endfor div body html After twig html headhead body ALL SPACES AND NO TABS MAKES JACK A DULL BOY ALL SPACES AND NO TABS MAKES JACK A DULL BOY p ALL SPACES AND NO TABS MAKES JACK A DULL BOY p div classrows ALL SPACES AND NO TABS MAKES JACK A DULL BOY ALL SPACES AND NO TABS MAKES JACK A DULL BOY p ALL SPACES AND NO TABS MAKES JACK A DULL BOY p also note space introduced in the below div div classrow daterow div for person in datapeople div classrow td classname persondisplayName td div endfor div body html Formatting the output repetedly pushes the wrapped lines further and further right Having combined with the format on save options they run away to infinity and beyond A couple issues have been raised about this in other repos Having read the above description in the documentation I assumed I could use prettydiff as a plugin replacement for the Unix diff in a separate program that expects diff output to look a certain way This is not at all the case as you can see in this example diff tmpdifftest tmpdifftest c puts Hello world end def goodbye puts Goodbye world puts Hello self prettydiff diff diffformattext sourcetmpdifftest difftmpdifftest Line puts Hello world puts Hello self Line def goodbye puts Goodbye world end Pretty Diff found differences on lines A program expecting the former will not even nearly be able to parse the latter and it seems a bit misleading to say the two are similar My suggestions for solutions are to either Remove the statement about similarity to Unix diff or ideally Add a new diffformatnormal which actually does output something similar to the Unix diff normal format