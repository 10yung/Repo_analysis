 What operating system and version are you using Windows What version of osquery are you using v What steps did you take to reproduce the issue After a few hours the ext crashes leading to one of two situations The osqueryd process is still up but does nothing cannot be queried and doesnt talk to the fleet server The osqueryd process crashed and comes back normally with the ext unloaded this usually takes less than an hour Seems like running enableextensionswatchdog helps but not always What did you expect to see The osqueryd process not crashing and the ext tables available at all times What did you see instead After a while I see that the osqueryd process started writing logs to a new log file when not connected to fleet and in it all I see is Error executing scheduled query winxxxxxx Error running query no such table winxxxxxx Also before the process crashes and doesnt come back the logs go into a loop of Registering extension plgxwinwinextension pid version sdk Extension pid has duplicate plugin name windnsevents in registry table Could not add extension plgxwinextension Duplicate registry item windnsevents Ive configured my Kolide Fleet instance to send the following to osqueryd when it calls apiv osqueryconfig to get its config osqueryconftxt However when trying to load the osqextbin extension osqueryd just hangs and repeatedly calls apiv osqueryconfig over and over again C ProgramData osqueryC ProgramData osquery osqueryd osquerydexe flagfileC ProgramData osquery fleetflags I initcpp osquery initialized version I systemcpp Found stale process for osqueryd I systemcpp Writing osqueryd pid to ProgramData osquery osquerydpidfile I extensionscpp Found autoloadable extension C ProgramData osquery plgxwinextensionextexe I rocksdbcpp Opening RocksDB handle C ProgramData osquery osquerydb I watchercpp Created and monitoring extension child C ProgramData osquery plgxwinextensionextexe I databasecpp Checking database version for migration I autoconstructedtablescpp Removing stale ATC entries I interfacecpp Extension manager service starting pipe osqueryem I tlscpp TLSHTTPS POST request to URI hostnameapiv osqueryconfig I initcpp osquery extension initialized sdk I interfacecpp Registering extension plgxwinextension version sdk I registryfactorycpp Extension registered table plugin windnsevents I registryfactorycpp Extension registered table plugin windnsresponseevents I registryfactorycpp Extension registered table plugin winepptable I registryfactorycpp Extension registered table plugin winfileevents I registryfactorycpp Extension registered table plugin winfiletimestompevents I registryfactorycpp Extension registered table plugin winhash I registryfactorycpp Extension registered table plugin winhttpevents I registryfactorycpp Extension registered table plugin winimageloadevents I registryfactorycpp Extension registered table plugin winimageloadprocessmap I registryfactorycpp Extension registered table plugin winloggerevents I registryfactorycpp Extension registered table plugin winmemperf I registryfactorycpp Extension registered table plugin winmsr I registryfactorycpp Extension registered table plugin winobfuscatedps I registryfactorycpp Extension registered table plugin winpefileevents I registryfactorycpp Extension registered table plugin winprocessevents I registryfactorycpp Extension registered table plugin winprocesshandles I registryfactorycpp Extension registered table plugin winprocessopenevents I registryfactorycpp Extension registered table plugin winprocessperf I registryfactorycpp Extension registered table plugin winprograms I registryfactorycpp Extension registered table plugin winregistryevents I registryfactorycpp Extension registered table plugin winremotethreadevents I registryfactorycpp Extension registered table plugin winremovablemediaevents I registryfactorycpp Extension registered table plugin winservices I registryfactorycpp Extension registered table plugin winsocketevents I registryfactorycpp Extension registered table plugin winstartupitems I registryfactorycpp Extension registered table plugin winyaraevents I extensionscpp Extension plgxwinextension registered I interfacecpp Extension service starting pipe osqueryem I sqliteutilcpp DBManager contention opening transient SQLite database I sqliteutilcpp DBManager contention opening transient SQLite database I sqliteutilcpp DBManager contention opening transient SQLite database I sqliteutilcpp DBManager contention opening transient SQLite database I tlscpp TLSHTTPS POST request to URI hostnameapiv osqueryconfig I plgxwinextnsdkservercpp The named pipe created FF CF DE I configcpp Refreshing configuration state I tlscpp TLSHTTPS POST request to URI hostnameapiv osqueryconfig If I use the attached config as osqueryconf and use the filesystem config plugin everything works fine and the extension loads C ProgramData osqueryC ProgramData osquery osqueryd osquerydexe flagfileC ProgramData osquery fleetflags I initcpp osquery initialized version I systemcpp Found stale process for osqueryd I systemcpp Writing osqueryd pid to ProgramData osquery osquerydpidfile I extensionscpp Found autoloadable extension C ProgramData osquery plgxwinextensionextexe I rocksdbcpp Opening RocksDB handle C ProgramData osquery osquerydb I watchercpp Created and monitoring extension child C ProgramData osquery plgxwinextensionextexe I databasecpp Checking database version for migration I autoconstructedtablescpp Removing stale ATC entries I interfacecpp Extension manager service starting pipe osqueryem I initcpp osquery extension initialized sdk I interfacecpp Registering extension plgxwinextension version sdk I systemcpp Using host identifier uuid I registryfactorycpp Extension registered table plugin windnsevents I tlscpp TLSHTTPS POST request to URI hostnameapiv osquerylog I registryfactorycpp Extension registered table plugin windnsresponseevents I registryfactorycpp Extension registered table plugin winepptable I registryfactorycpp Extension registered table plugin winfileevents I registryfactorycpp Extension registered table plugin winfiletimestompevents I registryfactorycpp Extension registered table plugin winhash I registryfactorycpp Extension registered table plugin winhttpevents I registryfactorycpp Extension registered table plugin winimageloadevents I registryfactorycpp Extension registered table plugin winimageloadprocessmap I registryfactorycpp Extension registered table plugin winloggerevents I registryfactorycpp Extension registered table plugin winmemperf I registryfactorycpp Extension registered table plugin winmsr I registryfactorycpp Extension registered table plugin winobfuscatedps I registryfactorycpp Extension registered table plugin winpefileevents I registryfactorycpp Extension registered table plugin winprocessevents I registryfactorycpp Extension registered table plugin winprocesshandles I registryfactorycpp Extension registered table plugin winprocessopenevents I registryfactorycpp Extension registered table plugin winprocessperf I registryfactorycpp Extension registered table plugin winprograms I registryfactorycpp Extension registered table plugin winregistryevents I registryfactorycpp Extension registered table plugin winremotethreadevents I registryfactorycpp Extension registered table plugin winremovablemediaevents I registryfactorycpp Extension registered table plugin winservices I registryfactorycpp Extension registered table plugin winsocketevents I registryfactorycpp Extension registered table plugin winstartupitems I registryfactorycpp Extension registered table plugin winyaraevents I killswitchcpp enum osqueryKillswitchIsEnabledError Cannot call registry item I eventscpp Starting event publisher run loop windowsevents I tlscpp TLSHTTPS POST request to URI hostnameapiv osquerydistributedread I extensionscpp Extension plgxwinextension registered I interfacecpp Extension service starting pipe osqueryem I plgxwinextnsdkservercpp The named pipe created FF CF DE I configcpp Refreshing configuration state I tlscpp TLSHTTPS POST request to URI hostnameapiv osquerydistributedread I tlscpp TLSHTTPS POST request to URI hostnameapiv osquerylog Hi let me start saying we really like capabilities of this tool But we noticed impact to system resources Based on our measurements it consumes on average CPU with spikes to even without scheduled queries We are managing osquery agents with Kolide Fleet Here are the flags enrollsecretpathC ProgramData osquery skrivntxt tlsservercertsC ProgramData osquery certs pem tlshostnamexxxxx hostidentifier enrolltlsendpointapiv osqueryenroll configplugintls configtlsendpointapiv osqueryconfig configtlsrefresh disabledistributedfalse distributedplugintls distributedinterval distributedtlsmaxattempts distributedtlsreadendpointapiv osquerydistributedread distributedtlswriteendpointapiv osquerydistributedwrite loggerplugintls loggertlsendpointapiv osquerylog loggertlsperiod allowunsafe databasedumpfalse scheduledefaultinterval packrefreshinterval configrefresh Is such behavior expected I know the extention queries all sort of stuff in background but is there a way to turn off some of the background queries we dont need OSQuery does not currently support performance metrics like CPU utilization Memory Utilization PolyLogyX can pull this information from wmi GetWmiObject win processor select LoadPercentage fl Both Sysmon PolyLogyX are missing the ability to see if a process is a trusted process with authenticodesignatures Please add a check or flag to enable authenticode checking Currently I am using this query for the results SELECT processpid processpath signatureresult FROM processes as process LEFT JOIN authenticode AS signature ON processpath signaturepath WARNING Logging before InitGoogleLogging is written to STDERR W plgxwinextensionextcpp Running multiple instances of extn is NotSupported can be Error Prone WARNING Logging before InitGoogleLogging is written to STDERR W plgxwinextensionextcpp Running multiple instances of extn is snip Any idea how to debug this