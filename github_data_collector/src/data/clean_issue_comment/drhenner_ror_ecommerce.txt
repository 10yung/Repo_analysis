 with current validation code I can create referrals with same email adrress with lowercaseuppercase as attached I believe here should use validates email presence true uniqueness casesensitive false format with CustomValidatorsEmailsemailvalidator As per commit message To fix issues As per commit message To fix issues Hi There Did not see the issue but the server at roreherokuappcom is down and not working rorecommerceappmodelscartrb shoppingcartitemsmap totalsum rorecommerceappmodelscartrb shoppingcartitemsmap quantitysum to shoppingcartitemssumtotal shoppingcartitemssumtotal doing sum is faster in db side rorecommerceappviewsadminusersshowhtmlerb lilabel of Itemslabel shipmentorderitemscount li When rendering the products linkto imagetag and some other functions are used to generate corresponding label however they might be expensive and the contents generated actually have a lot of things in common Its possible to use string replace to achieve this function Also when the productstatusstock is low stock the same ribbon image will be rendered so there is no need to generate the imagetag every time we can put it out of the loop and reuse it when necessary Here is my patch it somewhat make the code a little bit hard to read but it indeed improve performance especially when one page have a lot of products to show diff git aappviewsproductsindexhtmlerb bappviewsproductsindexhtmlerb index be b e d aappviewsproductsindexhtmlerb bappviewsproductsindexhtmlerb Here is my patch div idinterestingitems ul idinterestingitemslist lowstock imagetagribbonslowstockpng width height class upperleftoverlay noimage imagetagnoimagemediumjpg image img src imagepath alt productseachwithindex do product i li idinterestingproduct i class div classinterestingitemsimage linkto productpathproduct title productname do a title productname href productpathproduct div classnohovershow if productherovarianttrylowstock imagetagribbonsproductstockstatuspng width height class upperleftoverlay lowstock end div classhoverdetails unfade p classbottomhoverdetails p div div linkto imagetagproductfeaturedimagemedium productpathproduct title productname class clearfix end a title productname class clearfix href productpathproduct if productfeaturedimagemedium noimagemediumjpg imagegsubimagepath productfeaturedimagemediumhtmlsafe else noimage end a a div div classinterestingitemsdetails productname br appcontrollersapplicationcontrollerrb sessioncartcartitemseach do item itemupdateattributeuserid userid if itemuserid userid end replaced by updateall sessioncartcartitemswherenotuserid useridupdatealluserid userid rorecommerceappviewsadminrmareturnauthorizationsformhtmlerb returnitem returnauthorizationreturnitemsdetect p porderitemid itemid will issue a query to get all returnitems of returnauthorization and then detect them to find the one with specified itemid However use findby will only issue the query use where condition returnauthorizationreturnitemsfindbyorderitemid itemid 