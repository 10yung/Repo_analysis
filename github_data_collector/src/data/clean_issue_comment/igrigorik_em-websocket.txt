 Error during WebSocket handshake Sent nonempty SecWebSocketProtocol header but no response was received How can I set the header to be binary its ok when start rails with command rails s b p but start rails with command rails s b p d cant connect to websocket server configinitializerswebsocketrb EMrun EMWebSocketrunhost port do ws wsonopen handshake puts WebSocket connection open Access properties on the EMWebSocketHandshake object eg path querystring origin headers Publish message to the client wssend Hello Client you connected to handshakepath wsonclose puts Connection closed wsonmessage msg puts Recieved message msg wssend Pong msg end client html file script var ws new WebSocketws wsonopen function alertwebsocket is connected wssendsend from browser wsonmessage function evt var msg evtdata alertMessage is received msg wsonclose function alertConnection is closed script html websocket test html Based on I did not implement full header param processing clientmaxwindowbits is ignored Basically I added changes until it started to work for me in my environment with some default hardcoded params for inflatedeflate So it is far from full spec implementation I hope that someone will improve this code or replace with a more correct solution Hello Im trying to start an encrypted WebSocket server I had called the method EMWebSocketrunhost port secure True tlsoptions My key and cert and got the following error message terminate called after throwing an instance of stdruntimeerror what Encryption not available on this event machine The key and cert are working fine with the Apache server The WebSocket server is working fine without encryption I installed libssldiv uninstalled the gem reinstalled the gem but its still not working Im trying to run the WebSocket server on a BackBox virtual machine running on Ubuntu host Any suggestions emwebsocket wont connect over SSL When trying to connect on secure false connection is working perfectly but when we try to include tlsoptions and set secure to true server just wont start The EventMachine start but EventMachineWebSocket start boot and get terminated but EventMachine is still running as a ruby process What I mean is that I can find it by running ps aux grep ruby This is the STDOUT we get when we start the process Server started Terminating WebSocket Server We are using Ruby on rails nginx server Ubuntu but we dont think that have any thing to do with this issue We are using Ruby eventmachine emwebsocket for testing purposes we are using letsencrypt for certificates When we setup ssl for https we added these lines to nginxconf sslcertificate etcletsencryptlivedomainfullchainpem sslcertificatekey etcletsencryptlivedomainprivkeypem sslprotocols TLSv TLSv TLSv sslpreferserverciphers on sslciphers EECDHAESGCMEDHAESGCMAES EECDHAES EDH This is the websocket script ruby require emwebsocket EventMachinerun EventMachineWebSocketstart host port debug true secure true tlsoptions privatekeyfile etcletsencryptlivedomainprivkeypem certchainfile etcletsencryptlivedomaincertpem cipherlist EECDHAESGCMEDHAESGCMAES EECDHAES EDH do ws puts Sterting Websocket wsonopen connection puts onOpen end puts Server started Thanks for looking at this Open issue on also not sure where it belong Heres an example WebSocket connection prymain wssgetWsList EventMachineWebSocketConnection x f closetimeoutnil debugfalse handler EventMachineWebSocketHandler x f ef applicationdatabuffer closetimernil connectionEventMachineWebSocketConnection x f data debugfalse frametypenil stateconnected handshakenil oncloseProc x f af REDACTED onerrorProc x f e REDACTED onmessageProc x f a REDACTED onopenProc x f b REDACTED optionshost port securetrue tlsoptionsprivatekeyfileprivkeypem certchainfilecertpem securetrue secureproxyfalse signature tlsoptionsprivatekeyfileprivkeypem certchainfilecertpem I want to get the IP address of the remote host so I use remoteip like in commit c f e a d ba d deb da e prymain wssgetWsList remoteip NoMethodError undefined method remoteip for EventMachineWebSocketConnection x f from pry in cmdLine However if I use the code inside of the remoteip method I get this prymain wssgetWsList getpeername unpacknC join REDACTEDIP Why wouldnt I have the remoteip method Im using version of the gem ERROR Error installing emwebsocket invalid gem package is corrupt exception while verifying undefined method size for nilNilClass I am looking for a ballpark estimate of the number of websocket connections emwebsocket could handle on say a standard heroku dyno And if you know how does it compare to the number of connections a socketio node server could handle Sorry if this is the wrong place to ask but I couldnt find any info googling I need to be able to publish data to specific websockets The full gist of it is Specifically I do something like ruby wsonmessage do msg eventtype data msgsplit if eventtype typing PublishMessagedoWSCLIENTS datafirst typingdatalast elsif eventtype connected WSCLIENTSNAMETOSOCKET wsgetpid datafirst WSCLIENTS datafirst ws end end and so this line ruby WSCLIENTS datafirst ws Saves the websocket for later reference by username this is causing MRI to leak no idea why any alternative suggestion to overcome this I am wondering if the code that gets executed in onmessage onopen etc runs on a new thread every time I know it isnt an issue was just wondering and didnt know where to post 