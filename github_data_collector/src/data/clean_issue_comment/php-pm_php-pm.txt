I have worker process with sleep sec Option maxexecutiontime is sec I see error Maximum execution time exceeded sometime My config and extend log bridge PHPPM Bridges Psr Middleware host port workers appenv production debug logging bootstrap DdMonitoring PmmAdapter maxrequests populateservervar maxexecutiontime memorylimit ttl reloadtimeout staticdirectory socketpath ppmrun pidfile ppmppmpid cgipath usrlocalCellarphp binphpcgi Starting PHPPM with workers using StreamSelectLoop workers starting at up and ready Application is ready at Method RequestHandlerSlaveClose cancelTimer Dec GET asteriskconnect HTTP Method RequestHandlermaxExecutionTimeExceeded Maximum execution time of seconds exceeded Closing worker Method RequestHandlerSlaveClose cancelTimer Method RequestHandlermaxExecutionTimeExceeded Maximum execution time of seconds exceeded Closing worker Method RequestHandlerSlaveClose cancelTimer Method RequestHandlermaxExecutionTimeExceeded Maximum execution time of seconds exceeded Closing worker Method RequestHandlerSlaveClose cancelTimer Method RequestHandlermaxExecutionTimeExceeded Maximum execution time of seconds exceeded Closing worker Method RequestHandlerSlaveClose cancelTimer Method RequestHandlermaxExecutionTimeExceeded Maximum execution time of seconds exceeded Closing worker Method RequestHandlerSlaveClose cancelTimer Method RequestHandlermaxExecutionTimeExceeded Maximum execution time of seconds exceeded Closing worker Method RequestHandlerSlaveClose cancelTimer Method RequestHandlerSlaveClose cancelTimer Dec GET asteriskconnect HTTP Method RequestHandlermaxExecutionTimeExceeded Maximum execution time of seconds exceeded Closing worker Method RequestHandlerSlaveClose cancelTimer Method RequestHandlermaxExecutionTimeExceeded Maximum execution time of seconds exceeded Closing worker Method RequestHandlerSlaveClose cancelTimer Screenshot with response timers and status code from chrome network Please check it I expected give response with status code is for all request after sec delay But I have after ms sec delay Add the possibility to provide the TCP context in the start process of ProcessManager and gives the opportunity to build Secure Socket Related Usage This PR add tcpcontext option which accept an JSON array encoded Example php binppm start tcpcontext tlslocalcert testpem This is the first shot What do you think Also I have some difficulty to make the ConfigTrait testable if you have some ideas I will take them If the main process receives an interruption signal running requests are not returned to the user Reproduce using sleep and ctrlc I primarily use PPM to have all kinds of data ready for computation at runtime when a request is coming in In order for that data to be fresh i need to reload periodically Because ttl only reloads after a request i cannot be sure that my data is fresh Also with this feature the worker does not get killed but only the method refreshApplication will be fired on the bridge every refreshinterval seconds Note Only of the workers in ready state and ready to refresh will be sent to refresh once every seconds Good day I try to investigate a strange situation with PHPPM but probably I do something wrong Our test application based on phppm httpkerneladapter PHP Zend Engine v Copyright c Zend Technologies with Zend OPcache v Copyright c by Zend Technologies with Xdebug v Copyright c by Derick Rethans Laravelframework It was started in same time on two different computers with same application docker images And after running for two weeks application was crashed and looks like in same time That is weird Last week applications was mostly idle And I am already find something like that phppm was started with bootstraplaravel staticdirectorypublic workers debug appenvdev vvv maxexecutiontime thats my stacktrace No slaves available to handle the request and timeout seconds exceeded No slaves available to handle the request and timeout seconds exceeded No slaves available to handle the request and timeout seconds exceeded No slaves available to handle the request and timeout seconds exceeded No slaves available to handle the request and timeout seconds exceeded No slaves available to handle the request and timeout seconds exceeded No slaves available to handle the request and timeout seconds exceeded In RequestHandlerphp line Symfony Component Debug Exception FatalThrowableError Call to a member function close on null Exception trace at optppmvendorphppmphppmsrcRequestHandlerphp PHPPM RequestHandlermaxExecutionTimeExceeded at optppmvendorreacteventloopsrcTimerTimersphp React EventLoop Timer Timerstick at optppmvendorreactevent loopsrcStreamSelectLoopphp React EventLoop StreamSelectLooprun at optppmvendorphppmphp pmsrcProcessManagerphp PHPPM ProcessManagerrun at optppmvendorphppmphp pmsrcCommandsStartCommandphp PHPPM Commands StartCommandexecute at optppmvendorsymfonyconsoleCommandCommandphp Symfony Component Console Command Commandrun at optppmvendorsymfonyconsoleApplicationphp Symfony Component Console ApplicationdoRunCommand at optppmvendorsymfonyconsoleApplicationphp Symfony Component Console ApplicationdoRun at optppmvendorsymfonyconsoleApplicationphp Symfony Component Console Applicationrun at optppmvendorphp pmphppmbinppm start bridge BRIDGE host HOST port PORT workers WORKERS appenv APPENV debug DEBUG logging LOGGING static directory STATICDIRECTORY maxrequests MAXREQUESTS max executiontime MAXEXECUTIONTIME memorylimit MEMORYLIMIT ttl TTL populateservervar POPULATESERVERVAR bootstrap BOOTSTRAP cgipath CGIPATH socketpath SOCKETPATH pidfile PIDFILE reloadtimeout RELOADTIMEOUT cconfig CONFIG workingdirectory Server is shutting down Stopping the process manager Probably you have some ideas what is wrong Thank in advance Hello I got HTTP Bad Gateway Server nginx Date Mon Oct GMT ContentType textplain ContentLength Connection close Slave returned an invalid HTTP response Maybe the script has called exit prematurely Instead of normal Symfonys error thats caused by my error in the application But just I dont know why phppm died on that cause that error was on the applicationpayload level Here the log cdpwebweb Worker stderr cdpwebweb An exception was thrown by the bridge Forcing restart of the worker The exception was Error Call to undefined method App Entity AccessTokengetUser in varwwwsrcSecurityAccessTokenAuthenticatorphp cdpwebweb Stack trace cdpwebweb varwwwvendorsymfonysecurityguardProviderGuardAuthenticationProviderphp App Security AccessTokenAuthenticatorgetUserae e dc e ObjectSymfony Bridge Doctrine Security User EntityUserProvider cdpwebweb varwwwvendorsymfonysecurityguardProviderGuardAuthenticationProviderphp Symfony Component Security Guard Provider GuardAuthenticationProviderauthenticateViaGuardObjectApp Security AccessTokenAuthenticator ObjectSymfony Component Security Guard Token PreAuthenticationGuardToken cdpwebweb varwwwvendorsymfonysecuritycoreAuthenticationAuthenticationProviderManagerphp Symfony Component Security Guard Provider GuardAuthenticationProviderauthenticateObjectSymfony Component Security Guard Token PreAuthenticationGuardToken cdpwebweb varwwwvendorsymfonysecurityguardFirewallGuardAuthenticationListenerphp Symfony Component Security Core Authentication AuthenticationProviderManagerauthenticateObjectSymfony Component Security Guard Token PreAuthenticationGuardToken cdpwebweb varwwwvendorsymfonysecurityguardFirewallGuardAuthenticationListenerphp Symfony Component Security Guard Firewall GuardAuthenticationListenerexecuteGuardAuthenticatormain ObjectApp Security AccessTokenAuthenticator ObjectSymfony Component HttpKernel Event RequestEvent cdpwebweb varwwwvendorsymfonysecurityhttpFirewallphp Symfony Component Security Guard Firewall GuardAuthenticationListenerinvokeObjectSymfony Component HttpKernel Event RequestEvent cdpwebweb varwwwvendorsymfonysecurityhttpFirewallphp Symfony Component Security Http FirewallhandleRequestObjectSymfony Component HttpKernel Event RequestEvent ObjectGenerator cdpwebweb varwwwvendorsymfonysecurityhttpFirewallphp Symfony Component Security Http FirewallcallListenersObjectSymfony Component HttpKernel Event RequestEvent ObjectGenerator cdpwebweb varwwwvendorsymfonyeventdispatcherEventDispatcherphp Symfony Component Security Http FirewallonKernelRequestObjectSymfony Component HttpKernel Event RequestEvent kernelrequest ObjectSymfony Component EventDispatcher EventDispatcher cdpwebweb varwwwvendorsymfonyeventdispatcherEventDispatcherphp Symfony Component EventDispatcher EventDispatcherSymfony Component EventDispatcher closureObjectSymfony Component HttpKernel Event RequestEvent kernelrequest ObjectSymfony Component EventDispatcher EventDispatcher cdpwebweb varwwwvendorsymfonyeventdispatcherEventDispatcherphp Symfony Component EventDispatcher EventDispatcherdoDispatchArray kernelrequest ObjectSymfony Component HttpKernel Event RequestEvent cdpwebweb varwwwvendorsymfonyeventdispatcherEventDispatcherphp Symfony Component EventDispatcher EventDispatchercallListenersArray kernelrequest ObjectSymfony Component HttpKernel Event RequestEvent cdpwebweb varwwwvendorsymfonyhttpkernelHttpKernelphp Symfony Component EventDispatcher EventDispatcherdispatchObjectSymfony Component HttpKernel Event RequestEvent kernelrequest cdpwebweb varwwwvendorsymfonyhttpkernelHttpKernelphp Symfony Component HttpKernel HttpKernelhandleRawObjectSymfony Component HttpFoundation Request cdpwebweb varwwwvendorsymfonyhttpkernelKernelphp Symfony Component HttpKernel HttpKernelhandleObjectSymfony Component HttpFoundation Request true cdpwebweb ppmvendorphppmhttpkerneladapterBridgesHttpKernelphp Symfony Component HttpKernel KernelhandleObjectSymfony Component HttpFoundation Request cdpwebweb ppmvendorphppmphppmsrcProcessSlavephp PHPPM Bridges HttpKernelhandleObjectReact Http Io ServerRequest cdpwebweb ppmvendorphppmphppmsrcProcessSlavephp PHPPM ProcessSlavehandleRequestObjectReact Http Io ServerRequest cdpwebweb ppmvendorreacthttpsrcIoMiddlewareRunnerphp PHPPM ProcessSlaveonRequestObjectReact Http Io ServerRequest cdpwebweb ppmvendorreacthttpsrcIoMiddlewareRunnerphp React Http Io MiddlewareRunnercallObjectReact Http Io ServerRequest cdpwebweb ppmvendorreacthttpsrcMiddlewareRequestBodyParserMiddlewarephp React Http Io MiddlewareRunnerReact Http Io closureObjectReact Http Io ServerRequest cdpwebweb ppmvendorreacthttpsrcIoMiddlewareRunnerphp React Http Middleware RequestBodyParserMiddlewareinvokeObjectReact Http Io ServerRequest ObjectClosure cdpwebweb ppmvendorreacthttpsrcIoMiddlewareRunnerphp React Http Io MiddlewareRunnercallObjectReact Http Io ServerRequest cdpwebweb ppmvendorreacthttpsrcMiddlewareRequestBodyBufferMiddlewarephp React Http Io MiddlewareRunnerReact Http Io closureObjectReact Http Io ServerRequest cdpwebweb ppmvendorreacthttpsrcIoMiddlewareRunnerphp React Http Middleware RequestBodyBufferMiddlewareinvokeObjectReact Http Io ServerRequest ObjectClosure cdpwebweb ppmvendorreacthttpsrcIoMiddlewareRunnerphp React Http Io MiddlewareRunnercallObjectReact Http Io ServerRequest cdpwebweb ppmvendorreacthttpsrcMiddlewareLimitConcurrentRequestsMiddlewarephp React Http Io MiddlewareRunnerReact Http Io closureObjectReact Http Io ServerRequest cdpwebweb ppmvendorreacthttpsrcIoMiddlewareRunnerphp React Http Middleware LimitConcurrentRequestsMiddlewareinvokeObjectReact Http Io ServerRequest ObjectClosure cdpwebweb ppmvendorreacthttpsrcIoMiddlewareRunnerphp React Http Io MiddlewareRunnercallObjectReact Http Io ServerRequest cdpwebweb ppmvendorreacthttpsrcStreamingServerphp React Http Io MiddlewareRunnerinvokeObjectReact Http Io ServerRequest cdpwebweb ppmvendorreacthttpsrcStreamingServerphp React Http StreamingServerhandleRequestObjectReact Socket Connection ObjectReact Http Io ServerRequest cdpwebweb ppmvendorevenementevenementsrcEvenementEventEmitterTraitphp React Http StreamingServerReact Http closureObjectReact Http Io ServerRequest cdpwebweb ppmvendorreacthttpsrcIoRequestHeaderParserphp Evenement EventEmitteremitheaders Array cdpwebweb ppmvendorreacthttpsrcIoRequestHeaderParserphp React Http Io RequestHeaderParserparseAndEmitRequest cdpwebweb ppmvendorevenementevenementsrcEvenementEventEmitterTraitphp React Http Io RequestHeaderParserfeedGET apiaccoun cdpwebweb ppmvendorreactstreamsrcUtilphp Evenement EventEmitteremitdata Array cdpwebweb ppmvendorevenementevenementsrcEvenementEventEmitterTraitphp React Stream UtilReact Stream closureGET apiaccoun cdpwebweb ppmvendorreactstreamsrcDuplexResourceStreamphp Evenement EventEmitteremitdata Array cdpwebweb ppmvendorreacteventloopsrcStreamSelectLoopphp React Stream DuplexResourceStreamhandleDataResource id cdpwebweb ppmvendorreacteventloopsrcStreamSelectLoopphp React EventLoop StreamSelectLoopwaitForStreamActivityNULL cdpwebweb ppmvendorphppmphppmsrcProcessSlavephp React EventLoop StreamSelectLooprun cdpwebweb tmpdbgJddOkp PHPPM ProcessSlaverun cdpwebweb main cdpwebweb Worker closed after handled requests cdpwebweb Start new worker cdpwebweb Script did not return a valid HTTP response Maybe it has called exit prematurely cdpwebweb Worker registered Waiting for application bootstrap cdpwebweb Worker ready Environment phppmphppm phppmhttpkerneladapter PHP Symfony Debug Might fix and Hello I see workers dead permanently after I changed a file Here is the log logs f web Attaching to cdpwebweb cdpwebweb CMD ppmvendorbinppm start ansi port socketpathppmrun pidfileppmppmpid staticdirectory bootstrapsymfony debug appenvdev workers memorylimit M vv cdpwebweb PID cdpwebweb Checking if pid is still running cdpwebweb Waiting to complete cdpwebweb varwww cdpwebweb cdpwebweb bridge HttpKernel cdpwebweb host cdpwebweb port cdpwebweb workers cdpwebweb appenv dev cdpwebweb debug cdpwebweb logging cdpwebweb staticdirectory cdpwebweb bootstrap symfony cdpwebweb maxrequests cdpwebweb maxexecutiontime cdpwebweb memorylimit cdpwebweb ttl cdpwebweb populateservervar cdpwebweb socketpath ppmrun cdpwebweb pidfile ppmppmpid cdpwebweb reloadtimeout cdpwebweb cgipath usrbinphpcgi cdpwebweb cdpwebweb Starting PHPPM with workers using StreamSelectLoop cdpwebweb Start new worker cdpwebweb Start new worker cdpwebweb Start new worker cdpwebweb Worker registered Waiting for application bootstrap cdpwebweb Worker registered Waiting for application bootstrap cdpwebweb Worker registered Waiting for application bootstrap cdpwebweb Worker ready cdpwebweb Received new files from Stats collection cycle files ms cdpwebweb Worker ready cdpwebweb Received new files from Stats collection cycle files ms cdpwebweb Worker ready cdpwebweb workers starting at up and ready Application is ready at cdpwebweb Received new files from Stats collection cycle files ms cdpwebweb Received new files from Stats collection cycle files ms cdpwebweb Current memory usage for worker MB cdpwebweb Oct GET apiaccount HTTP cdpwebweb Worker took abnormal seconds for handling a connection cdpwebweb Received new files from Stats collection cycle files ms cdpwebweb Current memory usage for worker MB cdpwebweb Oct POST login HTTP cdpwebweb Worker took abnormal seconds for handling a connection cdpwebweb Current memory usage for worker MB cdpwebweb Oct POST login HTTP cdpwebweb Worker took abnormal seconds for handling a connection cdpwebweb Current memory usage for worker MB cdpwebweb Oct GET apiaccount HTTP cdpwebweb Worker took abnormal seconds for handling a connection Then I changed a file cdpwebweb Oct File varwwwsrcControllerAccountControllerphp has changed cdpwebweb Oct At least one of known files was changed Reloading workers cdpwebweb Changes detection cycle length ms cdpwebweb Start new worker cdpwebweb Start new worker cdpwebweb Start new worker cdpwebweb Worker registered Waiting for application bootstrap cdpwebweb Worker registered Waiting for application bootstrap cdpwebweb Worker ready cdpwebweb Received new files from Stats collection cycle files ms cdpwebweb Worker registered Waiting for application bootstrap cdpwebweb Worker ready cdpwebweb Received new files from Stats collection cycle files ms cdpwebweb Worker ready cdpwebweb Received new files from Stats collection cycle files ms cdpwebweb Oct File varwwwvarcachedevUrlMatcherphp has changed cdpwebweb Oct At least one of known files was changed Reloading workers cdpwebweb Changes detection cycle length ms cdpwebweb Start new worker cdpwebweb Start new worker cdpwebweb Start new worker cdpwebweb Oct File varwwwvarcachedevUrlGeneratorphp has changed cdpwebweb Oct At least one of known files was changed Reloading workers cdpwebweb Changes detection cycle length ms cdpwebweb Start new worker cdpwebweb Start new worker cdpwebweb Start new worker cdpwebweb Worker took abnormal seconds for handling a connection cdpwebweb Script did not return a valid HTTP response Maybe it has called exit prematurely cdpwebweb Worker registered Waiting for application bootstrap cdpwebweb Worker registered Waiting for application bootstrap cdpwebweb Worker ready cdpwebweb Received new files from Stats collection cycle files ms cdpwebweb Worker registered Waiting for application bootstrap cdpwebweb Worker ready cdpwebweb Received new files from Stats collection cycle files ms cdpwebweb Worker wanted to register on master which was not expected cdpwebweb Worker permanently closed during PHPPM bootstrap Not so cool Not your fault please create a ticket at githubcomphppmphppm with the output of ppm start vv cdpwebweb Worker ready cdpwebweb Received new files from Stats collection cycle files ms cdpwebweb Worker wanted to register on master which was not expected cdpwebweb Worker permanently closed during PHPPM bootstrap Not so cool Not your fault please create a ticket at githubcomphppmphppm with the output of ppm start vv cdpwebweb Worker wanted to register on master which was not expected cdpwebweb Worker permanently closed during PHPPM bootstrap Not so cool Not your fault please create a ticket at githubcomphppmphppm with the output of ppm start vv What this line is mean cdpwebweb Script did not return a valid HTTP response Maybe it has called exit prematurely In the file Ive just changed HTTP response code to from purely for test how ppm handles files reloading in developer mode Next Ive sent that request again cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb took abnormal seconds for choosing next free worker cdpwebweb Connection to worker failed Try took s timeout s Error message Unable to connect to unix domain socket unixppmrun sock Connection refused cdpwebweb cdpwebweb In RequestHandlerphp line cdpwebweb cdpwebweb ErrorException cdpwebweb Notice Undefined property PHPPM RequestHandlerslave cdpwebweb cdpwebweb cdpwebweb Exception trace cdpwebweb at ppmvendorphppmphppmsrcRequestHandlerphp cdpwebweb PHPPM RequestHandlermaxExecutionTimeExceeded at ppmvendorreacteventloopsrcTimerTimersphp cdpwebweb React EventLoop Timer Timerstick at ppmvendorreacteventloopsrcStreamSelectLoopphp cdpwebweb React EventLoop StreamSelectLooprun at ppmvendorphppmphppmsrcProcessManagerphp cdpwebweb PHPPM ProcessManagerrun at ppmvendorphppmphppmsrcCommandsStartCommandphp cdpwebweb PHPPM Commands StartCommandexecute at ppmvendorsymfonyconsoleCommandCommandphp cdpwebweb Symfony Component Console Command Commandrun at ppmvendorsymfonyconsoleApplicationphp cdpwebweb Symfony Component Console ApplicationdoRunCommand at ppmvendorsymfonyconsoleApplicationphp cdpwebweb Symfony Component Console ApplicationdoRun at ppmvendorsymfonyconsoleApplicationphp cdpwebweb Symfony Component Console Applicationrun at ppmvendorphppmphppmbinppm cdpwebweb cdpwebweb start bridge BRIDGE host HOST port PORT workers WORKERS appenv APPENV debug DEBUG logging LOGGING staticdirectory STATICDIRECTORY maxrequests MAXREQUESTS maxexecutiontime MAXEXECUTIONTIME memorylimit MEMORYLIMIT ttl TTL populateservervar POPULATESERVERVAR bootstrap BOOTSTRAP cgipath CGIPATH socketpath SOCKETPATH pidfile PIDFILE reloadtimeout RELOADTIMEOUT cconfig CONFIG workingdirectory cdpwebweb cdpwebweb Server is shutting down cdpwebweb Worker terminated more workers to close cdpwebweb Worker terminated more workers to close cdpwebweb Worker terminated more workers to close cdpwebweb Stopping the process manager cdpwebweb PID USER TIME COMMAND cdpwebweb root binbash etcapprunsh bootstrapsymfony debug appenvdev workers memorylimit M vv cdpwebweb root nginx master process nginx cdpwebweb nginx nginx worker process cdpwebweb nginx nginx worker process cdpwebweb nginx nginx worker process cdpwebweb nginx nginx worker process cdpwebweb root ps ax cdpwebweb etcapprunsh line warning runpendingtraps bad value in traplist x dd cdpwebweb etcapprunsh line kill No such process cdpwebweb Trapped CHLD Sending signal CHLD to PID cdpwebweb exited with code This fixed Test ab c n bash c sleep vendorbinppm reload cgipathusrlocalbinphp Without the fix I see errors in stderr ppm Current memory usage for worker MB Aug GET abtesting HTTP Worker took abnormal seconds for handling a connection Marking locked worker as closed Worker closed after handled requests Start new worker Worker has been closed reloading Start new worker In SlavePoolphp line Exception Slave port already occupied Exception trace at varwwwhtmlvendorphppmphppmsrcSlavePoolphp PHPPM SlavePooladd at varwwwhtmlvendorphppmphppmsrcProcessManagerphp PHPPM ProcessManagernewSlaveInstance at varwwwhtmlvendorphppmphppmsrcProcessManagerphp PHPPM ProcessManagerPHPPM closure at varwwwhtmlvendorphppmphppmsrcProcessManagerphp PHPPM ProcessManagerPHPPM closure at varwwwhtmlvendorevenementevenementsrcEvenementEventEmitterTraitphp Evenement EventEmitteremit at varwwwhtmlvendorreactstreamsrcUtilphp React Stream UtilReact Stream closure at varwwwhtmlvendorevenementevenementsrcEvenementEventEmitterTraitphp Evenement EventEmitteremit at varwwwhtmlvendorreactstreamsrcDuplexResourceStreamphp React Stream DuplexResourceStreamclose at varwwwhtmlvendorreactsocketsrcConnectionphp React Socket Connectionclose at varwwwhtmlvendorphppmphppmsrcRequestHandlerphp PHPPM RequestHandlerslaveClosed at varwwwhtmlvendorevenementevenementsrcEvenementEventEmitterTraitphp Evenement EventEmitteremit at varwwwhtmlvendorreactstreamsrcUtilphp React Stream UtilReact Stream closure at varwwwhtmlvendorevenementevenementsrcEvenementEventEmitterTraitphp Evenement EventEmitteremit at varwwwhtmlvendorreactstreamsrcDuplexResourceStreamphp React Stream DuplexResourceStreamclose at varwwwhtmlvendorreactstreamsrcDuplexResourceStreamphp React Stream DuplexResourceStreamhandleData at varwwwhtmlvendorreacteventloopsrcStreamSelectLoopphp React EventLoop StreamSelectLoopwaitForStreamActivity at varwwwhtmlvendorreacteventloopsrcStreamSelectLoopphp React EventLoop StreamSelectLooprun at varwwwhtmlvendorphppmphppmsrcProcessManagerphp PHPPM ProcessManagerrun at varwwwhtmlvendorphppmphppmsrcCommandsStartCommandphp PHPPM Commands StartCommandexecute at varwwwhtmlvendorsymfonyconsoleCommandCommandphp Symfony Component Console Command Commandrun at varwwwhtmlvendorsymfonyconsoleApplicationphp Symfony Component Console ApplicationdoRunCommand at varwwwhtmlvendorsymfonyconsoleApplicationphp Symfony Component Console ApplicationdoRun at varwwwhtmlvendorsymfonyconsoleApplicationphp Symfony Component Console Applicationrun at varwwwhtmlvendorphppmphppmbinppm start bridge BRIDGE host HOST port PORT workers WORKERS appenv APPENV debug DEBUG logging LOGGING staticdirectory STATICDIRECTORY maxrequests MAXREQUESTS maxexecutiontime MAXEXECUTIONTIME memorylimit MEMORYLIMIT ttl TTL populateservervar POPULATESERVERVAR bootstrap BOOTSTRAP cgipath CGIPATH socketpath SOCKETPATH pidfile PIDFILE reloadtimeout RELOADTIMEOUT cconfig CONFIG workingdirectory Server is shutting down Stopping the process manager INFO exited phpppm exit status not expected INFO spawned phpppm with pid varwwwhtml bridge RMS RestApi PhpPM SlimBridge host port workers appenv prod debug logging staticdirectory bootstrap RMS RestApi PhpPM Bootstrap maxrequests maxexecutiontime memorylimit ttl populateservervar socketpath ppmrun pidfile ppmppmpid reloadtimeout cgipath usrlocalbinphp In TcpServerphp line RuntimeException Failed to listen on tcp Address in use Exception trace at varwwwhtmlvendorreactsocketsrcTcpServerphp React Socket TcpServerconstruct at varwwwhtmlvendorreactsocketsrcServerphp React Socket Serverconstruct at varwwwhtmlvendorphppmphppmsrcProcessManagerphp PHPPM ProcessManagerrun at varwwwhtmlvendorphppmphppmsrcCommandsStartCommandphp PHPPM Commands StartCommandexecute at varwwwhtmlvendorsymfonyconsoleCommandCommandphp Symfony Component Console Command Commandrun at varwwwhtmlvendorsymfonyconsoleApplicationphp Symfony Component Console ApplicationdoRunCommand at varwwwhtmlvendorsymfonyconsoleApplicationphp Symfony Component Console ApplicationdoRun at varwwwhtmlvendorsymfonyconsoleApplicationphp Symfony Component Console Applicationrun at varwwwhtmlvendorphppmphppmbinppm start bridge BRIDGE host HOST port PORT workers WORKERS appenv APPENV debug DEBUG logging LOGGING staticdirectory STATICDIRECTORY maxrequests MAXREQUESTS maxexecutiontime MAXEXECUTIONTIME memorylimit MEMORYLIMIT ttl TTL populateservervar POPULATESERVERVAR bootstrap BOOTSTRAP cgipath CGIPATH socketpath SOCKETPATH pidfile PIDFILE reloadtimeout RELOADTIMEOUT cconfig CONFIG workingdirectory Server is shutting down Stopping the process manager PHP Fatal error Uncaught ErrorException Warning unlinkppmppmpid No such file or directory in varwwwhtmlvendorphppmphppmsrcProcessManagerphp Stack trace varwwwhtmlvendorphppmphppmsrcProcessManagerphp PHPPM ProcessManagerquit internal function PHPPM ProcessManagershutdown main thrown in varwwwhtmlvendorphppmphppmsrcProcessManagerphp on line PHP Stack trace PHP main varwwwhtmlvendorphppmphppmbinppm PHP Symfony Component Console Applicationrun varwwwhtmlvendorphppmphppmbinppm INFO exited phpppm exit status not expected C WARN received SIGINT indicating exit request INFO waiting for processes phpppm statsdexporter confd to die INFO stopped statsdexporter terminated by SIGTERM T Z ab ec usrlocalsbinconfd INFO Captured terminated Exiting INFO stopped confd exit status C WARN received SIGINT indicating exit request INFO stopped processes terminated by SIGTERM One of the things phppm allows to do which simple phpfpm doesnt is to share the state between the requests Of course this shouldnt be overused but is caching things inmemory is quite possible usecase and is fastest approach possible faster than using external storage like Redis or Memcached One thing which could be improved over straightforward implementation is cache invalidation This could be done using one of React libraries like predisasync or RabbitMQ integration it does not add any latency to the requests and cache is invalidated in all the workers as soon as this is needed Whats missing to implement this properly with current core is ability to access the eventloop thats used by phppm Its inside ProcessSlave class which is not configurable and is not passed anyhow to the bridge Implementing this is possible but quite hackish Currently the ProcessSlave instance creation is hardcoded inside local variable in quite long method body PHPPM ProcessManagernewSlaveInstance So its possible to extend ProcessManager overwrite the method copy the contents and change only that single place classname of ProcessSlave but this makes it quite hard to maintain with the base code if anything would change in the core Also it needs quite many copypaste from ProcessSlave as run method needs to be changed which calls other private methods which in turn have to also be copypasted Well you get the drill A bit simpler but probably even more hackish approach is to get ProcessSlaveslave and get loop by using reflection and making it public I assume there could be several approaches how to achieve this Make ProcessSlave class configurable noted in but not followed upon This would also need some protected method for a hook to bind the thisloop inside run method Change PHPPM ProcessSlaverun method to call some outside class to store the loop inside lets say static publicly accessible variable Expose the loop variable with public function It could be accessed by calling ProcessSlaveslavegetLoop Current PoC I have set up locally php class ProcessSlave public function run thisloop Factorycreate thiserrorLogger BufferingLoggercreate ErrorHandlerregisternew ErrorHandlerthiserrorLogger EventLoopProviderregisterLoopthisloop this line was added thistryConnect thislooprun This is just a wrapper to avoid using static context in various places Expected to be service in Symfony DIC Could also provide methods for getting if were even running in the phppm context php class EventLoopProvider private static staticEventLoop private eventLoop public function construct thiseventLoop selfstaticEventLoop public static function registerLoopLoopInterface eventLoop selfstaticEventLoop eventLoop public function getEventLoop return thiseventLoop Example of storage with automatic cache invalidation Expects for message to be published but could also use Keyspace notifications if enabled php class RedisStorage private client private asyncClient private values public function constructEventLoopProvider eventLoopProvider thisclient new Predis Clienttcpredis thisasyncClient new Predis Async Clienttcpredis eventLoopProvidergetEventLoop public function getstring key if issetthisvalues key thisloadValuekey return thisvalues key private function loadValuestring key value thisclientgetkey thisvalues key value if thisasyncClientisConnected thisasyncClientconnectfunction use key thissubscribekey else thissubscribekey private function subscribestring key thisasyncClientpubSubLoopchanged key function unsetthisvalues key Is this something you would consider to make available I could make a pullrequest but I wanted to check the preferred approach if any of them makes sense