Hi Ive put a bit of testing into the thing implicitly calling pigz if its there and using alternatively xz which is always executed in multithreaded mode in favor of speed xz packs a whole lot of extra ratio c locale LANGzhCNUTF sudo PiShrinkpishrinksh img newimg pishrinksh v pishrinksh Copying img to newimg pishrinksh Gatherin data Creating new etcrclocal pishrinksh Checking filesystem rootfs resize fs Sep PiShrinkpishrinksh PiShrinkpishrinksh pishrinksh Shrinking filesystem resize fs Sep resize fs pishrinksh ERROR occured in line resize fs failed mount tmptmpSj Z EXlzV wrong fs type bad option bad superblock on devloop missing codepage or helper program or other error mv tmptmpSj Z EXlzVetcrclocalbak stat umount tmptmpSj Z EXlzV losetup devloop set var LANGenUSUTF could fix it Hi pishrink works wonderful pishrinksh v pishrinksh Copying idroid raspomvimg to idroid raspomvshrunkimg pishrinksh Shrunk idroid raspomvshrunkimg from G to G saves G thanks for the script Some observations have to wait wait pretty long before it begins printing anything So perhaps an idea is to begin with saying somethink like reading in data this can take a while it could not read in an image with brtfs and asked if it was perhaps ufs No big deal Thanks for the diskspace saver Also used it to migrate to a bigger sdcard worked wonderfully The debian package pigz contains a zip variant which uses all CPUs when shrinking This speeds things up a lot on todays multicore machines I suggest to test if pigz is present and then use it instead of gzip thanks a lot for this script thorsten It looks like everything is going fine but at the end I get Line partnewsize newpartend Error Cant have overlapping partitions pishrinksh ERROR occured in line parted failed with rc Any hint Hi I am trying to shrink my Rapsbian Lite copy but errors occurred when I run the script Below is the error when I run the script for the first time piVMPi sudo pishrinksh RPT tmpimg pishrinksh v pishrinksh Gatherin data Creating new etcrclocal pishrinksh Checking filesystem root files noncontiguous blocks resize fs Jan pishrinksh Shrinking filesystem resize fs Jan Resizing the filesystem on devloop to k blocks Begin pass max Relocating blocks XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX Begin pass max Scanning inode table XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX Begin pass max Updating inode references XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX The filesystem on devloop is now k blocks long Error You requested a partition from B to B sectors The closest location we can manage is B to B sectors pishrinksh ERROR occured in line parted failed with rc Since the second time run the error becomes as follows piVMPi sudo pishrinksh RPT tmpimg pishrinksh v pishrinksh Gatherin data tune fs Bad magic number in superblock while trying to open devloop mount devloop cant read superblock md sum tmptmp stYQuKCFcetcrclocal No such file or directory Creating new etcrclocal mv cannot stat tmptmp stYQuKCFcetcrclocal No such file or directory usrlocalbinpishrinksh line tmptmp stYQuKCFcetcrclocal No such file or directory chmod cannot access tmptmp stYQuKCFcetcrclocal No such file or directory umount tmptmp stYQuKCFc not mounted pishrinksh Checking filesystem e fsck Invalid argument while trying to open devloop devloop The superblock could not be read or does not describe a valid ext ext ext filesystem If the device is valid and it really contains an ext ext ext filesystem and not swap or ufs or something else then the superblock is corrupt and you might try running e fsck with an alternate superblock e fsck b device or e fsck b device pishrinksh Filesystem error detected pishrinksh Trying to recover corrupted filesystem e fsck Jan e fsck Invalid argument while trying to open devloop The superblock could not be read or does not describe a valid ext ext ext filesystem If the device is valid and it really contains an ext ext ext filesystem and not swap or ufs or something else then the superblock is corrupt and you might try running e fsck with an alternate superblock e fsck b device or e fsck b device pishrinksh ERROR occured in line Filesystem recoveries failed Giving up Please advise if I can do anything to make it work Thanks As far as I can see theres two options regarding expanding Expand to max size of sd card or dont expand at all Is it possible to choose a size to which the image expands Eg Expand a xGB image to GB although its a GB sd card Hi Im tryn to get PiShrink to work But when i enter the code for execute the script the script is gatherin data for a whole day and nothing happens The only thing i see is that there is a disk mounted Can anybody help me out baloukenbaloukenVirtualBoxmediasfPiShrinkmasterpi sudo chmod x pishrinksh sudo password for balouken baloukenbaloukenVirtualBoxmediasfPiShrinkmasterpi sudo pishrinksh RegaladV img pishrinksh v pishrinksh Gatherin data This change allows proper expansion of ArmbianOS on eMMc module on RockPro