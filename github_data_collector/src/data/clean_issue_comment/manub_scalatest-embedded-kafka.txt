 I couldnt add the target because kafka itself has no binary yet I figured this out later when I already upgraded the other dependencies Maybe this is still useful to have I want to test if an offset is committed or not because only commit in some situations I have not found any way to test that Im very newbie at this so probably theres something I just dont get Im using akka kafka streams Heres an example of a test that is working KafkaSource should consume from a kafka topic and pass the message in val commitToKafka true val key keygetBytes val message messagegetBytes withRunningKafka val source getKafkaSourcecommitToKafka val sub source toMatTestSinkprobe CommittableMessage Array Byte Array Byte ConsumerMessageCommittableOffset Keepboth run val messageOpt publishAndRequestRetrytopic key message sub retries messageOpt should not be empty messageOptgetvalue shouldBe message publishAndRequestRetry uses publishToKafka to put a message and wait for the source to get it I want to add a test to know if the offset has been commited or not Is this possible with EmbeddedKafka I am running tests over the same Kafka Streams topology I have different suites extending EmbeddedKafkaStreamsAllInOne Each suite uses different ZK and Kafka ports application name and topic names same names with appName prefixed Each suite contains several tests which use withRunningKafka and custom consumers to test different parts of a KafkaStreams application that has several output topics When running tests sequentially theyre fine but in parallel starts showing errors of nonexistent topics dangling threads trying to connect to ZK etc Ive updated to to no avail Ive seen this issue has been raised before here and some fixes have been merged Are they in already First failure when executing two suites with appNames customertest and ordertest INFO Create topic customertestsessionz comdivvitdpstreamstestingKafkaStreamsTestUtils INFO Create topic ordertestsessionz comdivvitdpstreamstestingKafkaStreamsTestUtils WARN Error registering AppInfo mbean orgapachekafkacommonutilsAppInfoParser javaxmanagementInstanceAlreadyExistsException kafkaadminclienttypeappinfoidembeddedkafkaadminclient at comsunjmxmbeanserverRepositoryaddMBeanRepositoryjava at comsunjmxinterceptorDefaultMBeanServerInterceptorregisterWithRepositoryDefaultMBeanServerInterceptorjava at comsunjmxinterceptorDefaultMBeanServerInterceptorregisterDynamicMBeanDefaultMBeanServerInterceptorjava at comsunjmxinterceptorDefaultMBeanServerInterceptorregisterObjectDefaultMBeanServerInterceptorjava at comsunjmxinterceptorDefaultMBeanServerInterceptorregisterMBeanDefaultMBeanServerInterceptorjava at comsunjmxmbeanserverJmxMBeanServerregisterMBeanJmxMBeanServerjava at orgapachekafkacommonutilsAppInfoParserregisterAppInfoAppInfoParserjava at orgapachekafkaclientsadminKafkaAdminClientinitKafkaAdminClientjava at orgapachekafkaclientsadminKafkaAdminClientcreateInternalKafkaAdminClientjava at orgapachekafkaclientsadminAdminClientcreateAdminClientjava at netmanubembeddedkafkaEmbeddedKafkaSupportcreateCustomTopicEmbeddedKafkascala I understand here winner takes it all in this case customers Suite seems to enter first then orders Suite is trying to use the same Kafka but it cant Is it the client ID idembeddedkafkaadminclient of any importance here It is hardcoded here so I suppose it shouldnt be a matter of conflict Then I can find these errors later which seem to show second Suite complaining about its topics javalangIllegalArgumentException Assigned partition ordertestcustomerOrderIntermediate for nonsubscribed topic regex pattern subscription pattern is customertestcustomerOrderIntermediatecustomertestcustomerzcustomertesteventzcustomertestvisitorz at orgapachekafkaclientsconsumerinternalsSubscriptionStateassignFromSubscribedSubscriptionStatejava at orgapachekafkaclientsconsumerinternalsConsumerCoordinatoronJoinCompleteConsumerCoordinatorjava at orgapachekafkaclientsconsumerinternalsAbstractCoordinatorjoinGroupIfNeededAbstractCoordinatorjava at orgapachekafkaclientsconsumerinternalsAbstractCoordinatorensureActiveGroupAbstractCoordinatorjava at orgapachekafkaclientsconsumerinternalsConsumerCoordinatorpollConsumerCoordinatorjava at orgapachekafkaclientsconsumerKafkaConsumerpollOnceKafkaConsumerjava at orgapachekafkaclientsconsumerKafkaConsumerpollKafkaConsumerjava at orgapachekafkastreamsprocessorinternalsStreamThreadpollRequestsStreamThreadjava at orgapachekafkastreamsprocessorinternalsStreamThreadrunOnceStreamThreadjava at orgapachekafkastreamsprocessorinternalsStreamThreadrunLoopStreamThreadjava at orgapachekafkastreamsprocessorinternalsStreamThreadrunStreamThreadjava Using netmanub scalatestembeddedkafka Im seeing an issue with stopping the embedded servers if the servers have been started individually When I start the servers by calling start the subsequent call to stop works as expected However when starting each server individually a call to stop results in repeated Connection refused ZooKeeper errors Looking at the code the discrepancy can be explained by the fact that start does not add the EmbeddedZ instance to servers and is thus never stopped by a call to stop while startZooKeeper adds the instance to servers This is best demonstrated in the REPL I canceled the session after two errors but they repeat indefinitely info Starting scala interpreter Welcome to Scala OpenJDK Bit Server VM Java Type in expressions for evaluation Or try help scala paste Entering paste mode ctrlD to finish import netmanubembeddedkafkaEmbeddedKafka import scalareflectioDirectory import orgslf jLoggerFactory val log LoggerFactorygetLoggerREPLlogger loginfoEmbeddedKafkastart EmbeddedKafkastart Threadsleep EmbeddedKafkastop Threadsleep loginfoEmbeddedKafkastartZooKeeper EmbeddedKafkastartZooKeeperDirectorymakeTempzookeeperlogs Threadsleep loginfoEmbeddedKafkastartKafka EmbeddedKafkastartKafkaDirectorymakeTempkafkalogs Threadsleep loginfoStopping servers EmbeddedKafkastop loginfoServers stopped Exiting paste mode now interpreting INFO REPLlogger EmbeddedKafkastart ERROR oazsZooKeeperServer ZKShutdownHandler is not registered so ZooKeeper server wont take any action on ERROR or SHUTDOWN server state changes WARN ksBrokerMetadataCheckpoint No metaproperties file under dir tmpkafkalogs tmpmetaproperties WARN ksBrokerMetadataCheckpoint No metaproperties file under dir tmpkafkalogs tmpmetaproperties ERROR oazsZooKeeperServer ZKShutdownHandler is not registered so ZooKeeper server wont take any action on ERROR or SHUTDOWN server state changes INFO REPLlogger EmbeddedKafkastartZooKeeper ERROR oazsZooKeeperServer ZKShutdownHandler is not registered so ZooKeeper server wont take any action on ERROR or SHUTDOWN server state changes INFO REPLlogger EmbeddedKafkastartKafka WARN oazClientCnxn Session x for server null unexpected error closing socket connection and attempting reconnect javanetConnectException Connection refused at sunniochSocketChannelImplcheckConnectNative Method at sunniochSocketChannelImplfinishConnectSocketChannelImpljava at orgapachezookeeperClientCnxnSocketNIOdoTransportClientCnxnSocketNIOjava at orgapachezookeeperClientCnxnSendThreadrunClientCnxnjava WARN ksBrokerMetadataCheckpoint No metaproperties file under dir tmpkafkalogs tmpmetaproperties WARN ksBrokerMetadataCheckpoint No metaproperties file under dir tmpkafkalogs tmpmetaproperties INFO REPLlogger Stopping servers ERROR oazsZooKeeperServer ZKShutdownHandler is not registered so ZooKeeper server wont take any action on ERROR or SHUTDOWN server state changes WARN oazClientCnxn Session x d d e for server null unexpected error closing socket connection and attempting reconnect javanetConnectException Connection refused at sunniochSocketChannelImplcheckConnectNative Method at sunniochSocketChannelImplfinishConnectSocketChannelImpljava at orgapachezookeeperClientCnxnSocketNIOdoTransportClientCnxnSocketNIOjava at orgapachezookeeperClientCnxnSendThreadrunClientCnxnjava WARN oazClientCnxn Session x d d e for server null unexpected error closing socket connection and attempting reconnect javanetConnectException Connection refused at sunniochSocketChannelImplcheckConnectNative Method at sunniochSocketChannelImplfinishConnectSocketChannelImpljava at orgapachezookeeperClientCnxnSocketNIOdoTransportClientCnxnSocketNIOjava at orgapachezookeeperClientCnxnSendThreadrunClientCnxnjava A release for M would be great as a first step before releasing for M which has new scala collections I recently wrote and to address some needs I had for running embedded Kafka in TestNGJava tests As it turns out I actually need to run embedded Kafka version with the changes Ive made for those issues eg Should I start with the code in this tag or should I start with master and try to use the correct properties for Ive been doing the former but Im having some issues Im also not sure what version to use Working off that tag I have set the version to SNAPSHOT Anyhow any thoughts in this area are appreciated Ive tried various approaches and keep hitting roadblocks Thanks Kafka fails to start with embedded schema registry with the following error Running the same code with EmbeddedKafkaConfig instead of EmbeddedKafkaConfigWithSchemaRegistry allows Kafka to start normally ScalaTestrunrunningAvroSerdeTest ERROR oazookeeperserverZooKeeperServer ZKShutdownHandler is not registered so ZooKeeper server wont take any action on ERROR or SHUTDOWN server state changes ScalaTestrunrunningAvroSerdeTest WARN kserverBrokerMetadataCheckpoint No metaproperties file under dir varfoldersgvxmthgtn ld c zntpyfhx gnTkafka tmpmetaproperties ScalaTestrunrunningAvroSerdeTest WARN kserverBrokerMetadataCheckpoint No metaproperties file under dir varfoldersgvxmthgtn ld c zntpyfhx gnTkafka tmpmetaproperties ScalaTestrunrunningAvroSerdeTest WARN ioconfluentrestApplication DEPRECATION warning listeners configuration is not configured Falling back to the deprecated port configuration ScalaTestrunrunningAvroSerdeTest WARN ioconfluentrestApplication DEPRECATION warning listeners configuration is not configured Falling back to the deprecated port configuration ScalaTestrunrunningAvroSerdeTestSendThreadlocalhost WARN orgapachezookeeperClientCnxn Session x for server null unexpected error closing socket connection and attempting reconnect javanetConnectException Connection refused at sunniochSocketChannelImplcheckConnectNative Method at sunniochSocketChannelImplfinishConnectSocketChannelImpljava at orgapachezookeeperClientCnxnSocketNIOdoTransportClientCnxnSocketNIOjava at orgapachezookeeperClientCnxnSendThreadrunClientCnxnjava ScalaTestrunrunningAvroSerdeTest WARN oakcadminAdminClientConfig The configuration topic was supplied but isnt a known config ScalaTestrunrunningAvroSerdeTest WARN oakcadminAdminClientConfig The configuration connectionurl was supplied but isnt a known config ScalaTestrunrunningAvroSerdeTest WARN icksstorageKafkaStore Creating the schema topic schemas using a replication factor of which is less than the desired one of If this is a production environment its crucial to add more brokers and increase the replication factor of the topic ScalaTestrunrunningAvroSerdeTest WARN oakcproducerProducerConfig The configuration topic was supplied but isnt a known config ScalaTestrunrunningAvroSerdeTest WARN oakcproducerProducerConfig The configuration connectionurl was supplied but isnt a known config ScalaTestrunrunningAvroSerdeTest WARN oakcconsumerConsumerConfig The configuration topic was supplied but isnt a known config ScalaTestrunrunningAvroSerdeTest WARN oakcconsumerConsumerConfig The configuration connectionurl was supplied but isnt a known config ScalaTestrunrunningAvroSerdeTestSendThreadlocalhost WARN orgapachezookeeperClientCnxn Session x for server null unexpected error closing socket connection and attempting reconnect javanetConnectException Connection refused at sunniochSocketChannelImplcheckConnectNative Method at sunniochSocketChannelImplfinishConnectSocketChannelImpljava at orgapachezookeeperClientCnxnSocketNIOdoTransportClientCnxnSocketNIOjava at orgapachezookeeperClientCnxnSendThreadrunClientCnxnjava ScalaTestrunrunningAvroSerdeTest WARN ioconfluentrestApplication DEPRECATION warning listeners configuration is not configured Falling back to the deprecated port configuration ScalaTestrunrunningAvroSerdeTest ERROR oazookeeperserverZooKeeperServer ZKShutdownHandler is not registered so ZooKeeper server wont take any action on ERROR or SHUTDOWN server state changes A needed class was not found This could be due to an error in your runpath Missing class orgeclipsejettyserverhandlerContextHandlerNoContext javalangNoClassDefFoundError orgeclipsejettyserverhandlerContextHandlerNoContext at orgeclipsejettyservletServletContextHandlernewServletHandlerServletContextHandlerjava at orgeclipsejettyservletServletContextHandlergetServletHandlerServletContextHandlerjava at orgeclipsejettyservletServletContextHandlerrelinkHandlersServletContextHandlerjava at orgeclipsejettyservletServletContextHandlerinitServletContextHandlerjava at orgeclipsejettyservletServletContextHandlerinitServletContextHandlerjava at orgeclipsejettyservletServletContextHandlerinitServletContextHandlerjava at ioconfluentrestApplicationcreateServerApplicationjava at ioconfluentkafkaschemaregistryRestAppstartRestAppjava at netmanubembeddedkafkaschemaregistryEmbeddedKafkaWithSchemaRegistrySupportstartSchemaRegistryembeddedKafkaWithSchemaRegistryscala at netmanubembeddedkafkaschemaregistryEmbeddedKafkaWithSchemaRegistrySupportstartSchemaRegistryembeddedKafkaWithSchemaRegistryscala at netmanubembeddedkafkaschemaregistryEmbeddedKafkaWithSchemaRegistrySupportanonfunwithRunningKafkaOnFoundPort embeddedKafkaWithSchemaRegistryscala at netmanubembeddedkafkaEmbeddedKafkaSupportwithTempDirEmbeddedKafkascala at netmanubembeddedkafkaEmbeddedKafkaSupportwithTempDirEmbeddedKafkascala sbt dependency entry netmanub scalatestembeddedschemaregistry kafka nosr Test Hello Im trying to use the version because Im using Spark Streaming and it seems the most compatible version But this version has some bugs Java heap problem and I need a newer version When I try to use a newer version I get some dependencies errors when I start Kafka embedded The reason seem that my sparkstreaming library use kafkaclient and if I try to use a newer version from kafka embedded it uses the version If I add this last dependency the code doesnt work because some functions doesnt exist in this new version from kafka client Is there any way to resolve this issue The spark version I use I have tried with many differents versions from kafka embedded and only works te version main ERROR oazserverNIOServerCnxnFactory Thread Thread main main died javalangreflectInvocationTargetException null at sunreflectNativeMethodAccessorImplinvoke Native Method na at sunreflectNativeMethodAccessorImplinvokeNativeMethodAccessorImpljava na at sunreflectDelegatingMethodAccessorImplinvokeDelegatingMethodAccessorImpljava na at javalangreflectMethodinvokeMethodjava na at comintellijrtexecutionCommandLineWrappermainCommandLineWrapperjava ideartjarna Caused by javalangNoSuchMethodError kafkaserverKafkaServerlessinitgreaterdefault LorgapachekafkacommonutilsTime at netmanubembeddedkafkaEmbeddedKafkaSupportclassstartKafkaEmbeddedKafkascala scalatestembeddedkafka jar at netmanubembeddedkafkaEmbeddedKafkastartKafkaEmbeddedKafkascala scalatestembeddedkafka jar at netmanubembeddedkafkaEmbeddedKafkastartEmbeddedKafkascala scalatestembeddedkafka jar Hi ManuB I included scalatestembeddedkafka in the test scope in my project but when I compile the code it gives the following errors info SUCCESSFUL netmanubscalatestembeddedkafka scalatestembeddedkafka jar ms warn FAILED comsunjdmkjmxtools jmxtoolsjar ms warn local tried warn C Users Yayati ivy local comsunjdmk jmxtools jars jmxtoolsjar warn public tried warn warn localpreloadedivy tried warn C Users Yayati sbt preloaded comsunjdmk jmxtools jars jmxtoolsjar warn localpreloaded tried warn fileCUsersYayatisbtpreloadedcomsunjdmkjmxtools jmxtools jar warn FAILED comsunjmxjmxri jmxrijar ms warn local tried warn C Users Yayati ivy local comsunjmx jmxri jars jmxrijar warn public tried warn warn localpreloadedivy tried warn C Users Yayati sbt preloaded comsunjmx jmxri jars jmxrijar warn localpreloaded tried warn fileCUsersYayatisbtpreloadedcomsunjmxjmxri jmxri jar warn warn FAILED DOWNLOADS warn see resolution messages for details warn warn comsunjdmkjmxtools jmxtoolsjar warn comsunjmxjmxri jmxrijar warn The moment I remove the dependency from my build file the compilation becomes successfull could you suggest a solution 