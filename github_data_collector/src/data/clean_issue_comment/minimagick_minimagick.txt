It looks like validateonwrite has been removed with this commit back in but it still is in readme I am getting the warning using this gem with ruby bash usrlocalrvmgemsruby myappgemsminimagick libminimagickimagerb warning Using the last argument as keyword parameters is deprecated Continuing from and It is surprising to me that a library intended to be a complete wrapper for ImageMagick has no functionality to create a new image to draw on without an outside library As of at least the current stance is that this is actually out of scope of MiniMagick which is completely ridiculous The following or something similar should be possible image MiniMagickImagecreate imagesize imagewritetestpng Im not sure if this is a bug here that is just now manifesting or a bug in IM or both According to their changelog it looks like they somewhat recently revised the PDF reader Given a PDF exported by Adobe Illustrator the identify command now outputs Mt Moonpdf AI x x bit ColorSeparation CMYK MiB u What it used to output is Mt Moonpdf PDF x x bit ColorSeparation CMYK MiB u With verbose added on they both give the correct mimetype Image Mt Moonpdf Format AI Adobe Illustrator CS Mime type applicationpdf Image Mt Moonpdf Format PDF Portable Document Format Mime type applicationpdf The mimetype method in MiniMagick doesnt actually use that value it takes the format AI or PDF and just adds it onto image ruby def mimetype imageself format downcase end So what we now get is imageai instead of imagepdf Even imagepdf isnt technically right it should be applicationpdf An easy way to get the proper value ruby def mimetype self data mimeType end This would of course be breaking to everyone expecting the old behavior of outputting imagepdf Id like to ensure that an attacker cannot execute arbitrary code on my server by for example uploading a carefully crafted Postscript with a JPEG file extension Is there a way to take advantage of the ImageMagick feature that forces an input file format by specifying a module prefix on the filename such as jpgsomefilejpg This is suggested as a security precaution for both ImageMagick see Other Security Considerations and GraphicsMagick see Safe Use Of The Software item Hello By raising the version of ghostscript it is no longer possible to create a PDF file that we were able to create Software version ubuntu minimagick ghostscript ImageMagick Target file ngpdf procedure ruby irbmain path ngpdf ngpdf irbmain MiniMagickImagenewpathdimensions Traceback most recent call last from binrails in main from binrails in require from varwwwcrevosharedbundleruby gemsrailties librailscommandsrb in top required from varwwwcrevosharedbundleruby gemsrailties librailscommandscommandstasksrb in runcommand from varwwwcrevosharedbundleruby gemsrailties librailscommandscommandstasksrb in console from varwwwcrevosharedbundleruby gemsrailties librailscommandsconsolehelperrb in start from varwwwcrevosharedbundleruby gemsrailties librailscommandsconsolerb in start from irb from varwwwcrevosharedbundleruby gemsminimagick libminimagickimagerb in block in attribute from varwwwcrevosharedbundleruby gemsminimagick libminimagickimageinforb in from varwwwcrevosharedbundleruby gemsminimagick libminimagickimageinforb in cheapinfo from varwwwcrevosharedbundleruby gemsminimagick libminimagickimageinforb in rescue in cheapinfo MiniMagickInvalid image data cant be read irbmain image MiniMagickImagenewpath MiniMagickImage x d pathtmpngpdf tempfilenil infoMiniMagickImageInfo x d pathtmpngpdf info irbmain imagepages MiniMagickImage x dabe pathtmpngpdf tempfilenil infoMiniMagickImageInfo x dabc pathtmpngpdf info MiniMagickImage x dab pathtmpngpdf tempfilenil infoMiniMagickImageInfo x daaf pathtmpngpdf info MiniMagickImage x daa pathtmpngpdf tempfilenil infoMiniMagickImageInfo x daa pathtmpngpdf info MiniMagickImage x da pathtmpngpdf tempfilenil infoMiniMagickImageInfo x da pathtmpngpdf info MiniMagickImage x da c pathtmpngpdf tempfilenil infoMiniMagickImageInfo x da a pathtmpngpdf info MiniMagickImage x da pathtmpngpdf tempfilenil infoMiniMagickImageInfo x da d pathtmpngpdf info MiniMagickImage x da pathtmpngpdf tempfilenil infoMiniMagickImageInfo x da pathtmpngpdf info MiniMagickImage x da pathtmpngpdf tempfilenil infoMiniMagickImageInfo x da pathtmpngpdf info MiniMagickImage x da a pathtmpngpdf tempfilenil infoMiniMagickImageInfo x da pathtmpngpdf info MiniMagickImage x da e pathtmpngpdf tempfilenil infoMiniMagickImageInfo x da b pathtmpngpdf info MiniMagickImage x da pathtmpngpdf tempfilenil infoMiniMagickImageInfo x da f pathtmpngpdf info irbmain imageidentify Error reading a content stream The page may be incomplete n Output may be incorrect n Error Form stream has unbalanced qQ operators too many qs n Output may be incorrect nError Ignoring invalid annotation output may be incorrect n Error reading a content stream The page may be incomplete n Output may be incorrect n Error Form stream has unbalanced qQ operators too many qs n Output may be incorrect nError Ignoring invalid annotation output may be incorrect ntmpngpdf PBM x x bit Bilevel Gray KB u Description It is a cause By raising the version of ghostscript the contents outputted in the error log will be returned as the result of standard output stdout stderr status ghostscript PBM B Error reading a content stream The page may be incomplete n Warning Form stream has unbalanced qQ operators too many qs n Error reading a content stream The page may be incomplete n Warning Form stream has unbalanced qQ operators too many qs n n This file had errors that were repaired or ignored n The file was produced by n Adobe PDF library n Please notify the author of the software that produced this n file that it does not conform to Adobes published PDF n specification n n ghostscript Error reading a content stream The page may be incomplete n Output may be incorrect n Error Form stream has unbalanced qQ operators too many qs n Output may be incorrect nError Ignoring invalid annotation output may be incorrect n Error reading a content stream The page may be incomplete n Output may be incorrect n Error Form stream has unbalanced qQ operators too many qs n Output may be incorrect nError Ignoring invalid annotation output may be incorrect nPBM B As a result parsing on minimagick side fails and it is an error ruby pryMiniMagickImageInfo self m w h b split Error reading a content stream The page may be Approach approach Look at the version of ghostscript and change parse processing Originally it is a problem of ghostscript Expect ghostscript to be modified It will be a problem that software can not be used until then I think whether the former is good To be honest since the output of ghostscript has been changed it is not easy to deal with it here hi thanks for helping take a look at this The closest I found so far is Getting MiniMagickInvalid due to improper image header Minimgack started failing out of the blue and I cant seem to find the cause of it Most importantly it doesnt return a description as to why it has failed identify tmpminimagick mu uf failed with error In my error logs it only shows a MiniMagickImagenew filepath MiniMagickImageopennode xlinkhref MiniMagickToolConvertnew Thanks I use Minimagick and my folder tmp dont stop growing with file like minimagick y ae jpg I use minimagick like this begin image MiniMagickImageopenabsolutepathfile imagethumbnailTHUMBNAILSDIMENSION imagewrite thumbnailsabsolutepathfile rescue StandardError end I miss something Using minimagick with imagemagick cause an error on some images since the result of convert json may contain values like image name null and skewness entropy nan I fixed this with a hack in inforb def data raise Error MiniMagickImagedata isnt supported on GraphicsMagick Use MiniMagickImagedetails instead if MiniMagickgraphicsmagick info data json MiniMagickToolConvertnew do convert convert path convert json added end nan NaN accept NaN when parsing JSON data JSONparsejsongsub nan NaN allownan true data datafetch if dataisaArray datafetchimage end The code avoids name null and replace nan with Nan By enabling the proper option to accept NaN the result can now be parsed I can provide an example image when necessary The gem is linking to Rubyforge