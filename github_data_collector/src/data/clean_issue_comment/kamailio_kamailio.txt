 Description In plain Kamailio language we used the following line if sdpwithtransportRTPSAVP Now we wanted to convert that to Kemi Turns out the sdpwithtransport function is not exported to Kemi So we thought we could use sdptransport to work around the missing function This works as long as there is only one transport in SDP But if a phone sends two media streams in SDP one with RTPAVP and one with RTPSAVP sdptransport will return Troubleshooting Reproduction Send an INVITE to Kamailio and try to get the transport type into a variable with sdptransport This can be done for example with a snom phone where in the rtp section of the identity configuration the parameter RTPSAVP is set to optional Log Messages Jan hagi usrsbinkamailio DEBUG appjsdt appjsdtapic srkemijsdtexecfuncex param for sdptransport is str avpmediaTransport Jan hagi usrsbinkamailio DEBUG core coreusravpc parseavpident Parsing mediaTransport Jan hagi usrsbinkamailio DEBUG core corepvapic pvcacheadd pvar avpmediaTransport added in cache Jan hagi usrsbinkamailio DEBUG sdpops sdpopsmodc sdptransporthelper stream of transport RTPSAVP Jan hagi usrsbinkamailio DEBUG sdpops sdpopsmodc sdptransporthelper stream of transport RTPAVP Jan hagi usrsbinkamailio DEBUG sdpops sdpopsmodc sdptransporthelper no common transport Additional Information We are still running Kamailio x but as far as I could see the behavior has not changed since then Description Explain what you did what you expected to happen and what actually happened Im looking at using presence module with subsdbmode parameter set to where it uses memory to store and query active watchers I noticed that sometimes Kamailio will throw following message during PUBLISH processesing and it will not generate appropriate NOTIFY for watchers DEBUG presence notifyc publnotify Could not find subsdialog RPC command to dump current active watchers will be helpful during troubleshooting Currently with subsdbmode set to you can not tell for sure if subsciption already expired or not And with subsdbmode set to or you can get information from DB with delay This command will also allow to clarify subscriber domain value which if I understood correctly must match domain from presentity Thanks a lot Description Kamailio fails to forward indialog request over TCPTLSWSWSS connection Troubleshooting kamailio branch has a commit ac e ef dbd b dec b ae b f ed cherry picked from master branch It makes sense for master because getsendsocket behavior has changed and function became smarter and also there were some patches to propagate connection it to the uac structure After applying this patch to x kamailio searches for an outgoing socket receives the first one due to limitations of getsendsocket and SNDFFORCESOCKET flag Then it fails to find an existing TCP connection by destination ipport since it searches for a connection associated with a wrong socket Log Messages Check the syslog file and if there are relevant log messages printed by Kamailio add them next or attach to issue or provide a link to download them eg to a pastebin site Dec kamailio WARNING core coremsgtranslatorc viabuilder TCPTLS connection id for WebSocket could not be found Dec kamailio ERROR tm tmsgbuilderc assemblevia via building failed Dec kamailio ERROR tm tmsgbuilderc builduacreq error while assembling Via Dec kamailio ERROR tm uacc tuacprepare Error while building message Dec kamailio ERROR presence notifyc sendnotifyrequest in function tmbtrequestwithin Dec kamailio ERROR presence notifyc notify sending Notify not successful Dec kamailio ERROR presence notifyc publnotify Could not send notify for messagesummary Possible Solutions Delete mentioned commit from the branch If you found a solution or workaround for the issue describe it Ideally provide a pull request with a fix Additional Information Kamailio Version output of kamailio v Operating System Details about the operating system the type Linux eg Debian Ubuntu CentOS MacOS xBSD Solaris Kernel details output of uname a linux Kamailio Project uses GitHub Issues only for bugs in the code or feature requests Please use this template only for bug reports If you have questions about using Kamailio or related to its configuration file ask on srusers mailing list If you have questions about developing extensions to Kamailio or its existing C code ask on srdev mailing list Please try to fill this template as much as possible for any issue It helps the developers to troubleshoot the issue If there is no content to be filled in a section the entire section can be removed You can delete the comments from the template sections when filling You can delete next line and everything above before submitting it is a comment Kamailio with appruby crashed with example config Kamailio with same config and ruby not have this issue I try example appruby from appruby mod documentation and kamailio crash after call ruby method example ruby script cat varkamailiorubytestrb def infosi KSRinfo from ruby src ip si KSRisINVITE KSRPVgetsi n KSRinfo from ruby src ip si KSRisINVITE KSRPVsetsvartmp KSRPVgetsi n KSRPVsetivartmp KSRSLslsendreply OKRuby end kamailio config loadmodule apprubyso modparamappruby load varkamailiorubytestrb handle requests within SIP dialogs routeWITHINDLG only initial requests no To tag authentication routeAUTH record routing for dialog forming requests in case they are routed remove preloaded route headers removehfRoute if ismethodINVITESUBSCRIBE recordroute ifrubyruninfosi xdbgSCRIPT failed to execute ruby function n xlogLINFORUBY vartmp Troubleshooting Reproduction Install latest ruby from source Install kamailio from git If the issue can be reproduced describe how it can be done Debugging Data bt full info locals list New LWP Thread debugging using libthreaddb enabled Using host libthreaddb library libx linuxgnulibthreaddbso Core was generated by usrlocalsbinkamailio P varrunkamailiokamailiopid f usrlocaletcka Program terminated with signal SIGSEGV Segmentation fault x f affe cfbe in rbcurrentthread at vmcoreh return rbecthreadptrec x f affe cfbe in rbcurrentthread at vmcoreh ec x ec optimized out rubycleanup ex at evalc state optimized out errs th optimized out nerr optimized out sysex step x f b dc in rubysrdestroy at apprubyapic No locals x f b c in moddestroy at apprubymodc No locals x cc in destroymodules at coresrmodulec t x f b f foo x f b func destroymodules x aef in cleanup showstatus at mainc memlog func cleanup x a e in shutdownchildren sig showstatus at mainc func shutdownchildren x d in handlesigs at mainc chld chldstatus anychldstopped memlog func handlesigs x in mainloop at mainc i pid si x sidesc udp receiver child sock I QGV Lm X PW bN nrprocs woneinit func mainloop x ea in main argc argv x fffb ce at mainc cfgstream x c r tmp x fffb f tmplen port proto ahost x aport options x db fcmMdVIhEeblLnvKrRDTNWwtugPGSQOaAxXY ret seed rfd debugsave debugflag dontforkcnt nlst x p x f b b af handleintel H uf t M st stdev stino stnlink stmode stuid stgid pad strdev stsize stblksize stblocks statim tvsec tvnsec stmtim tvsec tvnsec stctim tvsec tvnsec glibcreserved tbuf Y xX bU repeats times M Y J Z Z repeats times J Y Y M optionindex longoptions name x a help hasarg flag x val name x a c version hasarg flag x val name x f alias hasarg flag x val name x subst hasarg flag x val name x b substdef hasarg flag x val name x substdefs hasarg flag x val name x e serverid hasarg flag x val name x hasarg flag x val func main ec x ec optimized out static inline rbthreadt rbcurrentthreadvoid const rbexecutioncontextt ec GETEC return rbecthreadptrec static inline rbvmt rbcurrentvmvoid Log Messages Check the syslog file and if there are relevant log messages printed by Kamailio add them next or attach to issue or provide a link to download them eg to a pastebin site Dec serZt usrlocalsbinkamailio CRITICAL core corepassfdc receivefd EOF on Dec serZt usrlocalsbinkamailio ALERT core mainc handlesigs child process exited by a signal Dec serZt usrlocalsbinkamailio ALERT core mainc handlesigs core was generated Dec serZt usrlocalsbinkamailio INFO core mainc handlesigs terminating due to SIGCHLD Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received Dec serZt usrlocalsbinkamailio INFO core mainc sigusr signal received SIP Traffic If the issue is exposed by processing specific SIP messages grab them with ngrep or save in a pcap file then add them next or attach to issue or provide a link to download them eg to a pastebin site INVITE sip SIP Via SIP UDP rportbranchz hG bKPjMoJzLYnzbFfyeQgAkPu nh yPaZUM MaxForwards From sipkovik tagAETpu nyfAmiW ruBDgrcHPm w Uc To sip Contact sipkovik ob CallID kat b EbVAbAm hSTPXG eU lME QG CSeq INVITE Allow PRACK INVITE ACK BYE CANCEL UPDATE INFO SUBSCRIBE NOTIFY REFER MESSAGE OPTIONS Supported replaces rel timer norefersub SessionExpires MinSE UserAgent PJSUA v svn Linux x glibc ProxyAuthorization Digest usernamekovik realm nonceXfoqml KW qVYVrbT WbA jHDV rwC urisip responseffafbe bbdd fa aeba b f ContentType applicationsdp ContentLength v o IN IP spjmedia bAS t aXnat maudio RTPAVP cIN IP bTIAS artcp IN IP asendrecv artpmap speex artpmap speex artpmap speex artpmap iLBC afmtp mode artpmap GSM artpmap PCMU artpmap PCMA artpmap G artpmap telephoneevent afmtp artpmap telephoneevent afmtp artpmap telephoneevent afmtp assrc cname bdc ad ba b Possible Solutions If you found a solution or workaround for the issue describe it Ideally provide a pull request with a fix Additional Information Kamailio Version output of kamailio v version kamailio x linux d d edirty flags USETCP USETLS USESCTP TLSHOOKS USERAWSOCKS DISABLENAGLE USEMCAST DNSIPHACK SHMMMAP PKGMALLOC QMALLOC FMALLOC TLSFMALLOC DBGSRMEMORY USEFUTEX FASTLOCKADAPTIVEWAIT USEDNSCACHE USEDNSFAILOVER USENAPTR USEDSTBLACKLIST HAVERESOLVRES TLSPTHREADMUTEXSHARED ADAPTIVEWAITLOOPS MAXRECVBUFFERSIZE MAXURISIZE BUFSIZE DEFAULT PKGSIZE MB poll method support poll epolllt epollet sigiort select id d d e dirty compiled on Dec with gcc ruby v ruby p revision x linux Operating System Details about the operating system the type Linux eg Debian Ubuntu CentOS MacOS xBSD Solaris Kernel details output of uname a lsbrelease a No LSB modules are available Distributor ID Debian Description Debian GNULinux buster Release Codename buster uname a Linux serZt pve SMP PVE Tue Apr x GNULinux CC gcc M dbredisso redistableo CC gcc M dbredisso dbredismodo CC gcc M dbredisso redisconnectiono In file included from libsrdb coreuth from libsrdb dbkeyh from libsrdb dbh from dbredismodh from redistablec redistablec In function dbredisparsekeys libsrdb coredprinth warning tablenamelen may be used uninitialized in this function Wmaybeuninitialized fprintfstderr dd s ss fmt redistablec note tablenamelen was declared here str tablename In file included from libsrdb coreuth from libsrdb dbkeyh from libsrdb dbh from dbredismodh from redistablec libsrdb coredprinth warning tablenames may be used uninitialized in this function Wmaybeuninitialized fprintfstderr dd s ss fmt redistablec note tablenames was declared here str tablename redistablec warning table may be used uninitialized in this function Wmaybeuninitialized tabletypes typetarget type CC gcc M dbredisso redisdbaseo make libsrdb so is up to date make libsrdb so is up to date Description Explain what you did what you expected to happen and what actually happened In some cases we need to call zabbixsender utility to notify that some failure happens At this time we move our configs from Kamailio to Kamailio and during testing we meet this issue We configured exec module to kill the program after seconds modparamexec timetokill execavpusrbinzabbixsender config ZABBIXAGENTCONFIGPATH key ecspnotelephony value zabbixsender could not connect to server and were hanged up Kamailio probably tried to kill it and crashed Troubleshooting Reproduction If the issue can be reproduced describe how it can be done Debugging Data If you got a core dump use gdb to extract troubleshooting data full backtrace local variables and the list of the code at the issue location gdb pathtokamailio pathtocorefile bt full gdb bt full x f a e b in runfailurehandlers t x f d b c rpl xffffffffffffffff code extraflags at treplyc fakedreq x f d f a fakedreqlen shmemmsg x f d cf onfailure keng x FUNCTION runfailurehandlers x f a b ff in tshouldrelayresponse Trans x f d b c newcode branch shouldstore x ffdc d efc shouldrelay x ffdc d f canceldata x ffdc d fb reply xffffffffffffffff at treplyc branchcnt pickedcode newbranch invthrough extraflags i repliesdropped FUNCTION tshouldrelayresponse x f a a ae in relayreply t x f d b c pmsg xffffffffffffffff branch msgstatus canceldata x ffdc d fb doputonwait at treplyc relay saveclone buf x reslen relayedcode relayedmsg x replybak x bm totagval s x start I H H PTI yw len totagretr replystatus RPSERROR uasrb x f d cc totag x f d ba reason s x len onsendparams req x start rpl x ffdc d f param x code flags branch trbuf x ffdc d fd dst x f a bb dbtimerudomain sendbuf s x ffffffff Address x ffffffff out of bounds len ip af len u addrl addr addr addr FUNCTION relayreply x f a f b in fakereply t x f d b c branch code at timerc canceldata cancelbitmap reason cause u text s x len e ecancel x packedhdrs s x len docancelbranch replystatus x f a f d in finalresponsehandler rbuf x f d baf t x f d b c at timerc silent branchret prevbranch now x f a f bc in retrbufhandler ticks tl x f d bb p x f at timerc rbuf x f d baf frremainder retrremainder retrinterval newretrintervalms crtretrintervalms t x f d b c FUNCTION retrbufhandler x bb f in slowtimermain at coretimerc n Type return to continue or q return to quit ret tl x f d bb i FUNCTION slowtimermain x f in mainloop at mainc i pid si x sidesc udp receiver child sock t W repeats times j z Xv W nrprocs woneinit FUNCTION mainloop x e a in main argc argv x ffdc d f at mainc cfgstream x e c r tmp x ffdc d f tmplen port proto ahost x aport options x b fcmMdVIhEeblLnvKrRDTNWwtugPGSQOaAxXY ret seed rfd debugsave debugflag dontforkcnt nlst x f f f f f f f f p x st stdev stino stnlink stmode stuid stgid pad strdev stsize stblksize stblocks statim tvsec tvnsec stmtim tvsec tvnsec stctim tvsec tvnsec unused tbuf W W repeats times H W H W W D b repeats times h H W I W P I W O W optionindex longoptions name x e a help hasarg flag x val name x dac version hasarg flag x val name x e f alias hasarg flag x val name x e subst hasarg flag x val name x e b substdef hasarg flag x val name x e a substdefs hasarg flag x val name x e ae serverid hasarg flag x val name x hasarg flag x val FUNCTION main info locals gdb info locals cfgstream x e c r tmp x ffdc d f tmplen port proto ahost x aport options x b fcmMdVIhEeblLnvKrRDTNWwtugPGSQOaAxXY ret seed rfd debugsave debugflag dontforkcnt nlst x f f f f f f f f p x st stdev stino stnlink stmode stuid stgid pad strdev stsize stblksize stblocks statim tvsec tvnsec stmtim tvsec tvnsec stctim tvsec tvnsec unused tbuf W W repeats times H W H W W D b repeats times h H W I W P I W O W optionindex longoptions name x e a help hasarg flag x val name x dac version hasarg flag x val name x e f alias hasarg flag x val name x e subst hasarg flag x val name x e b substdef hasarg flag x val name x e a substdefs hasarg flag x val name x e ae serverid hasarg flag x val name x hasarg flag x val FUNCTION main list gdb list execpostscriptcbfakedreq FAILURECBTYPE logprefixsetNULL update message flags if changed in failure route tuasrequestflags fakedreqflags restore original environment fakedenv t Log Messages Check the syslog file and if there are relevant log messages printed by Kamailio add them next or attach to issue or provide a link to download them eg to a pastebin site Dec sipproxy usrecspsbinkamailio NOTICE script zabbixsender ecspnotelephony Dec sipproxy usrecspsbinkamailio ALERT core mainc handlesigs child process exited by a signal Dec sipproxy usrecspsbinkamailio CRITICAL core corepassfdc receivefd EOF on Dec sipproxy usrecspsbinkamailio ALERT core mainc handlesigs core was generated SIP Traffic If the issue is exposed by processing specific SIP messages grab them with ngrep or save in a pcap file then add them next or attach to issue or provide a link to download them eg to a pastebin site paste your sip traffic here Possible Solutions If you found a solution or workaround for the issue describe it Ideally provide a pull request with a fix Additional Information Kamailio Version output of kamailio v version kamailio x linux cc a flags USETCP USETLS USESCTP TLSHOOKS USERAWSOCKS DISABLENAGLE USEMCAST DNSIPHACK SHMMMAP PKGMALLOC QMALLOC FMALLOC TLSFMALLOC DBGSRMEMORY USEFUTEX FASTLOCKADAPTIVEWAIT USEDNSCACHE USEDNSFAILOVER USENAPTR USEDSTBLACKLIST HAVERESOLVRES ADAPTIVEWAITLOOPS MAXRECVBUFFERSIZE MAXURISIZE BUFSIZE DEFAULT PKGSIZE MB poll method support poll epolllt epollet sigiort select id cc a compiled on Nov with gcc Operating System Details about the operating system the type Linux eg Debian Ubuntu CentOS MacOS xBSD Solaris Kernel details output of uname a Linux sipproxy el x SMP Fri Oct UTC x x x GNULinux CentOS Linux release Core When upgrading from stretch to buster the kamailio packages arent upgraded because the stretch version is greater than buster dpkg compareversions stretch gt buster echo The package version should include the release version instead of its codename eg deb u deb u like done for stable updates dpkg compareversions deb u gt deb u echo On Kamailio ad on CentOS with libcurl an httpconnect request to an unresponsive server httpconnectstuff url varhttpres correctly sets varhttpres to which is an operation timeout per However curlerrorvarhttpres returns the value No error This is not quite as promised in Thanks in advance Alex Description When relaying an INVITE from a Kamailio proxy to an interconnect we are using DNS SRV records for loadbalancing and failover The proxy is listening on both a private interface and a public interface with an rfc ie and a public IP address ie respectively The first branch before DNS SRV failover is working as expected The message will be relayed from the received socket to the interconnect When this branch results in a timeout the proxy will try to do DNS SRV failover This new branch and any subsequent branches will no longer use the initial received socket as source In our case we see that the private address is now being used as source address Troubleshooting Reproduction DNS SRV sipudptransitnet SRV transit net sipudptransitnet SRV transit net transit net A transit net A Kamailio du siptransitnettransportudp xinfoRelaying rm request ru with CallID ci tsetfr if not trelay slreplyerror Network flow INVITE udp udp internal request to proxy INVITE udp udp relaying from proxy to interconnect request times out after second proxy will do a failover to the next endpoint INVITE udp udp relaying to next interconnect address Log Messages Attempt to see where it goes wrong onsendroute xinfo RAut Rut sas n xinfosndbuf n INFO sip transportudp sip transportudp udp INFO INVITE sip transitnetuserphone SIP RecordRoute sip lrftagtDr m erX N D Via SIP UDP branchz hG bKafe fb e fa a a ce Via SIP UDP received rport branchz hG bK t a N FcB So the RecordRoute seems to be correct but the top most Via header shows the private IP address The message is being sent from the private IP address as well and never reaches the second address from the interconnect Possible Solutions A workaround to add fs udp in the onsendroute seems to be effective Additional Information Kamailio Version output of kamailio v version kamailio x linux flags STATS Off USETCP USETLS USESCTP TLSHOOKS USERAWSOCKS DISABLENAGLE USEMCAST DNSIPHACK SHMMEM SHMMMAP PKGMALLOC QMALLOC FMALLOC TLSFMALLOC DBGSRMEMORY USEFUTEX FASTLOCKADAPTIVEWAIT USEDNSCACHE USEDNSFAILOVER USENAPTR USEDSTBLACKLIST HAVERESOLVRES ADAPTIVEWAITLOOPS MAXRECVBUFFERSIZE MAXURISIZE BUFSIZE DEFAULT PKGSIZE MB poll method support poll epolllt epollet sigiort select id unknown compiled with gcc Operating System Ubuntu LTS Linux proxy generic Ubuntu SMP Thu Sep UTC x x x GNULinux Kamailio Project uses GitHub Issues only for bugs in the code or feature requests Please use this template only for feature requests If you have questions about using Kamailio or related to its configuration file ask on srusers mailing list If you have questions about developing extensions to Kamailio or its existing C code ask on srdev mailing list Please try to fill this template as much as possible for any issue It helps the developers to troubleshoot the issue If you submit a feature request or enhancement add the description of what you would like to be added If there is no content to be filled in a section the entire section can be removed You can delete the comments from the template sections when filling You can delete next line and everything above before submitting it is a comment Description Currently the functions setadvertisedaddress and setadvertisedport only accept strings as parameters Trying to use it with variable causes an error Having the function using a hard coded value is not a good practice and in order to add flexibility to the script in different installations it would be nice to have this function accepting variables Also the advertise option on the listen parameter is not always desired because it apply for all messages sent via the socket and there are situations where different advertised IP for the same interface are necessary Expected behavior setadvertisedaddress should receive a variable as parameter and use its value to change the SIP headers Actual observed behavior Kamailio wont start if setadvertisedaddress is used with a variable due to script parse error or it will set the SIP message with the literal string vartest for example instead of using the value of vartest Additional Information Kamailio Version output of kamailio v kamailio v version kamailio x linux f flags STATS Off USETCP USETLS USESCTP TLSHOOKS USERAWSOCKS DISABLENAGLE USEMCAST DNSIPHACK SHMMEM SHMMMAP PKGMALLOC QMALLOC FMALLOC TLSFMALLOC DBGSRMEMORY USEFUTEX FASTLOCKADAPTIVEWAIT USEDNSCACHE USEDNSFAILOVER USENAPTR USEDSTBLACKLIST HAVERESOLVRES ADAPTIVEWAITLOOPS MAXRECVBUFFERSIZE MAXURISIZE BUFSIZE DEFAULT PKGSIZE MB poll method support poll epolllt epollet sigiort select id f compiled on Mar with gcc Operating System Details about the operating system the type Linux eg Debian Ubuntu CentOS MacOS xBSD Solaris Kernel details output of uname a uname a Linux voiceconnkamailio el x SMP Tue Jun UTC x x x GNULinux 