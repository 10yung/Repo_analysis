 Issue While running the Lhmcleanup command I realized that the instructions and examples in the README stated the first argument as run see below instead of a boolean as reflected in the source code ruby Lhmcleanuprun Fix I modified the first argument in the Lhmcleanup READMEmd instructions and examples to reflect the intended boolean usage in the source code ruby Lhmcleanuptrue Rails ruby Lhmcleanuptrue until dayago I am interested in running a query that will return ROWCOUNT once the update query has been run Lhmchangetable tableone do m mddlUPDATE tableone end One the above is run is there a way to query for the rowcountto get no of records updated via lhm The original problem in issue was that if we alter table having external constraints ie refer by other tables using foreign key constraints using lhm it modifies the table without any warning and errors and lhm uses a method of modification is copy table and rename strategy when lhm renames origin table that time all references get changed In MySQL renaming of tables works like it changes all external references to a newtable so it causing an issue after migration runs I have faced this issue as well So in this pull request have just added validation it checks external foreign key constraints for given table and if it founds any table having references so it aborts the migration Need of this validation till the time LHMwe provide any solution for rebuilding for foreign key constraints As of this change in Rails the tableexists should be replaced by datasourceexists There was already an open issue for this matter I got this running LHM on a Rails app DEPRECATION WARNING tableexists currently checks both tables and views This behavior is deprecated and will be changed with Rails to only check tables Use datasourceexists instead I notice tableexists is indeed present in LHM so maybe its just a matter of findreplace For example I have users table which I would like to alter add columns with LHM But I have more tables that have constraints on users table As I understand after LHM job they will point to old users table not new one how to fix it LHM migration fails when there is existing lhm temp table for example lhmnusers which got created by previous LHM migration We need to do Lhmcleanup to clean those tables Instead if we have timestamp it wont conflict with the previous temp table Please review Our current setup is master db server primarydb RDS instance using RDS external replication masterreplica RDS read replicas uswest and uswest When we run an LHM on a reasonably busy table on primarydb the read replicas uswest and uswest report errors like this one Read Replica Replication Error SQLError reason Could not execute Updaterows event on table databasetablename Can apost find record in apostablename apos Errorcode handler error HAERRKEYNOTFOUND the event aposs master log mysqlbinchangelog endlogpos The replication between primarydb and masterreplica continues to work just fine its only the read replicas that crack the poops All instances use binlogformat ROW All instances are configured with logbintrustfunctioncreators All instances are running or higher Anyone else got this sort of configuration working Things we believe but dont have specific evidence to prove or disprove The errors are less likely to occur if no updates occur to the table being LHMed ie the trigger doesnt do any work LHMs do not always cause replication issues but it does appear to only not happen on fairly static tables Running the LHM on the masterreplica directly does not break the Read replicas BUT we have not run it on a RDS replica that has updates occuring to it ie it hasnt broken when weve experimented but see above Fixes some inconsistencies and outdated documentation around the throttler stride and throttle options 