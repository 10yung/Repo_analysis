 Provide a general summary of the issue in the Title above As a client on my android phone I want to use K However Im having a problem with it When I disconnect the device from the network the account is not disconnected from the dovecot server or put the other way when I connect anew the account is not reconnected but a new connection is initiated I have default setting of max users using the same account connecting from the same ip So after a few refreshes of my inbox in K Id get error from the server because there are too many connected accounts using the same ip My setup is dead simple mostly using defaults with one account and one alias to it Id be grateful if someone could point me in the direction of where I should search for the problem or why does this happen I acknowledge that it might be actually a problem with K as with thunderbird the session is closed properly Context Provide a more detailed introduction to the issue itself How has this issue affected you What were you trying to accomplish I have only devices connected to the server my notebook and my phone Logging into the container and executing doveadm who I can see something like this username proto pids ips usermailservercom imap Expected Behavior Tell us what should happen I would expect dovecot to reconnect to the lost connection or close the session properly Actual Behavior Tell us what happens instead I think the session in dovecot is lost when the device disconnects Your Environment Include as many relevant details about the environment you experienced the issue in Docker version build a ea image tvialdockermailserverlatest K mail client on mobile thunderbird on notebook An excerpt from the log illustrating the outcome Jan mail dovecot imaplogin Login userusermailcom methodPLAIN rip lip mpid TLS session gLOchecYtSW jpe Jan mail dovecot imaplogin Login userusermailcom methodPLAIN rip lip mpid TLS sessionNOfcchecZNSW jpe Jan mail dovecot imaplogin Login userreportsmailcom methodPLAIN rip lip mpid TLS sessionNed cxeccNSW jpe Jan mail dovecot imaplogin Maximum number of connections from userIP exceeded mailmaxuseripconnections userusermailcom methodPLAIN rip lip TLS session gUtdxecGsiW jpG Jan mail dovecot imaplogin Maximum number of connections from userIP exceeded mailmaxuseripconnections userusermailcom methodPLAIN rip lip TLS sessionf IvdxecG iW jpG Jan mail dovecot imaplogin Maximum number of connections from userIP exceeded mailmaxuseripconnections userusermailcom methodPLAIN rip lip TLS session kvdxecHMiW jpG Provide a general summary of the issue in the Title above Context cannot connect with SSL when i setup SSL Actual Behavior failed connection when no ssl it is ok Possible Fix Not obligatory but suggest a fix or reason for the issue Steps to Reproduce my dockercomposeyml version services mail image tvialdockermailserverlatest hostname mail domainname emailamazingboycn containername CONTAINERNAME ports volumes etcssltmpsslro maildatavarmail mailstatevarmailstate maillogsvarlogmail configtmpdockermailserver environment SSLTYPEmanual SSLCERTPATHtmpsslcertpubliccrt SSLKEYPATHtmpsslprivateprivatekey envfile env envmailserver capadd NETADMIN SYSPTRACE restart always volumes maildata driver local mailstate dockercomposeyml L C the tmpsslcertpubliccrt it with cert chain it had multidomain and contain emailamazingboycn BEGIN CERTIFICATE MIIE DCCBHegAwIBAgIQaEzBOjjE sBYYkETc rLYDAKBggqhkjOPQQDAjCBjzEL MAkGA UEBhMCR IxGzAZBgNVBAgTEkdyZWF ZXIgTWFuY hlc RlcjEQMA GA UE BxMHU FsZm yZDEYMBYGA UEChMPU VjdGlnbyBMaW pdGVkMTcwNQYDVQQDEy T ZWN aWdvIEVDQyBEb haW gVmFsaWRhdGlvbiBTZWN cmUgU VydmVyIENBMB X DTIwMDExNDAwMDAwMFoXDTIyMDExMzIzNTk OVowGDEWMBQGA UEAxMNYW hemlu Z JveS jbjBZMBMGByqGSM AgEGCCqGSM AwEHA IABKAP vjym SGg dov wY x WqY aPmufEvzMgM gax MA SgeTJJ BSWalS RLqWV QM M bny t Ms pBijggMpMIIDJTAfBgNVHSMEGDAWgBT hQo EYbhBH Oqgss u MZHt rjAdBgNV HQ EFgQUGnccZjMpLkFuKUSL maBdWbEG wDgYDVR PAQHBAQDAgeAMAwGA Ud EwEBwQCMAAwHQYDVR lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMEkGA UdIARC MEAwNAYLKwYBBAGyMQECAgcwJTAjBggrBgEFBQcCARYXaHR cHM Ly zZWN aWdv LmNvbS DUFMwCAYGZ EMAQIBMIGEBggrBgEFBQcBAQR MHYwTwYIKwYBBQUHMAKG Q h dHA Ly jcnQuc VjdGlnby jb vU VjdGlnb VDQ RvbWFpblZhbGlkYXRp b TZWN cmVTZXJ ZXJDQS jcnQwIwYIKwYBBQUHMAGGF h dHA Ly vY NwLnNl Y RpZ uY tMFMGA UdEQRMMEqCDWFtYXppbmdib kuY CDyouYW hemluZ Jv eS jboIVKi lbWFpbC hbWF aW nYm LmNughF d cuYW hemluZ JveS jbjCC AX GCisGAQQB nkCBAIEggFtBIIBaQFnAHUARqVV X kSAwtaKJafTzfREsQXS Um havyHDbUcAAAFvoqSpIwAABAMARjBEAiBdv PeisOWX P eXtWvISUL b tFI uZC L uTYgIgWRoz iEr wuCfr ZcnsG fTcxVr g nGVePWWUA dwBvU asMfAxGdiZAKRRFf FRwR QLBACkGjbIImjfZEwAAAWipKkIAAAEAwBI MEYCIQDdrXgSyrNTz MKwEZ X tCMZ xVgsz EjFqDJvPVHAIhAJEKgjz U ij QOLKBqkro OknXPzlLdMJYNrUfnXCNAHUAIkVFB lVJFaWP Ev fdthuAjJmOt wEtXcaDXG iDwIAAAFvoqSpCwAABAMARjBEAiB jmfxEOJAtkrCYJ e oacAk lQVnnSrVYIowuzrngIgNAU A ALLNfvbsIDS YWefnN Fw W JOJww CgYIKoZIzj EAwIDRwAwRAIgIe wxovwwaSk c iYS osF HM g BCUBYkJdMw PtQCIHtspLgZypzMadLRjLwNzPNVPKoslj gjHWoXvfatsn END CERTIFICATE BEGIN CERTIFICATE MIIDqDCCAy gAwIBAgIRAPNkTmtuAFAjfglGvXvh R wCgYIKoZIzj EAwMwgYgx CzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpOZXcgSmVyc V MRQwEgYDVQQHEwtKZXJz ZXkgQ l eTEeMBwGA UEChMVVGhlIFVTRVJUUlVTVCBOZXR b JrMS wLAYDVQQD EyVVU VSVHJ c QgRUNDIENlcnRpZmljYXRpb gQXV aG yaXR MB XDTE MTEw MjAwMDAwMFoXDTMwMTIzMTIzNTk OVowgY xCzAJBgNVBAYTAkdCMRswGQYDVQQI ExJHcmVhdGVyIE hbmNoZXN ZXIxEDAOBgNVBAcTB NhbGZvcmQxGDAWBgNVBAoT D NlY RpZ gTGltaXRlZDE MDUGA UEAxMuU VjdGlnbyBFQ MgRG tYWluIFZh bGlkYXRpb gU VjdXJlIFNlcnZlciBDQTBZMBMGByqGSM AgEGCCqGSM AwEH A IABHkYk qfbZ sVwAjBTcLXw YWsTef Wj R W SUKiKAgSh TwUwimNJE xk IQeVTo UrOkPAY z vaKb EijggFuMIIBajAfBgNVHSMEGDAWgBQ QmG M Z wpZ dEl OA xmNjmjAdBgNVHQ EFgQU oUKOxGG QR DqoLLNLuzGR e wDgYD VR PAQHBAQDAgGGMBIGA UdEwEBwQIMAYBAf CAQAwHQYDVR lBBYwFAYIKwYB BQUHAwEGCCsGAQUFBwMCMBsGA UdIAQUMBIwBgYEVR gADAIBgZngQwBAgEwUAYD VR fBEkwRzBFoEOgQYYaHR cDovL NybC c VydHJ c QuY tL VTRVJUcnVz dEVDQ NlcnRpZmljYXRpb BdXRob JpdHkuY JsMHYGCCsGAQUFBwEBBGowaDA BggrBgEFBQcwAoYzaHR cDovL NydC c VydHJ c QuY tL VTRVJUcnVzdEVD Q FkZFRydXN Q EuY J MCUGCCsGAQUFBzABhhlodHRwOi vb NzcC c VydHJ c QuY tMAoGCCqGSM BAMDA gAMGUCMEvnx FcsVwJbZpCYF z fDWJtS UVRs cS chWBNKPFNpvDKdrdKReoAkr jUubgIxAODheSr XhcA oz HmedGdMhlrd ToKFbZlOnFFzqnvOhcjHvClECEQcKmc fmA END CERTIFICATE BEGIN CERTIFICATE MIID zCCArugAwIBAgIQdti htHzUkulT xQD Z TANBgkqhkiG w BAQwFADBv MQswCQYDVQQGEwJTRTEUMBIGA UEChMLQWRkVHJ c QgQUIxJjAkBgNVBAsTHUFk ZFRydXN IEV dGVybmFsIFRUUCBOZXR b JrMSIwIAYDVQQDExlBZGRUcnVzdCBF eHRlcm hbCBDQSBSb MB XDTAwMDUzMDEwNDgzOFoXDTIwMDUzMDEwNDgzOFow gYgxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpOZXcgSmVyc V MRQwEgYDVQQHEwtK ZXJzZXkgQ l eTEeMBwGA UEChMVVGhlIFVTRVJUUlVTVCBOZXR b JrMS wLAYD VQQDEyVVU VSVHJ c QgRUNDIENlcnRpZmljYXRpb gQXV aG yaXR MHYwEAYH KoZIzj CAQYFK EEACIDYgAEGqxUWqn aCPnetUkb PGWthLq bVttHmc Gu ZzW DGH CJA gFFOxXzu dPIhs Ip KODfi X GHE ZncJZFjq wo Rw seh M zzvy cU Ffs yf o l o HMIH MB GA UdIwQYMBaAFK mHo tCb sQm VO DveAky QaMB GA UdDgQWBBQ QmG M ZwpZ dEl OA xmNjmjAOBgNVHQ B Af EBAMCAYYwDwYDVR TAQHBAUwAwEBzARBgNVHSAECjAIMAYGBFUdIAAwSQYD VR fBEIwQDAoDygOoY aHR cDovL NybC cnVzdC wcm aWRlci jb vQWRk VHJ c RFeHRlcm hbENBUm vdC jcmwwOgYIKwYBBQUHAQEELjAsMCoGCCsGAQUF BzABhh odHRwOi vb NzcC cnVzdC wcm aWRlci jb wDQYJKoZIhvcNAQEM BQADggEBAKj xNg sDYxKidBNjc oTeyXGoRdTMxCKNcL m G ktwPZGN cM s qkBE mDacVnFEnKSqBx II KLhPZd pZdLbA JAHWgQ ieoQO EUcukkhj AHm yElINgE tsVm Auv qUxSPe VwphjJEaGnQBsx TJClWWKrKJ MHK b xe osHjU kzB SYrWHFMPDLF dvYXAFR sltJm oFeVZeF nXZ Sd RlWG WJkAl P PtVAqenXgE DzoHYTJa pzaOYkzZRWGcUyMLj LhL YyUU g ZKTnl P Hqrg St Cf U SdbQ S JS OpBv JWM END CERTIFICATE I see this in my log quite often How can I figure out whats wrong Everything seems to work though mail Jan mx amavis connect to varrunclamavclamdctl failed attempt Cant connect to a UNIX socket varrunclamavclamdctl No such file or directory mail Jan mx postfixsmtpd disconnect from ismyemailworkingcom ehlo mail rcpt data quit commands mail Jan mx amavis connect to varrunclamavclamdctl failed attempt Cant connect to a UNIX socket varrunclamavclamdctl No such file or directory mail Jan mx amavis ClamAVclamd All attempts failed connecting to varrunclamavclamdctl retrying mail Jan mx amavis connect to varrunclamavclamdctl failed attempt Cant connect to a UNIX socket varrunclamavclamdctl No such file or directory mail Jan mx amavis ClamAVclamd avscanner FAILED runav error Too many retries to talk to varrunclamavclamdctl All attempts failed connecting to varrunclamavclamdctl at eval line n mail Jan mx amavis WARN all primary virus scanners failed considering backups Is it possible that multiple mail domains can be used similar to mailcow In env it is only possible to configure one hostname Provide a general summary of the issue in the Title above Context Provide a more detailed introduction to the issue itself How has this issue affected you What were you trying to accomplish This is almost a duplicate of but Im opening a new one as asked in Expected Behavior Tell us what should happen Logs shouldnt be crazy yum I dont have a tmpdockermailserverpostfixaccountscf file because Im only using the image as a relay Actual Behavior Tell us what happens instead Logs are crazy exactly as in Possible Fix Not obligatory but suggest a fix or reason for the issue I had to use this workaround to make the loop disappear bash dockercompose exec smtp touch tmpdockermailserverpostfixaccountscf Steps to Reproduce Provide a link to a live example or an unambiguous set of steps to reproduce this issue include code to reproduce if relevant dockercompose up d in a new project detailssummaryRelevant parts of dockercomposeymlsummary yaml services smtp capadd SYSPTRACE domainname examplenet environment DEFAULTRELAYHOST smtpgmailcom DMSDEBUG ENABLESRS ONEDIR PERMITDOCKER connectednetworks POSTFIXMESSAGESIZELIMIT RELAYHOST smtpgmailcom RELAYPASSWORD hidden RELAYPORT RELAYUSER hidden SMTPONLY SRSDOMAINNAME examplenet SRSEXCLUDEDOMAINS examplenetexamplecom SRSSENDERCLASSES envelopesenderheadersender image tvialdockermailserverlatest networks default aliases smtplocal restart unlessstopped stopgraceperiod m volumes mailconfigtmpdockermailserverz maillogsvarlogmailz maillogssupervisordvarlogsupervisorz Workaround for maildatavarmailz mailstatevarmailstatez version volumes mailconfig maildata maillogs maillogssupervisord mailstate details Your Environment Include as many relevant details about the environment you experienced the issue in Amount of RAM available G Mailserver version used v gf d f Docker version used Docker version build bc Environment settings relevant to the config See relevant parts of dockercomposeyml above Any relevant stack traces Full trace preferred Please remember to format code using triple backticks so that it is neatly formatted when the issue is posted smtp INFO success changedetector entered RUNNING state process has stayed up for than seconds startsecs smtp INFO exited changedetector exit status expected smtp INFO spawned changedetector with pid smtp INFO success changedetector entered RUNNING state process has stayed up for than seconds startsecs smtp INFO exited changedetector exit status expected smtp INFO spawned changedetector with pid smtp INFO success changedetector entered RUNNING state process has stayed up for than seconds startsecs smtp INFO exited changedetector exit status expected smtp INFO spawned changedetector with pid etc Possible answers to you issue ClamAV keeps restarting Email seen as spam Creating new domains and accounts Use a relay mail server The variable name can be used for other email servers FAQ and tips And the WIKI Open issues Tecnativa TT When building for debian buster I cant find the zoo or ripole packages anywhere so amavis complains that it lacks support for F might be an old warning doc and zoo files Jan mail amavis No ext program for zoo tried zoo Jan mail amavis No ext program for doc tried ripole Jan mail amavis No decoder for F Jan mail amavis No decoder for doc Jan mail amavis No decoder for zoo Zoo might be old enough that we can scrap it but it would be nice to handle doc files Suggestions welcome When building the next version for Debian Buster the fail ban tests warn about legacy IP tables as Debian has switched from iptables to nftables Not sure what we should do with this as the right solution may depend on what is running on the host We can just ignore the warning in the tests filter with grep and hope that it works We can use updatealternatives in the container to select iptables which should get rid of the warning and work well with hosts that are running iptables Not sure what will happen if the host runs nftables though We can add a new configuration option that selects the proper implementation and allow end users to select the implementation which is passed to updatealternatives Then we can support hosts with iptables and hosts with nftables but we add a new configuration option that people need to understand We can possibly try to figure out what the host is running and use the same implementation Not sure how easy that is but perhaps the presence of legacy rules could be enough Suggestions welcome See and Note that this should only affect fail ban I dont think we use iptables for anything else Assuming I have a super simple setup Only one domain domaincom one local mailbox maildomaincom and an external mailbox eg Gmail megmailcom The goal is to catchall emails forward them to external as well as to the local mailbox domaincom megmailcom maildomaincom Results in mails arriving twice at the external service can see this in the logs as well maildomaincom maildomaincom domaincom megmailcom maildomaincom Seems to make no difference What is the solution If there is one Or is the duplication issue a bug I recently made a config change and see a weird problem since then Cannot really tell what is going on and probably need some help on this I have domains configured Every domain has a mainaccount maildomaintld For each of those four accounts I have a forward to a gmail address Furthermore there are some additional accounts for special cases which I dont think relate to this problem maildomain tld megmailcommaildomain tld domain tld megmailcom maildomain tld megmailcommaildomain tld domain tld megmailcom maildomain tld megmailcommaildomain tld domain tld megmailcom additional domain tld additional domain tldmegmailcom additional domain tld additional domain tldmegmailcom maildomain tld megmailcommaildomain tld domain tld megmailcom Because gmail is blocking some forwarded emails ARC I wanted to additionally store all emails in the mailservers mailboxes as well and changed my config to maildomain tld megmailcommaildomain tld domain tld megmailcommaildomain tld maildomain tld megmailcommaildomain tld domain tld megmailcommaildomain tld maildomain tld megmailcommaildomain tld domain tld megmailcommaildomain tld additional domain tld additional domain tldmegmailcom additional domain tld additional domain tldmegmailcom maildomain tld megmailcommaildomain tld domain tld megmailcommaildomain tld Everything seems to work as expected Except that some emails seem to be duplicated and arrive twice in gmail It is only mails being sent from different server systems to my domain tld This domain is purely used for machinecommunication cron mails backup notifications etc All this emails are being duplicated If I use the same account and manually send me an email I only receive it once Also my normal emails to the other three domains arrive as they should I must be overlooking something really stupid here Any idea where to start looking Or is my setup screwed I am a little bit confused about the name overloading between accounts and aliases in the configuration Maybe something like this would be better maildomain tld megmailcommaildomain tld domain tld maildomain tld maildomain tld megmailcommaildomain tld domain tld maildomain tld maildomain tld megmailcommaildomain tld domain tld maildomain tld additional domain tld additional domain tldmegmailcom additional domain tld additional domain tldmegmailcom maildomain tld megmailcommaildomain tld domain tld maildomain tld Or will that only forward the maildomainXtld emails to Gmail Context Hello I have made a fresh install of this wonderful docker mailserver on a Kubernetes cluster everything was fine until I turn on ClamAV ENABLECLAMAV Expected Behavior ClamAV should be able to analyze the emails without permission problems Actual Behavior When I send an email I can see the following lines in the logs Jan mailserver d ff b mdbf amavis runav ClamAVclamd FAILED unexpected outputvarlibamavistmpamavis T u EETtwjparts lstat failed Permission denied ERROR n Jan mailserver d ff b mdbf amavis ClamAVclamd avscanner FAILED CODE x f a ab unexpected outputvarlibamavistmpamavis T u EETtwjparts lstat failed Permission denied ERROR n at eval line Jan mailserver d ff b mdbf amavis WARN all primary virus scanners failed considering backups And when I do ls al varlibamavistmp I get this drwxrx amavis amavis Jan drwxrwx amavis amavis Jan drwxrx amavis amavis Jan amavis T hZa ayDp drwxrx amavis amavis Jan amavis T AUK KTg The clamav user is in the amavis group and vice versa this is the solution suggested by all the posts Ive read until now and I dont know why it doesnt work excepted that the folders in the varlibamavistmp repository are in instead of Ive tried with an external volume and inside the container the issue is the same Its really close to this issue but I didnt find any fix in it although its closed Can someone help me Steps to Reproduce Install it Send a mail from an user to himself for example Your Environment Amount of RAM available GB Mailserver version used latest Docker version used Embedded in K s 