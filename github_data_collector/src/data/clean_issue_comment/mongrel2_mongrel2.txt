At least when request is routed through the default host entry differentiating log entries by hostname parsed from host header would be very helpful When a host entry matches other than the default host then the name entry from the host table could continue to be used although I find that the hostname from the Host header is always the most useful but perhaps we could log both so that it is clear from the logs which host the request was routed through and also what the Host header for the request was Hi there Im having a fatal error killing completely my mongrel server trying to upload a GB file I have replicated this error in mongrel master and mongrel develop branch Ive attached valgrind log It seems error appears in http parserc with p var equals null Ive tested with other several files and I didnt found any problem until GB files valgrind txt This removes the hard requirement on HAVEGE and allows using devurandom within a chroot iMacTMP joe brew install dvs mongrel usrlocalHomebrewLibraryHomebrewbrewrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulamongrel rb usrlocalHomebrewLibraryHomebrewbrewrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulambedtlsrb usrlocalHomebrewLibraryHomebrewbrewrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulazeromqrb usrlocalHomebrewLibraryHomebrewbrewrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulacmakerb usrlocalHomebrewLibraryHomebrewbrewrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulasphinxdocrb usrlocalHomebrewLibraryHomebrewbrewrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulaasciidocrb usrlocalHomebrewLibraryHomebrewbrewrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulaautoconfrb usrlocalHomebrewLibraryHomebrewbrewrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormuladocbookxslrb usrlocalHomebrewLibraryHomebrewbrewrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormuladocbookrb usrlocalHomebrewLibraryHomebrewbrewrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulapkgconfigrb usrlocalHomebrewLibraryHomebrewbrewrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulaxmltorb usrlocalHomebrewLibraryHomebrewbrewrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulagnugetoptrb usrlocalHomebrewLibraryHomebrewbrewrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulagettextrb usrbinsandboxexec f privatetmphomebrew f bzvfsb nice usrlocalHomebrewLibraryHomebrewvendorportableruby binruby W I usrlocalHomebrewLibraryHomebrewusrlocalHomebrewLibraryHomebrewcasklib usrlocalHomebrewLibraryHomebrewbuildrb usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulamongrel rb verbose debug usrlocalHomebrewLibraryHomebrewbuildrb FormularyFromPathLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulamongrel rb usrlocalHomebrewLibraryHomebrewbuildrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulambedtlsrb usrlocalHomebrewLibraryHomebrewbuildrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulazeromqrb usrlocalHomebrewLibraryHomebrewbuildrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulacmakerb usrlocalHomebrewLibraryHomebrewbuildrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulasphinxdocrb usrlocalHomebrewLibraryHomebrewbuildrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulaasciidocrb usrlocalHomebrewLibraryHomebrewbuildrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulaautoconfrb usrlocalHomebrewLibraryHomebrewbuildrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormuladocbookxslrb usrlocalHomebrewLibraryHomebrewbuildrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormuladocbookrb usrlocalHomebrewLibraryHomebrewbuildrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulapkgconfigrb usrlocalHomebrewLibraryHomebrewbuildrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulaxmltorb usrlocalHomebrewLibraryHomebrewbuildrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulagnugetoptrb usrlocalHomebrewLibraryHomebrewbuildrb FormularyFormulaLoader loading usrlocalHomebrewLibraryTapshomebrewhomebrewcoreFormulagettextrb Downloading Already downloaded UsersjoeLibraryCachesHomebrewmongrel tarbz Verifying mongrel tarbz checksum tar xjf UsersjoeLibraryCachesHomebrewmongrel tarbz make all clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcadtdarrayo srcadtdarrayc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcadtdicto srcadtdictc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcadthasho srcadthashc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcadtlisto srcadtlistc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcadtradixmapo srcadtradixmapc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcadttsto srcadttstc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcbstrbsafeo srcbstrbsafec clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcbstrbstrauxo srcbstrbstrauxc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcbstrbstrlibo srcbstrbstrlibc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcconfigconfigo srcconfigconfigc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcconfigdbo srcconfigdbc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcconfigmoduleo srcconfigmodulec clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srchttp http parsero srchttp http parserc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srchttp httpclientparsero srchttp httpclientparserc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcmemhalloco srcmemhallocc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srctaskcontexto srctaskcontextc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srctaskfdo srctaskfdc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srctaskneto srctasknetc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srctaskqlocko srctaskqlockc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srctaskrendezo srctaskrendezc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srctasktasko srctasktaskc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcbsdspecifico srcbsdspecificc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srccacheo srccachec clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcchunkedo srcchunkedc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcconnectiono srcconnectionc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srccontrolo srccontrolc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcdbgo srcdbgc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcdiro srcdirc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcfiltero srcfilterc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srchandlero srchandlerc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srchandlerparsero srchandlerparserc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcheaderso srcheadersc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srchosto srchostc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcioo srcioc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srclogo srclogc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srclogrotateo srclogrotatec clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcmimeo srcmimec clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcpatterno srcpatternc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcproxyo srcproxyc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcregistero srcregisterc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcrequesto srcrequestc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcresponseo srcresponsec clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcroutingo srcroutingc clang g O Wall Wextra Isrc DNDEBUG DFILEOFFSETBITS pthread fPIC c o srcservero srcserverc srcserverc error use of undeclared identifier mbedtlshavegestate did you mean mbedtlssha starts ctx callocsizeofmbedtlshavegestate mbedtlssha starts usrlocalincludembedtlssha h note mbedtlssha starts declared here MBEDTLSDEPRECATED void mbedtlssha starts mbedtlssha context ctx srcserverc error expected expression mbedtlshavegeinitmbedtlshavegestate ctx srcserverc error use of undeclared identifier mbedtlshavegestate did you mean mbedtlshavegeinit mbedtlshavegeinitmbedtlshavegestate ctx mbedtlshavegeinit srcserverc note mbedtlshavegeinit declared here mbedtlshavegeinitmbedtlshavegestate ctx srcserverc error use of undeclared identifier mbedtlshavegerandom did you mean mbedtlshavegeinit srvrngfunc mbedtlshavegerandom mbedtlshavegeinit srcserverc note mbedtlshavegeinit declared here mbedtlshavegeinitmbedtlshavegestate ctx errors generated make srcservero Error usrlocalHomebrewLibraryHomebrewdebrewrb in raise BuildError Failed executing make all raise ignore backtrace irb shell Choose an action doing as instructed Had a mongrel hang today with the following messages Mon Jun GMT WARN srcconnectionc errno Resource temporarily unavailable Connection x is not dying contact jasom This instance was recently rebuild from FreeBSD ports Mongrel version czmq libzmq FreeBSD stable Please let me know if I can gather any additional information to help track this down im trying to build on centos the stable version works but the develop branch doesnt build It seems that the include path for mbedtls are different In file included from srctasknetc srcserverh fatal error mbedtlssslh No such file or directory include mbedtlssslh However when I solve those by symlinking to the needed location it still cant find the mbedtls so files usrbinld cannot find lmbedtls usrbinld cannot find lmbedx usrbinld cannot find lmbedcrypto I can not find how to build those Is there a fix for this May be i need to switch to a different branch for mbedtls Regards The current build logic lacks flexibility it does not allow arbitrary flags to be passed Thus arbitrary include directory library directory for zmq cannot be specified dependencies are hardcoded eg lzmq Thus cannot statically link zmq sqlite compilation link are not separated This make is impossible to statically link C library zmq to C code Hi Ive tried to run mongrel under Debian with latest libzmq github master build and got the same problem already reported before Without sudo everything works fine but when i try to run mongrel with sudo i cant connect to the server anymore Ive tried the proc fix but it doesnt work for me I would be grateful for any help Cheers Even though the output forms of the ragel files are in the repository the ragel files could end up with newer timestamps than their output counterparts When I pulled the git repo to a server today the toolsm shsrcclirl file was newer than toolsm shsrcclic causing the build process to want to run ragel To make this more deterministic we might consider making the ragel steps an explicit action eg make ragel Even if the user does have ragel installed to compensate for this race condition the output file might be different than the file in the repo This may not be an issue but something to consider A command like m sh help on unknown will cause buggy help text to be displayed Additionally a few other m sh error messages dont quite explain the problem to the user This diff should help address those issues 