This is my dockercompose file version services etcd containername etcd image bitnamietcdlatest environment ALLOWNONEAUTHENTICATIONyes ETCDADVERTISECLIENTURLS ports networks micronet micro containername micro command registryetcd registryaddressetcd api namespacegomicroexamplesrv handlerhttp image micromicro ports networks micronet luna containername luna build context luna dockerfile Dockerfile dependson etcd lunadb registrator command waitforpostgressh lunadb usrlocalbinapp ports networks micronet When I run micro api from local it worksbut it does not work in docker container and i get id gomicroexamplesrv code detail service not found status Internal Server Error If you use the image at micromicrolatest and either set the environment variable MICROREGISTRYnats or use registrynats micro will print the default help page and no error like this docker run nametest micromicrolatest registrynats NAME micro A microservice runtime USAGE micro global options command command options arguments VERSION v b c e COMMANDS api Run the api gateway bot Run the chatops bot cli Run the interactive CLI call Call a service eg micro call greeter SayHello name John services List the services in the network stream Create a service stream publish Publish a message to a topic stats Query the stats of a service list List items in registry or network register Register an item in the registry deregister Deregister an item in the registry get Get item from registry broker Run the message broker health Check the health of a service proxy Run the service proxy monitor Run the monitoring service router Run the micro network router tunnel Run the micro network tunnel network Run the micro network node registry Run the service registry runtime Run the micro runtime run Run a service eg micro run service version kill Kill removes a running service eg micro kill service ps Ps returns status of a running service or lists all running services eg micro ps debug Run the micro debug service log Get logs for a service server Run the micro network server service Run a micro service store Run the micro store service token API token commands new Create a service template plugin Plugin commands web Run the web dashboard init Run the micro operator help h Shows a list of commands or help for one command GLOBAL OPTIONS client value Client for gomicro rpc MICROCLIENT clientrequesttimeout value Sets the client request timeout eg ms s m Default s MICROCLIENTREQUESTTIMEOUT clientretries value Sets the client retries Default default MICROCLIENTRETRIES clientpoolsize value Sets the client connection pool size Default default MICROCLIENTPOOLSIZE clientpoolttl value Sets the client connection pool ttl eg ms s m Default m MICROCLIENTPOOLTTL registerttl value Register TTL in seconds default MICROREGISTERTTL registerinterval value Register interval in seconds default MICROREGISTERINTERVAL server value Server for gomicro rpc MICROSERVER servername value Name of the server gomicrosrvexample MICROSERVERNAME serverversion value Version of the server MICROSERVERVERSION serverid value Id of the server Autogenerated if not specified MICROSERVERID serveraddress value Bind address for the server MICROSERVERADDRESS serveradvertise value Used instead of the serveraddress when registering with discovery MICROSERVERADVERTISE servermetadata value A list of keyvalue pairs defining metadata version MICROSERVERMETADATA broker value Broker for pubsub http nats rabbitmq MICROBROKER brokeraddress value Commaseparated list of broker addresses MICROBROKERADDRESS profile value Debug profiler for cpu and memory stats MICRODEBUGPROFILE registry value Registry for discovery etcd mdns MICROREGISTRY registryaddress value Commaseparated list of registry addresses MICROREGISTRYADDRESS runtime value Runtime for building and running services eg local kubernetes default local MICRORUNTIME selector value Selector used to pick nodes for querying MICROSELECTOR store value Store used for keyvalue storage MICROSTORE storeaddress value Commaseparated list of store addresses MICROSTOREADDRESS storenamespace value Namespace for store data MICROSTORENAMESPACE transport value Transport mechanism used http MICROTRANSPORT transportaddress value Commaseparated list of transport addresses MICROTRANSPORTADDRESS local Enable local only development enableacme Enables ACME support via Lets Encrypt ACME hosts should also be specified MICROENABLEACME acmehosts value Comma separated list of hostnames to manage ACME certs for MICROACMEHOSTS acmeprovider value The provider that will be used to communicate with Lets Encrypt Valid options autocert certmagic MICROACMEPROVIDER enabletls Enable TLS support Expects cert and key file to be specified MICROENABLETLS tlscertfile value Path to the TLS Certificate file MICROTLSCERTFILE tlskeyfile value Path to the TLS Key file MICROTLSKEYFILE tlsclientcafile value Path to the TLS CA file to verify clients against MICROTLSCLIENTCAFILE apiaddress value Set the api address eg MICROAPIADDRESS proxyaddress value Proxy requests via the HTTP address specified MICROPROXYADDRESS webaddress value Set the web UI address eg MICROWEBADDRESS network value Set the micro network name local gomicro MICRONETWORK networkaddress value Set the micro network address eg MICRONETWORKADDRESS routeraddress value Set the micro router address eg MICROROUTERADDRESS gatewayaddress value Set the micro default gateway address eg MICROGATEWAYADDRESS tunneladdress value Set the micro tunnel address eg MICROTUNNELADDRESS apihandler value Specify the request handler to be used for mapping HTTP requests to services api proxy rpc MICROAPIHANDLER apinamespace value Set the namespace used by the API eg comexampleapi MICROAPINAMESPACE webnamespace value Set the namespace used by the Web proxy eg comexampleweb MICROWEBNAMESPACE enablestats Enable stats MICROENABLESTATS autoupdate Enable automatic updates MICROAUTOUPDATE reportusage Report usage statistics MICROREPORTUSAGE namespace value Set the micro service namespace default gomicro MICRONAMESPACE plugin value Comma separated list of plugins eg brokerrabbitmq registryetcd microbasicauth pathtopluginso MICROPLUGIN help h show help version v print the version Im assuming the nats plugin isnt in the build by default so some help on the best way to include it would be great but Im assuming this isnt the intended behavior I tried the kubernetes deployment guide with GKE v gke It went with a lot of things that I need to tweak fix CMIIW The following notes I experienced during deployment There is no explanation how to use Cloudflare DNS and its API So I went with autocert and remove the unnecessary Cloudflare settings The guide needs to fix where the helm tiller is required Since it is not required in helm or rather specify the helm version is important The GKE guides need to increase minimum size n standard is not enough based on my experience I got insufficient vCPU Thus I need to increase my cluster size Right now I am having difficulty to deploy the greeting web example where the deployed service cannot dial the ETCDv greetersvcyaml apiVersion v kind Service metadata name greeter namespace default labels app greeter spec ports port protocol TCP selector name greetersrv apiVersion v kind Service metadata name greeterweb namespace default labels app greeterweb spec ports port protocol TCP selector name greeterweb greetersrvyaml yaml apiVersion appsv kind Deployment metadata namespace default name greeter spec replicas selector matchLabels name greetersrv template metadata labels name greetersrv spec containers name greeter command greetersrv env name MICROSERVER value grpc name MICROSERVERNAME value gomicrosrvgreeter name MICROSERVERADDRESS value name MICROREGISTRY value etcdv name MICROREGISTRYADDRESS value etcdclusterclient image gcrioxxxxxgreetersrv imagePullPolicy Always ports containerPort name greeterport greeterwebyaml yaml apiVersion appsv kind Deployment metadata namespace default name greeterweb spec replicas selector matchLabels name greeterweb template metadata labels name greeterweb spec containers name greeterweb command greeterweb env name MICROPROXY value gomicroproxy name MICROREGISTRY value etcdv name MICROREGISTRYADDRESS value etcdclusterclient image gcrioxxxxxxgreeterweb imagePullPolicy Always ports containerPort name webport Greeter web error log shell k logs tail f p greeterweb f f vkp g I Listening on levelwarnts T Zcallerclientv retryinterceptorgo msgretrying of unary invoker failedtargetendpointclient bd a da d a d f eetcdclusterclientattempt errorrpc error code DeadlineExceeded desc latest connection error connection error desc transport Error while dialing dial tcp address etcdclusterclient missing port in address I context deadline exceeded List of services k get services NAME TYPE CLUSTERIP EXTERNALIP PORTS AGE etcdcluster ClusterIP None none TCP TCP h etcdclusterclient ClusterIP none TCP h etcdrestoreoperator ClusterIP none TCP h greeter ClusterIP none TCP h greeterweb ClusterIP none TCP h m kubernetes ClusterIP none TCP h microapi LoadBalancer xxxxxx TCP h microbroker ClusterIP none TCP h microgateway ClusterIP none TCP h micronetwork LoadBalancer xxxxxx UDP h microproxy ClusterIP none TCP h microregistry ClusterIP none TCP h microrouter ClusterIP none TCP h microtunnel NodePort none UDP h microweb LoadBalancer xxxxxx TCP h natscluster ClusterIP none TCP h natsclustermgmt ClusterIP None none TCP TCP TCP h List of pods k get pods NAME READY STATUS RESTARTS AGE etcdoperator etcdoperatoretcdbackupoperatotvzdx Running h m etcdoperator etcdoperatoretcdoperator bdpkh Running h m etcdoperator etcdoperatoretcdrestoreoperatzz cv Running h m greeter d d d cs lc Running h m greeterweb f f vkp g CrashLoopBackOff m microapi d c b vbhj Running h microapi d c b zsp Running h m microapi d c b gmn Running h m microbot d c nzqc CrashLoopBackOff h m microbroker d bcbdd f dg Running h m microbroker d bcbdd kbvvb Running h m microbroker d bcbdd mscn Running h m microdebug b d qqqvv CrashLoopBackOff h m microdebugweb c f ddcbj sz Running h microinit c dd jf qc Running h micromonitor d d b hdj Running h m micronetwork bfff cb t CrashLoopBackOff h m micronetwork bfff cb qrpwn Running h micronetwork bfff cb w rk CrashLoopBackOff h m micronetworkapi cc bcc jtv d Running h m micronetworkweb d c j mn Running h microproxy b dfnt Running h m microproxy b qwp m Running h m microproxy b v nbh Running h m microregistry c c b cdqmqgv Running h microrouter cc fcbbctk Running h microruntime d bd f f ptddm Running h m microstore ffd cfbdbzvkl CrashLoopBackOff h m microtunnel b c mcgcs CrashLoopBackOff h m microweb b c b xvk Running h natscluster Running h m natscluster Running h m natscluster Running h m natsoperator dcd k snb Running h m Im having trouble changing the transport type from http to tcp when running the micro service command from the terminal using the transporthttp argument works but transporttcp fails with help output Im getting by by doing micro service name memcachedactivation endpoint localhost metadata hostlocalhost micro service name mqttbroker endpoint localhost metadata hosttcplocalhost and then reading the metadata but Id rather it just forward the traffic from the url given by the registry I do understand that micro has a tcp plugin but how do I use or install it properly using the micro command List of hackstechnical debt that needs to be fixed Micro debug dashboard should not use netdata by default package githubcomcenkaltibackoffv cannot find package githubcomcenkaltibackoffv in any of homelogangosrcgithubcomcenkaltibackoffv from GOROOT homeloganDevgosrcgithubcomcenkaltibackoffv from GOPATH However it most definitely is in homeloganDevgosrcgithubcomcenkaltibackoff days ago centkali release v of library and doesnt have a v although it should use right What am I doing wrong here After some things it seems GO MODULEon was the issue but when enabling that we came across this issue pkgmodgithubcomlucasclementequicgov internalhandshakecryptosetupgo not enough arguments in call to hconnGetSessionTicket Hello I have a service failed and got restarted by supervisor but the previously registered node was not removed by consul service log Registry consul Registering node cmn b c a f e e aa rpc unable to write error response write tcp write broken pipe rpc unable to write error response write tcp write broken pipe rpc unable to write error response write tcp write broken pipe rpc unable to write error response write tcp write broken pipe Transport http Listening on Broker http Connected to Registry consul Registering node cmnb e d e cabada e Registry consul Deregistering node cmnb e d e cabada e Transport http Listening on consul log INFO raft Snapshot to complete ERR yamux keepalive failed io deadline reached ERR yamux keepalive failed connection write timeout WARN consul error getting server health from res context deadline exceeded WARN consul error getting server health from res rpc error getting client failed to get conn dial tcp io timeout WARN consulcoordinate Batch update failed timed out enqueuing operation INFO agent Synced service cmnb e d e cabada e Newer Consul version available currently running INFO agent Caught signal terminated INFO agent Graceful shutdown disabled Exiting INFO agent Requesting shutdown INFO consul shutting down server Since failed node was not removed it became a zombie node a lot of requests were still directed to it How to make consul remove the failed node Because of some reason I only can use windows to dev my application I exec micro in powershell and wait load finished then exec micro list service in another powershell but it show nothing even try more times I thought maybe my network have too much mDNS package After I stop connet LAN thing is going better but it can not show all service every timemaybe nothing or incomplete or full I run it in the Windows Sandbox where have a very clear network It seem everythings is ok Because mDNS cant use I have tried use consul but when I exec micro register consul it show the help list without any error So I have no way to use it Here is my go env bash set GO MODULEon set GOARCHamd set GOBIN set GOCACHEC Users XXX AppData Local gobuild set GOENVC Users XXX AppData Roaming go env set GOEXEexe set GOFLAGS set GOHOSTARCHamd set GOHOSTOSwindows set GONOPROXY set GONOSUMDB set GOOSwindows set GOPATHC Users XXX go set GOPRIVATE set GOPROXY set GOROOTC Go go set GOSUMDBsumgolangorg set GOTMPDIR set GOTOOLDIRC Go go pkg tool windowsamd set GCCGOgccgo set ARar set CCgcc set CXXg set CGOENABLED set GOMODNUL set CGOCFLAGSg O set CGOCPPFLAGS set CGOCXXFLAGSg O set CGOFFLAGSg O set CGOLDFLAGSg O set PKGCONFIGpkgconfig set GOGCCFLAGSm mthreads fmessagelength fdebugprefixmapC Users XXX AppData Local Temp gobuild tmpgobuild gnorecordgccswitches If you need other infomation please tell me I ve just started to study go micro I need process message like tcp long connect so i chose use stream rpc and create service with tcp transport I define a read rpc and a write rpc in proto and use this two rpc create readwrite stream rpc Request stream ReqMessage returns ResMessage rpc Response ReqMessage returns stream ResMessage in my server code i use two goroutine to process RequeststreamResponseStream readwrite func c ClientStream WriteLoopstream pbMicroServiceResponseStream for select case msg cchBuf if err streamSendmsg err nil logErrorfWriteLoop errorv err break case cclose return func c ClientStream ReadLooprsp pbMicroServiceRequestStream for msg err rspRecv if err nil logErrorfReadLoop errors errError break cRecvmsg closecclose if I kill client to disconnect from server but this two stream cant capture disconnect event this two loop cant break In go micro source code rpcservergo i found transprotsocket close was blocked by wgwait func s rpcServer ServeConnsock transportSocket var wg syncWaitGroup var mtx syncRWMutex streams are multiplexed on MicroStream or MicroId header sockets makemap string socketSocket defer func wait till done wgWait close underlying socket sockClose close the sockets mtxLock for id psock range sockets psockClose deletesockets id mtxUnlock recover any panics if r recover r nil logLogpanic recovered r logLogstringdebugStack in debug i found wg value was so defer was blocked problem Please explain why wg value was I guess psock have two goroutinereadwrite If no message in psocks chansend and recv this two goroutine will be blocked cant break loop How to solve wgwait block problem in stream rpc we know GoMicro has integrated EtcdConsul kv store and watch for distributed configuration But for most services just reading the configs is not enough we need a service to support reading and watching configs and also have the ability to manage data on a web portal to be a service distributed store pluggable MySQLPostgreSQLRedisEtcdConsulGit etc etc cluster supports different clusters they can share and copy configs from each other version easy for clients to read special version data canary tests supports push data to special clients based on IPMetadata able to rollback supports rolling back the last push global and unified management entranceweb portal Design Clients any client or service which reading configs from configsrvmicro config Platformweb UIPortal web dashboard ConfigSrv micro config supports for microservices to read configs and watch the change of config but only supports updatedelete data for adminsrv adminsrv management srv for micro configwe can merge configsrv and adminsrv Config Data structure App application name Cluster eg deva devb testa testb Namespace Item config item Key Value Request AND Protocol AND Store VERSION APPCLUSTERNamespace Core Store id namespaceid key value microbookname BOOKNAME microbookprice Format Convertible Easy converts to JSON Properties YAML json micro book name BOOKNAME price So we dont support the data below id namespaceid key value microbookname BOOKNAME microbookprice microbook I am a good man there are subkeys in microbook so it could not be a key otherwise it will get a conflict 