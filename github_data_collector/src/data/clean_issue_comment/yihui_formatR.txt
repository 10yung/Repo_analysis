Hi Yihui I have code snippet as this r cc vapplynamesplatforms functionx listsuppressMessagesConsensusClusterPlusConsensusClusterPlusplatforms x genesig maxK maxK repsrepruns pItempItem pFeaturepFeature titlerundir x clusterAlgclusterAlg distancedistance seedccseed plot NULL ConsensusClusterPlus returns a list of elements but we need a nested list listreplistaString When I try tidy this file something goes wrong pre Error in baseparsetext code keepsource FALSE text unexpected function invisibleBeGiNTiDyIdEnTiFiErHaHaHa Must use here for scope restrinctionHaHaHaEnDTiDyIdEnTiFiEr function Well I have read the documents and I know that it can be confusing But sometimes peoples need these comments inplace to remind contributors often himself what this part of code DOES do Could you consider just reserve these comments or add a parameter for this aim You can assign this feature to me Its my honor Hi Yihui EDIT FEB I did a hack who tries to fit the desired width and works for many cases Reference Im using formatR inside bookdown and I found an issue when creating the PDF The maximum width doesnt work for the code but it does for comments Easily reproducible at formatR copy the following lines using minimum line width Input Keeping all columns except the ones present in varstoremove vector heartdisease selectheartdisease oneofvarstoremove aasd selectdaa oneofholas oneofholas oneofholas Output Keeping all columns except the ones present in varstoremove vector heartdisease selectheartdisease oneofvarstoremove aasd selectdaa oneofholas oneofholas oneofholas Width line Width line So it didnt re adjust the with for the code Afer doing several test I tracked the problem to what it seem its origin basedeparse function Testing from your code text Keeping all columns except the ones present in varstoremove vector heartdisease selectheartdisease oneofvarstoremove aasd selectdaa oneofholas oneofholas oneofholas exprs parseonlytext basedeparseexprs width expressionheartdisease selectheartdisease oneofvarstoremove aasd selectdaa oneofholas oneofholas oneofholas If I try lower width lets say it adjust the rd line but the max len is I would have like to fix it myself but Im lack of ideas to debug deparse function Any ideas Related to this case Thanks Hi probably more a feature request than an issue formatR does current not work outofthebox with a complete markdown file using tidyfile does it Subquestion Is there a way in RStudio to use the formatR addin on a specific chunk only Selecting the chunk before running the addin does not do the trick for me Thanks Oli This patch adds another option widthstrict to tidysource defaulting to FALSE If TRUE instead of calling deparse with widthcutoff directly it calls a new function strictdeparse widthmax which performs a binary search for the highest widthcutoff value to pass to deparse such that the longest line in its output is after stripping trailing whitespace at most widthmax in length It seems to work quite well in most situations though it still doesnt handle inline comments very well the magic constant InLiNeIdEnTiFiEr counts towards the line length though it shouldnt A possible solution might be to replace this magic constant with something much shorter perhaps involving nonASCII characters which are legal in variable names in R as far as I know to reduce chances of a collision Hi Yihui Hope you are well I added a new feature to address magrittr line wrapping issues The unit tests run and I added couple more Most of it was writing the function magrittrwraplines in utilsR and adding it into the tidysource function Appreciate any feedback you may have Love the package but would it be possible to allow pipelines to have each operator on a separate line so d d groupbyage summarizeheight meanheight I think this would make for much cleaner pipelines as in long ones operators are currently split over multiple lines Thanks Jon Zelner After using format code in the latest RStudio the parameters of functions are split into different lines and kept aligned But I am unable to find the corresponding settings in formatR package How to do it with formatR Consider the source code r mysum functiona b c returna b c The desired formatted result RStudio returns this r mysum functiona b c returna b c Any way to automatically add braces for single line code inside if or something like that For the source code like this r if TRUE a b Current default result for tidysource r if TRUE a b Expected formatted result of the requested feature r if TRUE a b Please add reformatting for magrittr pipe operator For example result mydata filtercriterion groupbymygroup summarisesummand sumcount should be converted to something like mydata filtercriterion groupbymygroup summarisesummand sumcount results This looks very helpful it does not indent the lines that it does in the same way that Rstudio or emacs ESS does by default For example this line r oldpriors dbquerypasteselect priorid from pftspriors where pftid parentpftid con con is converted to tidysource as r oldpriors dbquerypasteselect priorid from pftspriors where pftid parentpftid con con while Rstudio converts it to r oldpriors dbquerypasteselect priorid from pftspriors where pftid parentpftid con con the Rstudio way makes it easier to see that the arguments on line are arguments to the paste functions Is there a way around this Ive reviewed many isues in this repository and suspect that the answer is no but couldnt find a reference to this in particular 