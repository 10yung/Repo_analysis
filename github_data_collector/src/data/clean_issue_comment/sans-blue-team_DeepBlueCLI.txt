Greetings SANS Blue Team Under Examples current example commands for Metasploit PowerShell target security and Metasploit PowerShell target system are a repeat of the previous native commands Metasploit PowerShell target security should be DeepBlueps evtx metasploitpsexecpowershelltargetsecurityevtx and Metasploit PowerShell target system should be DeepBlueps evtx metasploitpsexecpowershelltargetsystemevtx I can fork fix and send you a pull request if you prefer Cheers Russ While trying my luck with SANS holiday hack challenge this year I realized that the password spray attack detection was not implemented in Python I looked at the PowerShell version and tried to port the same logic in Python This seems to work on the example file mfredlocalhost DeepBlueCLI python DeepBluepy evtxpasswordsprayevtx Distributed Account Explicit Credential Use Password Spray Attack The use of multiple user account access attempts with explicit credentials is an indicator of a password spray attack Target usernames Administrator celgee eskoudis jwright smisenar dpendolino thessman Accessing username jwrig I have an issue where where the script local log or remote file arguments shows no results There is no error so it looks like it cannot find anything even though there are event IDs that should match on the MicrosoftWindowsPowerShellOperationalevtx log Can you please help me to troubleshoot this Updated the logic in deepwhitecollectorps to handle Sysmon v schema Getwinevent will accept the computer name parameter but for some reason DNS resolution inside the parameter breaks the detection engine To fix this it appears that passing the ipv address will return results as expected Needs additional testing to validate data is being detected correctly from remote logs Code changes to DeepBlueps line Checking the Computer var and converting it to an address If computer ne ips SystemNetDns GetHostAddressescomputer ips ips select ExpandProperty IPAddressToString Line Run GetWinEvent with the Computer switch only if the computername was passed If computer ne events iex GetWinEvent ComputerName ips filter ErrorAction Stop Else events iex GetWinEvent filter ErrorAction Stop this would make it alot easier to run the script as a preparser on data coming in from winlogbeat logstasah before being sent to elasticsearch db Two new parameters path specifies where to save output format default value is txt supports csv Example Process evtx file and save results to current directory in CSV format DeepBlueps file evtx psattacksecurityevtx format csv path Add All option to be able to query all the logs that DeepBlue can analyze Incorporate the regex and whitelist into the script to be able to launch it from the memory Create ProcessEvents to be able to add further improvements easily I tried to preserve at least part of the previous text output by using the WriteVerboseDebugWarning functions Ive found that the descriptions or Message attribute look much better when piped to FormatList because they are output as arrays and dont get enough screen real estate otherwise Thoughts on the output formats or anything else Suggestions are always welcome 