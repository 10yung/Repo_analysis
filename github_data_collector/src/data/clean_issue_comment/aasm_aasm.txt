Is your feature request related to a problem Please describe In our projects UI we would like states to look different depending on who is logged in For example for user A the pending state should appear as Pending manager review and for user B it should appear as Pending peer review Describe the solution youd like We would like to be able to use I n translation interpolation to solve this eg calling MyClassaasmstatushumannamereviewer peer given the translation statuspending Pending reviewer review should return Pending peer review Describe alternatives youve considered For now I am using the much longer and less elegant MyClasshumanattributenamestatusmyclassaasmstatusname It seems like this addition would be appropriate to me but maybe Im missing something Here is everything you need to know about this upgrade Please take a good look at what changed and the test results before merging this pull request What changed rails Repo details summaryRelease Notessummary h a href blockquoteh Active Supporth ul liNo changesli ul h Active Modelh ul liNo changesli ul h Active Recordh ul liNo changesli ul h Action Viewh ul liNo changesli ul h Action Packh ul li pFix possible information leak session hijacking vulnerabilityp pThe codeActionDispatchSessionMemcacheStorecode is still vulnerable given it requires thebr gem dalli to be updated as wellp pa href li ul h Active Jobh ul liNo changesli ul h Action Mailerh ul liNo changesli ul h Action Cableh ul liNo changesli ul h Active Storageh ul liNo changesli ul h Action Mailboxh ul liNo changesli ul h Action Texth ul liNo changesli ul h Railtiesh ul liNo changesli ulblockquote h a href blockquoteh Active Supporth ul li pEager load translations during initializationp pemDiego Plentzemp li li pUse perthread CPU time clock on codeActiveSupportNotificationscodep pemGeorge Claghornemp li ul h Active Modelh ul liNo changesli ul h Active Recordh ul li pShare the same connection pool for primary and replica databases in thebr transactional tests for the same databasep pemEdouard Chinemp li li pFix the preloader when one record is fetched using codeafterinitializecodebr but not the entire collectionp pemBradley Priceemp li li pFix collection callbacks not terminating when codeabortcode is thrownp pemEdouard Chinem emRyuta Kamizonoemp li li pCorrectly deprecate codewherenotcode working as NOR for relationsp pa href deprecated wherenot working as NOR howeverbr doing a relation query like codewherenotrelation codebr wouldnt be properly deprecated and codewherenotcode would work asbr NAND insteadp pemEdouard Chinemp li li pFix codedbmigratecode task with multiple databases to restore the connectionbr to the previous databasep pThe migrate task iterates and establish a connection over each dbbr resulting in the last one to be used by subsequent rake tasksbr We should reestablish a connection to the connection that wasbr established before the migrate tasks was runp pemEdouard Chinemp li li pFix multithreaded issue for codeAcceptanceValidatorcodep pemRyuta Kamizonoemp li ul h Action Viewh ul liNo changesli ul h Action Packh ul li pAllow using mountable engine route helpers in System Testsp pemChalo Fernandezemp li ul h Active Jobh ul li pAllow Sidekiq access to the underlying job classp pBy having access to the Active Job class Sidekiq can get access to any codesidekiqoptionscode whichbr have been set on that Active Job type and serialize those options into Redisp pa href pemMike Perhamemp li ul h Action Mailerh ul li pFix ActionMailer assertions dont work for parameterized mail with legacy delivery jobp pembogdanvlvivemp li ul h Action Cableh ul liNo changesli ul h Active Storageh ul liNo changesli ul h Action Mailboxh ul liNo changesli ul h Action Texth ul liNo changesli ul h Railtiesh ul li pFix the collision check for the scaffold generatorp pemRyan Robesonemp li ulblockquote h a href blockquoteh Active Supporth ul li pcodeActiveSupportSafeBuffercode supports codeEnumeratorcode methodsp pemShugo Maedaemp li li pThe Redis cache store fails gracefully when the server returns a max number of clients reached errorp pemBrandon Medenwaldemp li li pFixed that mutating a value returned by a memory cache store would unexpectedly change the cached valuep pemJonathan Hymanemp li li pThe default inflectors in codezeitwerkcode mode support overridesp div classhighlight highlightsourcerubyprespan classplcspan classplcspan configinitializerszeitwerkrbspan span classplc Railsspanautoloaderseach span classplkdospan span classplsmiautoloaderspan autoloaderinflectorinflect span classplsspan classplpdsspanhtmlparserspan classplpdsspanspan gt span classplsspan classplpdsspanHTMLParserspan classplpdsspanspan span classplsspan classplpdsspansslerrorspan classplpdsspanspan gt span classplsspan classplpdsspanSSLErrorspan classplpdsspanspan span classplkendspanprediv pThat way you can tweak how individual basenames are inflected without touching Active Support inflection rules which are global These inflectors fallback to codeStringcamelizecode so existing inflection rules are still taken into account for nonoverridden basenamesp pPlease check the a href guide for codezeitwerkcode modea if you prefer not to depend on codeStringcamelizecode at allp pemXavier Noriaemp li li pImprove codeRangecode codeRangeincludecode and codeRangecovercode to work with beginless startless and endless range targetsp pemAllen Hsuem emAndrew Hodgkinsonemp li li pDont use codeProcessclockgettimeCLOCKPROCESSCPUTIMEIDcode on Solarisp pemIain Beestonemp li ul h Active Modelh ul liNo changesli ul h Active Recordh ul li pCommon Table Expressions are allowed on readonly connectionsp pemChris Morrisemp li li pNew record instantiation respects codeunscopecodep pemRyuta Kamizonoemp li li pFixed a case where codefindinbatchescode could halt too earlyp pemTakayuki Nakataemp li li pAutosaved associations always perform validations when a custom validation context is usedp pemTekin Suleymanemp li li pcodesqlactiverecordcode notifications now include the codeconnectioncode in their payloadsp pemEugene Kennyemp li li pA rollback encountered in an codeaftercommitcode callback does not reset previouslycommitted record statep pemRyuta Kamizonoemp li li pFixed that join order was lost when eagerloadingp pemRyuta Kamizonoemp li li pcodeDESCRIBEcode queries are allowed on readonly connectionsp pemDylan ThackerSmithemp li li pFixed that records that had been codeinspectcodeed could not be marshaledp pemEugene Kennyemp li li pThe connection pool reaper thread is respawned in forked processes This fixes that idle connections in forked processes wouldnt be reapedp pemJohn Hawthornemp li li pThe memoized result of codeActiveRecordRelationtakecode is properly cleared when codeActiveRecordRelationresetcode or codeActiveRecordRelationreloadcode is calledp pemAnmol Aroraemp li li pFixed the performance regression for codeprimarykeyscode introduced MySQL p pemHiroyuki Ishiiemp li li pcodeinsertcode codeinsertallcode codeupsertcode and codeupsertallcode now clear the query cachep pemEugene Kennyemp li li pCall codewhilepreventingwritescode directly from codeconnectedtocodep pIn some cases application authors want to use the database switching middleware and make explicit calls with codeconnectedtocode Its possible for an app to turn off writes and not turn them back on by the time we call codeconnectedtorole writingcodep pThis change allows apps to fix this by assuming if a role is writing we want to allow writes except in the case its explicitly turned offp pemEileen M Uchitelleemp li li pImprove detection of ActiveRecordStatementTimeout with mysql adapter in the edge case when the query is terminated during filesortp pemKir Shatrovemp li ul h Action Viewh ul li pUJS avoids codeElementclosestcode for IE compatibilityp pemGeorge Claghornemp li ul h Action Packh ul li pcodeActionDispatchSystemTestCasecode now inherits from codeActiveSupportTestCasecode rather than codeActionDispatchIntegrationTestcode This permits running jobs in system testsp pemGeorge Claghornem emEdouard Chinemp li li pRegistered MIME types may contain extra flagsp div classhighlight highlightsourcerubyprespan classplc Mimespanspan classplc Typespanregister span classplsspan classplpdsspantexthtml fragmentspan classplpdsspanspan span classplc htmlfragmentspanprediv pemAaron Pattersonemp li ul h Active Jobh ul liNo changesli ul h Action Mailerh ul liNo changesli ul h Action Cableh ul liNo changesli ul h Active Storageh ul li pcodeActiveStorageAnalyzeJobcodes are discarded on codeActiveRecordRecordNotFoundcode errorsp pemGeorge Claghornemp li li pBlobs are recorded in the database before being uploaded to the service This fixes that generated blob keys could silently collide leading to data lossp pemJulik Tarkhanovemp li ul h Action Mailboxh ul liNo changesli ul h Action Texth ul liNo changesli ul h Railtiesh ul li pThe codezeitwerkcheckcode Rake task reports files outside the apps root directory as in engines loaded from gemsp pemXavier Noriaemp li li pFixed a possible error when using the evented file update checkerp pemYuji Yaginumaemp li li pThe sqlite database files created by the parallel testing feature are included in the default codegitignorecode file for newlygenerated appsp pemYasuo Hondaemp li li pcoderails newcode generates a codekeepcode file in codetmppidscode This fixes starting a server via coderackupcode instead of coderails servercodep pemRafael Mendon a Fran aemp li ulblockquote h a href blockquoteh Active Supporth ul liNo changesli ul h Active Modelh ul liNo changesli ul h Active Recordh ul liNo changesli ul h Action Viewh ul liNo changesli ul h Action Packh ul li pFix possible information leak session hijacking vulnerabilityp pThe codeActionDispatchSessionMemcacheStorecode is still vulnerable given it requires thebr gem dalli to be updated as wellp pa href li ul h Active Jobh ul liNo changesli ul h Action Mailerh ul liNo changesli ul h Action Cableh ul liNo changesli ul h Active Storageh ul liNo changesli ul h Railtiesh ul liNo changesli ulblockquote h a href blockquoteh Active Supporth ul li pMake ActiveSupportLogger Fibersafe Fixes a href pUse codeFibercurrentidcode in codeActiveSupportLoggerlocallevelcode in orderbr to make log level local to Ruby Fibers in addition to Threadsp pExamplep precodelogger ActiveSupportLoggernewSTDOUT loggerlevel p Main is debug loggerdebug Fibernew loggerlocallevel p Thread is debug loggerdebug resume p Main is debug loggerdebug codepre pBeforep precodeMain is debug false Thread is debug true Main is debug true codepre pAfterp precodeMain is debug false Thread is debug true Main is debug false codepre pemAlexander Varninemp li ul h Active Modelh ul li pType cast falsy boolean symbols on boolean attribute as falsep pFixes a href pemRyuta Kamizonoemp li ul h Active Recordh ul li pFix circular codeautosave truecode causes invalid records to be savedp pPrior to the fix when there was a circular series of codeautosave truecodebr associations the callback for a codehasmanycode association was run whilebr another instance of the same callback on the same association hadntbr finished running When control returned to the first instance of thebr callback the instance variable had changed and subsequent associatedbr records werent saved correctly Specifically the ID field for thebr codebelongstocode corresponding to the codehasmanycode was codenilcodep pFixes a href pemLarry Reidemp li li pPostgreSQL Fix GROUP BY with ORDER BY virtual count attributep pFixes a href pemRyuta Kamizonoemp li li pFix sqlite collation parsing when using decimal columnsp pemMartin R Schusteremp li li pMake ActiveRecord codeConnectionPoolconnectionscode method threadsafep pFixes a href pemJeff Doeringemp li li pAssign all attributes before calling codebuildcode to ensure the child record is visible inbr codebeforeaddcode and codeafteraddcode callbacks for codehasmany throughcode associationsp pFixes a href pemRyan H Kerremp li ul h Action Viewh ul li pAllow programmatic click events to trigger Rails UJS click handlersbr Programmatic click events eg ones generated by codeRailsfirelink clickcode dont specify a button These events were being incorrectly stopped by code meant to ignore scroll wheel and right clicks introduced in a href pemSudara Williamsemp li ul h Action Packh ul liNo changesli ul h Active Jobh ul liNo changesli ul h Action Mailerh ul liNo changesli ul h Action Cableh ul liNo changesli ul h Active Storageh ul liNo changesli ul h Railtiesh ul li pUse original codebundlercode environment variables during the process of generating a new rails projectp pemMarco Costaemp li li pAllow loading seeds without ActiveJobp pFixes a href pemJeremy Weathersemp li li pOnly force codeasynccode ActiveJob adapter to codeinlinecode during seedingp pemBatedUrGonnaDieemp li ulblockquote h a href blockquoteh Active Supporth ul li pAdd codeActiveSupportHashWithIndifferentAccessassoccodep pcodeassoccode can now be called with either a string or a symbolp pemStefan Sch leremp li li pFix codeStringsafeconstantizecode throwing a codeLoadErrorcode for incorrectly cased constant referencesp pemKeenan Brockemp li li pAllow Range and Rangecover on Rangep pcodeRangecovercode can now accept a range argument like codeRangeincludecode andbr codeRangecode codeRangecode works correctly on Ruby codeRangeincludecode is movedbr into a new file with these two methodsp pemutilumemp li li pIf the same block is codeincludedcode multiple times for a Concern an exception is no longer raisedp pemMark J Titorenkoem emVlad Bokovemp li ul h Active Modelh ul li pFix date value when casting a multiparameter date hash to not convertbr from Gregorian date to Julian datep pBeforep precodeDaynewday i gt day i gt day i gt gt ltDay id nil day createdat nil updatedat nil gt codepre pAfterp precodeDaynewday i gt day i gt day i gt gt ltDay id nil day createdat nil updatedat nil gt codepre pFixes a href pemSayan Chakrabortyemp li li pFix numericality equality validation of codeBigDecimalcode and codeFloatcodebr by casting to codeBigDecimalcode on both ends of the validationp pemGannon McGibbonemp li ul h Active Recordh ul li pFix different codecountcode calculation when using codesizecode with manual codeselectcode with DISTINCTp pFixes a href pemJuani Villarejoemp li li pFix prepared statements caching to be enabled even when query caching is enabledp pemRyuta Kamizonoemp li li pDont allow codewherecode with invalid value matches to nil valuesp pFixes a href pemRyuta Kamizonoemp li li pRestore an ability that class level codeupdatecode without giving idsp pFixes a href pemRyuta Kamizonoemp li li pFix join table column quoting with SQLitep pemGannon McGibbonemp li li pEnsure that codedeleteallcode on collection proxy returns affected countp pemRyuta Kamizonoemp li li pReset scope after delete on collection association to clear stale offsets of removed recordsp pemGannon McGibbonemp li ul h Action Viewh ul li pPrevent nonprimary mouse keys from triggering Rails UJS click handlersbr Firefox fires click events even if the click was triggered by nonprimary mouse keys such as right or scrollwheelclicksbr For example rightclicking a link such as the one described below with an underlying ajax request registered on click should not cause that request to occurp precode lt linkto Remote remotepath class remote remote true data type json gt codepre pFixes a href pemWolfgang Hobmaieremp li ul h Action Packh ul li pAllow using combine the Cache Control codepubliccode and codenocachecode headersp pBefore this change even if codepubliccode was specified for Cache Control headerbr it was excluded when codenocachecode was included This fixed to keep codepubliccodebr header as isp pFixes a href pemYuji Yaginumaemp li li pAllow codenilcode params for codeActionControllerTestCasecodep pemRyo Nakamuraemp li ul h Active Jobh ul liNo changesli ul h Action Mailerh ul liNo changesli ul h Action Cableh ul liNo changesli ul h Active Storageh ul liNo changesli ul h Railtiesh ul li pSeed database with inline ActiveJob job adapterp pemGannon McGibbonemp li li pFix boolean interaction in scaffold system testsp pemGannon McGibbonemp li ulblockquote h a href blockquoteh Active Supporth ul li pFix bug where codetooptionscode for codeActiveSupportHashWithIndifferentAccesscodebr would not act as alias for codesymbolizekeyscodep pemNick Weilandemp li li pImprove the logic that detects nonautoloaded constantsp pemJan Habermannem emXavier Noriaemp li li pFix bug where codeURIunescapecode would fail with mixed Unicodeescaped character inputp precodeURIunescape xe x x gt URIunescapeE gt URIunescape xe x x E gt EncodingCompatibilityError codepre pemAshe Connorem emAaron Pattersonemp li ul h Active Modelh ul li pFix numericality validator to still use value before type cast except Active Recordp pFixes a href a href pemRyuta Kamizonoemp li ul h Active Recordh ul li pDo not ignore the scoping with query methods in the scope blockp pemRyuta Kamizonoemp li li pAllow aliased attributes to be used in codeupdatecolumnscode and codeupdatecodep pemGannon McGibbonemp li li pAllow spaces in postgres table namesp pFixes issue where user post is misinterpreted as userpost when quoting table names with the postgresbr adapterp pemGannon McGibbonemp li li pCached columnshash fields should be excluded from ResultSetcolumntypesp pPR a href addresses the inconsistent behaviour when attribute is defined for an ignored column The following testbr was passing for SQLite and MySQL but failed for PostgreSQLp div classhighlight highlightsourcerubyprespan classplkclassspan span classplenDeveloperNamespan classple lt ActiveRecordTypeStringspanspan span classplkdefspan span classplendeserializespanspan classplsmivaluespan span classplsspan classplpdsspanDeveloper span classplpsespanspan classpls valuespanspan classplpsespanspan classplpdsspanspan span classplkendspan span classplkendspan span classplkclassspan span classplenAttributedDeveloperspan classple lt ActiveRecordBasespanspan span classplc selfspantablename span classplkspan span classplsspan classplpdsspandevelopersspan classplpdsspanspan attribute span classplc namespan span classplc DeveloperNamespanspan classplknewspan span classplc selfspanignoredcolumns span classplkspan span classplsspan classplpdsspannamespan classplpdsspanspan span classplkendspan developer span classplkspan span classplc AttributedDeveloperspancreate developerupdatecolumn span classplc namespan span classplsspan classplpdsspannamespan classplpdsspanspan loadeddeveloper span classplkspan span classplc AttributedDeveloperspanwherespan classplc idspan developeridspan classplc selectspanspan classplsspan classplpdsspanspan classplpdsspanspanfirst span classplc putsspan loadeddevelopername span classplcspan classplcspan should be Developer name but its just namespanprediv pemDmitry Tsepelevemp li li pValues of enum are frozen raising an error when attempting to modify themp pemEmmanuel Byrdemp li li pcodeupdatecolumnscode now correctly raises codeActiveModelMissingAttributeErrorcodebr if the attribute does not existp pemSean Griffinemp li li pDo not use prepared statement in queries that have a large number of bindsp pemRyuta Kamizonoemp li li pFix query cache to load before first requestp pemEileen M Uchitelleemp li li pFix collection cache key with limit and custom select to avoid ambiguous timestamp column errorp pFixes a href pemFederico Martinezemp li li pFix duplicated record creation when using nested attributes with codecreatewithcodep pemDarwin Wuemp li li pFix regression setting children record in parent codebeforesavecode callbackp pemGuo Xiang Tanemp li li pPrevent leaking of users DB credentials on coderails dbcreatecode failurep pembogdanvlvivemp li li pClear mutation tracker before continuing the around callbacksp pemYuya Tanakaemp li li pPrevent deadlocks when waiting for connection from poolp pemBrent Wheeldonemp li li pAvoid extra scoping when using codeRelationupdatecode that was causing this method to change the current scopep pemRyuta Kamizonoemp li li pFix numericality validator not to be affected by custom getterp pemRyuta Kamizonoemp li li pFix bulk change table ignores comment option on PostgreSQLp pemYoshiyuki Kinjoemp li ul h Action Viewh ul liNo changesli ul h Action Packh ul li pReset Capybara sessions if failed system test screenshot raising an exceptionp pReset Capybara sessions if codetakefailedscreenshotcode raise exceptionbr in system test codeafterteardowncodep pemMaxim Perepelitsaemp li li pUse request object for context if theres no controllerp pThere is no controller instance when using a redirect route or abr mounted rack application so pass the request object as the contextbr when resolving dynamic CSP sources in this scenariop pFixes a href pemAndrew Whiteemp li li pApply mapping to symbols returned from dynamic CSP sourcesp pPreviously if a dynamic source returned a symbol such as self itbr would be converted to a string implicity egp precodepolicydefaultsrc gt self codepre pwould generate the headerp precodeContentSecurityPolicy defaultsrc self codepre pand now it generatesp precodeContentSecurityPolicy defaultsrc self codepre pemAndrew Whiteemp li li pFix coderails routes ccode for controller name consists of multiple wordp pemYoshiyuki Kinjoemp li li pCall the coderedirecttocode block in controller contextp pemSteven Peckinsemp li ul h Active Jobh ul li pMake sure codeassertenqueuedwithcode amp codeassertperformedwithcode work reliably with hash argumentsp pemSharang Dashputreemp li li pRestore codeActionControllerParameterscode support to codeActiveJobArgumentsserializecodep pemBernie Chiuemp li li pRestore codeHashWithIndifferentAccesscode support to codeActiveJobArgumentsdeserializecodep pemGannon McGibbonemp li li pInclude deserialized arguments in job instances returned frombr codeassertenqueuedwithcode and codeassertperformedwithcodep pemAlan Wuemp li li pIncrement execution count before deserialize argumentsp pCurrently the execution count increments after deserializes argumentsbr Therefore if an error occurs with deserialize it retries indefinitelyp pemYuji Yaginumaemp li ul h Action Mailerh ul liNo changesli ul h Action Cableh ul liNo changesli ul h Active Storageh ul li pSupport multiple submit buttons in Active Storage formsp pemChr s Seelusemp li li pFix codeArgumentErrorcode when uploading to amazon s p pemHiroki Sanpeiemp li li pAdd a foreignkey constraint to the codeactivestorageattachmentscode table for blobsp pemGeorge Claghornemp li li pDiscard codeActiveStoragePurgeJobscode for missing blobsp pemGeorge Claghornemp li li pFix uploading Tempfiles to Azure Storagep pemGeorge Claghornemp li ul h Railtiesh ul li pDisable content security policy for mailer previewsp pemDylan Reileemp li li pLog the remote IP address of clients behind a proxyp pemAtul Bhosaleemp li ulblockquote h a href blockquoteh Active Supporth ul liNo changesli ul h Active Modelh ul liNo changesli ul h Active Recordh ul li pFix codetouchcode option to behave consistently with codePersistencetouchcode methodp pemRyuta Kamizonoemp li li pBack port Rails codereverseordercode Arel SQL literal fixp pemMatt Jonesem emBrooke Kuhlmannemp li li pcodebecomescode should clear the mutation tracker which is created in codeafterinitializecodep pFixes a href pemRyuta Kamizonoemp li ul h Action Viewh ul li pFix issue with codebuttontocodes codetoformparamscodep pcodebuttontocode was throwing exception when invoked with codeparamscode hash thatbr contains symbol and string keys The reason for the exception was thatbr codetoformparamscode was comparing the given symbol and string keysp pThe issue is fixed by turning all keys to strings insidebr codetoformparamscode before comparing themp pemGeorgi Georgievemp li ul h Action Packh ul liNo changesli ul h Active Jobh ul liNo changesli ul h Action Mailerh ul liNo changesli ul h Action Cableh ul liNo changesli ul h Railtiesh ul liNo changesli ulblockquote pemDoes any of this look wrong a href let us knowaemp details details summaryCommitssummary pa href the full diff on Githuba The new version differs by more commits than we can show herep details Depfu Status Depfu will automatically keep this PR conflictfree as long as you dont add any commits to this branch yourself You can also trigger a rebase manually by commenting with depfu rebase detailssummaryAll Depfu comment commandssummary blockquotedl dt depfu rebasedtddRebases against your default branch and redoes this updatedd dt depfu recreatedtddRecreates this PR overwriting any edits that youve made to itdd dt depfu mergedtddMerges this PR once your tests are passing and conflicts are resolveddd dt depfu closedtddCloses this PR and deletes the branchdd dt depfu reopendtddRestores the branch and reopens this PR if its closeddd dt depfu pausedtddIgnores all future updates for this dependency and closes this PRdd dt depfu pause minormajor dtddIgnores all future minormajor updates for this dependency and closes this PRdd dt depfu resumedtddFuture versions of this dependency will create PRs again leaves this PR as isdd dlblockquote details Here is everything you need to know about this upgrade Please take a good look at what changed and the test results before merging this pull request What changed sqlite Repo Changelog details summaryRelease Notessummary h from changelogh blockquoteul li pTravis Drop unused setting sudo false p li li pThe taint mechanism will be deprecated in Ruby p li li pFix Ruby rbchecksafeobj warningsp li li pUpdate travis configp li ulblockquote pemDoes any of this look wrong a href let us knowaemp details details summaryCommitssummary pa href the full diff on Githuba The new version differs by commitsp ul lia href versioncodeali lia href branch master of githubcomsparklemotionsqlite rubycodeali lia href pull request from casperisfineremovedeprecatedtaintfollowupcodeali lia href travis configcodeali lia href Ruby rbchecksafeobj warningscodeali lia href taint mechanism will be deprecated in Ruby codeali lia href pull request from olleolleollepatch codeali ul details Depfu Status Depfu will automatically keep this PR conflictfree as long as you dont add any commits to this branch yourself You can also trigger a rebase manually by commenting with depfu rebase detailssummaryAll Depfu comment commandssummary blockquotedl dt depfu rebasedtddRebases against your default branch and redoes this updatedd dt depfu recreatedtddRecreates this PR overwriting any edits that youve made to itdd dt depfu mergedtddMerges this PR once your tests are passing and conflicts are resolveddd dt depfu closedtddCloses this PR and deletes the branchdd dt depfu reopendtddRestores the branch and reopens this PR if its closeddd dt depfu pausedtddIgnores all future updates for this dependency and closes this PRdd dt depfu pause minormajor dtddIgnores all future minormajor updates for this dependency and closes this PRdd dt depfu resumedtddFuture versions of this dependency will create PRs again leaves this PR as isdd dlblockquote details Here is everything you need to know about this upgrade Please take a good look at what changed and the test results before merging this pull request What changed rails Repo details summaryRelease Notessummary h a href blockquoteh Active Supporth ul liNo changesli ul h Active Modelh ul liNo changesli ul h Active Recordh ul liNo changesli ul h Action Viewh ul liNo changesli ul h Action Packh ul li pFix possible information leak session hijacking vulnerabilityp pThe codeActionDispatchSessionMemcacheStorecode is still vulnerable given it requires thebr gem dalli to be updated as wellp pa href li ul h Active Jobh ul liNo changesli ul h Action Mailerh ul liNo changesli ul h Action Cableh ul liNo changesli ul h Active Storageh ul liNo changesli ul h Railtiesh ul liNo changesli ulblockquote h a href blockquoteh Active Supporth ul li pMake ActiveSupportLogger Fibersafe Fixes a href pUse codeFibercurrentidcode in codeActiveSupportLoggerlocallevelcode in orderbr to make log level local to Ruby Fibers in addition to Threadsp pExamplep precodelogger ActiveSupportLoggernewSTDOUT loggerlevel p Main is debug loggerdebug Fibernew loggerlocallevel p Thread is debug loggerdebug resume p Main is debug loggerdebug codepre pBeforep precodeMain is debug false Thread is debug true Main is debug true codepre pAfterp precodeMain is debug false Thread is debug true Main is debug false codepre pemAlexander Varninemp li ul h Active Modelh ul li pType cast falsy boolean symbols on boolean attribute as falsep pFixes a href pemRyuta Kamizonoemp li ul h Active Recordh ul li pFix circular codeautosave truecode causes invalid records to be savedp pPrior to the fix when there was a circular series of codeautosave truecodebr associations the callback for a codehasmanycode association was run whilebr another instance of the same callback on the same association hadntbr finished running When control returned to the first instance of thebr callback the instance variable had changed and subsequent associatedbr records werent saved correctly Specifically the ID field for thebr codebelongstocode corresponding to the codehasmanycode was codenilcodep pFixes a href pemLarry Reidemp li li pPostgreSQL Fix GROUP BY with ORDER BY virtual count attributep pFixes a href pemRyuta Kamizonoemp li li pFix sqlite collation parsing when using decimal columnsp pemMartin R Schusteremp li li pMake ActiveRecord codeConnectionPoolconnectionscode method threadsafep pFixes a href pemJeff Doeringemp li li pAssign all attributes before calling codebuildcode to ensure the child record is visible inbr codebeforeaddcode and codeafteraddcode callbacks for codehasmany throughcode associationsp pFixes a href pemRyan H Kerremp li ul h Action Viewh ul li pAllow programmatic click events to trigger Rails UJS click handlersbr Programmatic click events eg ones generated by codeRailsfirelink clickcode dont specify a button These events were being incorrectly stopped by code meant to ignore scroll wheel and right clicks introduced in a href pemSudara Williamsemp li ul h Action Packh ul liNo changesli ul h Active Jobh ul liNo changesli ul h Action Mailerh ul liNo changesli ul h Action Cableh ul liNo changesli ul h Active Storageh ul liNo changesli ul h Railtiesh ul li pUse original codebundlercode environment variables during the process of generating a new rails projectp pemMarco Costaemp li li pAllow loading seeds without ActiveJobp pFixes a href pemJeremy Weathersemp li li pOnly force codeasynccode ActiveJob adapter to codeinlinecode during seedingp pemBatedUrGonnaDieemp li ulblockquote h a href blockquoteh Active Supporth ul li pAdd codeActiveSupportHashWithIndifferentAccessassoccodep pcodeassoccode can now be called with either a string or a symbolp pemStefan Sch leremp li li pFix codeStringsafeconstantizecode throwing a codeLoadErrorcode for incorrectly cased constant referencesp pemKeenan Brockemp li li pAllow Range and Rangecover on Rangep pcodeRangecovercode can now accept a range argument like codeRangeincludecode andbr codeRangecode codeRangecode works correctly on Ruby codeRangeincludecode is movedbr into a new file with these two methodsp pemutilumemp li li pIf the same block is codeincludedcode multiple times for a Concern an exception is no longer raisedp pemMark J Titorenkoem emVlad Bokovemp li ul h Active Modelh ul li pFix date value when casting a multiparameter date hash to not convertbr from Gregorian date to Julian datep pBeforep precodeDaynewday i gt day i gt day i gt gt ltDay id nil day createdat nil updatedat nil gt codepre pAfterp precodeDaynewday i gt day i gt day i gt gt ltDay id nil day createdat nil updatedat nil gt codepre pFixes a href pemSayan Chakrabortyemp li li pFix numericality equality validation of codeBigDecimalcode and codeFloatcodebr by casting to codeBigDecimalcode on both ends of the validationp pemGannon McGibbonemp li ul h Active Recordh ul li pFix different codecountcode calculation when using codesizecode with manual codeselectcode with DISTINCTp pFixes a href pemJuani Villarejoemp li li pFix prepared statements caching to be enabled even when query caching is enabledp pemRyuta Kamizonoemp li li pDont allow codewherecode with invalid value matches to nil valuesp pFixes a href pemRyuta Kamizonoemp li li pRestore an ability that class level codeupdatecode without giving idsp pFixes a href pemRyuta Kamizonoemp li li pFix join table column quoting with SQLitep pemGannon McGibbonemp li li pEnsure that codedeleteallcode on collection proxy returns affected countp pemRyuta Kamizonoemp li li pReset scope after delete on collection association to clear stale offsets of removed recordsp pemGannon McGibbonemp li ul h Action Viewh ul li pPrevent nonprimary mouse keys from triggering Rails UJS click handlersbr Firefox fires click events even if the click was triggered by nonprimary mouse keys such as right or scrollwheelclicksbr For example rightclicking a link such as the one described below with an underlying ajax request registered on click should not cause that request to occurp precode lt linkto Remote remotepath class remote remote true data type json gt codepre pFixes a href pemWolfgang Hobmaieremp li ul h Action Packh ul li pAllow using combine the Cache Control codepubliccode and codenocachecode headersp pBefore this change even if codepubliccode was specified for Cache Control headerbr it was excluded when codenocachecode was included This fixed to keep codepubliccodebr header as isp pFixes a href pemYuji Yaginumaemp li li pAllow codenilcode params for codeActionControllerTestCasecodep pemRyo Nakamuraemp li ul h Active Jobh ul liNo changesli ul h Action Mailerh ul liNo changesli ul h Action Cableh ul liNo changesli ul h Active Storageh ul liNo changesli ul h Railtiesh ul li pSeed database with inline ActiveJob job adapterp pemGannon McGibbonemp li li pFix boolean interaction in scaffold system testsp pemGannon McGibbonemp li ulblockquote h a href blockquoteh Active Supporth ul li pFix bug where codetooptionscode for codeActiveSupportHashWithIndifferentAccesscodebr would not act as alias for codesymbolizekeyscodep pemNick Weilandemp li li pImprove the logic that detects nonautoloaded constantsp pemJan Habermannem emXavier Noriaemp li li pFix bug where codeURIunescapecode would fail with mixed Unicodeescaped character inputp precodeURIunescape xe x x gt URIunescapeE gt URIunescape xe x x E gt EncodingCompatibilityError codepre pemAshe Connorem emAaron Pattersonemp li ul h Active Modelh ul li pFix numericality validator to still use value before type cast except Active Recordp pFixes a href a href pemRyuta Kamizonoemp li ul h Active Recordh ul li pDo not ignore the scoping with query methods in the scope blockp pemRyuta Kamizonoemp li li pAllow aliased attributes to be used in codeupdatecolumnscode and codeupdatecodep pemGannon McGibbonemp li li pAllow spaces in postgres table namesp pFixes issue where user post is misinterpreted as userpost when quoting table names with the postgresbr adapterp pemGannon McGibbonemp li li pCached columnshash fields should be excluded from ResultSetcolumntypesp pPR a href addresses the inconsistent behaviour when attribute is defined for an ignored column The following testbr was passing for SQLite and MySQL but failed for PostgreSQLp div classhighlight highlightsourcerubyprespan classplkclassspan span classplenDeveloperNamespan classple lt ActiveRecordTypeStringspanspan span classplkdefspan span classplendeserializespanspan classplsmivaluespan span classplsspan classplpdsspanDeveloper span classplpsespanspan classpls valuespanspan classplpsespanspan classplpdsspanspan span classplkendspan span classplkendspan span classplkclassspan span classplenAttributedDeveloperspan classple lt ActiveRecordBasespanspan span classplc selfspantablename span classplkspan span classplsspan classplpdsspandevelopersspan classplpdsspanspan attribute span classplc namespan span classplc DeveloperNamespanspan classplknewspan span classplc selfspanignoredcolumns span classplkspan span classplsspan classplpdsspannamespan classplpdsspanspan span classplkendspan developer span classplkspan span classplc AttributedDeveloperspancreate developerupdatecolumn span classplc namespan span classplsspan classplpdsspannamespan classplpdsspanspan loadeddeveloper span classplkspan span classplc AttributedDeveloperspanwherespan classplc idspan developeridspan classplc selectspanspan classplsspan classplpdsspanspan classplpdsspanspanfirst span classplc putsspan loadeddevelopername span classplcspan classplcspan should be Developer name but its just namespanprediv pemDmitry Tsepelevemp li li pValues of enum are frozen raising an error when attempting to modify themp pemEmmanuel Byrdemp li li pcodeupdatecolumnscode now correctly raises codeActiveModelMissingAttributeErrorcodebr if the attribute does not existp pemSean Griffinemp li li pDo not use prepared statement in queries that have a large number of bindsp pemRyuta Kamizonoemp li li pFix query cache to load before first requestp pemEileen M Uchitelleemp li li pFix collection cache key with limit and custom select to avoid ambiguous timestamp column errorp pFixes a href pemFederico Martinezemp li li pFix duplicated record creation when using nested attributes with codecreatewithcodep pemDarwin Wuemp li li pFix regression setting children record in parent codebeforesavecode callbackp pemGuo Xiang Tanemp li li pPrevent leaking of users DB credentials on coderails dbcreatecode failurep pembogdanvlvivemp li li pClear mutation tracker before continuing the around callbacksp pemYuya Tanakaemp li li pPrevent deadlocks when waiting for connection from poolp pemBrent Wheeldonemp li li pAvoid extra scoping when using codeRelationupdatecode that was causing this method to change the current scopep pemRyuta Kamizonoemp li li pFix numericality validator not to be affected by custom getterp pemRyuta Kamizonoemp li li pFix bulk change table ignores comment option on PostgreSQLp pemYoshiyuki Kinjoemp li ul h Action Viewh ul liNo changesli ul h Action Packh ul li pReset Capybara sessions if failed system test screenshot raising an exceptionp pReset Capybara sessions if codetakefailedscreenshotcode raise exceptionbr in system test codeafterteardowncodep pemMaxim Perepelitsaemp li li pUse request object for context if theres no controllerp pThere is no controller instance when using a redirect route or abr mounted rack application so pass the request object as the contextbr when resolving dynamic CSP sources in this scenariop pFixes a href pemAndrew Whiteemp li li pApply mapping to symbols returned from dynamic CSP sourcesp pPreviously if a dynamic source returned a symbol such as self itbr would be converted to a string implicity egp precodepolicydefaultsrc gt self codepre pwould generate the headerp precodeContentSecurityPolicy defaultsrc self codepre pand now it generatesp precodeContentSecurityPolicy defaultsrc self codepre pemAndrew Whiteemp li li pFix coderails routes ccode for controller name consists of multiple wordp pemYoshiyuki Kinjoemp li li pCall the coderedirecttocode block in controller contextp pemSteven Peckinsemp li ul h Active Jobh ul li pMake sure codeassertenqueuedwithcode amp codeassertperformedwithcode work reliably with hash argumentsp pemSharang Dashputreemp li li pRestore codeActionControllerParameterscode support to codeActiveJobArgumentsserializecodep pemBernie Chiuemp li li pRestore codeHashWithIndifferentAccesscode support to codeActiveJobArgumentsdeserializecodep pemGannon McGibbonemp li li pInclude deserialized arguments in job instances returned frombr codeassertenqueuedwithcode and codeassertperformedwithcodep pemAlan Wuemp li li pIncrement execution count before deserialize argumentsp pCurrently the execution count increments after deserializes argumentsbr Therefore if an error occurs with deserialize it retries indefinitelyp pemYuji Yaginumaemp li ul h Action Mailerh ul liNo changesli ul h Action Cableh ul liNo changesli ul h Active Storageh ul li pSupport multiple submit buttons in Active Storage formsp pemChr s Seelusemp li li pFix codeArgumentErrorcode when uploading to amazon s p pemHiroki Sanpeiemp li li pAdd a foreignkey constraint to the codeactivestorageattachmentscode table for blobsp pemGeorge Claghornemp li li pDiscard codeActiveStoragePurgeJobscode for missing blobsp pemGeorge Claghornemp li li pFix uploading Tempfiles to Azure Storagep pemGeorge Claghornemp li ul h Railtiesh ul li pDisable content security policy for mailer previewsp pemDylan Reileemp li li pLog the remote IP address of clients behind a proxyp pemAtul Bhosaleemp li ulblockquote h a href blockquoteh Active Supporth ul liNo changesli ul h Active Modelh ul liNo changesli ul h Active Recordh ul li pFix codetouchcode option to behave consistently with codePersistencetouchcode methodp pemRyuta Kamizonoemp li li pBack port Rails codereverseordercode Arel SQL literal fixp pemMatt Jonesem emBrooke Kuhlmannemp li li pcodebecomescode should clear the mutation tracker which is created in codeafterinitializecodep pFixes a href pemRyuta Kamizonoemp li ul h Action Viewh ul li pFix issue with codebuttontocodes codetoformparamscodep pcodebuttontocode was throwing exception when invoked with codeparamscode hash thatbr contains symbol and string keys The reason for the exception was thatbr codetoformparamscode was comparing the given symbol and string keysp pThe issue is fixed by turning all keys to strings insidebr codetoformparamscode before comparing themp pemGeorgi Georgievemp li ul h Action Packh ul liNo changesli ul h Active Jobh ul liNo changesli ul h Action Mailerh ul liNo changesli ul h Action Cableh ul liNo changesli ul h Railtiesh ul liNo changesli ulblockquote pemDoes any of this look wrong a href let us knowaemp details details summaryCommitssummary pa href the full diff on Githuba The new version differs by more commits than we can show herep details Depfu Status Depfu will automatically keep this PR conflictfree as long as you dont add any commits to this branch yourself You can also trigger a rebase manually by commenting with depfu rebase detailssummaryAll Depfu comment commandssummary blockquotedl dt depfu rebasedtddRebases against your default branch and redoes this updatedd dt depfu recreatedtddRecreates this PR overwriting any edits that youve made to itdd dt depfu mergedtddMerges this PR once your tests are passing and conflicts are resolveddd dt depfu closedtddCloses this PR and deletes the branchdd dt depfu reopendtddRestores the branch and reopens this PR if its closeddd dt depfu pausedtddIgnores all future updates for this dependency and closes this PRdd dt depfu pause minormajor dtddIgnores all future minormajor updates for this dependency and closes this PRdd dt depfu resumedtddFuture versions of this dependency will create PRs again leaves this PR as isdd dlblockquote details If suppose my application is in applied state I need to make a hash where I should know that if I trigger hire it should move to hired or if I reject it should move to rejected state So Need to compute execute hash like Applicationfirstaasmpermittedtransitions event hire state hired event reject state rejected Hi I have some complex logic that is executed in an after callback after a transition Depending on the outcome of that logic Id like to trigger a completed or failed event Is that something that is recommended or will I get to spaghetti callback hell Best Sebastian The bug I am trying to upgrade from aasm version to however this is causing the following rspec model test to fail ruby describe reject do subject FactoryBotcreate order letuser FactoryBotcreate user letparams some params it changes the state do expectsubjectto receive updateorder expect subjectrejectparams user to change subjectstate to rejected end end I get the following error from rspec FailureError expect subjectrejectparams user to change subjectstate to rejected ArgumentError Wrong number of arguments Expected got However if I remove the line expectsubjectto receiveupdateorder the test passes Additional context Gemfile gem rails gem aasm gem rspecrails The test passes before upgrading from aasm to When there is a default scope and an initial state on an aasm column upon initialize it takes the scoped state as initial instead of the initial in the aasm state machine Is it possible to override this behaviour and make the aasm initial as the default initial state I have certain places in my app where I have integrated with an external API I have the following code event pause do before do integrationpauseself end transitions from live to paused end This makes an Api request to the service we have integrated with When this is successful to saves a request log However when it fails say a then my request log that is saved to the DB is rolled back How do I force these types of logs to be saved when there is a failed event And if this is not possible what are the common ways people get around this sort of problem thanks Fix for if an unknown event was fired raise AASMUndefinedState dont trigger callbacks