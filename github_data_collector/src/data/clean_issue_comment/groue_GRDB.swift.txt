 What did you do Attempting to perform FTS search to filter results for a NSTableView Fatal error Unexpectedly found nil while implicitly unwrapping an Optional value file ViewControllerswift line Environment GRDB flavors GRDB GRDB version Installation method CocoaPods Xcode version Swift version x newest whatever is default from a new project Platforms running GRDB macOS macOS version running Xcode public beta Demo Project Hello I am a fairly novice programmer and am running into an issue with FetchedRecordsController I am aware it is a deprecated API Being the nd time Im using GRDB a wonderful library I was trying to use code from a previous project that continues to work though after this message I will possibly try to migrate to ValueObservation since it is a new app and is the preferred method I have an NSTableView that filters from the value of a NSSearchField I get a crash when trying to setRequest from a SQL query try itemControllersetRequestsql sql arguments queryString It is a media app much like those apps that catalog books music film etc It is mostly for personal use for now and as it grows Im not sure what the table structure will look like For the moment I am merely trying to get a basic app to work and will refine it as it is built As it stands the code is as such class ViewController NSViewController var selectedRowIndexes IndexSet var sortString uuid for later filtering and sorting by columns and order var sortOrder DESC override func viewDidLoad superviewDidLoad try selfsetupDatabase libdbCreateTables itemController try FetchedRecordsController dbPool sql SELECT itemid itemuuid itemtitle itemseries itemcreator itempublisher itemyear itemsize itemdatecreated itemdateupdated itemfavorite FROM item ORDER BY uuid DESC try itemControllerperformFetch track changes itemControllertrackChanges animated table changes maybe are not needed at the moment so could remove this and readd later using ValueObservation willChange unowned self in selfselectedRowIndexes selftableViewselectedRowIndexes selftableViewbeginUpdates controllers records have changed didChange unowned self in selftableViewreloadData selftableViewselectRowIndexesselfselectedRowIndexes byExtendingSelection false selffilterTable on startup show all results later used for filtering public func filterTable if searchString try itemControllersetRequestRestrictedItemorderColumnuuiddesc else let queryString libformatQuerysearchString appends to each search term for FTS var sql SELECT itemid itemuuid itemtitle itemseries itemcreator itempublisher itemyear itemsubjects itemsize itemdatecreated itemdateupdated itemfavorite FROM item JOIN itemsearch ON itemsearchrowid itemid WHERE itemsearch MATCH ORDER BY sql sql selfsortString selfsortOrder try itemControllersetRequestsql sql arguments queryString crash here Query is ok as run within the SQLite console RestrictedItem with a subset of fields for the NSTableView struct RestrictedItem Prefer Int for autoincremented database ids var id Int var uuid Int var title String var series String var creator String var publisher String var year Int var subjects String var size Int var datecreated Date var dateupdated Date var favorite Bool Hashable conformance supports tableView diffing extension RestrictedItem Hashable extension RestrictedItem Codable FetchableRecord TableRecord MutablePersistableRecord TableRecord static let databaseTableName item Define database columns from CodingKeys private enum Columns static let id ColumnCodingKeysid static let uuid ColumnCodingKeysuuid static let title ColumnCodingKeystitle static let series ColumnCodingKeysseries static let creator ColumnCodingKeyscreator static let publisher ColumnCodingKeyspublisher static let year ColumnCodingKeysyear static let subjects ColumnCodingKeyssubjects static let size ColumnCodingKeyssize static let datecreated ColumnCodingKeysdatecreated static let dateupdated ColumnCodingKeysdateupdated static let favorite ColumnCodingKeysfavorite Update id after it has been inserted in the database mutating func didInsertwith rowID Int for column String id rowID final class MediaLibrary NSObject func dbCreateTables let exists try dbPoolread db in Bool true if the table exists try dbtableExistsitem if exists true return try dbPoolwrite db in Create table try dbcreatetable item ifNotExists true t in tautoIncrementedPrimaryKeyid tcolumnuuid integeruniquenotNullindexed tcolumntitle textnotNull tcolumnseries text tcolumncreator textnotNull tcolumnpublisher text tcolumnyear integernotNull tcolumnisbn text tcolumndescription text tcolumnsubjects text tcolumnsize integerindexed tcolumndatecreated datetimenotNull tcolumndateupdated datetimenotNull tcolumnfavorite booleannotNulldefaultsto false Create fulltext table perhaps later will be contentless try dbcreatevirtualTable itemsearch ifNotExists true using FTS t in ttokenizer porterwrapping unicode unsure how to use removediacritics remove I recall didnt show up as an available option tprefixes tcolumntitle tcolumnseries tcolumncreator tcolumnpublisher tcolumndescription tcolumnsubjects fulltext search triggers try dbexecutesql CREATE TRIGGER IF NOT EXISTS itemdelete AFTER DELETE ON item BEGIN DELETE FROM itemsearch where rowidoldid END CREATE TRIGGER IF NOT EXISTS iteminsert AFTER INSERT ON item BEGIN INSERT INTO itemsearchrowid title series creator publisher description subjects VALUES newid newtitle newseries newcreator newpublisher newdescription newsubjects END CREATE TRIGGER IF NOT EXISTS updatetitle AFTER UPDATE OF title ON item BEGIN DELETE FROM itemsearch where rowidoldid INSERT INTO itemsearchrowid title series creator publisher description subjects VALUES newid newtitle newseries newcreator newpublisher newdescription newsubjects END CREATE TRIGGER IF NOT EXISTS updateseries AFTER UPDATE OF series ON item BEGIN DELETE FROM itemsearch where rowidoldid INSERT INTO itemsearchrowid title series creator publisher description subjects VALUES newid newtitle newseries newcreator newpublisher newdescription newsubjects END CREATE TRIGGER IF NOT EXISTS updatecreator AFTER UPDATE OF creator ON item BEGIN DELETE FROM itemsearch where rowidoldid INSERT INTO itemsearchrowid title series creator publisher description subjects VALUES newid newtitle newseries newcreator newpublisher newdescription newsubjects END CREATE TRIGGER IF NOT EXISTS updatepublisher AFTER UPDATE OF subjects ON item BEGIN DELETE FROM itemsearch where rowidoldid INSERT INTO itemsearchrowid title series creator publisher description subjects VALUES newid newtitle newseries newcreator newpublisher newdescription newsubjects END CREATE TRIGGER IF NOT EXISTS updatedescription AFTER UPDATE OF publisher ON item BEGIN DELETE FROM itemsearch where rowidoldid INSERT INTO itemsearch rowid title series creator publisher description subjects VALUES newid newtitle newseries newcreator newpublisher newdescription newsubjects END CREATE TRIGGER IF NOT EXISTS updatesubjects AFTER UPDATE OF subjects ON item BEGIN DELETE FROM itemsearch where rowidoldid INSERT INTO itemsearch rowid title series creator publisher description subjects VALUES newid newtitle newseries newcreator newpublisher newdescription newsubjects END As Im not too experienced at programming Im trying to decrypt the the debug output What I think is relevant x fff e jne x fff e x fff e a testq r r x fff e d jne x fff e x fff e leaq x f b rip rax laceableCollectionswift x fff e a movabsq x r imm x x fff e orq rax r x fff e leaq x f rip rdi Fatal error x fff e e leaq x fe brip r BuildRootLibraryCachescomapplexbsSourcesswiftlangswiftlang swiftstdlibpubliccoreStaticStringswift x fff e d leaq x f rip rdi Fatal error x fff e leaq x f rip rcx UnsafeBufferPointer with negative count x fff e b movl xb esi x fff e movl x r d x fff e jmp x fff e x fff e subq x rsp x fff e c leaq x f rip rdi Fatal error x fff e leaq x f c rip rcx Not enough bits to represent the passed value x fff e a movl xb esi x fff e f movl x d r d x fff e movl x edx x fff e a movl x r d x fff e pushq x x fff e callq x fff e c function signature specialization Arg Exploded Arg Exploded Arg Dead Arg Dead of SwiftfatalErrorMessage SwiftStaticString SwiftStaticString file SwiftStaticString line SwiftUInt flags SwiftUInt SwiftNever Please let me know if you need more information btw it is terrific that the documentation is as extensive as it is Though as a novice programmer I sometimes find it difficult to refer to needing to reread sections multiple times to figure something out Being so long perhaps you might someday consider moving it to the wiki and having each section being a separate page with some side bar for navigation so it is easier to see the whole API at a glance and quickly navigate to relevant sections Im not sure what else might make the docs easier to use Perhaps as books might sometimes title their sections based on what to do rather than API names maybe that would be a good section to add Sometimes too for each topic such as ValueObservation and recordstruct types maybe a bit of rewording so I can go to the section and at the beginning see what parts are relevant rather than so far needing to read the whole thing and then figuring out which part of the API to use Ill continue to think about how the docs could be easier to use DatabasePoolSchemaCacheTeststestCachedStatementsAreNotShared crashlog Description of this PR to be written Sometimes a Travis test fails I was lucky to catch it in Xcode today details summarystack tracesummary Test Case GRDBOSXTestsDatabasePoolReleaseMemoryTests testDatabasePoolReleaseMemoryClosesReaderConnections started xctest x a malloc tinyfreelistremoveptr Internal invariant broken prev ptr of next ptr x f nextprev x xctest x a malloc set a breakpoint in mallocerrorbreak to debug lldb bt all thread queue comapplerootuserinteractiveqos frame x fff d aa e libsystemkerneldylibulockwait frame x fff d ac libdispatchdylibdispatchulockwait frame x fff d b libdispatchdylibdispatchthreadeventwaitslow frame x fff d a libdispatchdylibdispatchapplyinvokeandwait frame x fff d f a libdispatchdylibdispatchapplyf frame x bc a libswiftDispatchdylibstatic extension in DispatchCOSdispatchqueueconcurrentPerformiterations SwiftInt execute SwiftInt frame x d GRDBOSXTestsDatabasePoolReleaseMemoryTeststestDatabasePoolReleaseMemoryClosesReaderConnectionsself x a a at DatabasePoolReleaseMemoryTestsswift frame x d GRDBOSXTestsobjc DatabasePoolReleaseMemoryTeststestDatabasePoolReleaseMemoryClosesReaderConnections at compilergenerated frame x fff fe cf c CoreFoundationinvoking frame x fff fe cde CoreFoundation NSInvocation invoke frame x cf XCTest XCTestCase invokeTest blockinvoke frame x e b XCTest XCTMemoryChecker assertInvalidObjectsDeallocatedAfterScope frame x fa XCTest XCTestCase assertInvalidObjectsDeallocatedAfterScope frame x cea XCTest XCTestCase invokeTest blockinvoke frame x ceee XCTest XCTestCaseFailures performFailableBlocktestCaseRunshouldInterruptTest frame x cee XCTest XCTestCaseFailures performTurningExceptionsIntoFailuresInterruptAfterHandlingblock frame x cae XCTest XCTestCase invokeTest blockinvoke frame x d d d XCTest XCUITestContext performInScope frame x c d XCTest XCTestCase testContextPerformInScope frame x c e XCTest XCTestCase invokeTest frame x e XCTest XCTestCase performTest blockinvoke frame x ceee XCTest XCTestCaseFailures performFailableBlocktestCaseRunshouldInterruptTest frame x cee XCTest XCTestCaseFailures performTurningExceptionsIntoFailuresInterruptAfterHandlingblock frame x e e XCTest XCTestCase performTest blockinvoke frame x dcc XCTest XCTContext runInContextForTestCaseblock frame x da XCTest XCTestCase performTest frame x b XCTest XCTest runTest frame x a XCTest XCTestSuite performTest blockinvoke frame x d XCTest XCTestSuite performProtectedSectionForTesttestSection frame x e XCTest XCTestSuite performTest frame x b XCTest XCTest runTest frame x a XCTest XCTestSuite performTest blockinvoke frame x d XCTest XCTestSuite performProtectedSectionForTesttestSection frame x e XCTest XCTestSuite performTest frame x b XCTest XCTest runTest frame x a XCTest XCTestSuite performTest blockinvoke frame x d XCTest XCTestSuite performProtectedSectionForTesttestSection frame x e XCTest XCTestSuite performTest frame x b XCTest XCTest runTest frame x f a a XCTest XCTTestRunSession runTestsAndReturnError blockinvoke frame x f b b XCTest XCTTestRunSession runTestsAndReturnError blockinvoke frame x c f XCTest XCTestObservationCenter observeTestExecutionForBlock frame x f bd XCTest XCTTestRunSession runTestsAndReturnError frame x cbcf XCTest XCTestDriver runTestsAndReturnError frame x d XCTestXCTestMain frame x c xctestmain frame x fff d eed libdylddylibstart thread frame x fff d a b a libsystemkerneldylibworkqkernreturn frame x fff d libsystempthreaddylibpthreadwqthread frame x fff d libsystempthreaddylibstartwqthread frame x xctestmhexecuteheader thread queue shared memory transport listener queue frame x fff d abeae libsystemkerneldylibsemwaitsignal frame x fff d libsystemcdylibnanosleep frame x fff d libsystemcdylibusleep frame x c DTXConnectionServices DTXSharedMemoryTransport setupWithShmasCreator blockinvoke frame x fff d fd libdispatchdylibdispatchcallblockandrelease frame x fff d dcf libdispatchdylibdispatchclientcallout frame x fff d libdispatchdylibdispatchlaneserialdrain frame x fff d bdc libdispatchdylibdispatchlaneinvoke frame x fff d libdispatchdylibdispatchworkloopworkerthread frame x fff d b libsystempthreaddylibpthreadwqthread frame x fff d libsystempthreaddylibstartwqthread thread frame x fff d f libsystempthreaddylibstartwqthread thread frame x fff d f libsystempthreaddylibstartwqthread thread queue GRDBDatabasePoolreader stop reason breakpoint frame x fff d de libsystemmallocdylibmallocerrorbreak frame x fff d libsystemmallocdylibmallocvreport frame x fff d a c libsystemmallocdylibmalloczoneerror frame x fff d libsystemmallocdylibtinyfreelistremoveptr frame x fff d c libsystemmallocdylibtinyfreenolock frame x fff d libsystemmallocdylibfreetiny frame x fff d c libdispatchdylibdispatchsourcedispose frame x fff d c libdispatchdylibdispatchdispose frame x fff d ac libdispatchdylib OSdispatchsource xrefdispose frame x fff c dc f libsqlite dylibunixFileControl frame x fff c f libsqlite dylibsqlite WalClose frame x fff c d libsqlite dylibsqlite PagerClose frame x fff c c libsqlite dylibsqlite BtreeClose frame x fff c b e libsqlite dylibsqlite LeaveMutexAndCloseZombie frame x fff c be f libsqlite dylibsqlite Close frame x c efa GRDBstatic DatabasecloseConnectionv sqliteConnection x db ba sqlite closev x fff c becb libsqlite dylibsqlite closev selfGRDBDatabase at Databaseswift frame x c b d GRDBstatic DatabasecloseConnectionsqliteConnection x db ba selfGRDBDatabase at Databaseswift frame x c ded GRDBDatabasecloseself x db at Databaseswift frame x c c GRDBclosure in SerializedDatabasedeinitdb x db at SerializedDatabaseswift frame x bfdce GRDBthunk for calleeguaranteed guaranteed Database error owned Error at compilergenerated frame x c eb GRDBpartial apply for thunk for calleeguaranteed guaranteed Database error owned Error at compilergenerated frame x c e GRDBclosure in SerializedDatabasereentrantSyncAself x db d block x c d GRDBpartial apply forwarder for reabstraction thunk helper from calleeguaranteed guaranteed GRDBDatabase error owned SwiftError to escaping calleeguaranteed guaranteed GRDBDatabase out error owned SwiftError at compilergenerated at SerializedDatabaseswift frame x c GRDBpartial apply for closure in SerializedDatabasereentrantSyncA at compilergenerated frame x bcc libswiftDispatchdylibpartial apply forwarder for reabstraction thunk helper A from calleeguaranteed out A error owned SwiftError to escaping calleeguaranteed out A error owned SwiftError frame x bc b libswiftDispatchdylibclosure in closure throws A in extension in DispatchCOSdispatchqueuesyncHelper in F D D C E E C CE C AAfn execute throws A rescue SwiftError throws A throws A frame x bcc d libswiftDispatchdylibmerged partial apply forwarder for closure in extension in DispatchCOSdispatchqueuesyncHelper in F D D C E E C CE C AAfn DispatchDispatchWorkItem flags DispatchDispatchWorkItemFlags execute throws A rescue SwiftError throws A throws A frame x bcc libswiftDispatchdylibpartial apply forwarder for closure in closure throws A in extension in DispatchCOSdispatchqueuesyncHelper in F D D C E E C CE C AAfn execute throws A rescue SwiftError throws A throws A frame x bcc libswiftDispatchdylibpartial apply forwarder for reabstraction thunk helper from calleeguaranteed to escaping calleeguaranteed frame x bcd libswiftDispatchdylibreabstraction thunk helper from calleeguaranteed to escaping calleeguaranteed partial apply forwarder with unmangled suffix frame x bbd e libswiftDispatchdylibreabstraction thunk helper from escaping calleeguaranteed to calleeunowned conventionblock frame x fff d dcf libdispatchdylibdispatchclientcallout frame x fff d ca c libdispatchdylibdispatchlanebarriersyncinvokeandcomplete frame x bc f a libswiftDispatchdylibnonobjc COSdispatchqueuesyncexecute frame x bc b libswiftDispatchdylibpartial apply forwarder for nonobjc frame x bc b libswiftDispatchdylibextension in DispatchCOSdispatchqueuesyncHelper in F D D C E E C CE C AAfn execute throws A rescue SwiftError throws A throws A frame x bc e f libswiftDispatchdylibextension in DispatchCOSdispatchqueuesyncAexecute throws A throws A frame x c GRDBSerializedDatabasereentrantSyncAblock x c d GRDBpartial apply forwarder for reabstraction thunk helper from calleeguaranteed guaranteed GRDBDatabase error owned SwiftError to escaping calleeguaranteed guaranteed GRDBDatabase out error owned SwiftError at compilergenerated self x db d at SerializedDatabaseswift frame x c GRDBSerializedDatabasedeinitself x db d at SerializedDatabaseswift frame x c GRDBSerializedDatabasedeallocatingdeinitself x db d at SerializedDatabaseswift frame x caa a libswiftCoredylibswiftreleasedealloc frame x c fd GRDBPoolItemdeinitselfelement x available false at Poolswift frame x c fd GRDBPoolItemdeallocatingdeinitselfelement x available false at Poolswift frame x caa a libswiftCoredylibswiftreleasedealloc frame x ca becb libswiftCoredylibswiftarrayDestroy frame x c db libswiftCoredylibSwiftContiguousArrayStoragedeallocatingdeinit frame x caa a libswiftCoredylibswiftreleasedealloc frame x c caa GRDBclosure in Poolclearitems values block x c b GRDBclosure in GRDBPoolclear at Poolswift at Poolswift frame x c d GRDBpartial apply for closure in PoolclearandThen at compilergenerated frame x c a GRDBthunk for calleeguaranteed inout PoolAItem error owned Error at compilergenerated frame x c dc GRDBthunk for calleeguaranteed inout PoolAItem error owned Errorpartial apply at compilergenerated frame x bfdade GRDBclosure in ReadWriteBoxwriteAblock x c d GRDBreabstraction thunk helper A from calleeguaranteed inout SwiftArrayGRDBPoolAItem in B CED AE EAAED CE error owned SwiftError to escaping calleeguaranteed inout SwiftArrayGRDBPoolAItem in B CED AE EAAED CE out error owned SwiftErrorpartial apply forwarder with unmangled suffix at compilergenerated self x db ab at ReadWriteBoxswift frame x bfdaed GRDBpartial apply for closure in ReadWriteBoxwriteA at compilergenerated frame x bcc libswiftDispatchdylibpartial apply forwarder for reabstraction thunk helper A from calleeguaranteed out A error owned SwiftError to escaping calleeguaranteed out A error owned SwiftError frame x bc b libswiftDispatchdylibclosure in closure throws A in extension in DispatchCOSdispatchqueuesyncHelper in F D D C E E C CE C AAfn execute throws A rescue SwiftError throws A throws A frame x bcc d libswiftDispatchdylibmerged partial apply forwarder for closure in extension in DispatchCOSdispatchqueuesyncHelper in F D D C E E C CE C AAfn DispatchDispatchWorkItem flags DispatchDispatchWorkItemFlags execute throws A rescue SwiftError throws A throws A frame x bcc libswiftDispatchdylibpartial apply forwarder for closure in closure throws A in extension in DispatchCOSdispatchqueuesyncHelper in F D D C E E C CE C AAfn execute throws A rescue SwiftError throws A throws A frame x bcc libswiftDispatchdylibpartial apply forwarder for reabstraction thunk helper from calleeguaranteed to escaping calleeguaranteed frame x bbd e libswiftDispatchdylibreabstraction thunk helper from escaping calleeguaranteed to calleeunowned conventionblock frame x fff d dcf libdispatchdylibdispatchclientcallout frame x fff d cd libdispatchdylibdispatchsyncinvokeandcompleterecurse frame x fff d c e libdispatchdylibdispatchsyncfslow frame x bc e libswiftDispatchdylibpartial apply forwarder for extension in DispatchCOSdispatchqueuesyncBarrier in F D D C E E C CE C Ablock frame x bc b libswiftDispatchdylibextension in DispatchCOSdispatchqueuesyncHelper in F D D C E E C CE C AAfn execute throws A rescue SwiftError throws A throws A frame x bc libswiftDispatchdylibextension in DispatchCOSdispatchqueuesyncAflags DispatchDispatchWorkItemFlags execute throws A throws A frame x bfda GRDBReadWriteBoxwriteAblock x c d GRDBreabstraction thunk helper A from calleeguaranteed inout SwiftArrayGRDBPoolAItem in B CED AE EAAED CE error owned SwiftError to escaping calleeguaranteed inout SwiftArrayGRDBPoolAItem in B CED AE EAAED CE out error owned SwiftErrorpartial apply forwarder with unmangled suffix at compilergenerated self x db ab at ReadWriteBoxswift frame x c b d GRDBPoolclearblock x c b GRDBclosure in GRDBPoolclear at Poolswift self x db at Poolswift frame x c d GRDBPoolclearself x db at Poolswift frame x c bba a GRDBDatabasePoolreleaseMemoryself x d b a at DatabasePoolswift frame x d a GRDBOSXTestsclosure in DatabasePoolReleaseMemoryTeststestDatabasePoolReleaseMemoryClosesReaderConnectionss x db dbPool x d b a at DatabasePoolReleaseMemoryTestsswift frame x d af GRDBOSXTestspartial apply for closure in DatabasePoolReleaseMemoryTeststestDatabasePoolReleaseMemoryClosesReaderConnections at compilergenerated frame x f dc GRDBOSXTeststhunk for escaping calleeguaranteed at compilergenerated frame x d c GRDBOSXTeststhunk for escaping calleeguaranteed partial apply at compilergenerated frame x d ca GRDBOSXTestsclosure in DatabasePoolReleaseMemoryTeststestDatabasePoolReleaseMemoryClosesReaderConnectionsindex blocks values at DatabasePoolReleaseMemoryTestsswift frame x d d d GRDBOSXTestspartial apply for closure in DatabasePoolReleaseMemoryTeststestDatabasePoolReleaseMemoryClosesReaderConnections at compilergenerated frame x bc libswiftDispatchdylibpartial apply forwarder for reabstraction thunk helper from calleeguaranteed unowned SwiftInt to escaping calleeguaranteed unowned SwiftInt frame x bc libswiftDispatchdylibreabstraction thunk helper from escaping calleeguaranteed unowned SwiftInt to calleeunowned conventionblock unowned SwiftInt frame x fff d e libdispatchdylibdispatchclientcallout frame x fff d libdispatchdylibdispatchapplyinvoke frame x fff d dcf libdispatchdylibdispatchclientcallout frame x fff d ee libdispatchdylibdispatchrootqueuedrain frame x fff d f bd libdispatchdylibdispatchworkerthread frame x fff d dd libsystempthreaddylibpthreadwqthread frame x fff d libsystempthreaddylibstartwqthread thread frame x fff d a b a libsystemkerneldylibworkqkernreturn frame x fff d libsystempthreaddylibpthreadwqthread frame x fff d libsystempthreaddylibstartwqthread frame x xctestmhexecuteheader details