I have a batch node combined with a query node that uses a groupBy This groupBy groups on runtimename so the runtimename appears in the Tag map Further I have two string variables that reference that runtimename Tag These are the variables See template below var startsummary PROBLEM Start summary text for runtime index Tags runtimename var endsummary FIXED End summary text for runtime index Tags runtimename I added these variables to the Tag map by using the DefaultNode so I can reference them via a Golang template via the construction with the curly braces Then following the batch node is the deadman function For the deadman function I use the following message this message refers to the Tags that were created for the variables var message if eq Level CRITICAL index Tags startsummary else if eq Level OK index Tags endsummary end The deadman function is used to detect if during a certain period of time data were missing If for a certain amount of time there was no data and Level gets the value CRITICAL I want to see the value of variable startsummary and when the value of Level changes to OK again I want to see the value of the variable endsummary Lets assume that the name of the involved runtime is systemcontainer When Level gets the value CRITICAL I want to see PROBLEM Start summary text for runtime systemcontainer But what I see is PROBLEM Start summary text for runtime index Tags runtimename The runtimeTag in the curly braces doesn t get evaluated The same happens when Level goes from CRITICAL to OK again Then I want to see the message FIXED End summary text for runtime systemcontainer I get FIXED End summary text for runtime index Tags runtimename Is it possible to let the deadman function output a message depending on values of alert data where the messages are in the Tag map and where the messages themselves reference a Tag Is it possible to fix that the Tag in those messages gets evaluated Or is a different approach is needed for letting messages depend on values of alert data What are the possibilities Template var message if eq Level CRITICAL index Tags startsummary else if eq Level OK index Tags endsummary end var dayRestriction lambda var timeRestriction lambda var qry SELECT count FROM db rp measurement WHERE whereClause var data batch queryqry periodperiod cronqryCronExpr groupBy environment runtimename defaulttag startsummary startsummary defaulttag endsummary endsummary var trigger data deadmanthreshold interval lambda dayRestriction AND timeRestriction messagemessage stateChangesOnly details post We have a very long tick script that is only a single file because we want to share a bunch of variables like a POST url the database to query etc One way to solve this is to use env vars as suggested in which is still not supported Another way would be to allow an import statement of some kind that allows inlining other tick scripts into a tick file This would also help with the load directory feature as then we could also separate tick files for better code separation but still define a single templateid in the task templates If using importing then you need a way for the load directory feature to only load toplevel tick scripts For example you could then start all library file names with an underscore or change the extension or something like that Hi all Im pretty new to tick script and Im trying to make a window of s and emits every s Here is a my code var source stream from measurementmeasurement wherelambda isPresentretxPacketsReceived AND isPresentpacketsReceived groupBydevice log window period s every s var retxPercentage source firstretxPacketsReceived asfirstRetxPacketsReceived lastretxPacketsReceived aslastRetxPacketsReceived firstpacketsReceived asfirstPacketsReceived lastpacketsReceived aslastPacketsReceived evallambda intlastRetxPacketsReceived intfirstRetxPacketsReceived asretxPercentageValue log retxPercentage alert warnlambda retxPercentageValue RETXPACKETSPERCENTAGEWARN warnResetlambda retxPercentageValue RETXPACKETSPERCENTAGEWARN message idindex Tags device idTagidTag levelTaglevelTag messageFieldmessageField durationFielddurationField Here are the code I insert in Influx insert measurementdevice retxPacketsReceived packetsReceived insert measurementdevice retxPacketsReceived packetsReceived insert measurementdevice retxPacketsReceived packetsReceived The error I see in logs ts T Z lvlerror msgfailed to realize reduce context from fields servicekapacitor taskmastermain taskargodev nodelast errfield retxPacketsReceived missing from point If I remove the last and only call single time to first then I can make it work Its like calling first removes the field from the window or something like that Any idea In my kapactior config file I defined a httppost handler named after wechat httppost endpoint wechat url headers ContentType applicationjson alerttemplate Message rowtemplate Message In chronograf my alram rule was set as below But in kapacitor I got this error ts T Z lvlerror msgfailed to POST alert data servicehttppost taskchronografv c fcf c c d d errPost wechat unsupported protocol scheme I have no idea about where the problem is fix Update RPM specific packaging to match RPM naming convention RPM naming convention says that We should use dashes not underscores in the package filename We should include a package version iteration in the package name This change removes the code which swapped underscores for dashes in the RPM specific code It also moves the code which removes the packageiteration in to an else block and adds an rpm specific work around to not do that This was done so that nonrpm builds are not affected by this change Fixes Required for all nontrivial PRs Rebasedmergable Tests pass CHANGELOGmd updated Sign CLA if not already signed Hello everybody Im trying to create an MQTT alert on kapacitor writing to a queue on RabbitMQ I configured kapacitorconfig like this mqtt enabled true name localhost default true url tcplocalhost mqtt enabled true name alertsbroker default false url ssl sslca etckapacitorcapem sslcert etckapacitorcertpem sslkey etckapacitorkeypem clientid alertsbroker username mqadmin password mqadminpassword and a tickScript like this stream from measurementcpu alert critlambda usageidle messageTom Test OK topiccpu But it doesnt work Can you help me Tommaso Hi when i test kapacitor with influx i can see a bad datetime its while late by hour it is h and its request the DB for h Thanks you for the help kapacitor watch atick ts T lvldebug msgstarting next batch query servicekapacitor taskmastermain taskatick nodeinfluxdbout querySELECT lastvalue AS last FROM exampleautogenload WHERE time T Z AND time T Z yes the name of script is atick and atick python script test py from influxdb import InfluxDBClient from datetime import datetime import time client InfluxDBClientlocalhost root root example clientcreatedatabaseexample X while True timesleep now datetimenow print valeur formatnow X jsonbody measurement load tags host server region uswest time now fields value X X if X X clientwritepointsjsonbody the tickScript Get batch data var views batch querySELECT lastvalue as last FROM exampleautogenload period h every s Join errors and views views Calculate percentage evallambda last Give the resulting field a name asvalue influxDBOut databaseexample measurementalert retentionPolicyautogen result in influx select last from alert name alert time lastvalue T Z false SELECT last FROM exampleautogenload name load time lastvalue T Z the kapacitor config is kapacitord config kapacitorconf without change im french kapacitor version is influx version is Adding a Webex Teams Alertnode Tests were ran via bash go test v go list grep v vendor Two failures did occur at the following tests bash FAIL TestServerUDFStreamAgents s servertestgo open service udfService failed to load process info for movingAvg exec python executable file not found in PATH and bash Agent for connection finished FAIL TestServerUDFStreamAgentsSocket s servertestgo open service udfService failed to load process info for mirror dial unix varfoldersswnz vtk n m x v x fn gnTkapacitorservertest mirrorpysock connect no such file or directory Server stopped Required for all nontrivial PRs Rebasedmergable Tests pass CHANGELOGmd updated Sign CLA if not already signed Required only if applicable You can erase any checkboxes below this note if they are not applicable to your Pull Request TICKscript Spec updated Hi Team We are using kapacitor x and chronograf x and influxdb x Kapacitor and Chronograf are running on one server and InfluxDB is running on another server I can see all Tables and other details on Chronograf under Build Alert Rule but unable to generate Alert I have added InfluxDB server IP in kapacitor config file Please help to know why no alert is generating through kapacitor is there any configuration required because InfluxDB is running in another server Hi I have below installed to my window OS InfluxDB v Telegraf v and Kapacitor v kapacitor list tasks ID Type Status Executing Databases and Retention Policies slackalert stream enabled true mydbautogen telegramalert stream enabled true mydbautogen kapacitor servicetests slack telegram Service Success Message slack false service is not enabled telegram false service is not enabled kapacitord error log ts T lvlerror msgfailed to send event to Telegram servicetelegram tasktelegramalert errservice is not enabled ts T lvlerror msgfailed to send event serviceslack taskslackalert errservice is not enabled ts T lvldebug msgalert triggered servicekapacitor taskmastermain tasktelegramalert nodealert levelOK idcpunil eventmessageHey check your CPU data cpu map cpucpu dcdenver hostDESKTOPDJBDJUU time usageguest usageguestnice usageidle usageiowait usageirq usagenice usagesoftirq usagesteal usagesystem usageuser UTC ts T lvlerror msgfailed to send event to Telegram servicetelegram tasktelegramalert errservice is not enabled ts T lvldebug msgalert triggered servicekapacitor taskmastermain taskslackalert nodealert levelOK idcpunil eventmessageHey check your CPU data cpu map hostDESKTOPDJBDJUU cpucpu dcdenver time usageguest usageguestnice usageidle usageiowait usageirq usagenice usagesoftirq usagesteal usagesystem usageuser UTC ts T lvlerror msgfailed to send event serviceslack taskslackalert errservice is not enabled ts T lvldebug msgalert triggered servicekapacitor taskmastermain tasktelegramalert nodealert levelCRITICAL idcpunil eventmessageHey check your CPU data cpu map cpucpu dcdenver hostDESKTOPDJBDJUU time usageguest usageguestnice usageidle usageiowait usageirq usagenice usagesoftirq usagesteal usagesystem usageuser UTC ts T lvlerror msgfailed to send event to Telegram servicetelegram tasktelegramalert errservice is not enabled ts T lvldebug msgalert triggered servicekapacitor taskmastermain taskslackalert nodealert levelWARNING idcpunil eventmessageHey check your CPU data cpu map cpucpu dcdenver hostDESKTOPDJBDJUU time usageguest usageguestnice usageidle usageiowait usageirq usagenice usagesoftirq usagesteal usagesystem usageuser UTC ts T lvlerror msgfailed to send event serviceslack taskslackalert errservice is not enabled ts T lvldebug msgalert triggered servicekapacitor taskmastermain tasktelegramalert nodealert levelOK idcpunil eventmessageHey check your CPU data cpu map cpucpu dcdenver hostDESKTOPDJBDJUU time usageguest usageguestnice usageidle usageiowait usageirq usagenice usagesoftirq usagesteal usagesystem usageuser UTC ts T lvlerror msgfailed to send event to Telegram servicetelegram tasktelegramalert errservice is not enabled ts T lvldebug msgalert triggered servicekapacitor taskmastermain taskslackalert nodealert levelOK idcpunil eventmessageHey check your CPU data cpu map cpucpu dcdenver hostDESKTOPDJBDJUU time usageguest usageguestnice usageidle usageiowait usageirq usagenice usagesoftirq usagesteal usagesystem usageuser UTC ts T lvlerror msgfailed to send event serviceslack taskslackalert errservice is not enabled ts T lvldebug msgalert triggered servicekapacitor taskmastermain tasktelegramalert nodealert levelCRITICAL idcpunil eventmessageHey check your CPU data cpu map cpucpu dcdenver hostDESKTOPDJBDJUU time usageguest usageguestnice usageidle usageiowait usageirq usagenice usagesoftirq usagesteal usagesystem usageuser UTC ts T lvlerror msgfailed to send event to Telegram servicetelegram tasktelegramalert errservice is not enabled ts T lvldebug msgalert triggered servicekapacitor taskmastermain taskslackalert nodealert levelWARNING idcpunil eventmessageHey check your CPU data cpu map cpucpu dcdenver hostDESKTOPDJBDJUU time usageguest usageguestnice usageidle usageiowait usageirq usagenice usagesoftirq usagesteal usagesystem usageuser UTC ts T lvlerror msgfailed to send event serviceslack taskslackalert errservice is not enabled ts T lvldebug msgalert triggered servicekapacitor taskmastermain tasktelegramalert nodealert levelOK idcpunil eventmessageHey check your CPU data cpu map dcdenver hostDESKTOPDJBDJUU cpucpu time usageguest usageguestnice usageidle usageiowait usageirq usagenice usagesoftirq usagesteal usagesystem usageuser UTC ts T lvlerror msgfailed to send event to Telegram servicetelegram tasktelegramalert errservice is not enabled ts T lvldebug msgalert triggered servicekapacitor taskmastermain taskslackalert nodealert levelOK idcpunil eventmessageHey check your CPU data cpu map cpucpu dcdenver hostDESKTOPDJBDJUU time usageguest usageguestnice usageidle usageiowait usageirq usagenice usagesoftirq usagesteal usagesystem usageuser UTC ts T lvlerror msgfailed to send event serviceslack taskslackalert errservice is not enabled ts T lvlinfo msghttp request servicehttp host username start T methodPOST uriwriteconsistency dbinternal precisionns rpmonitor protocolHTTP status referer useragentInfluxDBClient requestid d e c f ea duration s ts T lvlinfo msghttp request servicehttp host username start T methodGET urikapacitorv tasksdotviewattributes fieldstype fieldsstatus fieldsexecuting fieldsdbrps limit offset pattern replayid scriptformatformatted protocolHTTP status referer useragentKapacitorClient requestid f ea duration s ts T lvlinfo msghttp request servicehttp host username start T methodPOST uriwriteconsistency dbmydb precisionns rpautogen protocolHTTP status referer useragentInfluxDBClient requestid d a a f ea duration s ts T lvlinfo msghttp request servicehttp host username start T methodPOST uriwriteconsistency dbinternal precisionns rpmonitor protocolHTTP status referer useragentInfluxDBClient requestid ec dd f ea duration s ts T lvlinfo msghttp request servicehttp host username start T methodPOST uriwriteconsistency dbinternal precisionns rpmonitor protocolHTTP status referer useragentInfluxDBClient requestid bf a f ea duration s ts T lvlinfo msghttp request servicehttp host username start T methodPOST uriwriteconsistency dbmydb precisionns rpautogen protocolHTTP status referer useragentInfluxDBClient requestid f f ea a duration s ts T lvlinfo msghttp request servicehttp host username start T methodPOST uriwriteconsistency dbinternal precisionns rpmonitor protocolHTTP status referer useragentInfluxDBClient requestid ab cb f ea b duration s ts T lvldebug msglinking subscription for cluster serviceinfluxdb clusterdefault clusterdefault kapacitor conf slack enabled true default true workspace url channel username global false statechangesonly false telegram enabled true url token chatid disablewebpagepreview false disablenotification false global true statechangesonly false tick file dbrp stream from measurementcpu alert warnlambda usageidle stateChangesOnly messageHey check your CPU slack or telegram how to enable kapacitor slack or telegram service