 Is your feature request related to a problem Please describe When I update my chezmoitomltmpl and add a key I run chezmoi init to update my config file I then have to reenter every configuration key even if they are already present in the config file Describe the solution youd like Id like to be prompted for only the configuration keys not already present in my config file Describe alternatives youve considered A possible workaround would be to manually edit my template to only prompt for a config value if it is not already set I would like it better if promptString had this built in though Describe the bug Having an encrypted file the chezmoi dir and modifying it locally with the intent of calling chezmoi merge filename afterwards results in the crypt text being shown in the diff and not the plain version To reproduce chezmoi add encrypt file nano file chezmoi merge file Expected behavior The file should be encrypted before presenting it in the merge via chezmoi diff shows decrypted version Output of command with verbose chezmoi merge verbose debug netrc files to edit Runusrbinvimdiff homefbartelsnetrc homefbartelslocalsharechezmoiencryptedprivatedotnetrc tmpchezmoi netrc m s usrbinvimdiff homefbartelsnetrc homefbartelslocalsharechezmoiencryptedprivatedotnetrc tmpchezmoi netrc Output of chezmoi doctor chezmoi doctor ok version commit acf a ef a bd aa ad built at T Z ok runtimeGOOS linux runtimeGOARCH amd ok homefbartelslocalsharechezmoi source directory perm ok homefbartels destination directory perm ok homefbartelsconfigchezmoichezmoitoml configuration file ok binbash shell ok binnano editor ok usrbinvimdiff merge command ok usrbingit source VCS command version ok usrbingpg GnuPG version warning op Password CLI not found warning bw Bitwarden CLI not found warning gopass gopass CLI not found warning keepassxccli KeePassXC CLI not found warning lpass LastPass CLI not found warning pass pass CLI not found warning vault Vault CLI not found Additional context I have not reproduced it yet but it also seems that chezmoi merge ignores templated files would store the file as it is locally discarding templated syntax No bug just wanted to let you know that I love using chezmoi and appreciate you and the effort youve put into maintaining it Cheers Hi I am trying to install chezmoi on my Raspberry Pi and I get this message sh curl sfL sh twpaynechezmoi crit platform linuxarmv is not supported Make sure this script is uptodate and file request at age is a modern alternative to gpg and a good candidate for encrypted file support Maybe chezmoi should support it Describe the bug Adding and encrypting a file with chezmoi add encrypt requires two subsequent calls to chezmoi add for the unencrypted file to show as the source state To reproduce shell printf s n test myfileconfig chezmoi add encrypt myfileconfig cat chezmoi sourcepathencryptedmyfileconfig encrypted as expected chezmoi add myfileconfig added the same file without encryption cat chezmoi sourcepathmyfileconfig file still encrypted when it shoudnt chezmoi add myfileconfig cat chezmoi sourcepathmyfileconfig file is not encrypted anymore Expected behavior The file should show up unencrypted on the first call to chezmoi add Output of command with verbose chezmoi add verbose myfileconfig mv homewilsonlocalsharechezmoiencryptedmyfileconfig homewilsonlocalsharechezmoimyfileconfig Output of chezmoi doctor chezmoi doctor warning version ok runtimeGOOS linux runtimeGOARCH amd ok homewilsonlocalsharechezmoi source directory perm ok homewilson destination directory perm ok homewilsonconfigchezmoichezmoitoml configuration file ok binzsh shell ok usrbinvim editor ok usrbinvimdiff merge command ok usrbingit source VCS command version ok usrbingpg GnuPG version warning op Password CLI not found warning bw Bitwarden CLI not found warning usrbingopass gopass CLI warning keepassxccli KeePassXC CLI not found warning lpass LastPass CLI not found ok usrbinpass pass CLI version ok usrbinvault Vault CLI version Additional context Theres another bug related to this issue Follow these steps to fall into an infinite loop shell printf s n test myfileconfig chezmoi add encrypt myfileconfig chezmoi add verbose debug myfileconfig infinite loop I get the following line over and over again Renamehomewilsonlocalsharechezmoiencryptedmyfileconfig homewilsonlocalsharechezmoimyfileconfig Describe the bug A nonempty source file myfileconfig gets emptied without warning when chezmoi add e myfileconfig executes on an empty target file To reproduce shell printf s n test chezmoi sourcepathmyfileconfig touch HOMEmyfileconfig cd HOME chezmoi add e myfileconfig myfileconfig gets removed on source state cat chezmoi sourcepathemptymyfileconfig outputs nothing as expected Expected behavior Expected to get a warning that a nonempty myfileconfig file existed on the source directory before removing the file Output of command with verbose and debug chezmoi add e myfileconfig verbose debug RemoveAllhomewilsonlocalsharechezmoimyfileconfig s rm rf homewilsonlocalsharechezmoimyfileconfig WriteFilehomewilsonlocalsharechezmoiemptymyfileconfig ms install m devnull homewilsonlocalsharechezmoiemptymyfileconfig ahomewilsonlocalsharechezmoiemptymyfileconfig bhomewilsonlocalsharechezmoiemptymyfileconfig test Output of chezmoi doctor chezmoi doctor warning version ok runtimeGOOS linux runtimeGOARCH amd ok homewilsonlocalsharechezmoi source directory perm ok homewilson destination directory perm ok homewilsonconfigchezmoichezmoitoml configuration file ok binzsh shell ok usrbinvim editor ok usrbinvimdiff merge command ok usrbingit source VCS command version ok usrbingpg GnuPG version warning op Password CLI not found warning bw Bitwarden CLI not found warning usrbingopass gopass CLI warning keepassxccli KeePassXC CLI not found warning lpass LastPass CLI not found ok usrbinpass pass CLI version ok usrbinvault Vault CLI version Describe the bug Say myfileconfig was already populated added to the source directory and applied to the target state Then user empties out myfileconfig on the source state using chezmoi edit Then chezmoi apply To reproduce shell touch chezmoi sourcepathmyfileconfig touch HOMEmyfileconfig chezmoi apply removes myfileconfig on the target state but not on the source state ls chezmoi sourcepathmyfileconfig file still exists Expected behavior Since the source state of myfileconfig was empty and it does not have an empty prefix I expected chezmoi apply to also remove the file at the source Perhaps chezmoi edit should check if the source state is an empty file when the editor subprocess finishes and then simply show the same prompt chezmoi rm shows for removing files Output of command with verbose and debug shell chezmoi apply verbose debug rm rf homewilsonmyfileconfig Output of chezmoi doctor chezmoi doctor warning version ok runtimeGOOS linux runtimeGOARCH amd ok homewilsonlocalsharechezmoi source directory perm ok homewilson destination directory perm ok homewilsonconfigchezmoichezmoitoml configuration file ok binzsh shell ok usrbinvim editor ok usrbinvimdiff merge command ok usrbingit source VCS command version ok usrbingpg GnuPG version warning op Password CLI not found warning bw Bitwarden CLI not found warning usrbingopass gopass CLI warning keepassxccli KeePassXC CLI not found warning lpass LastPass CLI not found ok usrbinpass pass CLI version ok usrbinvault Vault CLI version chezmoi currently uses VSCodes Markdown All in One plugin to generate the tables of contents for documentation However this plugin is changing the format of the tables of contents regularly which lead to large unwanted diffs like e cbe a a d e b chezmoi should use its own method to generate tables of contents Related to Troubleshooting x I ran chezmoi doctor and fixed as many issues as possible and retried my command x I have double checked the instructions for Installation and the Quickstart Guide x I have search for previous issues that have been reportedopened and none of them relate to my problem Failure to follow the troubleshooting steps and to report information requested below may make it difficult to provide the proper support required Furthermore your issue may be closed without reply if the instructions were not properly followed Description of issue I added this block in my chezmoitomltmpl data isLinux if eq chezmoios linux trueelsefalseend isMac if eq chezmoios darwin trueelsefalseend isUnix if eq chezmoios linux trueelse if eq chezmoios darwin trueelsefalseend isWindows if eq chezmoios windows trueelsefalseend The file that got generated is this one data isLinux false isMac true isUnix true isWindows false But trying to use those variables doesnt work unless I write them down all in lowercase ie islinux A quick note is that it looks like my system macOS Mojave has a non casesensitive file system which might or might not be the cause of this But I would like to not have to change that setting because this machine is my main programming device and I am afraid changing that setting might cause other issues Also all other chezMoi data strings are cased correctly like chezmoifullHostname EDIT Looks like the same thing happens in WSL Linux subsystem on Windows so might not be related to the filesystem being casesensitive I could also just use the chezmoios data directly but those data fields help me keep things more readable and avoid typos better Also just wanted to say I really appreciate this software it really helps me manage my dotfiles much better Command that failed sammy in localsharechezmoi master N cat chezmoitomltmpl data isLinux if eq chezmoios linuxtrueelsefalseend isMac if eq chezmoios darwintrueelsefalseend isUnix if eq chezmoios linux trueelse if eq chezmoios darwintrueelsefalseend isWindows if eq chezmoios windowstrueelsefalseend sammy in localsharechezmoi master N cat configchezmoichezmoitoml data isLinux false isMac true isUnix true isWindows false sammy in localsharechezmoi master N chezmoi data chezmoi arch amd fullHostname SammysMacbookProlocal group staff homedir Userssammy hostname SammysMacbookPro os darwin username sammy islinux false ismac true isunix true iswindows false Output of command with verbose sammy in localsharechezmoi master N chezmoi data verbose chezmoi arch amd fullHostname SammysMacbookProlocal group staff homedir Userssammy hostname SammysMacbookPro os darwin username sammy islinux false ismac true isunix true iswindows false Output of chezmoi doctor sammy in localsharechezmoi master N chezmoi doctor ok version commit c fdc faf bf f ded d ea a bca f built at T Z ok Userssammylocalsharechezmoi source directory perm ok Userssammy destination directory perm ok Userssammyconfigchezmoichezmoitoml configuration file ok usrlocalbinbash shell ok ApplicationsVisual Studio CodeappContentsResourcesappbincode editor ok usrbinvimdiff merge command ok usrlocalbingit source VCS command version warning gpg GnuPG not found ok Userssammybinop Password CLI version warning bw Bitwarden CLI not found warning gopass gopass CLI not found warning keepassxccli KeePassXC CLI not found ok usrlocalbinlpass LastPass CLI version warning pass pass CLI not found warning vault Vault CLI not found Output of chezmoi version sammy in localsharechezmoi master N chezmoi version chezmoi version commit c fdc faf bf f ded d ea a bca f built at T Z 