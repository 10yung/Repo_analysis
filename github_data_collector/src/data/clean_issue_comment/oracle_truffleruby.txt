Ruby objects are supposed to implement objectid as well as id but this does not seem to be the case with foreign objects Consequently a NoMethodError is thrown when the user tries to print a foreign object I suggest to implement both using ObjecthashCode for now Repro session polyglot jvm shell GraalVM MultiLanguage Shell Copyright c Oracle andor its affiliates JavaScript version Ruby version ruby Polyglotevaljs objectid Unknown identifier objectid NoMethodError at ruby top requiredresourcetrufflerubycoretrufflebootrb at ruby parsingrequestUnknown ruby Polyglotevaljs id Unknown identifier id NoMethodError at ruby top requiredresourcetrufflerubycoretrufflebootrb at ruby parsingrequestUnknown ruby puts Polyglotevaljs Unknown identifier objectid NoMethodError at ruby top requiredresourcetrufflerubycoretrufflebootrb at ruby parsingrequestUnknown cc chumer janehmueller and querenker This is another change that Im not totally sure about yet It enables compilation of the protobuf gem which otherwise fails in linking because somehow there are multiple copies of these inlined methods not inlined I think we probably shouldnt have inline without static Does that make sense to other people Can you try it in your CI as well Formatting slightly unusual due to our build system linking sharedobject googleprotobufcso ldlld error duplicate symbol rbtrgcguard defined in protobufo defined in defso ldlld error duplicate symbol rbnativethreadlockinitialize defined in protobufo defined in defso ldlld error duplicate symbol rbnativethreadlockdestroy defined in protobufo defined in defso In RubyContextpatch and then in RubyContextinit The reason this is an issue is that warnings about the home get printed twice ruby WARNING Trufflereported home foo does not look like TruffleRubys home ruby WARNING home foo guessed from executable foobinruby does not look like TruffleRubys home ruby WARNING could not determine TruffleRubys home the standard library will not be available set home or use loglevelCONFIG to see details ruby WARNING Trufflereported home foo does not look like TruffleRubys home ruby WARNING home foo guessed from executable foobinruby does not look like TruffleRubys home ruby WARNING could not determine TruffleRubys home the standard library will not be available set home or use loglevelCONFIG to see details This is a rough PR aardvark invokeMember should throw an ArityException in case the number of arguments is incorrect At the moment it throws a TruffleRubyinternal ArgumentError instead ruby polyglot jvm shell rGraalVM MultiLanguage Shell Copyright c Oracle andor its affiliates Ruby version ruby TruffleInteropinvoke wrong number of arguments given expected ArgumentError at ruby top requiredresourcetrufflerubycoretrufflebootrb at ruby parsingrequestUnknown js Polyglotevalpython append TypeError append missing required positional argument a js Polyglotevalruby delete wrong number of arguments given expected ArgumentError Gem debase fails to compile with haveheader checking for vmcoreh no Userssimonmdrbenvversionstruffleruby libsulongnativebingraalvmnativeclang o conftest IUserssimonmdrbenvversionstruffleruby libcextinclude IUserssimonmdrbenvversionstruffleruby libcextincluderubybackward IUserssimonmdrbenvversionstruffleruby libcextinclude I IUserssimonmdrbenvsourcestruffleruby rubytruffleruby Iusrlocaloptopenssl include Wimplicitfunctiondeclaration Wnointconversion Wnointtopointercast Wnoincompatiblepointertypes Wnoformatinvalidspecifier Wnoformatextraargs ferrorlimit conftestc L LUserssimonmdrbenvversionstruffleruby lib Lusrlocaloptopenssl lib rpath Userssimonmdrbenvversionstruffleruby libsulongnativelib LUserssimonmdrbenvversionstruffleruby libcext rpath Userssimonmdrbenvversionstruffleruby libcext ltruffleruby lpolyglotmock checked program was begin include rubyh int mainint argc char argv return end conftestc fatal error vmcoreh file not found include vmcoreh error generated Userssimonmdrbenvversionstruffleruby libsulongnativebingraalvmnativeclang E IUserssimonmdrbenvversionstruffleruby libcextinclude IUserssimonmdrbenvversionstruffleruby libcextincluderubybackward IUserssimonmdrbenvversionstruffleruby libcextinclude I IUserssimonmdrbenvsourcestruffleruby rubytruffleruby Iusrlocaloptopenssl include Wimplicitfunctiondeclaration Wnointconversion Wnointtopointercast Wnoincompatiblepointertypes Wnoformatinvalidspecifier Wnoformatextraargs ferrorlimit conftestc o conftesti checked program was begin include rubyh include vmcoreh end haveheader checking for vmcoreh no conftestc fatal error vmcoreh file not found include vmcoreh error generated Userssimonmdrbenvversionstruffleruby libsulongnativebingraalvmnativeclang E IUserssimonmdrbenvversionstruffleruby libcextinclude IUserssimonmdrbenvversionstruffleruby libcextincluderubybackward IUserssimonmdrbenvversionstruffleruby libcextinclude I IUserssimonmdrbenvversionstruffleruby libcextincluderuby p Wimplicitfunctiondeclaration Wnointconversion Wnointtopointercast Wnoincompatiblepointertypes Wnoformatinvalidspecifier Wnoformatextraargs ferrorlimit conftestc o conftesti checked program was begin include rubyh include vmcoreh end haveheader checking for vmcoreh no In file included from conftestc In file included from Userssimonmdrbenvversionstruffleruby libgemsgemsdebaserubycoresource libdebaserubycoresourceruby p vmcoreh In file included from Userssimonmdrbenvversionstruffleruby libgemsgemsdebaserubycoresource libdebaserubycoresourceruby p methodh Userssimonmdrbenvversionstruffleruby libgemsgemsdebaserubycoresource libdebaserubycoresourceruby p internalh fatal error sanitizerasaninterfaceh file not found include sanitizerasaninterfaceh error generated Userssimonmdrbenvversionstruffleruby libsulongnativebingraalvmnativeclang E IUserssimonmdrbenvversionstruffleruby libcextinclude IUserssimonmdrbenvversionstruffleruby libcextincluderubybackward IUserssimonmdrbenvversionstruffleruby libcextinclude I IUserssimonmdrbenvversionstruffleruby libgemsgemsdebaserubycoresource libdebaserubycoresourceruby p Wimplicitfunctiondeclaration Wnointconversion Wnointtopointercast Wnoincompatiblepointertypes Wnoformatinvalidspecifier Wnoformatextraargs ferrorlimit conftestc o conftesti checked program was begin include rubyh include vmcoreh end To reproduce gem install rdiscount Error Building native extensions This could take a while ERROR Error installing rdiscount ERROR Failed to build gem native extension current directory gemtruffleruby gemsrdiscount ext rubiestruffleruby bintruffleruby I rubiestruffleruby libmri r siteconf xt i hrb extconfrb checking for random yes checking for srandom yes checking for rand yes checking for srand yes checking size of unsigned long rubiestruffleruby libmrimkmfrb in Integer cant convert nil into Integer TypeError from rubiestruffleruby libmrimkmfrb in block in tryconstant from rubiestruffleruby libmrimkmfrb in popen from rubiestruffleruby libmrimkmfrb in block in xpopen from rubiestruffleruby libmrimkmfrb in open from rubiestruffleruby libmrimkmfrb in xpopen from rubiestruffleruby libmrimkmfrb in tryconstant from rubiestruffleruby libmrimkmfrb in block in checksizeof from rubiestruffleruby libmrimkmfrb in block in checkingfor from rubiestruffleruby libmrimkmfrb in block levels in postpone from rubiestruffleruby libmrimkmfrb in open from rubiestruffleruby libmrimkmfrb in block in postpone from rubiestruffleruby libmrimkmfrb in open from rubiestruffleruby libmrimkmfrb in postpone from rubiestruffleruby libmrimkmfrb in checkingfor from rubiestruffleruby libmrimkmfrb in checksizeof from extconfrb in block in sizedint from extconfrb in block in find from extconfrb in each from extconfrb in find from extconfrb in sizedint from extconfrb in main extconfrb failed Could not create Makefile due to some reason probably lack of necessary libraries andor headers Check the mkmflog file for more details You may need configuration options Provided configuration options withoptdir withoutoptdir withoptinclude withoutoptincludeoptdirinclude withoptlib withoutoptliboptdirlib withmakeprog withoutmakeprog srcdir curdir rubyrubiestruffleruby bintruffleruby withrdiscountdir withoutrdiscountdir withrdiscountinclude withoutrdiscountincluderdiscountdirinclude withrdiscountlib withoutrdiscountlibrdiscountdirlib To see why this extension failed to compile please check the mkmflog which can be found here gemtruffleruby extensionsx darwin rdiscount mkmflog extconf failed exit code Gem files will remain installed in gemtruffleruby gemsrdiscount for inspection Results logged to gemtruffleruby extensionsx darwin rdiscount gemmakeout 