How to test the below condition spcreateloginrequesturlidp function err loginurl requestid if err null failure Same for the log out function spcreatelogoutrequesturl Its always sending the err null Need help writing the Jest test cases for the code jest Resolves issue This was a regression in v Return an error via callback when attributes are missing rather than throwing an exception How I expect it to work In v any SAML assertion with a missing Subject would cause an error to be caught and returned in the callback Expected Subject found This allows my SAML code to properly handle the errorrejected promise and report it back to the API consumer How it appears to be working In v Line usernameid getnameid validatedassertion If there is not exactly one subject in the SAML assertion an uncaught exception is thrown here This makes it difficult to capture what went wrong and report it back to the API consumer Steps to reproduce Send a SAML assertion with an entirely missing Subject node using a Promise return new Promiseresolve reject serviceProviderpostassertidentityProvider options function err samlresponse return err rejecterr resolvesamlresponse An exception is thrown within the node module It never returns an error to the Promise Is this intentional Suggested Fix Wrap the call to usernameid getnameid validatedassertion in a trycatch block Return the exception to the callback function Thanks Based on the conversation in I found that the Express sample in the README also has the same issue Both nameid and sessionindex are undeclared and will throw in error in strict environments Pretty straightforward fix thatll make the sample code a bit more portable When verifying a response that is both signed and encrypted the signed value may need to be decrypted after verifying the signature When using OneLogin as the IDP for example this is required to verify assertions This PR pulls in work by erm from the fork with the hope of getting it merged into the upstream This may be a dumb question but what does this function do Heres my projected SAML Logout flow Logout from site SP Send request to IdP via spcreatelogoutrequesturl IdP sees request sends encoded SAMLResponse to specified SLO endpoint SP validates the response as legitimate completes logout In this workflow I think for step youd want a function similar to redirectassert to parse and validate the response Wouldnt creating a response URL only be something an IdP would do to tell an SP the logout went successfully This is all my own thought process and Im sure Im just missing something but wanted some insight Generate logout response URL correctly in the case where the ssologouturl has a query string already This copies the code that dealt with that possibility when generating a logout request URL Add an entityid option to IdentityProvider If provided assertions are required to have an Issuer that matches this value Includes tests Hi it seems like when I try to set this flag to true and then pass it to the createloginrequesturl it doesnt do what I expect it to do My expectation was that the first time the user has to type in their login credentials into the idP servers page Then they get logged out using the createlogoutrequesturl as the user visits it the SAML session is terminated and the user will be completely logged out if they close all their browser windows This forces the user to reauthenticate by typing in their credentials next time I was hoping that forceauthn would allow me to skip the close all the browsers step in a way by just requiring the user to reauthenticate with the idP again even though they are logged in Is it a mistake in my expectations or is the flag just not working I am using a custom fork from but looking through the updates I didnt see anything that might affect the behavior of the flag Ill try and update my fork with the most recent changes anyways though Thanks Id like to pass a subject in the AuthnRequest can we add nameid to CreateLoginRequestUrlOptions