Describe the bug Using a Webhook to Discord from Matrix uploads to the mediaserver but uploads to Discord anyways and doesnt spoof the avatar or use the mediaserver link To Reproduce Steps to reproduce the behavior Set up a standard bridge between Discord and Matrix using a webhook Attempt to post something Avatar doesnt show up on the webhook If something is attached it will upload to the mediaserver but use Discord for the message anyways Expected behavior The webhook avatar is spoofed from Matrix and the file is linked to using the mediaserver Screenshotsdebug logs INFO main Enabling debug logging INFO main Running version bfa a INFO router Parsing gateway lewd INFO router Parsing gateway candy INFO router Starting bridge matrixcandymatrix INFO matrix Connecting INFO matrix Connection succeeded INFO matrix matrixcandymatrix joining candycancermatrixorg ID candycancermatrixorgmatrixcandymatrix INFO matrix matrixcandymatrix joining lewdcancermatrixorg ID lewdcancermatrixorgmatrixcandymatrix INFO router Starting bridge discordcandydiscord INFO discord Connecting INFO discord Connecting using token INFO discord Connection succeeded DEBUG discord found channel discordgoChannelID GuildID Name Cancer Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwrite UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID NameVoice Channels Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwrite UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID NameGeneral Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID NameAdmin Only Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc c discordgoPermissionOverwrite xc UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Namemusic channel Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc discordgoPermissionOverwrite xc discordgoPermissionOverwrite xc UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Namebotcommands Topic Type LastMessageID LastPinTimestamp T NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwrite UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name roles Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc c UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name disclaimer Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name newmemberlog Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc discordgoPermissionOverwrite xc d UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name partners Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc e discordgoPermissionOverwrite xc discordgoPermissionOverwrite xc UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name server information Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwrite UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Nameadministration Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwrite UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name log Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc a UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name adminonly Topic Type LastMessageID LastPinTimestamp T NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc discordgoPermissionOverwrite xc UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name general Topic Type LastMessageID LastPinTimestamp T NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name annoucements Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name bot Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwrite UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name xchan Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwrite UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name seriousdiscussion Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwrite UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name dailycute Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc discordgoPermissionOverwrite xc b discordgoPermissionOverwrite xc UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name originally TopicAll messages in this channel must be original or the bot deletes and mutes you in this channel for an exponential amount of time Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc a discordgoPermissionOverwrite xc UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name partnermanagersonly Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc c discordgoPermissionOverwrite xc f discordgoPermissionOverwrite xc UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name info Topic Type LastMessageID LastPinTimestamp NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwritediscordgoPermissionOverwrite xc b UserLimit ParentID RateLimitPerUser DEBUG discord found channel discordgoChannelID GuildID Name gotothegymfatass Topic Type LastMessageID LastPinTimestamp T NSFWfalse Icon Position Bitrate Recipients discordgoUsernil Messages discordgoMessagenil PermissionOverwrites discordgoPermissionOverwrite UserLimit ParentID RateLimitPerUser INFO discord discordcandydiscord joining general ID generaldiscordcandydiscord INFO discord discordcandydiscord joining nsfw ID nsfwdiscordcandydiscord INFO main Gateways started succesfully Now relaying messages DEBUG matrix Receiving event gomatrixEventStateKeystringnil Sendergenericspidermatrixorg Typemroommessage Timestamp IDOIoQVPmxwuT v CzudV AvYsyW OulBvz SGNvDnM RoomIDWXXQVHwSClhyWCtsoSmatrixorg Contentmap string interface bodydeviantart Webberpng infomap string interface h mimetypeimagepng size thumbnailinfomap string interface h mimetypeimagepng size w thumbnailurlmxcmatrixorgGKNrQTQbbSYhewUAMWmJBwHc w msgtypemimage urlmxcmatrixorgkkBTbVhDvCzVOwFVdvNMYlNF Redacts Unsignedmap string interface age DEBUG matrix Trying to download deviantart Webberpng with size DEBUG matrix Download OK deviantart Webberpng DEBUG matrix Sending message from genericspidermatrixorg on matrixcandymatrix to gateway DEBUG gateway mediaserver path placing file homeregalmattermedia e fddeviantart Webberpng DEBUG gateway mediaserver download URL DEBUG gateway Sending configMessageTextdeviantart Webberpng Channelcandycancermatrixorg Usernamegenericspidermatrixorg UserIDgenericspidermatrixorg Avatar Accountmatrixcandymatrix Event Protocol Gatewaycandy ParentID TimestamptimeTimewall xbf cd c ext loctimeLocation x bf f IDOIoQVPmxwuT v CzudV AvYsyW OulBvz SGNvDnM Extramap string interface file interface configFileInfoNamedeviantart Webberpng Data uint xc ee Comment URL Size Avatarfalse SHA e fd from matrixcandymatrix candycancermatrixorg to discordcandydiscord general DEBUG discord Receiving configMessageTextdeviantart Webberpng Channel general Usernamegenericspidermatrixorg UserIDgenericspidermatrixorg Avatar Accountmatrixcandymatrix Event Protocol Gatewaycandy ParentID TimestamptimeTimewall xbf cd c ext loctimeLocation x bf f ID Extramap string interface file interface configFileInfoNamedeviantart Webberpng Data uint xc ee Comment URL Size Avatarfalse SHA e fd DEBUG discord Broadcasting using Webhook DEBUG discord Processing webhook sending for message configMessageTextdeviantart Webberpng Channel general Usernamegenericspidermatrixorg UserIDgenericspidermatrixorg Avatar Accountmatrixcandymatrix Event Protocol Gatewaycandy ParentID TimestamptimeTimewall xbf cd c ext loctimeLocation x bf f ID Extramap string interface file interface configFileInfoNamedeviantart Webberpng Data uint xc ee Comment URL Size Avatarfalse SHA e fd DEBUG gateway mID discordcandydiscord DEBUG matrix Receiving event gomatrixEventStateKeystringnil Sendergenericspidermatrixorg Typemroomredaction Timestamp IDQGVHXAiDSlw vCOVbdjGIuikE xoY nnPo tBxokw RoomIDWXXQVHwSClhyWCtsoSmatrixorg Contentmap string interface Redacts IsXCR qlIjwquX rvDzXPqBCBPv yXrCUgKmfILg Unsignedmap string interface age ERROR matrix Content body is not a string nil map string interface Environment please complete the following information Alpine Linux version bfa a Additional context gatewayinout accountdiscordcandydiscord channel general gatewayinoutoptions WebhookURLsnip gatewayinout accountmatrixcandymatrix channelcandycancermatrixorg gateway namelewd enabletrue gatewayinout accountmatrixcandymatrix channellewdcancermatrixorg gatewayinout accountdiscordcandydiscord channel nsfw gatewayinoutoptions WebhookURLsnip discordcandydiscord Tokentoken Server RemoteNickFormatNICK UsrUserNametrue UseDiscriminatortrue matrixcandymatrix Server Loginsnip Passwordsnip RemoteNickFormatNICK general MediaDownloadPathpathtomediaserverdir MediaServerDownload Describe the bug I bridge matrix telegram irc mattermost and xmpp which is working in all combinations Today we had an user sending a link where the url contained a double dash Which was relayed as a single dash in the resulting formatted body on matrix side We noticed that because the link on matrix side was invalid in the first place I could reproduce that with regular text as well but hence that is no klickable link it hadnt hardly ever be noticed by us before content body Xtelegram format orgmatrixcustomhtml formattedbody Xtelegram ndash msgtype mtext To Reproduce Bridge telegram xmpp irc mattermost and matrix Send amessage containing a double dash Expected behavior in matrix you will see a message that contains the double dashes in both the formatted body as well as in the unformatted body Screenshotsdebug logs Matterbridge log entry with the essential content DEBUG gateway Sending configMessageText Channel UsernameX UserID Avatar Accounttelegramfoobar Event Protocoltelegram Gatewayfoobar ParentID TimestamptimeTimewall xbf f d ext loctimeLocation x af cfc ID Extramap string interface from telegramfoobar to matrixfoobar foobarchatmatrixorg DEBUG matrix Receiving configMessageText Channelfoobarchatmatrixorg Username Xtelegram UserID Avatar Accounttelegramfoobar Event Protocoltelegram Gatewayfoobar ParentID TimestamptimeTimewall xbf f d ext loctimeLocation x af cfc ID Extramap string interface DEBUG matrix Channel foobarchatmatrixorg maps to channel id abcdefghmatrixorg DEBUG gateway mID matrixfoobar TK jTFV EHroKM AwDBNPCzhram GHwu U yJ nYo DEBUG matrix Receiving event gomatrixEventStateKeystringnil Senderfoobarchatmatrixorg Typemroommessage Timestamp IDTK jTFV EHroKM AwDBNPCzhram GHwu U yJ nYo RoomIDabcdefghmatrixorg Contentmap string interface body Xtelegram formatorgmatrixcustomhtml formattedbody Xtelegram msgtypemtext Redacts Unsignedmap string interface age transactionidgo Environment please complete the following information OS host is debian using official docker image wimmatterbridgelatest the version you made for Matterbridge version version dev dd c Additional context general MediaServerUpload MediaServerDownload RemoteNickFormat NICKPROTOCOL OPTIONAL default megabyte MediaDownloadSize irc ircfreenode Serverircfreenodenet NickschraddelblinkundbuntChat MessageSplittrue Charsetutf mattermost mattermostschraddelblinkundbunt Serverchatschraddelblinkundbuntde Teamschraddelblinkundbunt Tokenfoobarbaz PrefixMessagesWithNicktrue xmpp xmppschraddelblinkundbunt Serverjabberschraddelblinkundbuntde Jidchatjabberschraddelblinkundbuntde Passwordfoobarbaz Mucconferencejabberschraddelblinkundbuntde NickschraddelblinkundbuntChat telegram telegramschraddelblinkundbunt Tokenfoobarbazfoobarbaz UseFirstNametrue matrix matrixschraddelblinkundbunt Server Loginschraddelblinkundbuntchat Passwordfoobarbaz NoHomeServerSuffixtrue gateway nameschraddelblinkundbunt enabletrue gatewayinout accountircfreenode channelschraddelblinkundbunt gatewayinout accountmattermostschraddelblinkundbunt channelfoobarbaz gatewayinout accountxmppschraddelblinkundbunt channelfoobarbaz gatewayinout accounttelegramschraddelblinkundbunt channel gatewayinout accountmatrixschraddelblinkundbunt channelschraddelblinkundbuntchatmatrixorg gateway namefoobarbaz enabletrue gatewayinout accountmattermostschraddelblinkundbunt channelfoobarbaz gatewayinout accountxmppschraddelblinkundbunt channelfoobarbaz gatewayinout accounttelegramschraddelblinkundbunt channel gateway namefoobarbaz enabletrue gatewayinout accountxmppschraddelblinkundbunt channelfoobarbaz gatewayinout accounttelegramschraddelblinkundbunt channel gatewayinout accountmatrixschraddelblinkundbunt channelfoobarbazmatrixorg Describe the bug Matterbridge seems to randomly pick one of the channelsgateways as some sort of catchall channel and all of the messages from other bridges are received on that channel To Reproduce Steps to reproduce the behavior Use a configuration similar to this one keybasemykeybase Teamsuperteam RemoteNickFormatNICKPROTOCOL discordmydiscord Tokenobscured Serverobscured RemoteNickFormatNICKPROTOCOL IconURL ShowEmbedstrue gateway namegateway enabletrue gatewayinout accountkeybasemykeybase channelchannela gatewayinout accountdiscordmydiscord channelchannela gatewayinoutoptions WebhookURL gateway namegateway enabletrue gatewayinout accountkeybasemykeybase channelchannelb gatewayinout accountdiscordmydiscord channelchannelb gatewayinoutoptions WebhookURL Expected behavior Correct pairing of channels on both ends of multiple gateways Environment OS linux Matterbridge version version dev Output of git revparse HEAD dd c b c cd e cdc b f Additional context Workaround create one account per gateway Is your feature request related to a problem Please describe Link previews may contain unwanted material from other protocols or waste space in Telegram when there is a titlefetcher bot in the channel that repeats the messages and shows another preview if the bot includes the domain Describe the solution youd like I wish to have the option of Matterbridge to not send link previews to Telegram as per bot API option disablewebpagepreview under sendMessage Describe alternatives youve considered I dont know Additional context I had a Discord spammer send a cockandballtorture porn video on multiple channels that then appeared at Telegram and thankfully Matterbridge was able to remove those from there after they were removed from DIscord While another moderator took care of it I remembered the Telegram bot we used previously having a feature request to do just this This pull request implements the apisocket endpoint which is a websocket x Server client mirrors apistream Client server mirrors apimessage This implements Microsoft Teams support It uses polling to check for new messages because the ChatMessagesDelta isnt working Documentation on how to setup can be found on working x Receiving and sending messages x Listening on multiple channels x Messages edited in Microsoft Teams will also be edited in bridges that support message editing mattermost slack discord x RichtextHTML messages from Microsoft Teams will be sent as Markdown to other bridges x Receiving attachments from Microsoft Teams to other bridges x Replies from mattermostslack to Microsoft Teams x Code snippets from Microsoft teams to other bridges not possible because Microsoft API limitations The nonsupported API issues are sending stuff to msteams receiving stuff from msteams mostly works Doesnt work x Messages edited in other bridges also edited in MS teams x Sending HTMLcodeblockemoji messages to Microsoft Teams they will not be rendered as such x Sending messages with attachments and images is not supported Is your feature request related to a problem Please describe When I reply to a message from Telegram the whole message gets quoted and that can be difficult to users on other protocols Describe the solution youd like FruitieXTeleIRC where I migrated to Matterbridge had an option to specify how much of the old message is quoted and I found a good size I wish I could make the quote format UserRepliedto reply restricted to characters the new message The closest to this that I have found is QuoteDisableQuoteFormat from the matterbridgetomlsample but it has no indication on how would I restrict the quote length Describe the bug When I upload a photo or picture to Telegram it appears to Discord but without the caption To Reproduce Setup a Matterbridge between Telegram and Discord using webhooks Upload a photo with caption to Telegram The photo appears at Discord without caption Expected behavior The photo sent at Telegram will appear at Discord Screenshotsdebug logs Telegram Discord I am unable to provide debug logs at this time as the debug logs are too verbose and the bot is on two very active groups at the moment and I dont know how to grep I will get back to this later Environment please complete the following information OS Ubuntu LTS Matterbridge version fe Additional context The config file contains lines so I am cutting it to only protocol and gateway configuration discordpiraatit TokenREDACTED Server UseUsernamefalse UseDiscriminatorfalse LabelD RemoteNickFormat LABEL NICK discordpiraattinuoret TokenREDACTED Server UseUsernamefalse UseDiscriminatorfalse LabelD RemoteNickFormat LABEL NICK telegramppfimatterbridge TokenREDACTED LabelT ircpirateirc NickMI NickServNickMI NickServPasswordREDACTED Serverroubaixfrpirateircnet UseTLStrue UseSASLtrue SkipTLSVerifyfalse ReplaceNicks T Telegram IgnoreNicksChanServ Bunny Tails Blackbeard PirateIRC BotServ MessageSplittrue LabelI general RemoteNickFormat LABEL NICK MediaDownloadPathvarwwwhtmlmatterbridge MediaServerDownloadREDACTED MediaDownloadSize MediaDownloadBlacklist htmlhtm IgnoreFailureOnStarttrue gateway nametesti enabletrue gatewayinout accountircpirateirc channeltest gatewayinout accountdiscordpiraatit channelID gatewayinoutoptions WebhookURLREDACTED gatewayinout accountdiscordpiraattinuoret channelID gatewayinoutoptions WebhookURL gatewayinout accounttelegramppfimatterbridge channel Would be nice to have the ability to issue commandcommand over the bridge to IRC This would allow interaction with eggdrop bots etc Currently when commandcommands are issued it simply shows it being relayed through the matterbridge bot via your nick which is ignored by IRC bots discord NickMe weather irc matterbridgebot NickMe weather what would work discord NickMe weather irc matterbridgebot NickMe requested weather irc matterbridgebot weather irc weatherbot Todays low is xxxxxxx 