Could you push the latest release to the ubuntu repo Hi team Description of the use case I am using Mcrouter for HA and failover mechanism for Memcache Both mcrouter and Memcache are deployed as kubernetes deployment and statefulset respectively We have created a service for mcrouter and Memcache as ClusterIP and a headless service respectively Now we provide the mcrouter service as Memcache endpoint for the application The command for the mcrouter pods startup is command mcrouterportserviceportnumproxies configstr pools PoolA servers MEMCACHEDPOOL route type OperationSelectorRoute operationpolicies get MissFailoverRoutePoolPoolA set AllFastestRoutePoolPoolA defaultpolicy AllSyncRoutePoolPoolA where MEMCACHEDPOOL set as memcachedpreproductionstatefulset memcachedpreproductionservice memcachedpreproductionstatefulset memcachedpreproductionservice memcachedpreproductionstatefulset memcachedpreproductionservice Issue When we try the failover for Memcache pods by deleting one of the Memcache pod as per the routing policy mcrouter must try to get the key sequentially in all the pods but it is not happening we get some errors from the application side Do you recommend any library to use as we are using gomemcache for the same Do you suggest any best practices or changes in mcrouter config Please do reply It would be great if mcrouter could provide an endpoint ootb for metricsprobing suitable for prometheus There are some clientlibs listed here I found but it does not seem maintained maybe it could be adopted Updated readme URL for memcashed to use https instead of http So I havent been able to find a quick answer to this For simplicity in our network setup we use DNS instead of IPs However sometimes we want to replace the memcached instance behind a DNS record with a new machine with a different IP address Will mcrouter reresolve a DNS record when a connection to a server fails and has to be reestablished Does mcrouter works on network layer For example haproxy which can work on layer and layer as well After receiving quit r nversion r n mcrouter crashes with message mcrouter networkMcServerSessioncpp void facebookmemcacheMcServerSessioncheckClosed Assertion pendingWritesempty failed Can be reproduced with echo e quit r nversion nc host port Stack trace from core dump x f f cb in GIraise sigsigentry at sysdepsunixsysvlinuxraisec x f f cb a in GIabort at abortc x f f cadbd in assertfailbase fmtoptimized out assertionassertionentry xe b pendingWritesempty filefileentry xe networkMcServerSessioncpp linelineentry functionfunctionentry xe e facebookmemcacheMcServerSessioncheckClosedPRETTYFUNCTION void facebookmemcacheMcServerSessioncheckClosed at assertc x f f cadc in GIassertfail assertionassertionentry xe b pendingWritesempty filefileentry xe networkMcServerSessioncpp linelineentry functionfunctionentry xe e facebookmemcacheMcServerSessioncheckClosedPRETTYFUNCTION void facebookmemcacheMcServerSessioncheckClosed at assertc x ff in facebookmemcacheMcServerSessioncheckClosed this x f f at networkMcServerSessioncpp x ff in facebookmemcacheMcServerSessiononTransactionCompleted this x f f isSubRequestoptimized out at networkMcServerSessioncpp x fecb in facebookmemcacheMcServerRequestContextMcServerRequestContext this x f f de inchrgoptimized out at networkMcServerRequestContextcpp x ffbb in follyOptionalfacebookmemcacheMcServerRequestContextStorageNonTriviallyDestructibleclear thisoptimized out at usrlocalmcrouterinstallincludefollyOptionalh follyOptionalfacebookmemcacheMcServerRequestContextStorageNonTriviallyDestructibleStorageNonTriviallyDestructible thisoptimized out inchrgoptimized out at usrlocalmcrouterinstallincludefollyOptionalh follyOptionalfacebookmemcacheMcServerRequestContextOptional thisoptimized out inchrgoptimized out at usrlocalmcrouterinstallincludefollyOptionalh facebookmemcacheWriteBufferWriteBuffer this x f f de inchrgoptimized out at networkWriteBuffercpp x f in stddefaultdeletefacebookmemcacheWriteBufferoperator thisoptimized out ptr x f f de at usrincludec bitsuniqueptrh facebookmemcacheUniqueIntrusiveListfacebookmemcacheWriteBuffer facebookmemcacheWriteBufferhook stddefaultdeletefacebookmemcacheWriteBuffer UniqueIntrusiveListlambdafacebookmemcacheWriteBuffer operatorfacebookmemcacheWriteBuffer const t x f f de closureoptimized out at mcrouterlibnetworkUniqueIntrusiveListh boostintrusivelistimplboostintrusivemhtraitsfacebookmemcacheWriteBuffer boostintrusivelistmemberhookboostintrusivelinkmodeboostintrusivelinkmodetype void void facebookmemcacheWriteBufferhook unsigned long true voidclearanddisposefacebookmemcacheUniqueIntrusiveListfacebookmemcacheWriteBuffer facebookmemcacheWriteBufferhook stddefaultdeletefacebookmemcacheWriteBuffer UniqueIntrusiveListlambdafacebookmemcacheWriteBuffer facebookmemcacheUniqueIntrusiveListfacebookmemcacheWriteBuffer facebookmemcacheWriteBufferhook stddefaultdeletefacebookmemcacheWriteBuffer UniqueIntrusiveListlambdafacebookmemcacheWriteBuffer this x f f disposer at usrincludeboostintrusivelisthpp facebookmemcacheUniqueIntrusiveListfacebookmemcacheWriteBuffer facebookmemcacheWriteBufferhook stddefaultdeletefacebookmemcacheWriteBuffer UniqueIntrusiveList this x f f inchrgoptimized out at mcrouterlibnetworkUniqueIntrusiveListh facebookmemcacheMcServerSessionMcServerSession this x f f inchrgoptimized out at networkMcServerSessionh x in facebookmemcacheMcServerSessionMcServerSession this x f f inchrgoptimized out at networkMcServerSessionh x in facebookmemcacheMcServerSessionreadDataAvailable this x f f lenoptimized out at networkMcServerSessioncpp x ac in follyAsyncSockethandleRead this x f f e d at usrlocalmcrouterpkgsfollyfollyioasyncAsyncSocketcpp x ac in follyAsyncSocketioReady this x f f e d events at usrlocalmcrouterpkgsfollyfollyioasyncAsyncSocketcpp x acb a in follyAsyncSocketIoHandlerhandlerReady this x f f e f events at usrlocalmcrouterpkgsfollyfollyioasyncAsyncSocketh x ad dfd in follyEventHandlerlibeventCallback fd events arg x f f e f at usrlocalmcrouterpkgsfollyfollyioasyncEventHandlercpp x f f c in eventbaseloop from usrlibx linuxgnulibevent so x a e in follyEventBaseloopBody this x f f c a flags ignoreKeepAlivefalse at usrlocalmcrouterpkgsfollyfollyioasyncEventBasecpp x a e in follyEventBaseloopOnce this x f f c a flags at usrlocalmcrouterpkgsfollyfollyioasyncEventBasecpp x ffe in facebookmemcachemcrouterdetailserverLoopfacebookmemcacheMemcacheRouterInfo facebookmemcacheMemcacheRequestHandler router threadIdoptimized out evb worker standaloneOpts at mcrouterServerinlh x b ee in stdfunctionvoid unsigned long follyEventBase facebookmemcacheAsyncMcServerWorker operatorunsigned long follyEventBase facebookmemcacheAsyncMcServerWorker const args args args thisoptimized out at usrincludec functional facebookmemcacheMcServerThreadstartThreadlambda operator const closure x f f c at networkAsyncMcServercpp x f f bc in from usrlibx linuxgnulibstdcso x f f afb ba in startthread arg x f f bff at pthreadcreatec x f f d d in clone at sysdepsunixsysvlinuxx cloneS I have been trying to develop a couple of changes for mcrouter and want to add proper unit tests as part of that effort As a starting point I am trying to run the existing unit tests but I keep getting failures while building the unit tests Operating System Ubuntu Branch Tags Tested So Far release release Error make mcrouternetworktest make Entering directory homestackmcroutermcrouterlibnetworktest binbash libtool tagCXX modelink g stdgnu DLIBMCFBTRACEDISABLE DDISABLECOMPRESSION Wnomissingfieldinitializers Wnodeprecated W Wall Wextra Wnounusedparameter fnostrictaliasing g O Lhomestackmcrouterinstallinstalllib ljemalloc o mcrouternetworktest mcrouternetworktestAccessPointTesto mcrouternetworktestAsyncMcClientTestSynco mcrouternetworktestCarbonMessageDispatcherTesto mcrouternetworktestCarbonMockMcTesto mcrouternetworktestCarbonQueueAppenderTesto genmcrouternetworktestCarbonTestMessageso mcrouternetworktestMcAsciiParserTesto mcrouternetworktestMcServerAsciiParserTesto mcrouternetworktestMockMco mcrouternetworktestMockMcServero mcrouternetworktestSessionTesto mcrouternetworktestSessionTestHarnesso mcrouternetworktestTestClientServerUtilo mcrouternetworktestTestMcAsciiParserUtilo liblibmcroutera liblibtestmainla libnetworklibtestutila lwangle lfizz lsodium lfolly lfizz lsodium lfolly ldl ldoubleconversion lz lssl lcrypto levent lgflags lglog Lusrlibx linuxgnu lboostcontext lboostfilesystem lboostprogramoptions lboostsystem lboostregex lboostthread lpthread pthread ldl lunwind libtool link g stdgnu DLIBMCFBTRACEDISABLE DDISABLECOMPRESSION Wnomissingfieldinitializers Wnodeprecated W Wall Wextra Wnounusedparameter fnostrictaliasing g O o mcrouternetworktest mcrouternetworktestAccessPointTesto mcrouternetworktestAsyncMcClientTestSynco mcrouternetworktestCarbonMessageDispatcherTesto mcrouternetworktestCarbonMockMcTesto mcrouternetworktestCarbonQueueAppenderTesto genmcrouternetworktestCarbonTestMessageso mcrouternetworktestMcAsciiParserTesto mcrouternetworktestMcServerAsciiParserTesto mcrouternetworktestMockMco mcrouternetworktestMockMcServero mcrouternetworktestSessionTesto mcrouternetworktestSessionTestHarnesso mcrouternetworktestTestClientServerUtilo mcrouternetworktestTestMcAsciiParserUtilo pthread Lhomestackmcrouterinstallinstalllib liblibmcroutera liblibslibtestmaina ljemalloc libnetworklibtestutila lwangle lfizz lsodium lfolly ldoubleconversion lz lssl lcrypto levent lgflags lglog Lusrlibx linuxgnu lboostcontext lboostfilesystem lboostprogramoptions lboostsystem lboostregex lboostthread lpthread ldl lunwind pthread mcrouternetworktestAsyncMcClientTestSynco In function apachethriftCompactProtocolWriterwriteBinaryfollyIOBuf const homestackmcrouterinstallinstallincludethriftlibcpp protocolCompactProtocoltcc undefined reference to apachethriftprotocolTProtocolExceptionthrowExceededSizeLimit mcrouternetworktestTestClientServerUtilo In function apachethriftCompactProtocolWriterwriteBinaryfollyIOBuf const homestackmcrouterinstallinstallincludethriftlibcpp protocolCompactProtocoltcc undefined reference to apachethriftprotocolTProtocolExceptionthrowExceededSizeLimit collect error ld returned exit status Makefile recipe for target mcrouternetworktest failed make mcrouternetworktest Error make Leaving directory homestackmcroutermcrouterlibnetworktest Steps to reproduce Build Mcrouter from source cd mcroutermcrounter Run make check I havent been able to determine whether or not these unit tests are running as part of the normal CI process Does anyone have any ideas what might be causing these failures homeubuntuhhvmthirdpartymcroutermcrouterroutesShardSplitterh error could not convert from int to const follydynamic Hi Ive been trying to dockerfile build mcrouter on a vanilla Ubuntu instance using scriptsinstallubuntu sh Boost version Found the following Boost libraries filesystem system thread chrono datetime atomic Found folly usrlocalmcrouterinstall Found YARPL usrlocalmcrouterinstall Found rsocket usrlocalmcrouterinstall Found fizz usrlocalmcrouterinstall CMake Error at CMakeListstxt findpackage Could not find a package configuration file provided by fmt with any of the following names fmtConfigcmake fmtconfigcmake Add the installation prefix of fmt to CMAKEPREFIXPATH or set fmtDIR to a directory containing one of the above files If fmt provides a separate development package or SDK be sure it has been installed Configuring incomplete errors occurred See also usrlocalmcrouterpkgsfbthriftbuildCMakeFilesCMakeOutputlog See also usrlocalmcrouterpkgsfbthriftbuildCMakeFilesCMakeErrorlog