In the wiki the colors of the balls in the urn are predefined and no new color is added in the procress But in the code new color is added to the urn under some circumstance And the new color is sampled from G However the G in the code is not a distribution not sum to When adding a new color the code sample a new color by running unituniform lambda rand toi The ratio is used as the identifer of the color What is the relationship between the ratios Really nice post I had to look at the code several times before I realized that the probability of sitting at table k which is nkna was smartly taken into account by organizing the problem as uniform picking from an array of table assignments Perhaps other people see that directly but it took me some time Maybe you can spend a few more lines on that 