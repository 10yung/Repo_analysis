How about something like this ruby Stripeapiversion Stripewithversion do StripeSetupIntentcreate usage offsession would use regardless of Stripeapiversion value end Its very easy to implement in Ruby with yield and ensure Useful to avoid doing permethod override for a ton of methods Hello Were getting the following error when attempting to pay StripeInvoicepayid stripesubscriptionlatestinvoice expand paymentintent an invoice TypeError no implicit conversion of Hash into String Usersandreirbenvversions librubygems gemsstripe libstripeapiresourcerb in escape Usersandreirbenvversions librubygems gemsstripe libstripeapiresourcerb in block in custommethod I would assume this doesnt work because StripeInvoicepay expects a positional argument for the ID while that way it cannot accept optional arguments such as expand This works when retrieving a subscription for example StripeSubscriptionretrieveid whatever expand latestinvoicepaymentintent When someone assigns to a StripeObjects attributes with an accessor ruby accountemail Or with a mass assignment ruby accountupdateattributes email We should make an effort to determine that the property assigned is actually one that exists on the resource This will prevent such problems as a buggy programs assigning to misspelled properties and then only realizing the mistake much later This will probably be done via some kind of machinereadable API manifest as with the testing stubs in Marking as future Add a mechanism for configuring an HTTP client that striperuby will use This is designed to solve such problems as Allow custom middleware to instrument requests and the like As seen in Allow an HTTP proxy to be configured without patching globals As seen in This change is pseudobreaking given that it will make significant changes to the plumbing of striperuby and theres probably a fair number of people who are anchored to the current implementation through monkey patches and the like Replaces and Would love to see this library include support for stubbed testing The aws gem does this and its pretty rad The existing third party gems like rspecstripe and striperubymock are ok but Im not overly fond of their approach to it Doesnt seem as elegant as it could be and they also tend to fall behind in terms of keeping up with the updates made to this library which makes it hard to update either library 