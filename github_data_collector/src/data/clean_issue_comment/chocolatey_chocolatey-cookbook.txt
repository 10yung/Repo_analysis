In the file installps there is an external uri dependency to download zip it needs to be made as an attribute so that we can download it from any internally hosted location zaExe JoinPath tempDir zaexe unzipMethod zip useWindowsCompression envchocolateyUseWindowsCompression if useWindowsCompression ne null and useWindowsCompression eq true WriteOutput Using builtin compression to unzip unzipMethod builtin elseif Not TestPath zaExe WriteOutput Downloading Zip commandline tool prior to extraction download zip DownloadFile zaExe Also change the logic to use archivefile for Chef and above if CHEFVERSIONtoi archivefile whatever else includerecipe zipdefault whatever zip resource end Cookbook version Chefclient version Platform Details Windows Scenario Trying to install chocolatey with chefrun or chefapply Steps to Reproduce Launched chefrun or chefapply on defaultrb Expected Result Install chocolatey on target system Actual Result On remote failed to converge and no log On local I see the log that says Generated at NameError uninitialized constant ClassChefRecipe x eee Chocolatey Downloads chocolatey recipes defaultrb in runchefrecipe Copscodechefworkstationembeddedlibrubygems gemschef universalmingw libchefapplicationapplyrb in instanceeval Copscodechefworkstationembeddedlibrubygems gemschef universalmingw libchefapplicationapplyrb in runchefrecipe Copscodechefworkstationembeddedlibrubygems gemschef universalmingw libchefapplicationapplyrb in runapplication Copscodechefworkstationembeddedlibrubygems gemschef universalmingw libchefapplicationapplyrb in run Copscodechefworkstationembeddedlibrubygems gemschefbin binchefapply in top required Copscodechefworkstationmoduleschefbinchefapply in load Copscodechefworkstationmoduleschefbinchefapply in main Description This adds an attribute to suppress the output of writing the installps file to disk It does NOT suppress the output of running the install just the initial Chef spam where it writes the entire contents to the console Issues Resolved Na Check List x All tests pass x New functionality includes testing x New functionality has been documented in the README if applicable Cookbook version Chefclient version Platform Details Windows Server Scenario Install Chocolatey from Artifactory repo instead of Chocolateyorg Steps to Reproduce We are running the Chocolatey Cookbook using the following code node chocolatey installvars chocolateyDownloadUrl includerecipe chocolateydefault Expected Result Expect the Chocolatey agent to be pulled from and then installed Actual Result Instead agent is being installed from Chocolateyorg Syntax to add URL variable looks correct but doesnt seem to be getting used Cookbook version latest Chefclient version Platform Details Scenario We are using the chocolatey cookbook in windows machines to install the windows packages we are trying to install some of windows packages via cookbook by using the chocolateypackage resource its failing in windows windows server but the same cookbook is successfully running in the windows and windows Steps to Reproduce The ChocolateyInstall install failing in windows windows server due to the following error Running handlers T ERROR Running exception handlers Running handlers complete T ERROR Exception handlers complete Chef Client failed resources updated in minutes seconds T FATAL Stacktrace dumped to Cchefcachechefstacktraceout T FATAL Please provide the contents of the stacktraceout the file if you file a bug report T FATAL ChefExceptionsMissingLibrary chocolateypackage svn sncrbamboosubversion li ne had an error ChefExceptionsMissingLibrary Could not locate your Chocolatey install To install chocolatey we recommend the chocolatey cookbook If Chocolatey is installed ensure that the ChocolateyInstall environment variable is correctly set You can verify this with the PowerShell command SystemEnvironment GetEnvironmentVariableChocolateyInstall MACHINE Expected Result We can able to install the packages via manually by using the chocolatey command but via cookbook is failing the environment test output is positive T INFO Running queued delayed notifications before reraising exception Running handlers T ERROR Running exception handlers Running handlers complete T ERROR Exception handlers complete Chef Client failed resources updated in seconds T FATAL Stacktrace dumped to cchefcachechefstacktraceout T FATAL Please provide the contents of the stacktraceout file if you file a bug report T FATAL ChefExceptionsMissingLibrary chocolateypackage svn sncrbamboosubversion li ne had an error ChefExceptionsMissingLibrary Could not locate your Chocolatey install To install chocolatey we recommend the chocolatey cookbook If Chocolatey is installed ensure that the ChocolateyInstall environment variable is correctly set You can verify this with the PowerShell command SystemEnvironment GetEnvironmentVariableChocolateyInstall MACHINE The variable check result PS C Windows system SystemEnvironment GetEnvironmentVariableChocolateyInstall MACHINE C ProgramData chocolatey So our question is this cookbook tested in windows and windows server Please need your help to fix this Regards Sunil Cookbook version Version of the cookbook where you are encountering the issue Chefclient version Version of chefclient in your environment Platform Details Operating system distribution and release version Cloud provider if running in the cloud Scenario What you are trying to achieve and you cant Steps to Reproduce If you are filing an issue what are the things we need to do in order to repro your problem How are you using this cookbook or any resources it includes Expected Result What are you expecting to happen as the consequence of above reproduction steps Actual Result What actually happens after the reproduction steps Include the error output or a link to a gist if possible Cookbook version Chefclient version Platform Details Windows Scenario Straightforward vendor of cookbook via Berks from supermarket Steps to Reproduce Depend on the latest version of this this cookbook via Berksfile and either install it directly via berks vendor or in a Kitchen Expected Result That the cookbook has the following contents Mode LastWriteTime Length Name d attributes d files d libraries d recipes a CHANGELOGmd a metadatajson a READMEmd Actual Result Cookbook is missing all folders and is only installed with the following files Mode LastWriteTime Length Name a CHANGELOGmd a metadatajson a READMEmd Version works fine and has all expected files so just locking to that for now Ive tried to fork and add this myself but I honestly dont know what Im doing its not particularly obvious tbh what looks like should work doesnt Is this already a feature if so how or could you please add this I need this so I can install ruby onto a deployment machine without breaking the ruby that gets installed with chef I plan to have a user just for running my app and only its path will contain the ruby stuff I need to get the app running I was hoping to use the node chocolatey upgrade attribute to keep the underlying chocolatey version up to date but it doesnt seem to work I think this is due to how the LWRP behaves if the version field is left blank as it is in the chocolatey chocolatey resource at the end of the default recipe Looking at the code in providersdefaultrb which runs in response to that resource packageinstalled will be true as obviously chocolatey is already installed by the installps bootstrapper We dont specify a particular version so packageexists also returns true Unfortunately upgradeable takes the latter as gospel so assumes theres nothing to do Would you accept a PR to only use currentresourceexists if the version is not blank Attempting to install IISASPNET via Chef recipe on a freshlybootstrapped stock Windows AMI I get the following text in the log Error You cannot service a running bit operating system with a bit version of DISM Please use the version of DISM that corresponds to your computers architecture The entire run is at and shows the command leading to that error at line 