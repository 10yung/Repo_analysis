Its the issue here Happens with numpy but fine with Implement GridMask augmentation from paper Bug After applying albumentationsimgaugtransformsIAAPerspective The bounding box is clearly off It suppose to include blue box as it happens in Imgaug To Reproduce Steps to reproduce the behavior Apply single augmentation with single bounding box which corresponds to a square drawn on the image to see how the box becomes off If you have a code sample error messages stack traces please provide it here as well Expected behavior Bounding box includes original area as it happens in Imgaug A clear and concise description of what you expected to happen Environment Albumentations version eg Python version eg OS eg Linux MacOS How you installed albumentations conda pip source pip Any other relevant information Additional context Add any other context about the problem here Grid distortion can crash for certain image sizes because range width xstep may produce a number of steps larger than the size of xsteps Simple repro should crash with current master import numpy as np import albumentations as ab transf abGridDistortionp numsteps x nprandomrand transfimagex Using linspace guarantees there are only numsteps steps Bug Segmentation fault is hapening when I try to use GridDistortion and ElasticTransform augmentations The problem does not happen in every execution To Reproduce Minimal reproducible example python import cv import numpy as np from albumentations import ElasticTransform GridDistortion OneOf Compose class DataAug staticmethod def getaugs grid GridDistortion distortlimit interpolationcv INTERNEAREST bordermodecv BORDERCONSTANT value alwaysapplyTrue elast ElasticTransform alphaaffine interpolationcv INTERNEAREST bordermodecv BORDERCONSTANT value alwaysapplyTrue return OneOf OneOf grid elast p Compose grid elast p p def applyself image mask aug selfgetaugs res augimageimageastypeuint maskmaskastypeuint return res res mask if name main inputa npzeros inputb npzeros image mask DataAugapplyimageinputa maskinputb printimageshape maskshape Expected behavior Code should execute without errors and print the shape of the augmented image and mask Environment Albumentations version Python version OS Ubuntu LTS How you installed albumentations Pip EDIT Apparently it happens less frequently when using python I tried in different machines all ubuntu using conda virtual env and this was the result opencv python albu OK opencv python albu not OK opencv python albu OK opencv python albu not OK but less frequent EDIT Using the trace method from this answer the last lines printed are line homegustavomaiaminiconda envstestlibpython sitepackagesalbumentationsaugmentationsfunctionalpy line homegustavomaiaminiconda envstestlibpython sitepackagesalbumentationsaugmentationsfunctionalpy Segmentation fault core dumped This PR allows using horizontal flip augmentation for keypoints in the problems where horizontal flip inverts the semantics for the keypoint Eg within pose estimation task a flipped keypoint for a left arm actually becomes a keypoint for a right arm Bug Setting labelfields to for bboxparams when creating Compose objects results in empty resulting bbox tuples after augmentationas are applied The error appeared after v for v if worker correcly The problem is caused that DataProcessordatalength is not initialized at DataProcessoraddlabelfieldstodata in this case and remains but is used at DataProcessorremovelabelfieldsfromdata to cut data Also I noted that using DataProcessordatalength implies that all datafields have the same data length An opposite case is probably seldom but will result in error To Reproduce codepython import albumentations as A import albumentationsaugmentationstransforms as T import numpy as np augslist THorizontalFlipp alb AComposeaugslist bboxparamsformat pascalvoc labelfields if you comment out this line it will operate properly img npzeros dtype npuint rects augres albimageimg bboxesrects printaugresshape augres bboxes Expected behavior in the above example Environment Albumentations version master rev c e Python version eg OS Windows How you installed albumentations git clone Additional information Ill fix it Add AdditiveNoise like MultiplicativeNoise Add warning message for shifthsv Do not use shifthsv for grayscale image Use AdditiveNoise with argument elementwiseFalse 