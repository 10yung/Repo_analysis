is the proxysqlslackcom available to join for everyone or is there an irc channel where discussionquestions can take place Create table from Mysql within sqlproxy MySQL szhtest CREATE TABLE spidermessage ENGINE MergeTree ORDER BY id AS SELECT FROM mysqlabababmysqlrdsaliyuncscom spider spidermessage user LIMIT Query OK rows affected sec MySQL szhtest select from spidermessage id rowkey key value time rows in set sec We can only see columnids data lost other columns data But now when I query it in clickhouseclient it shows ok BItableau select from spidermessage SELECT FROM spidermessage id rowkey key value time userInfoisLogin traceInfotimestamp traceInfoevent pageIn traceInfouiPath rows in set Elapsed sec Waiting for your answer Thx Description This PR fixes memory leak described in issue Clean PR Hello Found an issue with the proxysql pause function the mysqlwaittimeout value is not being changed Description of the issue mysqlwaittimeout is not set to when proxysql pause is run OS version CentOS Linux release ProxySQL version ProxySQL version g cab codename Truls Error log some parts were obfuscated for privacy reasons proxysqllog Steps to reproduce Check the value of mysqlwaittimeout on globalvariables and runtimeglobalvariables mysql select from runtimeglobalvariables where variablenamemysqlwaittimeout variablename variablevalue mysqlwaittimeout row in set sec mysql select from globalvariables where variablenamemysqlwaittimeout variablename variablevalue mysqlwaittimeout row in set sec Run proxysql pause mysql proxysql pause Query OK rows affected sec Check the value of mysqlwaittimeout on globalvariables and runtimeglobalvariables again it should have changed but didnt mysql select from runtimeglobalvariables where variablenamemysqlwaittimeout variablename variablevalue mysqlwaittimeout row in set sec mysql select from globalvariables where variablenamemysqlwaittimeout variablename variablevalue mysqlwaittimeout row in set sec Thank you for the attention Were using ProxySQL version percona on Debian and today we encountered a crash on one of our ProxySQL hosts Upon further investigation it revealed that the crash happened due to the watchdog missing heartbeats on one of our clusters MySQLMonitorcpp monitorping ERROR Server someborkedhost missed heartbeats shunning it and killing all the connections Disabling other checks until the node comes back online maincpp main ERROR Watchdog threads missed a heartbeat maincpp main ERROR Watchdog threads missed a heartbeat maincpp main ERROR Watchdog threads missed a heartbeat maincpp main ERROR Watchdog threads missed a heartbeat maincpp main ERROR Watchdog threads missed a heartbeat maincpp main ERROR Watchdog threads missed a heartbeat maincpp main ERROR Watchdog threads missed a heartbeat maincpp main ERROR Watchdog threads missed a heartbeat maincpp main ERROR Watchdog threads missed a heartbeat maincpp main ERROR Watchdog threads missed a heartbeat maincpp main ERROR Watchdog reached missed heartbeats Aborting proxysql maincpp int mainint const char Assertion failed Error signal proxysqlZ crashhandleri x a x b eda libx linuxgnulibcso x x f ae libx linuxgnulibcso gsignal xcf x f ae ffff libx linuxgnulibcso abort x a x f ae a libx linuxgnulibcso x be x f ae e libx linuxgnulibcso x bf x f ae f proxysqlmain x x b ece libx linuxgnulibcso libcstartmain xf x f ae d e proxysqlstart x a x b f a I see were not the only ones struggling with it I find the issue by Ben Mildren the most interesting one as its exactly what we encounter with one slight difference it seems that the line of shunningthe host in question prior the watchdog failing is the cause of all four threads locking up We have a core dump of proxysql that we can look into with you and we can also share our configuration with you Hi all I deploy proxysql and galeramariadb on k s using statefulset both this is my proxysqlconf datadirvarlibproxysql adminvariables admincredentialsadminOa Ulv cluster Zub neB mysqlifaces clusterusernamecluster clusterpasswordZub neB clustercheckintervalms clustercheckstatusfrequency mysqlvariables threads maxconnections defaultquerytimeout connecttimeoutserver monitorhistory monitorconnectinterval monitorusernameproxysql monitorpasswordRO eRa monitorgalerahealthcheckinterval setquerylockonhostgroup mysqlservers addressmariadbmariadb mariadbmariadbcce port hostgroup maxconnections addressmariadbmariadb mariadbmariadbcce port hostgroup maxconnections addressmariadbmariadb mariadbmariadbcce port hostgroup maxconnections mysqlusers username test password oo Qzl defaulthostgroup active username test password lRh IxS defaulthostgroup active mysqlqueryrules ruleid active matchpattern SELECT FOR UPDATE destinationhostgroup apply ruleid active matchpattern SELECT destinationhostgroup apply ruleid active matchpattern destinationhostgroup apply mysqlgalerahostgroups writerhostgroup backupwriterhostgroup readerhostgroup offlinehostgroup maxwriters writerisalsoreader maxtransactionsbehind active proxysqlservers hostname proxysql proxysql port weight hostname proxysql proxysql port weight hostname proxysql proxysql port weight when I do the failure recovery test i found that when i delete mariadbmariadb pod deliberatelynot let it start automatically In proxysql it also delete the record of mariadbmariadb in mysqlservers table But when I start mariadbmariadb again it can not come back into mysqlusers Which i want it can recover automatiically Here is the mysqlservers table when mariadb is running again it can not add mariadb into it select hostgroupidhostnamestatus from runtimemysqlservers hostgroupid hostname status mariadbmariadb mariadbmariadbcce ONLINE mariadbmariadb mariadbmariadbcce ONLINE mariadbmariadb mariadbmariadbcce ONLINE mariadbmariadb mariadbmariadbcce ONLINE the proxysql log says MySQLMonitorcpp monitorgalerathread ERROR Server mariadbmariadb mariadbmariadbcce missed Galera checks Assuming offline MySQLHostGroupsManagercpp updategalerasetoffline WARNING Galera skipping setting offline node mariadbmariadb mariadbmariadbcce from hostgroup because wont change the list of ONLINE nodes MySQLMonitorcpp monitorping ERROR Server mariadbmariadb mariadbmariadbcce missed heartbeats shunning it and killing all the connections Disabling other checks until the node comes back online mariadbmariadb mariadbmariadbcce MySQLHostGroupsManagercpp commit WARNING Removed server at address hostgroup address mariadbmariadb mariadbmariadbcce port Setting status OFFLINE HARD and immediately dropping all free connections Used connections will be dropped when trying to use the Problem description At my company we are running a Percona XtraDB Cluster solution together with ProxySQL as load balancing solution To solve data replication issues between our Percona nodes we would like to use the session property wsrepsyncwait I have tried to set the property in the connection String but the following exception is thrown in proxysql MySQLSessioncpp unabletoparsesetstatement WARNING Unable to parse unknown SET query Setting lockhostgroup Please report a bug for future enhancementsset session wsrepsyncwait Versions Operating system Debian GNULinux stretch ProxySQL version g dd ef Percona version log Steps to reproduce Add sessionVariableswsrepsyncwait to your JDBC url For example jdbcmysqlHOSTPORTDATABASENAMEcharacterEncodingutf charSetutf useSSLfalse allowPublicKeyRetrievaltrue useUnicodetrue useJDBCCompliantTimezoneShifttrue useLegacyDatetimeCodefalse serverTimezoneUTC sessionVariableswsrepsyncwait Start application and try to connect to the Proxysql instance I have also tried to set the wsrepsyncwait property using the query SET SESSION wsrepsyncwait within a connection but the same error occurs in the logs The workaround mentioned on makes the error disappear but the it doesnt activate the wsrepsyncwait function I was able to check this by executing the following query within the client application select SESSIONwsrepsyncwait This query returns If I connect directly to one of the Percona nodes it returns Problem Description In proxysql The mysql master state is intermittently changed to offlinehard state Causes the application to fail to obtain a database connection Could not open JDBC Connection for transaction nested exception is commysqljdbcexceptionsjdbc CommunicationsException Communications link failure The last packet successfully received from the server was milliseconds ago The last packet sent successfully to the server was milliseconds ago Environment configuration OSCentOS release Final proxysql g bc mysql Community app SLB proxysql proxysql mysql SLB is load balancedistribute requests to proxysql proxysql and proxysql is a cluster distributed to master and slave according to query routing rules Problem reproduced So far the time at which this error occurs is not fixed I cannot determine the cause of the mysql master state offlinehard FULL error log See attachment for details In proxysql fullproysqllog fullproxysqllog In proxysql fullproxysqllog MySQLSessioncpp handler WARNING Error during query on xxxxx user jyreportxxxxx schema jyreport Data too long for column mobile at row digesttext insert into xxxxx id regionid regionname projectid projectname insuredcompanyname customername idno mobile consumingcount refundedcount isactive activetime isbind firstconsume lastconsume balance customerstatus createdtime values UUID null now UUID null null null now UUID null null null null now INFO Cluster detected a new checksum for mysqlservers from peer version epoch checksum x F E CA C Not syncing yet INFO Cluster detected a new checksum for mysqlservers from peer version epoch checksum x ABFE F B Not syncing yet INFO Cluster checksum for mysqlservers from peer matches with local checksum x ABFE F B we wont sync mysql errlog T Note InnoDB pagecleaner ms intended loop took ms The settings might not be optimal flushed and evicted during the time T Note Aborted connection to db unconnected user monitor host Got timeout reading communication packets T Note Aborted connection to db unconnected user monitor host Got timeout reading communication packets T Note Aborted connection to db unconnected user monitor host Got timeout reading communication packets Supplementary description In proxysql it was detected that the master readonly status was which caused proxysql to set mysql master to offlinehard status forcibly killing all connections to proxysql with mysql master Only the proxysql node detects that the mysql master readonly is The proxysql node has no log report and the error has occurred multiple times on the proxysql node I dont understand why the mysql master readonly is detected as and only the proxysql node is detected Looking forward to your recovery thank you Description All currently supported session variables are moved into array Testing Tested with benchmark tools Additional tests for proxysql internal session are comming Hi renecannao for any reason every X time when the memory are very hight the ProxySQL crash by OOM I think I have been using ProxySQL for years and I suspect in this company that the intensive use of prepare statement on stored procedures and I think this is the reason img width altimagen src The version of OS thnprdproxysqlnode varlibproxysql cat etcreleaseversion NAMEAmazon Linux VERSION IDamzn IDLIKEcentos rhel fedora VERSIONID PRETTYNAMEAmazon Linux ANSICOLOR CPENAMEcpe oamazonamazonlinux HOMEURL Amazon Linux release Karoo cat etcversion No such file or directory The exact version of ProxySQL is g cab In the log file the first error is with and de second is with maincpp ProxySQLdaemonizephase ERROR ProxySQL crashed Restarting maincpp ProxySQLdaemonizephase ERROR ProxySQL crashed Restarting This is the jeprof log jeproftargz The variables MySQL none select from globalvariables variablename variablevalue mysqlshunonfailures mysqlshunrecoverytimesec mysqlqueryretriesonfailure mysqlclientmultistatements true mysqlconnectretriesonfailure mysqlconnectretriesdelay mysqlconnectiondelaymultiplexms mysqlconnectionmaxagems mysqlconnecttimeoutserver mysqlconnecttimeoutservermax mysqleventslogfilename mysqleventslogfilesize mysqleventslogdefaultlog mysqleventslogformat mysqlauditlogfilename mysqlauditlogfilesize mysqldefaultcharset utf mysqlfreeconnectionspct mysqlsessionidlems mysqlhavessl false mysqlhavecompress true mysqlclientfoundrows true mysqlmonitorenabled true mysqlmonitorhistory mysqlmonitorconnectinterval mysqlmonitorconnecttimeout mysqlmonitorpinginterval mysqlmonitorpingmaxfailures mysqlmonitorpingtimeout mysqlmonitorreadonlyinterval mysqlmonitorreadonlytimeout mysqlmonitorreadonlymaxtimeoutcount mysqlmonitorreplicationlaginterval mysqlmonitorreplicationlagtimeout mysqlmonitorgroupreplicationhealthcheckinterval mysqlmonitorgroupreplicationhealthchecktimeout mysqlmonitorgroupreplicationhealthcheckmaxtimeoutcount mysqlmonitorgalerahealthcheckinterval mysqlmonitorgalerahealthchecktimeout mysqlmonitorgalerahealthcheckmaxtimeoutcount mysqlmonitorreplicationlaguseperconaheartbeat mysqlmonitorqueryinterval mysqlmonitorquerytimeout mysqlmonitorslavelagwhennull mysqlmonitorthreadsmin mysqlmonitorthreadsmax mysqlmonitorthreadsqueuemaxsize mysqlmonitorwaittimeout true mysqlmonitorwriterisalsoreader true mysqlmaxallowedpacket mysqltcpkeepalivetime mysqlusetcpkeepalive mysqlthrottleconnectionspersectohostgroup mysqlmaxtransactiontime mysqlmultiplexing false mysqlforwardautocommit false mysqlenforceautocommitonreads false mysqlautocommitfalsenotreusable false mysqlautocommitfalseistransaction false mysqlverbosequeryerror false mysqlhostgroupmanagerverbose mysqlbinlogreaderconnectretrymsec mysqlthresholdquerylength mysqlthresholdresultsetsize mysqlquerydigestsmaxdigestlength mysqlquerydigestsmaxquerylength mysqlwaittimeout mysqlthrottlemaxbytespersecondtoclient mysqlthrottleratioservertoclient mysqlmaxconnections mysqlmaxstmtsperconnection mysqlmirrormaxconcurrency mysqlmirrormaxqueuelength mysqldefaultmaxlatencyms mysqldefaultquerydelay mysqldefaultquerytimeout mysqlqueryprocessoriterations mysqlqueryprocessorregex mysqlsetquerylockonhostgroup mysqlresetconnectionalgorithm mysqlautoincrementdelaymultiplex mysqllongquerytime mysqlquerycachesizeMB mysqlpingintervalservermsec mysqlpingtimeoutserver mysqldefaultschema informationschema mysqlpolltimeout mysqlpolltimeoutonfailure mysqlserverversion mysqlkeepmultiplexingvariables txisolationversion mysqlkillbackendconnectionwhendisconnect true mysqlclientsessiontrackgtid true mysqlsessionssort true mysqlsessionidleshowprocesslist true mysqlshowprocesslistextended mysqlcommandsstats true mysqlquerydigests true mysqlquerydigestslowercase false mysqlquerydigestsreplacenull false mysqlquerydigestsnodigits false mysqlquerydigestsnormalizedigesttext false mysqlquerydigeststrackhostname false mysqlserversstats true mysqldefaultreconnect true mysqlsslp sca mysqlsslp scert mysqlsslp skey mysqlsslp scipher mysqlstacksize mysqlinitconnect mysqlldapuservariable mysqladdldapusercomment mysqldefaultsqlmode mysqldefaulttimezone SYSTEM mysqldefaultisolationlevel READ COMMITTED mysqldefaulttransactionread WRITE mysqldefaulttxisolation READCOMMITTED mysqldefaultcharactersetresults NULL mysqldefaultsessiontrackgtids OFF mysqldefaultsqlautoisnull OFF mysqldefaultsqlselectlimit DEFAULT mysqldefaultsqlsafeupdates OFF mysqldefaultcollationconnection mysqldefaultnetwritetimeout mysqldefaultmaxjoinsize mysqlconnpollresetqueuelength mysqlminnumserverslantencyawareness mysqlstatstimebackendquery false mysqlstatstimequeryprocessor false mysqlquerycachestoresemptyresult true mysqlinterfaces tmpproxysqlsock mysqlmonitorpassword monitor mysqlmonitorusername monitor mysqlthreads mysqlservercapabilities mysqlhandleunknowncharset mysqllogunhealthyconnections true mysqlauroramaxlagmsonlyreadfromreplicas adminstatscredentials statsstats adminstatsmysqlconnections adminstatsmysqlconnectionpool adminstatsmysqlquerycache adminstatssystemcpu adminstatssystemmemory admintelnetadminifaces null admintelnetstatsifaces null adminrefreshinterval adminreadonly false adminhashpasswords true adminvacuumstats true adminclusterusername adminclusterpassword adminclustercheckintervalms adminclustercheckstatusfrequency adminclustermysqlqueryrulesdiffsbeforesync adminclustermysqlserversdiffsbeforesync adminclustermysqlusersdiffsbeforesync adminclusterproxysqlserversdiffsbeforesync adminclustermysqlqueryrulessavetodisk true adminclustermysqlserverssavetodisk true adminclustermysqluserssavetodisk true adminclusterproxysqlserverssavetodisk true adminchecksummysqlqueryrules true adminchecksummysqlservers true adminchecksummysqlusers true adminwebenabled false adminwebport adminadmincredentials adminMjLUazg Zt qRMMxdxyTpmv adminmysqlifaces adminversion g cab mysqlmaxstmtscache rows in set sec MySQL none SELECT FROM statsmysqlglobal VariableName VariableValue ProxySQLUptime ActiveTransactions ClientConnectionsaborted ClientConnectionsconnected ClientConnectionscreated ServerConnectionsaborted ServerConnectionsconnected ServerConnectionscreated ServerConnectionsdelayed ClientConnectionsnonidle Queriesbackendsbytesrecv Queriesbackendsbytessent Queriesfrontendsbytesrecv Queriesfrontendsbytessent QueryProcessortimensec Backendquerytimensec mysqlbackendbuffersbytes mysqlfrontendbuffersbytes mysqlsessioninternalbytes Comautocommit Comautocommitfiltered Comcommit Comcommitfiltered Comrollback Comrollbackfiltered Combackendchangeuser Combackendinitdb Combackendsetnames Comfrontendinitdb Comfrontendsetnames Comfrontendusedb Combackendstmtprepare Combackendstmtexecute Combackendstmtclose Comfrontendstmtprepare Comfrontendstmtexecute Comfrontendstmtclose Mirrorconcurrency Mirrorqueuelength Questions Selectsforupdateautocommit Slowqueries GTIDconsistentqueries GTIDsessioncollected Serverstableversion MySQLThreadWorkers AccessDeniedWrongPassword AccessDeniedMaxConnections AccessDeniedMaxUserConnections MySQLMonitorWorkers MySQLMonitorWorkersAux MySQLMonitorWorkersStarted MySQLMonitorconnectcheckOK MySQLMonitorconnectcheckERR MySQLMonitorpingcheckOK MySQLMonitorpingcheckERR MySQLMonitorreadonlycheckOK MySQLMonitorreadonlycheckERR MySQLMonitorreplicationlagcheckOK MySQLMonitorreplicationlagcheckERR ConnPoolgetconnlatencyawareness ConnPoolgetconnimmediate ConnPoolgetconnsuccess ConnPoolgetconnfailure generatederrorpackets maxconnecttimeouts backendlaggingduringquery backendofflineduringquery querieswithmaxlagms querieswithmaxlagmsdelayed querieswithmaxlagmstotalwaittimeus mysqlunexpectedfrontendcomquit ClientConnectionshostgrouplocked hostgrouplockedsetcmds hostgrouplockedqueries mysqlunexpectedfrontendpackets awsaurorareplicasskippedduringquery mysqlkilledbackendconnections mysqlkilledbackendqueries MyHGMmyconnpollget MyHGMmyconnpollgetok MyHGMmyconnpollpush MyHGMmyconnpolldestroy MyHGMmyconnpollreset SQLite memorybytes ConnPoolmemorybytes StmtClientActiveTotal StmtClientActiveUnique StmtServerActiveTotal StmtServerActiveUnique StmtMaxStmtid StmtCached QueryCacheMemorybytes QueryCachecountGET QueryCachecountGETOK QueryCachecountSET QueryCachebytesIN QueryCachebytesOUT QueryCachePurged QueryCacheEntries rows in set sec 