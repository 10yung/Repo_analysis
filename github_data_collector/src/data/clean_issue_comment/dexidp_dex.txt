Hi this implements an oauth connector which could be used for generic authentication following OAuth framework so client can get access to Dex resources eg forwarding auth request and performing token exchange while handling callback from Dex The list of groups is paginated default page is so when a user has more than groups only the first are retrieve This change is retrieving all the groups for a user by querying all the pages Rudimentary support for using an SQL database for authentication ie having a table of users groups and passwords Requires or something to the same effect to work with Postgres and others that use for placeholders Before the PR Dex will break if PrometheusRegistry is not provided IMHO that field doesnt need to be required unless there is a specfic reason With this PR if user is not interesting at collecting Dex metric through Prometheus one could config a Dex server without PrometheusRegistry Support for authenticating against CloudFoundry Documentation of CloudFoundry UAA server cc pivotaljwinters When Azure Active Directory is synchronized with an onpremises directory the boolean configuration parameter useOnPremSamAccountName can be set to get the onpremises samAccountName as the preferredusername claim Fixes As per comment this PR from ConcourseCI team is a rework of since the original PR is outdated and its author allowed us to continue his work cc pivotaljwinters bonifaido thanks Reflect over and walk the loaded configuration and replace any ENV keys with their corresponding environment variable but only of the whole key matches This makes it possible to include in configuration keys eg configured passwords see It also removes the possibility for injecting further JSONyaml in the middle of a document through envexpansion see On the flipside this makes it impossible to do envexpansion on anything nonstring ie numbers through environment variables as name is an invalid number Previously this was done by running the JSON through osExpandEnv which does not do escaping making it impossible to embed a anywhere in the storage or connector configurations Ive been playing with adding a SQL Posgres connector as we have internal users there To make that reusable I figured the query should be configurable say yaml connectors type sql id authdb name Internal Auth DB config connection hostlocalhost passwordtest query SELECT userId WHERE username AND pwhash crypt pwhash groupQuery But the SQL placeholders and vanish because of the environmentexpansion done in cmddexconfiggo go connConfig f if lenconnConfig data byteosExpandEnvstringconnConfig Here if err jsonUnmarshaldata connConfig err nil return fmtErrorfparse connector config v err I can see theres some vaguely related work going on in This could be fixed by forking osExpandEnv to leave unknown envs alone which would break if anyone set foo OR break out the reflectionpackage walk the configtree and check every stringkey for starting with a and matching some env name