 Provide a general summary of your changes in the Title above Description Describe your changes in detail Error was ignored when creating a new request When the endpoint url is not welformed ending without for example the get request will be nil and clientDo will segfault Motivation and Context Why is this change required What problem does it solve error out instead of segfault If it fixes an open issue please link to the issue here I have raised an issue to propose this change required My issue has received approval from the maintainers or lead with the designapproved label How Has This Been Tested Please describe in detail how you tested your changes Include details of your testing environment and the tests you ran to see how your change affects other areas of the code etc Types of changes What types of changes does your code introduce Put an x in all the boxes that apply x Bug fix nonbreaking change which fixes an issue New feature nonbreaking change which adds functionality Breaking change fix or feature that would cause existing functionality to change Checklist Go over all the following points and put an x in all the boxes that apply If youre unsure about any of these dont hesitate to ask Were here to help x My code follows the code style of this project My change requires a change to the documentation I have updated the documentation accordingly x Ive read the CONTRIBUTION guide I have signedoff my commits with git commit s I have added tests to cover my changes All new and existing tests passed Due dilligence My actions before raising this issue x Followed the troubleshooting guide x Readsearched the docs x Searched past issues issues Provide a general summary of the issue in the Title above Expected Behaviour If youre describing a bug tell us what should happen If youre suggesting a changeimprovement tell us how it should work A library that we use expects configuration files with secrets in them to have permissions or It would be nice for the default permissions for secrets exposed to be that or make them configurable Current Behaviour If describing a bug tell us what happens instead of the expected behavior If suggesting a changeimprovement explain the difference from current behavior The secrets exposed by faas have on a readonly filesystem so we cant even chmod them before using the in the handler The workaround is to copy them and chmod them at the beginning of the handler Which is not the right way to do it Your Environment Include as many relevant details about the environment you experienced the bug in FaaSCLI version Full output from faascli version CLI commit cada e bed a bdd e ca aa version Docker version docker version eg Docker Client Docker Engine Community Version API version Go version go Git commit a ea Built Wed Nov OSArch linuxamd Experimental false Server Docker Engine Community Engine Version API version minimum version Go version go Git commit a ea Built Wed Nov OSArch linuxamd Experimental false containerd Version GitCommit b a c af e c db c f fa runc Version rc dev GitCommit e f a c f e d a c b d aa dockerinit Version GitCommit fec Are you using Docker Swarm or Kubernetes FaaSnetes Kubernetes Operating System and version eg Linux Windows MacOS Linux Ubuntu Due dilligence how can i use this option addhost with faascli docker run it addhost host My actions before raising this issue Followed the troubleshooting guide Readsearched the docs x Searched past issues issues x Checked UI output CLI output both consistently wrong x Checked and codebase Expected Behaviour I have wordcount function in openfaasfn and in anotherns namespaces I invoke the wordcount function multiple times in both namespaces in my web UI portal The invocation count in the web UI shows the correct number of invocations in both namespaces And the CLI also shows same correct count as the web UI portal when function is invoked from web UI portal When CLI invokes the function using faas invoke wordcount or using faas invoke wordcount n namespace the count is shown correctly in both CLI and web UI portal Current Behaviour I invoked the wordcount function multiple times in both namespaces in my web UI portal But the invocation count in the web UI doesnt increase it shows the same count in both namespaces And the CLI also shows same count as the web UI portal when invoked from web UI portal But when CLI invokes the function using faas invoke wordcount the count increases in both CLI and web UI portal Steps to Reproduce for bugs install openfaas in k s with k sup this installs with openfaasfn as the default namespace for functions login to the gateway in the cli deploy functions in openfaasfn using this faas deploy f add another namespace in k s kubectl create ns anotherns kubectl annotate namespaceanotherns openfaas check namespaces list faas namespaces deploy wordcount function in the new namespace using the below yaml file stackyml provider name openfaas gateway can be a remote server functions wordcount lang dockerfile image functionsalpinelatest fprocess wc skipbuild true namespace anotherns faas deploy f stackyml Go to the web UI portal invoke the function in openfaasfn namespace and in anotherns namespace You will notice that the count doesnt increase in the UI and it doesnt increase in the CLI too when doing faas list or faas list n openfaasfn or faas list n anotherns Invoke the function using the CLI faas invoke wordcount faas list Also check web UI portal the count shows up now increases but is the number of CLI invocations Invoke the function using the CLI but with namespace flag You will notice count doesnt increase and is wrong faas invoke wordcount n openfaasfn faas invoke wordcount n anotherns faas list faas list n openfaasfn faas list n anotherns Context I was just trying out openfaas Noticed that my invocation count shows up wrong Your Environment FaaSCLI version Full output from faascli version CLI commit c e a d fdb f a version Gateway uri version sha b e ed b c d e commit Change how and when we fetch and parse namespace info Provider name faasnetes orchestration kubernetes version sha c f f c e bd f d f cff Docker version docker version eg Docker minikube vm docker Client Docker Engine Community Version API version Go version go Git commit a ea Built Wed Nov OSArch linuxamd Experimental false Server Docker Engine Community Engine Version API version minimum version Go version go Git commit a ea Built Wed Nov OSArch linuxamd Experimental false containerd Version v GitCommit b a c af e c db c f fa runc Version commit d ef f d a d cfc ddd a GitCommit dockerinit Version GitCommit fec Are you using Docker Swarm or Kubernetes FaaSnetes Kubernetes Operating System and version eg Linux Windows MacOS MacOS Catalina v Code example or link to GitHub repo or gist to reproduce problem Provided it all above Other diagnostic information logs from troubleshooting guide Initially I kind of assumed that the invocation count comes from prometheus later it turned out to be the truth So I was seeing Grafana and Prometheus and seeing the metrics for invocation count This is what Prometheus shows when I try what I have described above img width altprometheus metrics src You can see below how the CLI shows the number as for wordcount function in both namespaces My default is openfaasfn when nothing is provided img width altScreen Shot at PM src In prometheus the metric which has the value is this gatewayfunctioninvocationtotalappgatewaycode functionnamewordcountinstance jobkubernetespodskubernetesnamespaceopenfaaskubernetespodnamegateway c b f xhqzbpodtemplatehash c b f If you notice the functionname label value its wordcount This is the count for the number of invocations from the CLI with faas invoke wordcount And there are two other metrics with different values which relate to wordcount function gatewayfunctioninvocationtotalappgatewaycode functionnamewordcountanothernsinstance jobkubernetespodskubernetesnamespaceopenfaaskubernetespodnamegateway c b f xhqzbpodtemplatehash c b f gatewayfunctioninvocationtotalappgatewaycode functionnamewordcountopenfaasfninstance jobkubernetespodskubernetesnamespaceopenfaaskubernetespodnamegateway c b f xhqzbpodtemplatehash c b f Notice the functionname label values its wordcountanotherns and wordcountopenfaasfn This is the count of invocations that happened when I invoked in web UI But it doesnt show up as that though it shows up as img width altScreen Shot at PM src img width altScreen Shot at PM src On checking a bit of code for how the metrics comes some assumptions and intuitions based on input and output and how its all related and connecting the dots this is what I can say The key difference is how the request goes to the gateway When I do a CLI invocation faas invoke wordcount gateway log is like gateway c b f xhqzb gateway Forwarded POST to functionwordcount seconds and for following invocations faas invoke wordcount n openfaasfn or invoking in web UI portal in openfaasfn namespace the gateway log is like gateway c b f xhqzb gateway Forwarded POST to functionwordcountopenfaasfn seconds for anotherns faas invoke wordcount n anotherns or invoking in web UI portal in anotherns namespace the gateway log is like gateway c b f xhqzb gateway Forwarded POST to functionwordcountanotherns seconds The invocation count is shown using the response from the gateway for list functions API Checking the code gateway uses the following code to find the invocation count using the prometheus metrics data You can see how the metric labels function name and the function name from the provider not sure about the term are matched without considering namespace So seeing the above prometheus metrics data naturally the value will come no matter what namespace the user is looking at in CLI or web ui portal So thats one issue reading of the invocations count data I think to fix it just adding the namespace along with name like namenamespace should work And a test for it too Next issue is how did the wrong data even get into prometheus in the first place There are three sets of invocation counts but only two namespaces The metric with label functionnamewordcount is not a correct one there should always be a namespace to be specific about which namespace the count refers to even though if theres just one I guess Im right about this considering every function Must be in a namespace and its very clear that multiple namespaces is supported namespace must be part of the label value Do correct if Im missing something And checking the code the gateway is what exposes the metrics at port And prometheus scrapes these metrics Looking at the metrics data the metrics seem to be right for web UI portal invocations and for CLI invocations with namespace flag except for the one with functionnamewordcount label which got created from CLI invocations without namespace flag This is how the gateway logs look for such a case gateway c b f xhqzb gateway Forwarded POST to functionwordcount seconds Now why does this log matter The url path in this matters which is functionwordcount My guess based on the code when requests are made they go through these parts of the code functionNotifiers is here and has prometheus in it And the notify call is made here And for prometheus the implementation is here and this is where the service name is obtained And here is where the metric is created for prometheus to scrape This is all good but I think the service name will be wordcount when url is functionwordcount but it will be wordcountopenfaasfn when url is functionwordcountopenfaasfn and so metric also will be wrong The following is speculation Have to check CLI code for this To fix this I think the CLI has to make calls with namespace in the url path like functionwordcountopenfaasfn if openfaasfn is the default namespace I think this is not happening but it still works because behind the scenes even with functionwordcount as the default namespace function is taken up somehow and it all works but to make the invocation count work we might have to pull in namespaces and use the first one as the default according to this idea and then use that for the request Ill check CLI code next to understand better and also check web UI portal code and then post more here about my findings I am working on a dynamic template that uses golang task application to create handlers tests and a src folder where to run the function outside openfaas for debugging purpose Any idea to generalize this idea on every language template Here the link still under development Thanks Signedoffby Alex Ellis OpenFaaS Ltd alexellis gmailcom Provide a general summary of your changes in the Title above Description Describe your changes in detail Record metrics for invocations when they start Motivation and Context This experimental patch records metrics as invocations start so that the metrics can be used to make better scale to zero decisions in faasidler How Has This Been Tested Please describe in detail how you tested your changes Include details of your testing environment and the tests you ran to see how your change affects other areas of the code etc Tested with Kubernetes on a singlenode cluster metrics reported as expected Existing metrics still report Types of changes What types of changes does your code introduce Put an x in all the boxes that apply Bug fix nonbreaking change which fixes an issue x New feature nonbreaking change which adds functionality Breaking change fix or feature that would cause existing functionality to change Join us for the OpenFaaS rd birthday with an online Community Meeting Well have demos from TeamServerless and an update on the year so far QAfn n jpglarge Date th Dec GMT Join the event via Google Calendar Or on the day via Zoom Meeting ID Please if youre attending And checkout GitHub Sponsors for OpenFaaS to support Open Source in Description There is no way to change the name of the nats cluster id used for asynchronous invocation Currently it expects the cluster id to be faascluster Note that the queueworker does allow the cluster id to be overridden Proposal Add environment override to gateway default it to faascluster Due dilligence My actions before raising this issue x Followed the troubleshooting guide x Readsearched the docs x Searched past issues issues Provide a general summary of the issue in the Title above I hope to implement a function that can access the files in the host I know this idea may violate the original intention of FaaS but I think this requirement is very important in the design of singlenode microservices Does OpenFaas support such a setting For example do we need to modify the resource configuration file of k s Or modify the source code Expected Behaviour If youre describing a bug tell us what should happen If youre suggesting a changeimprovement tell us how it should work The host where the function runs has a stable and longterm shared directory and the function can access it directly in the code to get files Current Behaviour If describing a bug tell us what happens instead of the expected behavior If suggesting a changeimprovement explain the difference from current behavior I have used VOLUME instruction in the Dockfile in the language template to specify a shared path for function there is a stable path to access but for the host the shared directory path changes every time the container starts For application purpose I hope the path on the host does not change I took a look at the source code of OpenFaas but I have no idea how to do Possible Solution Not obligatory but suggest a fixreason for the bug or ideas how to implement the addition or change Maybe I should modify some resource configuration file or some operation of pod in the source code of OpenFaas Your Environment Include as many relevant details about the environment you experienced the bug in FaaSCLI version Full output from faascli version Docker version docker version eg Docker Are you using Docker Swarm or Kubernetes FaaSnetes Kuberneteskubeadm kubectl and kubelet are all v Operating System and version eg Linux Windows MacOS Linux Signedoffby Burton Rheutan rheutan gmailcom Provide a general summary of your changes in the Title above Description Describe your changes in detail Add video links to Kubecon talks in the community file Some of the talks were already present with a link to the event so Ive just added an additional link to the existing row for the video so as not to lose the event information If youd rather have duplicated records one for the event and one for the video Im happy to refactor this change Perhaps the video link could go into the writeups section with some of the other videos Motivation and Context Why is this change required What problem does it solve If it fixes an open issue please link to the issue here I have raised an issue to propose this change required X My issue has received approval from the maintainers or lead with the designapproved label Spoke with Alex via Slack How Has This Been Tested Please describe in detail how you tested your changes Include details of your testing environment and the tests you ran to see how your change affects other areas of the code etc Verified the links were functional and previewed the markdown rendering with VSCode Types of changes What types of changes does your code introduce Put an x in all the boxes that apply X Bug fix nonbreaking change which fixes an issue New feature nonbreaking change which adds functionality Breaking change fix or feature that would cause existing functionality to change Checklist Go over all the following points and put an x in all the boxes that apply If youre unsure about any of these dont hesitate to ask Were here to help X My code follows the code style of this project X My change requires a change to the documentation X I have updated the documentation accordingly X Ive read the CONTRIBUTION guide X I have signedoff my commits with git commit s I have added tests to cover my changes X All new and existing tests passed 