 TinygetInstancesourcebitmapDrawasBitmapwithOptionsoptionscompressisSuccess bitmap t if isSuccess else TinyFileCompressOptions options new TinyFileCompressOptions optionssize optionsisKeepSampling false FileWithBitmapResult result TinygetInstancesourcefilePathasFilewithOptionsoptionscompressWithReturnBitmapSync return resultbitmap demo gei public static Bitmap shouldKeepSamplingUri uri final TinyFileCompressOptions options throws Exception if uri null return null final Bitmap result null if UriUtilisNetworkUriuri HttpUrlConnectionFetcherfetchuri new HttpUrlConnectionFetcherResponseCallback Override public void callbackInputStream is byte decodeBytes CompressKittransformToByteArrayis if optionsisKeepSampling BitmapFactoryOptions decodeOptions CompressKitgetDefaultDecodeOptions decodeOptionsinPreferredConfig optionsconfig result BitmapFactorydecodeByteArraydecodeBytes decodeByteslength decodeOptions else result BitmapCompressorcompressdecodeBytes options true else if UriUtilisLocalContentUriuri UriUtilisLocalFileUriuri String filePath UriUtilgetRealPathFromUriuri if TextUtilsisEmptyfilePath return null if ConditionsfileIsExistfilePath ConditionsfileCanReadfilePath FileInputStream fis null File file new FilefilePath try fis new FileInputStreamfile byte decodeBytes CompressKittransformToByteArrayfis if optionsisKeepSampling BitmapFactoryOptions decodeOptions CompressKitgetDefaultDecodeOptions decodeOptionsinPreferredConfig optionsconfig result BitmapFactorydecodeByteArraydecodeBytes decodeByteslength decodeOptions else result BitmapCompressorcompressdecodeBytes options true finally try if fis null fisclose catch IOException e ignore return result Android Q new File private static Application getApplication Application application null Method method try method ClassforNameandroidappAppGlobalsgetDeclaredMethodgetInitialApplication methodsetAccessibletrue application Application methodinvokenull catch Exception e try method ClassforNameandroidappActivityThreadgetDeclaredMethodcurrentApplication methodsetAccessibletrue application Application methodinvokenull catch Exception ex exprintStackTrace return application android Q P libtinyso unused DT entry type x ffffffe arg x f libtinyso unused DT entry type x fffffff arg x eglMakeCurrent xa afa ver Bitmap format RGBA width height Fatal signal SIGILL code fault addr xa e f in tid pool thread val options TinyFileCompressOptions val result TinygetInstance sourcephoto asFile withOptionsoptions compressSync if resultsuccess Fileresultoutfile else photo M OOM false OOM Update for this version Open source c compression code Add synchronous compression Add compressed directory Settings