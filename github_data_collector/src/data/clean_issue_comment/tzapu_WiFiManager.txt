This is relates to the ArduinoJson changes I took what bigjohnson did in a and just added a define UseJsonV option that can be commented out if you want to use ArduinoJsonV Tested on ArduinoJson V and ArduinoJson V Latest as at This also links to and x update examples to be compatible with future arduinojson library x Maybe add support in the example in question for both versioons somehow x Can also Close saveConfigCallback is not called in the scenario where you configure STA but offline so you do not really connect just preconfigure it and save Hardware WiFimanager BranchRelease X Master Development Esp Esp ESP X ESP Hardware ESP e esp esp ESP ESP EFS nodemcu wemos feather X Other ESP Core Version staging X staging masterdev Description Assuming the manager starts in AP and exposes configuration portal if you implement it the way presented in the AutoConnectWithFSParameters then you enter blind configuration without being able to connect in STA to the configured infrastructure AP the flag to trigger saveConfigCallback is never set thous wont let you save custom parameters Meanwhile saving of the SSID and password to the infrastructure AP is being saved thus it is inconsistent Steps to reproduce start in AP mode expose configuration portal connect to it configure data for nonexisting or offline infrastructure AP you want to connect to click save Code include FSh include SPIFFSh include Arduinoh include AdafruitSensorh include DHTh include DHTUh include WiFih include ESPAsyncWebServerh include ESPAsyncWiFiManagerh include ArduinoJsonh Warning only versions prior are compatible define formatSPIFFS Force SPIFFS format Local AP section define APPASSWORD alamakota DHT Sensor section define DHTPIN define DHTTYPE DHT define MQTTTopicCommon itsilesiashowroom define MQTTTopicTemperature temperature define MQTTTopicHumidity Humidity DHTUnified dhtDHTPIN DHTTYPE uint t delayMS s Extra config parameters char mqttserver char mqttport char customDeviceId dev char mqttuser char mqttpass flag for saving data bool shouldSaveConfig false bool forceRestart false services AsyncWebServer server DNSServer dns Callbacks void saveConfigCallback SerialprintlnShould save config shouldSaveConfig true void setup Serialbegin dhtbegin Serialprintln Serialprintln if SPIFFSbegin Serialprintlnmounted file system if SPIFFSexistsconfigjson file exists reading and loading Serialprintlnreading config file File configFile SPIFFSopenconfigjson r if configFile Serialprintlnopened config file sizet size configFilesize Allocate a buffer to store contents of the file stduniqueptrchar bufnew char size configFilereadBytesbufget size DynamicJsonBuffer jsonBuffer JsonObject json jsonBufferparseObjectbufget jsonprintToSerial if jsonsuccess Serialprintln nparsed json strcpymqttserver json mqttserver strcpymqttport json mqttport strcpycustomDeviceId json customdeviceid strcpymqttuser json mqttuser strcpymqttpass json mqttpass else Serialprintlnfailed to load json config else SerialprintlnNo config file else Serialprintlnfailed to mount FS SPIFFSformat SerialprintlncustomDeviceId Serialprintlnmqttuser Serialprintlnmqttpass end reading config file AsyncWiFiManagerParameter custommqttserverserver mqtt server mqttserver AsyncWiFiManagerParameter custommqttportport mqtt port mqttport AsyncWiFiManagerParameter customdeviceiddeviceid device ID customDeviceId AsyncWiFiManagerParameter custommqttuseruser mqtt user mqttuser AsyncWiFiManagerParameter custommqttpasspass mqtt password mqttpass AsyncWiFiManager wifiManager server dns wifiManagersetDebugOutputfalse wifiManagersetSaveConfigCallbacksaveConfigCallback wifiManageraddParameter custommqttserver wifiManageraddParameter custommqttport wifiManageraddParameter customdeviceid wifiManageraddParameter custommqttuser wifiManageraddParameter custommqttpass wifiManagersetTimeout if wifiManagerautoConnectitSilesiaSensor APPASSWORD Serialprintlnfailed to connect and hit timeout delay reset and try again or maybe put it to deep sleep forceRestart true strcpymqttserver custommqttservergetValue strcpymqttport custommqttportgetValue strcpycustomDeviceId customdeviceidgetValue strcpymqttuser custommqttusergetValue strcpymqttpass custommqttpassgetValue Work save parameters otherwise if configuring offline shouldSaveConfig true save parameters if shouldSaveConfig Serialprintlnsaving config DynamicJsonBuffer jsonBuffer JsonObject json jsonBuffercreateObject json mqttserver mqttserver json mqttport mqttport json customdeviceid customDeviceId json mqttuser mqttuser json mqttpass mqttpass File configFile SPIFFSopenconfigjson w if configFile Serialprintlnfailed to open config file for writing jsonprintToSerial jsonprintToconfigFile configFileclose end save if forceRestart SerialprintlnRestarting ESPrestart delay Serialprintlnlocal ip SerialprintlnWiFilocalIP void loop delaydelayMS if WiFistatusWLCONNECTED reset and try again or maybe put it to deep sleep ESPrestart Delay between measurements Get temperature event and print its value sensorseventt event dhttemperaturegetEvent event if isnaneventtemperature SerialprintlnFError reading temperature else SerialprintFTemperature Serialprinteventtemperature SerialprintlnF C Get humidity event and print its value dhthumiditygetEvent event if isnaneventrelativehumidity SerialprintlnFError reading humidity else SerialprintFHumidity Serialprinteventrelativehumidity SerialprintlnF Hi Is it possible to add multiple Param Pages Say I want to have two separate param pages wifiManageraddParameter updateFrequency wifiManagersetSaveParamsCallbacksaveUpdateFrequencyParamCallback wifiManageraddParameter updateHumidityOffset wifiManagersetSaveParamsCallbacksaveUpdateHumidityOffsetParamCallback If I call param in the menu it shows the first parameter updateFrequency in both pages when testing code stdvectorconst char menu wifiinfo sep param param seprestartexit Thank you Basic Info Hardware WiFimanager BranchRelease Beta Master x Development Esp Esp ESP x ESP Hardware ESP e esp esp ESP ESP EFS nodemcu wemos feather Other x ESP Wroom DevKit ESP Core Version staging staging masterdev x esp by Espressif Description Hello Im trying to use WiFiManager with predefined WiFi credentials when I use ESP in my office and still be able to connect to WiFi when Im somewhere else Code below works when my office AP is ON predefined credentials in my code WM AutoConnect WM ESP event handler enabled WM AutoConnect ESP Already Connected WM STA static IP WM setSTAConfig static ip not set WM AutoConnect SUCCESS WM STA IP Address connectedyeey WiFiManager is not making its own AP to configure credentials so everything is fine When my office AP is OFF when ESP restarts there is a bug WiFiManager makes its own AP as it should I can go to Web interface etc But if I do nothing in Web interface turn on my predefined office AP and restart ESP it wont connect to it but instead WiFiManagers AP is created again and again To overcome the issues I need to go to WiFiManagers portal Info Remove WiFi credentials then after restart it successfully connects to the predefined office AP Settings in IDE Module ESP Dev Module Sketch cpp include Arduinoh include WiFih include WiFiManagerh define WIFISSID MYOFFICEAP define WIFIPASSWORD MYOFFICEAPPASSWORD void setup WiFiManager wm WiFibeginWIFISSID WIFIPASSWORD delay bool res res wmautoConnectWiFiManagerAPWiFiManagerAPPass password protected ap ifres SerialprintlnFailed to connect ESPrestart else if you get here you have connected to the WiFi Serialprintlnconnectedyeey void loop Serial output during the issue WM AutoConnect WM ESP event handler enabled WM Connecting as wifi client WM STA static IP WM setSTAConfig static ip not set WM WIFI station disconnect WM Connecting to SAVED AP MYOFFICEAP WM Using Password MYOFFICEAPPASSWORD WM WM EVENT WIFIREASON WiFi station enable WM connectTimeout not set ESP waitForConnectResult WM Connection result WLCONNECTFAILED WM lastconxresulttmp WLSTATIONWRONGPASSWORD WM lastconxresult WLSTATIONWRONGPASSWORD WM AutoConnect FAILED WM Starting Config Portal WM AccessPoint set password is VALID WM XXXXXXX WM WIFI station disconnect WM WiFi station enable WM Disabling STA WM Enabling AP WM StartAP with SSID WiFiManagerAP WM SoftAP Configuration WM WM ssid WiFiManagerAP WM password WiFiManagerAPPass WM ssidlen WM channel WM authmode WM ssidhidden WM maxconnection WM country CN WM beaconinterval ms WM WM AP IP address WM setupConfigPortal WM Starting Web Portal WM dns server started with ip WM HTTP server started WM WiFi Scan ASYNC completed in ms WM WiFi Scan ASYNC found WM WiFi Scan completed in ms WM Config Portal Running blocking waiting for clients The enable parameter is unused and if compiling where warnings are treated as errors this causes a failure added option to create standalone Access Points AP instead of joining an existing one merged options Configure WiFi and Configure WiFi no scan into Join network User can still configure custom wify entry just ignoring scanned ones and inserting SSID and password into respective fields Add security to endpoints make sure things are not available menu can be hidden but we do not disable the handles users can still use all forms etc Suggest implementing this in conjunction with secure api I just realized there is no issue for this PR feature This is added to the OTA branch as a test for now I was going to abstract it out into an example but I might just leave it in and fix it up This is available by adding it to the menu and is active in the DEV example It is available if you add it token is update to the menu C stdvectorconst char menu wifiinfoparamupdatecloseseperaserestartexit wmsetMenumenu custom menu pass vector add permissions make hookroute disabled not just menu find a good way to document this as it does not work via captive portals maybe even hide it Better handling of update success Master ESP ESP ESP Core Version Hi tzapu maybe this has already been in the forum but I couldnt find it I am working on a project with the option to read data via the internet now my question is that i want the entire wifi manager wifi to be switched off after a certain time if it is not cofigured by the user the only thing I can find is a timeout for the config portal in brief I get stuck with the code if the WiFi is not set here I want to give the user minutes to configure the WiFi after minutes the device must simply execute its code without wifi maybe you can help me Code void setupvoid Serialbegin pinModeLEDBUILTIN OUTPUT Wirebegin change hardware I C pins to D D int chk DHTreaddht pinModeRELAY OUTPUT digitalWriteRELAY Turns Relay On digitalWriteLEDBUILTIN LOW u g begin init display Versie firmware u g clearBuffer clear the internal memory u g setFontu g fonthelvB tr u g drawStr JDJ electronics u g drawStr Model DM u g drawStr Firmware v u g drawStr firmware date u g drawStr u g setCursor u g setFontu g fonthelvB tf u g printchar copyright karakter u g sendBuffer transfer internal memory to the display delay Wifi setup oled u g clearBuffer clear the internal memory u g setCursor u g setFontu g fontopeniconicwww xt u g printchar WIFI icon u g setFontu g fonthelvB tr u g drawStr Connect to u g drawStr JDJDM u g sendBuffer transfer internal memory to the display WiFiManager wifiManager wifiManagerautoConnectJDJDM wifiManagersetConfigPortalTimeout ifwifiManagerautoConnect Serialprintlnfailed to connect and hit timeout delay reset and try again or maybe put it to deep sleep ESPreset SerialprintlnConnected digitalWriteLEDBUILTIN HIGH serverbegin serveron handleOnConnect serveronNotFoundhandleNotFound serverbegin SerialprintlnHTTP server started SerialprintlnWiFilocalIP Connected Succes u g clearBuffer clear the internal memory u g setCursor u g setFontu g fontopeniconicwww xt u g printchar WIFI icon u g setFontu g fonthelvB tr u g drawStr Connected u g setCursor u g printWiFilocalIP u g sendBuffer transfer internal memory to the display delay Check up u g clearBuffer clear the internal memory u g setCursor u g setFontu g fontopeniconicembedded xt u g printchar tandwiel u g setFontu g fonthelvB tr u g drawStr DMCHECK u g drawStr WAIT u g sendBuffer transfer internal memory to the display delay Volt check up u g clearBuffer clear the internal memory u g setCursor u g setFontu g fontopeniconicembedded xt u g printchar tandwiel u g setFontu g fonthelvB tr u g drawStr VOLTAGE u g drawStr CHECK u g sendBuffer transfer internal memory to the display delay Check compleet u g clearBuffer clear the internal memory u g setCursor u g setFontu g fontopeniconiccheck xt u g printchar vinkje iccon u g sendBuffer delay Yours sincerly Jelmer de Jong Basic Infos Hardware WiFimanager BranchRelease Master x Development Esp Esp ESP x ESP Hardware ESP e esp esp ESP ESP EFS nodemcu wemos feather x Other ESP Core Version current Description There is a problem with WiFiConnections of ESP in combination with certain routersAPs The issue is described here A WiFi connection can only be established on every second attempt A far as I know the reason for that bug is still unknown There are some workarounds for that problem but they are not perfect and they dont work using WiFiManager WiFiManager with saved credentials connects only every second time the other times it starts the ESP AP with the captive portal If youre facing this ESP issue you cant use WifiManager I know that this issue isnt caused by WifiManager itself but Id like to ask if a workaround for that issue could be implemented or how I could use WifiManager anyway 