 x a possible bug This is not a very serious problem however it is on the one hand inconvenient and on the other hand a little troubleprone for careless users if there are predictors in a model that are factors rows and columns in a matrix returned by vcovmarginsobject have different order than what summarymarginsobject returns This makes hard to use vcovmarginsobject while calling vcov is widespread method of getting coefficients variances and if someone is not aware about this happens he may end up using wrong variancescovariances with respect to given AMEs R load package librarymargins requiredatasets code goes here x lmmpg wt factorcyl hp data mtcars mrg marginsx vcovmrg summarymrgAME cbindvcovrownames subdydx rownamesvcovmrg AMEsnames namessummarymrgAME session info for your system sessionInfo R version Platform x w mingw x bit Running under Windows x build Matrix products default locale LCCOLLATEPolishPoland LCCTYPEPolishPoland LCMONETARYPolishPoland LCNUMERICC LCTIMEPolishPoland attached base packages stats graphics grDevices utils datasets methods base other attached packages margins loaded via a namespace and not attached MASS compiler tools datatable prediction It seems appealing to do something with this is about line in buildmarginsR if variables object could get the proper order in that place everything afterwards should preserve this order However Im not sure from where to get a proper order of terms perhaps findtermsinmodel should be modified so it would include this order in an object it returns x a suggested code or documentation change improvement to the code or feature request If a simple coef method for margins objects would be added to the package it will enable for example easy computation of AMEs on multiply imputed datasets using package mitools I think it may look as simply as R export coefmargins functionobject summaryobjectAME Please specify whether your issue is about a possible bug x a question about package functionality a suggested code or documentation change improvement to the code or feature request Thanks for making this package its really useful Im having an issue when I try to use the margins command on my data I get the error message R Error cannot allocate vector of size Gb My dataset is pretty large the csv of raw data is GB and the regression model object is GB when I save it as a rds file Do you have any tips for getting around this issue so that I can use the package For more context Ill provide some sample dataa description of what Im trying to get at This code doesnt reproduce the error since it isnt as large as my data but Im hoping you can tell me if Im making a coding error that might be contributing to the vector size issue Basically I want to calculate the marginal effect of a binary categorical variable over time in several different states in the US Heres some sample data R Load packages librarylme librarymargins libraryfastDummies Make data setseed df dataframeyear rep each state repcmontana idaho colorado wyoming utah times each siteid asfactorrep times catvariable asfactorrep times each indcontvariable rnorm mean sd eventoccurred asfactorsamplec replace TRUE size Add dummy columns for states df dummycolsdf selectcolumns state removefirstdummy TRUE and a model Im interested in the effect of the catvariable on eventoccurred in a given year R fitdf glmereventoccurred indcontvariable catvariableyear state siteid data df family binomiallink logit nAGQ control glmerControloptimizer nloptwrap And then to get the marginal effect of for example the catvariable in each year R annualeffect summarymarginsfitstate at listyear variables catvariable data df dfstate colorado This last chunk of code is where I get the issue with the vector size Any ideas how I can get around this Also if I wanted to get the marginal effect of the catvariable across the time series in each state rather than just for Colorado how would I do that Possible bug Please excuse me if I dont follow all the rules correctly its my first time posting here I ran into this problem since I specify some continious covariates in a glmer by using fractional polynomials To identify the issue I compared the behavour of margins between a glm and a glmer I found If you specify a model where a covariate is only included in the formula as a functional form than a problem seems to occur in identification of the class of the variable Therefore dydx does not seem to work properly This problem occurs in glmer but not in glm I was not able to reproduce the exact same error message I found with my data using the InstEval data from lme but I believe the underlying problem is the same The following example does not produce an error but results in an empty margins object R load packages librarylme librarymargins centering continous predictor InstEvaly InstEvaly meanInstEvaly attachInstEval testglm glmservice y Iy familybinomial testglmer glmerservice y Iy deptfamilybinomiallinklogit margglm marginstestglm margglmer marginstestglmer testglm glmservice Iy familybinomial testglmer glmerservice Iy deptfamilybinomiallinklogit margglm marginstestglm margglmer marginstestglmer margglm margglmer session info for your system sessionInfo What happens margglmer marginstestglmer results in Warning messages In dydxdefaultX i Class of variable y is unrecognized Returning NA In dydxdefaultX i Class of variable y is unrecognized Returning NA In dydxdefaultX i Class of variable y is unrecognized Returning NA In dydxdefaultX i Class of variable y is unrecognized Returning NA And margglmer is a data frame with columns and rows SessionInfo R version Platform x w mingw x bit Running under Windows x build Matrix products default locale LCCOLLATEGermanGermany LCCTYPEGermanGermany LCMONETARYGermanGermany LCNUMERICC LCTIMEGermanGermany attached base packages stats graphics grDevices utils datasets methods base other attached packages margins lme Matrix loaded via a namespace and not attached minqa MASS compiler tools Rcpp splines nlme grid datatable nloptr boot lattice prediction Maybe there is a way to get around this problem by providing the class of the respective variables to the function Best Daniel The fixest package is a newish package for estimating OLS and GLM models with fixed effects It would be lovely if margins supported it There are already predict and vcov methods which should make things easier for anyone who wants to take this up Ref CC grantmcdermott Please specify whether your issue is about a possible bug a question about package functionality x a suggested code or documentation change improvement to the code or feature request Put your code here r librarymargins libraryfixest x fixestfeolsmpg hp wt cyl data mtcars marginsx Error in termsdefaultmodel no terms component nor attribute headpredictx vcovx hp wt hpwt hp e e wt e e hpwt e e attrtype Clustered cyl supCreated on by the reprex package v sup Note that by default fixest clusters by the fixed effects and different clustering can be specified as arguments to summary or vcov Im not sure what approach margins wants to take here Please specify whether your issue is about x a possible bug a question about package functionality a suggested code or documentation change improvement to the code or feature request R load package librarymargins code goes here librarymargins y rbinomn x rnorm x runif x x simdat dataframecbindy x x x mylogit glmy x x x data simdat family binomiallink logit sumout summarymarginsmylogit There were warnings use warnings to see them printsumout factor AME SE z p lower upper x NA NA NA NA NA x NA NA NA NA NA x NA NA NA NA NA mylogit Call glmformula y x x x family binomiallink logit data simdat Coefficients Intercept x x x NA Degrees of Freedom Total ie Null Residual Null Deviance Residual Deviance AIC vcovmylogit Intercept x x x Intercept NA x NA x NA x NA NA NA NA coefmylogit Intercept x x x NA marginsmylogit Average marginal effects glmformula y x x x family binomiallink logit data simdat x x x There were warnings use warnings to see them R session info for your system sessionInfo R version Platform x w mingw x bit Running under Windows x build Service Pack Matrix products default locale LCCOLLATEEnglishUnited Kingdom LCCTYPEEnglishUnited Kingdom LCMONETARYEnglishUnited Kingdom LCNUMERICC LCTIMEEnglishUnited Kingdom attached base packages stats graphics grDevices utils datasets methods base other attached packages margins loaded via a namespace and not attached MASS compiler datatable prediction x a possible bug a question about package functionality a suggested code or documentation change improvement to the code or feature request r libraryMASS librarymargins Simulate dataset n u rnormn X u rnormn X u rnormn Ystar X X rnormn Y cutYstar dat dataframeX X Y Ystar Estimate mod polrY X X data dat marginsmod unitses FALSE Refitting to get Hessian Average marginal effects polrformula Y X X data dat X X marginsmod unitses TRUE Refitting to get Hessian Error in jacobian vcov nonconformable arguments supCreated on by the reprex package v sup traceback diagjacobian vcov tjacobian FUNX i lapplyseqlennrowdata functiondatarow FUN gradientfactorydata data datarow model model variables variables type type weights weights eps eps varslist varslist jacobian jacobianFUN coefmodel namescoefmodel in cIntercept colnamesvcov weights weights eps eps diagjacobian vcov tjacobian docallrbind lapplyseqlennrowdata functiondatarow FUN gradientfactorydata data datarow model model variables variables type type weights weights eps eps varslist varslist jacobian jacobianFUN coefmodel namescoefmodel in cIntercept colnamesvcov weights weights eps eps diagjacobian vcov tjacobian buildmarginsmodel model data datalist i variables variables type NULL vcov vcov vce vce iterations iterations unitses unitses eps eps varslist varslist marginspolrmod unitses TRUE marginsmod unitses TRUE margins fails in a situation when in a model there is a factor variable with some unused levels R load package librarymargins code goes here mtcarsgear factormtcarsgear csortuniquemtcarsgear level not in the data tablemtcarsgear m lmhp gear mtcars marginsm session info for your system R version Platform x w mingw x bit Running under Windows x build Matrix products default locale LCCOLLATEPolishPoland LCCTYPEPolishPoland LCMONETARYPolishPoland LCNUMERICC LCTIMEPolishPoland attached base packages stats graphics grDevices utils datasets methods base other attached packages margins loaded via a namespace and not attached MASS compiler tools datatable prediction Thats is because dydx while calling for predictions goes through all the levels of a factor no matter they occur in a data on which model was estimated or not But in this latter situation model obviously gives no information needed to compute a prediction I think that simply adding droplevels in line of a file dydxR should work R levs levelsdroplevelsasfactordata variable margins S method for svyglm object now requires providing design object as an additional argument This causes trouble if there are missings in some variable included in a model R load package librarymargins librarysurvey dataapi code goes here dstrat svydesignid stratastype weightspw dataapistrat fpcfpc m svyglmgrowth target dstrat marginsm design dstrat not sure why there are times more rows reported in error message but in general error seems to be a consequence of observations in apistrattarget being NAs summaryisnaapistrattarget session info for your system R version Platform x w mingw x bit Running under Windows x build Matrix products default locale LCCOLLATEPolishPoland LCCTYPEPolishPoland LCMONETARYPolishPoland LCNUMERICC LCTIMEPolishPoland attached base packages grid stats graphics grDevices utils datasets methods base other attached packages margins survey survival Matrix loaded via a namespace and not attached MASS compiler DBI tools splines datatable lattice prediction mitools Importantly providing survey design object as an argument to margins seems completely unnecessary as it is included in a svyglm object and it is already restricted only to observations included in estimation please run R msurveydesign nrowmsurveydesign So simple solution should be replacing lines in marginssvyglmR with something like R wts weightsmodelsurveydesign Hi Thomas Hope you are well I noticed that the cplot function in margins doesnt appear to work when the data one passes to lm is a datatable instead of a dataframe Perhaps you are already aware but its caught me out a couple of times now Thanks Jack Please specify whether your issue is about X a possible bug a question about package functionality a suggested code or documentation change improvement to the code or feature request If you are reporting a bug or a question about code please supply a fully reproducible example using a publicly available dataset or provide your data if an error is occurring include the output of traceback run immediately after the error occurs the output of sessionInfo Put your code here R load package librarymargins librarydatatable x rnorm z samplecT F y rnorm mydt datatablexyz mydf dataframexyz dtmod lmy xz mydt dfmod lmy xz mydf DT data produces an error cplotdtmod xx dx z what effect Error in dat dx subscript out of bounds DF data does not produce an error cplotdfmod xx dx z what effect session info for your system sessionInfo R version Platform x appledarwin bit Running under macOS Sierra Matrix products default BLAS SystemLibraryFrameworksAccelerateframeworkVersionsAFrameworksvecLibframeworkVersionsAlibBLASdylib LAPACK LibraryFrameworksRframeworkVersions ResourcesliblibRlapackdylib locale enGBUTF enGBUTF enGBUTF CenGBUTF enGBUTF attached base packages stats graphics grDevices utils datasets methods base other attached packages datatable margins loaded via a namespace and not attached MASS compiler tools yaml prediction 