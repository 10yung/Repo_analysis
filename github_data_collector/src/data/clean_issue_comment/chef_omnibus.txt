Lets make sure this all works on Ruby Signedoffby Tim Smith tsmithchefio Description This change adds deep signing of libraries and binaries to the pakacking process for the pkg packager It aso enables the hardened runtime for binaries In order to deep sign we have to know where a software definition will install binaries and libraries To facilite this libdirs and bindirs functions have been added to the software definition These two functions return defaults that match standard omnibus locations but allow individual software defs to override if they do something different Bumps major version since signing deep signing is a major change Signedoffby Jon Morrow jmorrowchefio Maintainers Please ensure that you check for If this change impacts git cache validity it bumps the git cache serial number If this change impacts compatibility with omnibussoftware the corresponding change is reviewed and there is a release plan If this change impacts compatibility with the omnibus cookbook the corresponding change is reviewed and there is a release plan Description The hash needs to be expanded Asis it is an error with Ruby libomnibusdownloadhelpersrb warning Splitting the last argument into positional and keyword parameters is deprecated libomnibuscoreextensionsopenurirb in openuri usrlocalrvmrubiesruby libruby openurirb in openuri extra arguments ArgumentError I tried to fix this in but I ran into issues that I dont know how to fix because Im not very familiar with Ruby The Ruby documentation on the new behavior is comprehensive but as far as I can see there is no code that works in both Ruby versions without changing how things are wired Omnibus Version Platform Version Tell us which Operating System distribution version and architecture the Omnibus build is being executed on Replication Case Tell us what steps to take to replicate your problem See How to create a Minimal Complete and Verifiable example for information on how to create a good replication case Build Output The relevant output of the Omnibus build or a link to a gist of the entire build if there is one The verbose build output omnibus build PROJECT l internal may be useful but please link to a gist or truncate it Description S Publisher should inherit from s profile and not have to use publisers profile Omnibus Version Latest Platform Version el Replication Case I was using the following string bundle exec omnibus publish s REDACTED pkgpackage version el x rpm override s profileREDACTED I expected that s profile should be inherited into the s publisher instead of needing to use publishs profile This would be considered a quality of life enhancement and could likely be driven by OmnibusConfig and allow for order of operations If publishs use it if not check s else raise Build Output mMissing required attribute publishs accesskey for Config You must specify a value for publishs accesskey in your DSL file publishs accesskey ABCD Or set the value on the object configpublishs accesskeyABCD m m homecentosbundleruby omnibus bb fc libomnibusconfigrb in block in classConfig homecentosbundleruby omnibus bb fc libomnibusconfigrb in instanceeval homecentosbundleruby omnibus bb fc libomnibusconfigrb in setorreturn homecentosbundleruby omnibus bb fc libomnibusconfigrb in block in default homecentosbundleruby omnibus bb fc libomnibusconfigrb in block in default homecentosbundleruby omnibus bb fc libomnibuspublisherss publisherrb in s configuration homecentosbundleruby omnibus bb fc libomnibuss helpersrb in client homecentosbundleruby omnibus bb fc libomnibuss helpersrb in bucket homecentosbundleruby omnibus bb fc libomnibuss helpersrb in storeobject homecentosbundleruby omnibus bb fc libomnibuspublisherss publisherrb in block in publish homecentosbundleruby omnibus bb fc libomnibuspublisherss publisherrb in each homecentosbundleruby omnibus bb fc libomnibuspublisherss publisherrb in publish homecentosbundleruby omnibus bb fc libomnibuspublisherrb in publish homecentosbundleruby omnibus bb fc libomnibusclipublishrb in publish homecentosbundleruby omnibus bb fc libomnibusclipublishrb in s optomnibustoolchainembeddedlibrubygems gemsthor libthorcommandrb in run optomnibustoolchainembeddedlibrubygems gemsthor libthorinvocationrb in invokecommand optomnibustoolchainembeddedlibrubygems gemsthor libthorrb in dispatch homecentosbundleruby omnibus bb fc libomnibusclibaserb in dispatch optomnibustoolchainembeddedlibrubygems gemsthor libthorinvocationrb in invoke optomnibustoolchainembeddedlibrubygems gemsthor libthorrb in block in subcommand optomnibustoolchainembeddedlibrubygems gemsthor libthorcommandrb in run optomnibustoolchainembeddedlibrubygems gemsthor libthorinvocationrb in invokecommand optomnibustoolchainembeddedlibrubygems gemsthor libthorrb in dispatch homecentosbundleruby omnibus bb fc libomnibusclibaserb in dispatch optomnibustoolchainembeddedlibrubygems gemsthor libthorbaserb in start homecentosbundleruby omnibus bb fc libomnibusclirb in execute homecentosbundleruby omnibus bb fc binomnibus in top required optomnibustoolchainembeddedlibrubygems binomnibus in load optomnibustoolchainembeddedlibrubygems binomnibus in top required optomnibustoolchainembeddedlibrubysiteruby bundlercliexecrb in load optomnibustoolchainembeddedlibrubysiteruby bundlercliexecrb in kernelload optomnibustoolchainembeddedlibrubysiteruby bundlercliexecrb in run optomnibustoolchainembeddedlibrubysiteruby bundlerclirb in exec optomnibustoolchainembeddedlibrubysiteruby bundlervendorthorlibthorcommandrb in run optomnibustoolchainembeddedlibrubysiteruby bundlervendorthorlibthorinvocationrb in invokecommand optomnibustoolchainembeddedlibrubysiteruby bundlervendorthorlibthorrb in dispatch optomnibustoolchainembeddedlibrubysiteruby bundlerclirb in dispatch optomnibustoolchainembeddedlibrubysiteruby bundlervendorthorlibthorbaserb in start optomnibustoolchainembeddedlibrubysiteruby bundlerclirb in start optomnibustoolchainembeddedlibrubygems gemsbundler exebundle in block in top required optomnibustoolchainembeddedlibrubysiteruby bundlerfriendlyerrorsrb in withfriendlyerrors optomnibustoolchainembeddedlibrubygems gemsbundler exebundle in top required optomnibustoolchainbinbundle in load optomnibustoolchainbinbundle in main m Description Add new InstallBuilder packager InstallBuilder is multiplatform packagertool to build installers This packager allows to build linux and windows installers on linux os Add new fetcher to allow to download latest created artifact in artifactory Description Artifactory Fetcher allows to download newest created file from artifactory base on given pattern source repository somerepository path comcompanysomenamesomefolder filenamepattern npmmasterzip endpoint md da a ae b b b e b d eb Description There are cases when archive has to be added to installer package but Net Fetcher always extracts archives Adds new key extract in source parameter dictionary to allow to disable extraction By default archives will still be extracted Signedoffby Jaymala Sinha jsinhachefio Description Briefly describe the new feature or fix here Maintainers Please ensure that you check for If this change impacts git cache validity it bumps the git cache serial number If this change impacts compatibility with omnibussoftware the corresponding change is reviewed and there is a release plan If this change impacts compatibility with the omnibus cookbook the corresponding change is reviewed and there is a release plan Description When hdiutil fails in a shellout block we continue anyway producing an empty build as long as the last command in the block succeeds Omnibus Version Platform Version Mac os Mojave Replication Case These lines are failing We probably need to put on each command but this pattern is used throughout the project In this example shellout is happy because the last command returned shellout EOHgsub false true EOH MixlibShellOut command false true processstatus ProcessStatus pid exit stdout stderr childpid environment timeout user group workingdir but in this example shellout raises because the last command failed shellout EOHgsub true false EOH Traceback most recent call last from Usersbtmrvmrubiesruby binirb in main from irb from Usersbtmrvmgemsruby gemsomnibus libomnibusutilrb in shellout from Usersbtmrvmgemsruby gemsomnibus libomnibusutilrb in rescue in shellout OmnibusCommandFailed The following shell command exited with status true false Output nothing Error nothing This provides the expected behavior shellout EOHgsub false true EOH Traceback most recent call last from Usersbtmrvmrubiesruby binirb in main from irb from Usersbtmrvmgemsruby gemsomnibus libomnibusutilrb in shellout from Usersbtmrvmgemsruby gemsomnibus libomnibusutilrb in rescue in shellout OmnibusCommandFailed The following shell command exited with status false true Output nothing Error nothing Description Omnibus produces RPMs with incomplete dependencies the whitelisted dependencies do not show up as library requirements eg rpm q requires chef binsh binsh rpmlibPayloadFilesHavePrefix rpmlibCompressedFileNames rpmlibPayloadIsXz rpm q chef chef el x But Fedora and above ship libcryptso by default from libxcrypt instead of libcryptso from glibc as in RHEL so we cant assume that libcryptso is available without either embedding it or listing it as a required library in the RPM spec its still available but provided by libxcryptcompat Omnibus Version NA didnt build myself Platform Version RHEL x Replication Case Install Fedora Workstation with the default package set Download chef el x rpm and chef el x rpm Check the dependencies for the embedded Ruby either unpack the RPM with rpm cpio or install it Notice that libcryptso is not found but the RPM does not pull it in ldd optchefembeddedbinruby linuxvdsoso x fff a d librubyso optchefembeddedliblibrubyso x f c f libpthreadso lib libpthreadso x f c f libdlso lib libdlso x f c libcryptso not found libmso lib libmso x f c f libcso lib libcso x f c f d lib ldlinuxx so x f c libcryptso not found sudo chefclient s sudo password for michel optchefembeddedbinruby error while loading shared libraries libcryptso cannot open shared object file No such file or directory The same is still true for the latest chef el x rpm tmpchef rpm qp requires Downloadschef el x rpm warning homemichelDownloadschef el x rpm Header V DSASH A Signature key ID ef a NOKEY binsh binsh binsh rpmlibPayloadFilesHavePrefix rpmlibCompressedFileNames rpmlibPayloadIsXz tmpchef rpm cpio Downloadschef el x rpm cpio vid devnull tmpchef ldd optchefembeddedbinruby linuxvdsoso x ffcfa fb librubyso lib librubyso x f b libpthreadso lib libpthreadso x f f librtso lib librtso x f libdlso lib libdlso x f f libcryptso not found libmso lib libmso x f libcso lib libcso x f libgmpso lib libgmpso x f ff libcryptso lib libcryptso x f fb lib ldlinuxx so x f e tmpchef ls optchefembeddedliblibcrypt optchefembeddedliblibcryptoa optchefembeddedliblibcryptoso optchefembeddedliblibcryptoso Build Output NA bug with official build 