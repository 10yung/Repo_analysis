Trying to use the mysql makara adapter with Foreigner as in a rake task i was getting the error exec Database adapter mysql makara not supported Use nForeignerAdapterregister mysql makara pathtoadapter Thanks This PR solves two problems which are highly relevant if you are either using explicit schema names in addforeignkey instructions andor you are using the Apartment gem Incorrect behaviour of using foreign keys in conjunction with schema name see Example Unfavorable behaviour when using Apartment gem When creating a new tenant Apartment will create a new schema with specified name and load schemarb schemarb as we all know contains addforeignkey statements some of which may reference the public shared schema i e public foreign keys In current version of foreigner this will throw an exception because the FKs already exists We need to let foreigner skip adding foreign key if Apartment gem is in use Foreign key instruction wants to add to public shared schema Foreign key already exist We have patched the gem in our production environment and would like to share it with the main repo Example ruby addforeignkey publicrolesusers publicroles name rolesusersroleidfk dependent delete column roleid With foreigner v we will get this sql sql ALTER TABLE publicrolesusers ADD CONSTRAINT publicrolesuserspublicroleidfk FOREIGN KEY publicroleid REFERENCES publicrolesid What is expected is this sql sql ALTER TABLE publicrolesusers ADD CONSTRAINT publicrolesusersroleidfk FOREIGN KEY publicroleid REFERENCES publicrolesid Hello I have a multi tenanted app using the well known at least as far multitenancy goes Apartment gem This means that the concept of schemas beyond public schema is introduced Every tenant gets his own schema and each schema contains all tables However for common tables system tables for read only which are shared for all tenants there is a possibility to configure Apartment to exclude these models If you have foreign key constraints on these tables you will get into trouble with Foreigner Example The model Diagnosis is shared for all my tenants hence its data is in PUBLIC schema On this table I have a FK constraint When I run rake dbmigrate what happens is that the migration is run once for each tenant What also happens is schema dump and here is where Foreigner comes in I get this false diff diff addforeignkey sendvetprescriptionitems publicdiagnoses name sendvetprescriptionitemsdiagnosisidfk column diagnosisid addforeignkey sendvetprescriptionitems diagnoses name sendvetprescriptionitemsdiagnosisidfk This is because Foreigner assumes everything is in public schema as all vanilla rails applications are But in this case each foreign key is in a tenant schema and each foreign key need to explicitly point to the table in public schema This is because when postgres evaluates a FK in a tenant schema it will assume that the table being referred to also exist in the local schema UNLESS it explicitly says otherwise I have made a pull request to fix this PS Commentsreview are welcome I hope you like it and can consider merging it Add support for Apartment gem with excluded models tables of which exist in public schema If Apartment class is defined excluded models are inspected In case the current table that we are generating foreign keys for is one of the excluded tables it means it needs to have public prepended to its table name In the latest RC of Rails they renamed the instance variable containing the table name This broke the ability to use the foreignkey method within changetable Then new version introduces a name method which should hopefully be more stable This patch tries to use the name method if it exists and falls back to tablename otherwise Without setting up appraisal or some such Im not sure theres an easy way to test this but its working for me with Rails rc Trying to run dbschemaload runs the first time but on subsequent tries it fails trying to drop any tables that have foreign keys defined on them This is happening in both postgres and sqlserver 