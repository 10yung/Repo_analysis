For example testjs PHPsomeFunction testphp function someFunction ifstarsAreInWrongOrder throw new ExceptionI think I dont want to execute your code in file FILE on line LINE How to show the proper FILE and LINE when Im not in context of V JsScriptException Related to and I stopped using registerExtension but I think there might be one more registerExtension bug anyway or even nonobvious bugs From MSHUTDOWNFUNCTION the only thing I can think of that would leak are extensions and their associated data eg deps Motivation for suggesting switching all uses of zendstringdupzendstringcopy to zendstringinit instead I dont expect copying strings vs adding references to be a large source of extra memory usage for v js If this crashes or misbehaves eg frees a string twice or too early or not at all it would be easier to narrow down the cause when running with VALGRIND Interned or temporary strings can cause problem if theyre persisted by v js beyond the lifetime of a request grep E zendstringcopydup cc h v jsclasscc ZSTRPp zendstringdupZSTRPp v jsclasscc zendstringdup would return the original interned string if interned so we dont use that v jsv objectclasscc fcommonfunctionname zendstringcopymethod v jsvariablescc ctxvariablename zendstringcopyZSTRPitem One use from registerExtension with an array of deps seems like it might also be a problem for nonZTS builds Because of that zendpersistentzvaldup should probably use zendstringinit instead zendstringdup will return the original pointer for interned strings eg in php cpp Allocate a persistent string which will survive until module shutdown on both ZTSPersistent and NTSNot interned those would be cleaned up zendstringdup would return the original interned string if interned so we dont use that jsextname zendstringinitZSTRVALname ZSTRLENname jsextsource zendstringinitZSTRVALsource ZSTRLENsource if jsextdeps jsextdepsht HashTable mallocsizeofHashTable zendhashinitjsextdepsht jsextdepscount NULL v jspersistentzvaldtor zendhashcopyjsextdepsht ZARRVALPdepsarr v jspersistentzvalctor Context for why Im looking at string copying in V js if anyone has similar issues Im seeing a segfault in zendinternedstringfindpermanent in longrunning httpd processes for a fraction of apache restarts if I read the instruction pointer correctly Im not using registerExtension anywhere Im using php and v js Some opcache bugs were fixed in and but they all seem unrelated The code in question uses V Js with instance properties that are strings PHP closures with usevar etc Some V js instances execute multiple scripts then have methods invoked multiple times I havent obtained a core dump yet Rolling back V js seems to have helped in This happens with opcache enabled and withwithout xdebug There are two apachehttpd pools the segfault only seems to happen during restarts after the second pool gets stopped not the first This might be a coincidence zendinternedstringfindpermanent seems like it would only get called by opcache in php The line it crashes on suggests that the pointer to the zendstring that is being looked up was corrupted asm zendinternedstringfindpermanent push r ff mov rdir push r push r push r b push rbp c push rbx d ec sub x rsp b f mov x rdirbp crashes here probably fetching zendstringhashvalstr for an invalid str pointer ed test rbprbp e je a zendinternedstringfindpermanent x EDIT I obtained a core dump I was mistaken about what called zendinternedstringfindpermanent The source before signalhandler can vary memcached curl reading files etc but its just any point when signalhandler can get called for the httpd stop For gdb pathtolibphp so pathtocoredump Program terminated with signal Segmentation fault gdb bt x f e ca in zendinternedstringfindpermanent from usrlocalphpmoduleslibphp so x f e d f in accelshutdown from usrlocalphplibphp opcacheso x f e d ff in zmshutdownzendaccelerator from usrlocalphplibphp opcacheso x f e a ae in moduledestructor from usrlocalphpmoduleslibphp so x f e b cc in moduledestructorzval from usrlocalphpmoduleslibphp so x f e afa in zendhashgracefulreversedestroy from usrlocalphpmoduleslibphp so x f e d ce in zendshutdown from usrlocalphpmoduleslibphp so x f e f b in phpmoduleshutdown from usrlocalphpmoduleslibphp so x f e fa in phpmoduleshutdownwrapper from usrlocalphpmoduleslibphp so x f e e in phpapachechildshutdown from usrlocalphpmoduleslibphp so x f e ae in aprpooldestroy from lib libapr so x f e ada c in cleanchildexit from etchttpdmodulesmodmpmpreforkso x f e ada b in justdie from etchttpdmodulesmodmpmpreforkso x f e ca d in zendsignalhandler from usrlocalphpmoduleslibphp so x f e ca b in zendsignalhandlerdefer from usrlocalphpmoduleslibphp so signal handler called x f e da f in readnocancel from lib libpthreadso x f e d in phpstdiopread from usrlocalphpmoduleslibphp so x f e c in phpstreamfillreadbuffer from usrlocalphpmoduleslibphp so x f e ba in phpstreamgetline from usrlocalphpmoduleslibphp so x f e cb in phpexec from usrlocalphpmoduleslibphp so x f e ce a in zifexec from usrlocalphpmoduleslibphp so x f e a ec in executeex from usrlocalphpmoduleslibphp so x f e in zendexecute from usrlocalphpmoduleslibphp so x f e d in zendexecutescripts from usrlocalphpmoduleslibphp so x f e fcf in phpexecutescript from usrlocalphpmoduleslibphp so x f e ca in phphandler from usrlocalphpmoduleslibphp so x c bc ca in x c bc ca in x c bc f be in x c bc e ad in x c bc cf in x c bc bad in x c bc c f in x e fbb in x cbc dbc bb in x c bc dfc in x c bc ca in x in EDIT The larger problem is that this is a hard restart instead of a graceful restart so the details of shutdown are less important I dont believe these error messages have any unit tests covering them Some may be unreachable in practice This might not be comprehensive I didnt look at other files Noticed when looking into uses of zendstring for a crash in zendinternedstringfindpermanent in an application using V Js It might not even be related to v js and definitely isnt related to this PR struct zendclassentry char type zendstring name Trying to compile php branch for php version but got this errors linuxum w pecl install v js PHP Warning PHP Startup v js Unable to initialize module Module compiled with module API PHP compiled with module API These options need to match in Unknown on line WARNING channel peclphpnet has updated its protocols use pecl channelupdate peclphpnet to update downloading v js tgz Starting to download v js tgz bytes done bytes source files building running phpize Configuring for PHP Api Version Zend Module Api No Zend Extension Api No Please provide the installation prefix of libv autodetect optv Warning Use of undefined constant name assumed name this will throw an Error in a future version of PHP in PEARBuilderphp on line PHP Warning Use of undefined constant name assumed name this will throw an Error in a future version of PHP in usrsharephp PEARPEARBuilderphp on line building in tmppeartemppearbuildviperworkmyaH lv js running tmppeartempv jsconfigure withphpconfigusrbinphpconfig withv jsoptv configure loading site script usrsharesitex unknownlinuxgnu checking for grep that handles long lines and e bingrep checking for egrep bingrep E checking for a sed that does not truncate output binsed checking for pkgconfig usrbinpkgconfig checking pkgconfig is at least version yes checking for cc cc checking whether the C compiler works yes checking for C compiler default output file name aout checking for suffix of executables checking whether we are cross compiling no checking for suffix of object files o checking whether we are using the GNU C compiler yes checking whether cc accepts g yes checking for cc option to accept ISO C none needed checking how to run the C preprocessor cc E checking for icc no checking for suncc no checking for system library directory lib checking if compiler supports R no checking if compiler supports Wlrpath yes checking build system type x pclinuxgnu checking host system type x pclinuxgnu checking target system type x pclinuxgnu checking for PHP prefix usr checking for PHP includes Iusrincludephp Iusrincludephp main Iusrincludephp TSRM Iusrincludephp Zend Iusrincludephp ext Iusrincludephp extdatelib checking for PHP extension directory usrlib php extensions checking for PHP installed headers prefix usrincludephp checking if debug is enabled no checking if zts is enabled no checking for gawk gawk checking for V Javascript Engine yes shared checking for g g checking whether we are using the GNU C compiler yes checking whether g accepts g yes checking how to run the C preprocessor g E checking for C standard version c checking how to allow c narrowing Wnonarrowing checking for libv libplatform found checking for V version checking for nativesblobbin found optv libnativesblobbin checking for snapshotblobbin found optv libsnapshotblobbin checking for v ArrayBufferAllocatorNewDefaultAllocator yes checking how to print strings printf checking for a sed that does not truncate output cached binsed checking for fgrep bingrep F checking for ld used by cc usrx suselinuxbinld checking if the linker usrx suselinuxbinld is GNU ld yes checking for BSD or MScompatible name lister nm usrbinnm B checking the name lister usrbinnm B interface BSD nm checking whether ln s works yes checking the maximum length of command line arguments checking how to convert x pclinuxgnu file names to x pclinuxgnu format funcconvertfilenoop checking how to convert x pclinuxgnu file names to toolchain format funcconvertfilenoop checking for usrx suselinuxbinld option to reload object files r checking for objdump objdump checking how to recognize dependent libraries passall checking for dlltool no checking how to associate runtime and link libraries printf s n checking for ar ar checking for archiver FILE support checking for strip strip checking for ranlib ranlib checking for gawk cached gawk checking command to parse usrbinnm B output from cc object ok checking for sysroot no checking for a working dd bindd checking how to truncate binary pipes bindd bs count checking for mt mt checking if mt is a manifest tool no checking for ANSI C header files yes checking for systypesh yes checking for sysstath yes checking for stdlibh yes checking for stringh yes checking for memoryh yes checking for stringsh yes checking for inttypesh yes checking for stdinth yes checking for unistdh yes checking for dlfcnh yes checking for objdir libs checking if cc supports fnortti fnoexceptions no checking for cc option to produce PIC fPIC DPIC checking if cc PIC flag fPIC DPIC works yes checking if cc static flag static works no checking if cc supports c o fileo yes checking if cc supports c o fileo cached yes checking whether the cc linker usrx suselinuxbinld m elfx supports shared libraries yes checking whether lc should be explicitly linked in no checking dynamic linker characteristics GNULinux ldso checking how to hardcode library paths into programs immediate checking whether stripping libraries is possible yes checking if libtool supports shared libraries yes checking whether to build shared libraries yes checking whether to build static libraries no checking how to run the C preprocessor g E checking for ld used by g usrx suselinuxbinld m elfx checking if the linker usrx suselinuxbinld m elfx is GNU ld yes checking whether the g linker usrx suselinuxbinld m elfx supports shared libraries yes checking for g option to produce PIC fPIC DPIC checking if g PIC flag fPIC DPIC works yes checking if g static flag static works no checking if g supports c o fileo yes checking if g supports c o fileo cached yes checking whether the g linker usrx suselinuxbinld m elfx supports shared libraries yes checking dynamic linker characteristics cached GNULinux ldso checking how to hardcode library paths into programs immediate configure patching confighin configure creating configstatus configstatus creating configh configstatus executing libtool commands running make binsh tmppeartemppearbuildviperworkmyaH lv js libtool modecompile g Wnonarrowing stdc I Itmppeartempv js DPHPATOMINC ItmppeartemppearbuildviperworkmyaH lv js include ItmppeartemppearbuildviperworkmyaH lv js main Itmppeartempv js Iusrincludephp Iusrincludephp main Iusrincludephp TSRM Iusrincludephp Zend Iusrincludephp ext Iusrincludephp extdatelib Ioptv include Ioptv DHAVECONFIGH g O c tmppeartempv jsv jsarrayaccesscc o v jsarrayaccesslo libtool compile g Wnonarrowing stdc I Itmppeartempv js DPHPATOMINC ItmppeartemppearbuildviperworkmyaH lv js include ItmppeartemppearbuildviperworkmyaH lv js main Itmppeartempv js Iusrincludephp Iusrincludephp main Iusrincludephp TSRM Iusrincludephp Zend Iusrincludephp ext Iusrincludephp extdatelib Ioptv include Ioptv DHAVECONFIGH g O c tmppeartempv jsv jsarrayaccesscc fPIC DPIC o libsv jsarrayaccesso In file included from usrincludephp Zendzendtypesh from usrincludephp Zendzendh from usrincludephp mainphph from tmppeartempv jsphpv jsmacrosh from tmppeartempv jsv jsarrayaccesscc usrincludephp Zendzendoperatorsh In function zendlong zenddvaltolvaldouble tmppeartempv jsphpv jsmacrosh error stdstd has not been declared define isfinitea stdisfinitea usrincludephp Zendzendportabilityh note in definition of macro UNEXPECTED define UNEXPECTEDcondition builtinexpectcondition usrincludephp mainmainphpconfigh note in expansion of macro isfinite define zendfinite stdisfinite usrincludephp Zendzendoperatorsh note in expansion of macro zendfinite if UNEXPECTEDzendfinited UNEXPECTEDzendisnand tmppeartempv jsphpv jsmacrosh error stdstd has not been declared define isnana stdisnana usrincludephp Zendzendportabilityh note in definition of macro UNEXPECTED define UNEXPECTEDcondition builtinexpectcondition usrincludephp mainmainphpconfigh note in expansion of macro isnan define zendisnan stdisnan usrincludephp Zendzendoperatorsh note in expansion of macro zendisnan if UNEXPECTEDzendfinited UNEXPECTEDzendisnand usrincludephp Zendzendoperatorsh In function zendlong zenddvaltolvalcapdouble tmppeartempv jsphpv jsmacrosh error stdstd has not been declared define isfinitea stdisfinitea usrincludephp Zendzendportabilityh note in definition of macro UNEXPECTED define UNEXPECTEDcondition builtinexpectcondition usrincludephp mainmainphpconfigh note in expansion of macro isfinite define zendfinite stdisfinite usrincludephp Zendzendoperatorsh note in expansion of macro zendfinite if UNEXPECTEDzendfinited UNEXPECTEDzendisnand tmppeartempv jsphpv jsmacrosh error stdstd has not been declared define isnana stdisnana usrincludephp Zendzendportabilityh note in definition of macro UNEXPECTED define UNEXPECTEDcondition builtinexpectcondition usrincludephp mainmainphpconfigh note in expansion of macro isnan define zendisnan stdisnan usrincludephp Zendzendoperatorsh note in expansion of macro zendisnan if UNEXPECTEDzendfinited UNEXPECTEDzendisnand In file included from usrincludedirenth from usrincludephp Zendzendvirtualcwdh from usrincludephp mainphph from tmppeartempv jsphpv jsmacrosh from tmppeartempv jsv jsarrayaccesscc tmppeartempv jsv jsclassh In function v jsctx v jsctxfetchobjectzendobject tmppeartempv jsv jsclassh warning offsetof within nonstandardlayout type v jsctx is conditionallysupported Winvalidoffsetof return struct v jsctx char obj XtOffsetOfstruct v jsctx std tmppeartempv jsv jsclassh note in expansion of macro XtOffsetOf return struct v jsctx char obj XtOffsetOfstruct v jsctx std tmppeartempv jsv jsarrayaccesscc In function void v jsarrayaccessenumeratorconst v PropertyCallbackInfov Array tmppeartempv jsv jsarrayaccesscc warning v Localv Context v IsolateGetEnteredContext is deprecated Use GetEnteredOrMicrotaskContext Wdeprecateddeclarations resultSetisolateGetEnteredContext i V JSINTj In file included from optv includev internalh from optv includev h from tmppeartempv jsphpv jsmacrosh from tmppeartempv jsv jsarrayaccesscc optv includev h note declared here LocalContext GetEnteredContext optv includev configh note in definition of macro V DEPRECATED declarator attributedeprecatedmessage tmppeartempv jsv jsarrayaccesscc warning ignoring return value of v Maybebool v ObjectSetv Localv Context uint t v Localv Value declared with attribute warnunusedresult Wunusedresult resultSetisolateGetEnteredContext i V JSINTj In file included from tmppeartempv jsphpv jsmacrosh from tmppeartempv jsv jsarrayaccesscc optv includev h note declared here V WARNUNUSEDRESULT Maybebool SetLocalContext context uint t index tmppeartempv jsv jsarrayaccesscc warning v Localv Context v IsolateGetEnteredContext is deprecated Use GetEnteredOrMicrotaskContext Wdeprecateddeclarations resultSetisolateGetEnteredContext V JSSYMlength V JSINTi In file included from optv includev internalh from optv includev h from tmppeartempv jsphpv jsmacrosh from tmppeartempv jsv jsarrayaccesscc optv includev h note declared here LocalContext GetEnteredContext optv includev configh note in definition of macro V DEPRECATED declarator attributedeprecatedmessage tmppeartempv jsv jsarrayaccesscc warning ignoring return value of v Maybebool v ObjectSetv Localv Context v Localv Value v Localv Value declared with attribute warnunusedresult Wunusedresult resultSetisolateGetEnteredContext V JSSYMlength V JSINTi In file included from tmppeartempv jsphpv jsmacrosh from tmppeartempv jsv jsarrayaccesscc optv includev h note declared here V WARNUNUSEDRESULT Maybebool SetLocalContext context tmppeartempv jsv jsarrayaccesscc In function void v jsarrayaccessnamedgetterv Localv Name const v PropertyCallbackInfov Value tmppeartempv jsv jsarrayaccesscc warning v Localv Context v IsolateGetEnteredContext is deprecated Use GetEnteredOrMicrotaskContext Wdeprecateddeclarations ifprototypeToObjectisolateGetEnteredContextToLocal prototypeobject In file included from optv includev internalh from optv includev h from tmppeartempv jsphpv jsmacrosh from tmppeartempv jsv jsarrayaccesscc optv includev h note declared here LocalContext GetEnteredContext optv includev configh note in definition of macro V DEPRECATED declarator attributedeprecatedmessage tmppeartempv jsv jsarrayaccesscc warning v Localv Context v IsolateGetEnteredContext is deprecated Use GetEnteredOrMicrotaskContext Wdeprecateddeclarations prototypeobjectGetisolateGetEnteredContext propertyToLocal retvalue In file included from optv includev internalh from optv includev h from tmppeartempv jsphpv jsmacrosh from tmppeartempv jsv jsarrayaccesscc optv includev h note declared here LocalContext GetEnteredContext optv includev configh note in definition of macro V DEPRECATED declarator attributedeprecatedmessage tmppeartempv jsv jsarrayaccesscc warning ignoring return value of bool v MaybeLocalTToLocalv LocalS const with S v Value T v Value declared with attribute warnunusedresult Wunusedresult prototypeobjectGetisolateGetEnteredContext propertyToLocal retvalue make Makefile v jsarrayaccesslo ERROR make failed Output binbash tmpv jslibtool modecompile g Wnonarrowing stdc I Itmpv js DPHPATOMINC Itmpv jsinclude Itmpv jsmain Itmpv js Iusrincludephp Iusrincludephp main Iusrincludephp TSRM Iusrincludephp Zend Iusrincludephp ext Iusrincludephp extdatelib Iusr DHAVECONFIGH g O c tmpv jsv jsconvertcc o v jsconvertlo libtool compile g Wnonarrowing stdc I Itmpv js DPHPATOMINC Itmpv jsinclude Itmpv jsmain Itmpv js Iusrincludephp Iusrincludephp main Iusrincludephp TSRM Iusrincludephp Zend Iusrincludephp ext Iusrincludephp extdatelib Iusr DHAVECONFIGH g O c tmpv jsv jsconvertcc fPIC DPIC o libsv jsconverto In file included from usrincludedirenth from usrincludephp Zendzendvirtualcwdh from usrincludephp mainphph from tmpv jsphpv jsmacrosh from tmpv jsv jsconvertcc tmpv jsv jsclassh In function v jsctx v jsctxfetchobjectzendobject tmpv jsv jsclassh warning offsetof within nonstandardlayout type v jsctx is undefined Winvalidoffsetof return struct v jsctx char obj XtOffsetOfstruct v jsctx std tmpv jsv jsclassh note in expansion of macro XtOffsetOf return struct v jsctx char obj XtOffsetOfstruct v jsctx std tmpv jsv jsconvertcc In function v Localv Value v jshashtojsarrzval v Isolate tmpv jsv jsconvertcc error ZENDHASHGETAPPLYCOUNT was not declared in this scope if myht ZENDHASHGETAPPLYCOUNTmyht tmpv jsv jsconvertcc note suggested alternative ZENDHASHAPPLYSTOP if myht ZENDHASHGETAPPLYCOUNTmyht ZENDHASHAPPLYSTOP tmpv jsv jsconvertcc error ZENDHASHINCAPPLYCOUNT was not declared in this scope ZENDHASHINCAPPLYCOUNTmyht tmpv jsv jsconvertcc note suggested alternative ZENDHASHAPPLYSTOP ZENDHASHINCAPPLYCOUNTmyht ZENDHASHAPPLYSTOP tmpv jsv jsconvertcc error ZENDHASHDECAPPLYCOUNT was not declared in this scope ZENDHASHDECAPPLYCOUNTmyht tmpv jsv jsconvertcc note suggested alternative ZENDHASHAPPLYSTOP ZENDHASHDECAPPLYCOUNTmyht ZENDHASHAPPLYSTOP tmpv jsv jsconvertcc In function v Localv Value zendlongtov jszendlong v Isolate tmpv jsv jsconvertcc warning integer overflow in expression Woverflow if v stdnumericlimitsint tmin v stdnumericlimitsint tmax Makefile recipe for target v jsconvertlo failed make v jsconvertlo Error rootgr ng wftmpv js sudo make install binbash tmpv jslibtool modecompile g Wnonarrowing stdc I Itmpv js DPHPATOMINC Itmpv jsinclude Itmpv jsmain Itmpv js Iusrincludephp Iusrincludephp main Iusrincludephp TSRM Iusrincludephp Zend Iusrincludephp ext Iusrincludephp extdatelib Iusr DHAVECONFIGH g O c tmpv jsv jsconvertcc o v jsconvertlo libtool compile g Wnonarrowing stdc I Itmpv js DPHPATOMINC Itmpv jsinclude Itmpv jsmain Itmpv js Iusrincludephp Iusrincludephp main Iusrincludephp TSRM Iusrincludephp Zend Iusrincludephp ext Iusrincludephp extdatelib Iusr DHAVECONFIGH g O c tmpv jsv jsconvertcc fPIC DPIC o libsv jsconverto In file included from usrincludedirenth from usrincludephp Zendzendvirtualcwdh from usrincludephp mainphph from tmpv jsphpv jsmacrosh from tmpv jsv jsconvertcc tmpv jsv jsclassh In function v jsctx v jsctxfetchobjectzendobject tmpv jsv jsclassh warning offsetof within nonstandardlayout type v jsctx is undefined Winvalidoffsetof return struct v jsctx char obj XtOffsetOfstruct v jsctx std tmpv jsv jsclassh note in expansion of macro XtOffsetOf return struct v jsctx char obj XtOffsetOfstruct v jsctx std tmpv jsv jsconvertcc In function v Localv Value v jshashtojsarrzval v Isolate tmpv jsv jsconvertcc error ZENDHASHGETAPPLYCOUNT was not declared in this scope if myht ZENDHASHGETAPPLYCOUNTmyht tmpv jsv jsconvertcc note suggested alternative ZENDHASHAPPLYSTOP if myht ZENDHASHGETAPPLYCOUNTmyht ZENDHASHAPPLYSTOP tmpv jsv jsconvertcc error ZENDHASHINCAPPLYCOUNT was not declared in this scope ZENDHASHINCAPPLYCOUNTmyht tmpv jsv jsconvertcc note suggested alternative ZENDHASHAPPLYSTOP ZENDHASHINCAPPLYCOUNTmyht ZENDHASHAPPLYSTOP tmpv jsv jsconvertcc error ZENDHASHDECAPPLYCOUNT was not declared in this scope ZENDHASHDECAPPLYCOUNTmyht tmpv jsv jsconvertcc note suggested alternative ZENDHASHAPPLYSTOP ZENDHASHDECAPPLYCOUNTmyht ZENDHASHAPPLYSTOP tmpv jsv jsconvertcc In function v Localv Value zendlongtov jszendlong v Isolate tmpv jsv jsconvertcc warning integer overflow in expression Woverflow if v stdnumericlimitsint tmin v stdnumericlimitsint tmax Makefile recipe for target v jsconvertlo failed make v jsconvertlo Error Configlog This file contains any messages produced by compilers while running configure to aid debugging if configure makes a mistake It was created by configure which was generated by GNU Autoconf Invocation command line was configure withv jsoptv LDFLAGSlstdc Platform hostname gr ng wf uname m x uname r generic uname s Linux uname v Ubuntu SMP Tue Nov UTC usrbinuname p unknown binuname X unknown binarch unknown usrbinarch k unknown usrconvexgetsysinfo unknown usrbinhostinfo unknown binmachine unknown usrbinoslevel unknown binuniverse unknown PATH tmpdepottools PATH usrlocalsbin PATH usrlocalbin PATH usrsbin PATH usrbin PATH sbin PATH bin PATH usrgames PATH usrlocalgames Core tests configure checking for grep that handles long lines and e configure result bingrep configure checking for egrep configure result bingrep E configure checking for a sed that does not truncate output configure result binsed configure checking for cc configure found usrbincc configure result cc configure checking for C compiler version configure cc version cc Ubuntu ubuntu Copyright C Free Software Foundation Inc This is free software see the source for copying conditions There is NO warranty not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE configure configure cc v Using builtin specs COLLECTGCCcc COLLECTLTOWRAPPERusrlibgccx linuxgnu ltowrapper OFFLOADTARGETNAMESnvptxnone OFFLOADTARGETDEFAULT Target x linuxgnu Configured with srcconfigure v withpkgversionUbuntu ubuntu withbugurlfileusrsharedocgcc READMEBugs enablelanguagescadacgobrigdfortranobjcobjc prefixusr withgccmajorversiononly programsuffix programprefixx linuxgnu enableshared enablelinkerbuildid libexecdirusrlib withoutincludedgettext enablethreadsposix libdirusrlib enablenls withsysroot enableclocalegnu enablelibstdcxxdebug enablelibstdcxxtimeyes withdefaultlibstdcxxabinew enablegnuuniqueobject disablevtableverify enablelibmpx enableplugin enabledefaultpie withsystemzlib withtargetsystemzlib enableobjcgcauto enablemultiarch disablewerror witharch i withabim withmultiliblistm m mx enablemultilib withtunegeneric enableoffloadtargetsnvptxnone withoutcudadriver enablecheckingrelease buildx linuxgnu hostx linuxgnu targetx linuxgnu Thread model posix gcc version Ubuntu ubuntu configure configure cc V cc error unrecognized command line option V cc fatal error no input files compilation terminated configure configure cc qversion cc error unrecognized command line option qversion did you mean version cc fatal error no input files compilation terminated configure configure checking whether the C compiler works configure cc lstdc conftestc configure configure result yes configure checking for C compiler default output file name configure result aout configure checking for suffix of executables configure cc o conftest lstdc conftestc configure configure result configure checking whether we are cross compiling configure cc o conftest lstdc conftestc configure configure conftest configure configure result no configure checking for suffix of object files configure cc c conftestc configure configure result o configure checking whether we are using the GNU C compiler configure cc c conftestc configure configure result yes configure checking whether cc accepts g configure cc c g conftestc configure configure result yes configure checking for cc option to accept ISO C configure cc c g O conftestc configure configure result none needed configure checking how to run the C preprocessor configure cc E conftestc configure configure cc E conftestc conftestc fatal error acnonexistenth No such file or directory include acnonexistenth compilation terminated configure configure failed program was confdefsh define PACKAGENAME define PACKAGETARNAME define PACKAGEVERSION define PACKAGESTRING define PACKAGEBUGREPORT define PACKAGEURL end confdefsh include acnonexistenth configure result cc E configure cc E conftestc configure configure cc E conftestc conftestc fatal error acnonexistenth No such file or directory include acnonexistenth compilation terminated configure configure failed program was confdefsh define PACKAGENAME define PACKAGETARNAME define PACKAGEVERSION define PACKAGESTRING define PACKAGEBUGREPORT define PACKAGEURL end confdefsh include acnonexistenth configure checking for icc configure result no configure checking for suncc configure result no configure checking whether cc understands c and o together configure cc c conftestc o conftest o configure configure cc c conftestc o conftest o configure configure result yes configure checking for system library directory configure result lib configure checking if compiler supports R configure cc o conftest g O lstdc conftestc R usrlib cc error unrecognized command line option R configure configure failed program was confdefsh define PACKAGENAME define PACKAGETARNAME define PACKAGEVERSION define PACKAGESTRING define PACKAGEBUGREPORT define PACKAGEURL end confdefsh int main return configure result no configure checking if compiler supports Wlrpath configure cc o conftest g O lstdc conftestc Wlrpathusrlib configure configure result yes configure checking build system type configure result x pclinuxgnu configure checking host system type configure result x pclinuxgnu configure checking target system type configure result x pclinuxgnu configure checking for PHP prefix configure result usr configure checking for PHP includes configure result Iusrincludephp Iusrincludephp main Iusrincludephp TSRM Iusrincludephp Zend Iusrincludephp ext Iusrincludephp extdatelib configure checking for PHP extension directory configure result usrlibphp configure checking for PHP installed headers prefix configure result usrincludephp configure checking if debug is enabled configure result no configure checking if zts is enabled configure result no configure checking for re c configure result no configure WARNING You will need re c or later if you want to regenerate PHP parsers configure checking for gawk configure result no configure checking for nawk configure found usrbinnawk configure result nawk configure checking if nawk is broken configure result no configure checking for V Javascript Engine configure result yes shared configure checking for g configure found usrbing configure result g configure checking for C compiler version configure g version g Ubuntu ubuntu Copyright C Free Software Foundation Inc This is free software see the source for copying conditions There is NO warranty not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE configure configure g v Using builtin specs COLLECTGCCg COLLECTLTOWRAPPERusrlibgccx linuxgnu ltowrapper OFFLOADTARGETNAMESnvptxnone OFFLOADTARGETDEFAULT Target x linuxgnu Configured with srcconfigure v withpkgversionUbuntu ubuntu withbugurlfileusrsharedocgcc READMEBugs enablelanguagescadacgobrigdfortranobjcobjc prefixusr withgccmajorversiononly programsuffix programprefixx linuxgnu enableshared enablelinkerbuildid libexecdirusrlib withoutincludedgettext enablethreadsposix libdirusrlib enablenls withsysroot enableclocalegnu enablelibstdcxxdebug enablelibstdcxxtimeyes withdefaultlibstdcxxabinew enablegnuuniqueobject disablevtableverify enablelibmpx enableplugin enabledefaultpie withsystemzlib withtargetsystemzlib enableobjcgcauto enablemultiarch disablewerror witharch i withabim withmultiliblistm m mx enablemultilib withtunegeneric enableoffloadtargetsnvptxnone withoutcudadriver enablecheckingrelease buildx linuxgnu hostx linuxgnu targetx linuxgnu Thread model posix gcc version Ubuntu ubuntu configure configure g V g error unrecognized command line option V g fatal error no input files compilation terminated configure configure g qversion g error unrecognized command line option qversion did you mean version g fatal error no input files compilation terminated configure configure checking whether we are using the GNU C compiler configure g c conftestcpp configure configure result yes configure checking whether g accepts g configure g c g conftestcpp configure configure result yes configure checking how to run the C preprocessor configure g E conftestcpp configure configure g E conftestcpp conftestcpp fatal error acnonexistenth No such file or directory include acnonexistenth compilation terminated configure configure failed program was confdefsh define PACKAGENAME define PACKAGETARNAME define PACKAGEVERSION define PACKAGESTRING define PACKAGEBUGREPORT define PACKAGEURL define PHPV EXECPATH optv liblibv so end confdefsh include acnonexistenth configure result g E configure g E conftestcpp configure configure g E conftestcpp conftestcpp fatal error acnonexistenth No such file or directory include acnonexistenth compilation terminated configure configure failed program was confdefsh define PACKAGENAME define PACKAGETARNAME define PACKAGEVERSION define PACKAGESTRING define PACKAGEBUGREPORT define PACKAGEURL define PHPV EXECPATH optv liblibv so end confdefsh include acnonexistenth configure checking for C standard version configure g o conftest g O stdc lstdc Wlrpathoptv lib conftestcpp lstdc configure configure conftest configure configure result c configure checking how to allow c narrowing configure g o conftest stdc lstdc Wlrpathoptv lib conftestcpp lstdc conftestcpp In function int main conftestcpp error narrowing conversion of from int to unsigned int inside Wnarrowing struct unsigned int x foo configure configure program exited with status configure failed program was confdefsh define PACKAGENAME define PACKAGETARNAME define PACKAGEVERSION define PACKAGESTRING define PACKAGEBUGREPORT define PACKAGEURL define PHPV EXECPATH optv liblibv so end confdefsh int main struct unsigned int x foo void foo return configure g o conftest Wnoc narrowing stdc lstdc Wlrpathoptv lib conftestcpp lstdc conftestcpp In function int main conftestcpp error narrowing conversion of from int to unsigned int inside Wnarrowing struct unsigned int x foo At global scope cc plus warning unrecognized command line option Wnoc narrowing configure configure program exited with status configure failed program was confdefsh define PACKAGENAME define PACKAGETARNAME define PACKAGEVERSION define PACKAGESTRING define PACKAGEBUGREPORT define PACKAGEURL define PHPV EXECPATH optv liblibv so end confdefsh int main struct unsigned int x foo void foo return configure g o conftest Wnonarrowing stdc lstdc Wlrpathoptv lib conftestcpp lstdc configure configure conftest configure configure result Wnonarrowing configure checking for libv libplatform configure g o conftest g O Ioptv include stdc lstdc Wlrpathoptv lib Loptv lib conftestcpp lstdc lv libplatform lv configure configure result found configure checking for V version configure g o conftest g O Ioptv include stdc lstdc Wlrpathoptv lib Loptv lib conftestcpp lstdc lv libplatform Wlrpathoptv lib Loptv lib lv configure configure conftest conftest symbol lookup error optv liblibv so undefined symbol ZTVN icu FieldPositionE configure configure program exited with status configure failed program was confdefsh define PACKAGENAME define PACKAGETARNAME define PACKAGEVERSION define PACKAGESTRING define PACKAGEBUGREPORT define PACKAGEURL define PHPV EXECPATH optv liblibv so end confdefsh include v h include iostream include fstream using namespace std int main ofstream testfile conftestval if testfileisopen testfile v V GetVersion testfile n testfileclose return return configure result NONE configure error could not determine libv version Cache variables accvbuildx pclinuxgnu accvccompilergnuyes accvcxxcompilergnuyes accvenvCCCset accvenvCCCvalue accvenvCCset accvenvCCvalue accvenvCFLAGSset accvenvCFLAGSvalue accvenvCPPFLAGSset accvenvCPPFLAGSvalue accvenvCPPset accvenvCPPvalue accvenvCXXCPPset accvenvCXXCPPvalue accvenvCXXFLAGSset accvenvCXXFLAGSvalue accvenvCXXset accvenvCXXvalue accvenvLDFLAGSsetset accvenvLDFLAGSvaluelstdc accvenvLIBSset accvenvLIBSvalue accvenvLTSYSLIBRARYPATHset accvenvLTSYSLIBRARYPATHvalue accvenvbuildaliasset accvenvbuildaliasvalue accvenvhostaliasset accvenvhostaliasvalue accvenvtargetaliasset accvenvtargetaliasvalue accvhostx pclinuxgnu accvobjexto accvpathEGREPbingrep E accvpathGREPbingrep accvpathSEDbinsed accvprogAWKnawk accvprogCPPcc E accvprogCXXCPPg E accvprogacctCCcc accvprogacctCXXg accvprogccc accvprogcccccoyes accvprogccgyes accvprogcxxgyes accvtargetx pclinuxgnu accvv cstdc accvv narrowingWnonarrowing accvv versionNONE phpcvccdashrno phpcvccrpathyes Output variables AR AWKnawk CCcc CFLAGSg O CONFIGURECOMMAND configure withv jsoptv CONFIGUREOPTIONS withv jsoptv CPPcc E CPPFLAGS Ioptv include stdc CXXg CXXCPPg E CXXFLAGSg O DEFS DLLTOOL DSYMUTIL DUMPBIN ECHOC ECHONn ECHOT EGREPbingrep E EXEEXT FGREP GREPbingrep LD LDFLAGSlstdc Wlrpathoptv lib Loptv lib LIBOBJS LIBSlstdc lv libplatform Wlrpathoptv lib Loptv lib lv LIBTOOL LIPO LNS LTLIBOBJS LTSYSLIBRARYPATH MANIFESTTOOL NM NMEDIT OBJDUMP OBJEXTo OTOOL OTOOL PACKAGEBUGREPORT PACKAGENAME PACKAGESTRING PACKAGETARNAME PACKAGEURL PACKAGEVERSION PATHSEPARATOR RANLIB RE Cexit SEDbinsed SHELLbinbash SHLIBDLSUFFIXNAMEso SHLIBSUFFIXNAMEso STRIP acctAR acctCCcc acctCXXg acctDUMPBIN bindirexecprefixbin buildx pclinuxgnu buildalias buildcpux buildoslinuxgnu buildvendorpc datadirdatarootdir datarootdirprefixshare docdirdatarootdirdocPACKAGE dvidirdocdir execprefixNONE hostx pclinuxgnu hostaliasx pclinuxgnu hostcpux hostoslinuxgnu hostvendorpc htmldirdocdir includedirprefixinclude infodirdatarootdirinfo libdirexecprefixlib libexecdirexecprefixlibexec localedirdatarootdirlocale localstatedirprefixvar mandirdatarootdirman oldincludedirusrinclude pdfdirdocdir prefixusr programtransformnamesxx psdirdocdir runstatedirlocalstatedirrun sbindirexecprefixsbin sharedstatedirprefixcom sysconfdirprefixetc targetx pclinuxgnu targetalias targetcpux targetoslinuxgnu targetvendorpc confdefsh confdefsh define PACKAGENAME define PACKAGETARNAME define PACKAGEVERSION define PACKAGESTRING define PACKAGEBUGREPORT define PACKAGEURL define PHPV EXECPATH optv liblibv so configure exit phpize output PHP Api Version Zend Module Api No Zend Extension Api No In READMEmd If you execute untrusted JavaScript code make sure to use V version or higher See notes on untrusted code mitigations for further details However the latest version of v js requires libv version so this note should mention it only needs to be checked when building older releases of v js or be removed This may be related to I believe although the code triggering the error is different Test script js const formatter new IntlNumberFormatfrFR style currency currency EUR formatterformat Result Fatal error in line Failed to create ICU number format are ICU data files missing FailureMessage Object x fffcb e d C stack trace lib libnodeso v basedebugStackTraceStackTrace x a x f a a lib libnodeso x e b x f a eef b lib libnodeso V Fatalchar const int char const x x f a f lib libnodeso v internalNumberFormatInitializeNumberFormatv internalIsolate v internalHandlev internalString v internalHandlev internalJSObject v internalHandlev internalJSObject x d x f a f lib libnodeso v internalRuntimeCreateNumberFormatint v internalObject v internalIsolate x f x f a cef x de c d Illegal instruction core dumped Do you think the issues lies with V itself the way V JS initializes ICU default location or my system Im using remi php phppeclv js RPM package on Fedora I have libicu installed Just in case anyone spends a bunch of time debugging for this error tmpv jstmpv jsv jsconvertcc error no matching function for call to v ValueBooleanValuev Localv Context v Maybebool value jsValueBooleanValuev context Compiling against a very recent version of V will fail due to this patch Looks like it may have gone into My apologies I just really need assistance My question is here Thank you If i do something like the following php class MyV extends V Js function foopayload echo payload name nope echo payloadname this is ok v new MyV myv v executeStringmyv foo nameTesting then ill get a Cannot use object of type V Object as array error This is unless I use FLAGFORCEARRAY If we were calling foo via PHP itd be quite normal to be passing an array eg thisfoo name Testing and not an object instance so I cannot share the function between the JS and PHP space without conditional conversions I dont use FLAGFORCEARRAY as I find the default setup generally more useful and because it just blanket applies to everything Anyway Would it be feasible to offer at initialisation PHP classes that would extend the default V ObjectV Function etc so that we could perhaps deal with these sorts of cases Then this would be possible php class MyV Object extends V Object implements ArrayAccess so the FLAGFORCEARRAYtype functionality can be much more selective Cheers Mark