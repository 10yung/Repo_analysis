Sorry Im not sure whether I should report this here or rlibactions I see this error on runson macOSlatest which is added usethisusegithubactions unable to load shared object Usersrunnerrunners worktempLibrarysystemfontslibssystemfontsso dlopenUsersrunnerrunners worktempLibrarysystemfontslibssystemfontsso Library not loaded optX liblibfreetype dylib Referenced from Usersrunnerrunners worktempLibrarysystemfontslibssystemfontsso Reason image not found Backtrace vdiffrexpectdoppelganger basegetExportedValuepkg name baseasNamespacens basegetNamespacens baseloadNamespacename baseloadNamespacej i L clibloc libPaths versionCheck vI j baseloadNamespacej i L clibloc libPaths versionCheck vI j baselibrarydynamlib package packagelib basedynloadfile DLLpath DLLpath Right now it doesnt push the failure log file when NOTCRAN is defined This is meant to avoid creating a log file when testthat is run interactively and only create it when testthat is run by R CMD check However if we detect CI this should take precedence this way we create the log file on Travis etc by default Maybe we should use isinteractive instead of NOTCRAN to determine whether to push a log file Or maybe we should only create a log file when either VDIFFRLOGPATH or CI is defined We are no longer running visual tests on CRAN anyway cc thomasp Hi there I get failing tests when I test some graphics as of this commit of brolgar and when I go to run vdiffrmanagecases I get the following error which I cant seem to work out how to fix do you have any suggestions on how to fix this Perhaps I am missing something obvious but any pointers would be much appreciated Cheers r vdiffrmanagecases Running testthat to collect visual cases N New visual case X Failed doppelganger o Successful doppelganger XXXoE Error while collecting vdiffr cases Last error test unknown message invalid type closure of argument You can inspect this error with vdiffrlastcollectionerror errorrlangerror while collecting vdiffr cases Last error test unknown message invalid type closure of argument You can inspect this error with vdiffrlastcollectionerror Backtrace vdiffrmanagecases vdiffrcollectcasespackage filter filter basesuppressMessages basewithCallingHandlersexpr message functionc invokeRestartmuffleMessage devtoolstestpackage filter filter reporter reporter withrwithoptions baseforcecode withrwithenvvar baseforcecode Browse Q details closed r Session info setting value version R version os macOS Mojave system x darwin ui RStudio language EN collate enAUUTF ctype enAUUTF tz AustraliaMelbourne date Packages package version date lib anytime assertthat backports P brolgar callr cli clipr colorspace crayon curl desc details devtools digest dplyr ellipsis evaluate fabletools fansi farver fontBitstreamVera fontLiberation fontquiver forcats freetypeharfbuzz fs gdtools generics gghighlight ggplot glue goodshirt gridExtra gtable htmltools httr jsonlite knitr labeling lazyeval lifecycle lubridate magrittr memoise munsell packrat pak patchwork pillar pkgbuild pkgconfig pkgload png prettyunits processx ps purrr R Rcpp remotes rlang rmarkdown rprojroot rsconnect rstudioapi scales scico sessioninfo stringi stringr systemfonts testthat tibble tidyr tidyselect tsibble usethis vctrs vdiffr withr xfun xml yaml zeallot source CRAN R CRAN R CRAN R local CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R standard standard standard CRAN R standard CRAN R CRAN R CRAN R CRAN R CRAN R Github tidyverseglue b e Github adamgruergoodshirt CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R standard CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R standard CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R local CRAN R CRAN R CRAN R CRAN R Github rlibusethis dd c CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R CRAN R LibraryFrameworksRframeworkVersions Resourceslibrary P Loaded and ondisk path mismatch details br Might be useful for patchwork cc thomasp My thought is that usevdiffr could add vdiffr to Suggests and also set up a template visualisation test in tests In trying to understand why some of reference figures produced with managecases use themegrey and some a simpler theme presume themetest I realised that any use of theme even if just to fix the position of a legend which cant be done any other way seems to defeat the use of the test theme For example I have the following to turn off a legend by default user can turn it back on r plt plt guidescolour none If I switch to the alternative r plt plt themelegendposition none in my function the visual tests fail In the first case I get themetest in the second I get themegrey Is there any way to reliably use the simple test theme whilst using theme in a function I appreciate that in the specific case above I can use guides but what if I want to force a specific legendposition r plt plt themelegendposition bottom I have a couple of very longrunning tests in a single file that generate images I wish to check with vdiffr but not every time I run R CMD check on the package or every time I run managecases these are tests for some outputs from a paper which should be run only when preparing for a release I know I can filter the tests that get run by managecases but only to select the ones to be run Id like to be able to select all tests but the tests that match the regexp so I can ignore the one test file I want to exclude from managecases This could be achieved by having managecases collectcases etc accept an invert argument that can be passed down to devtoolstest which would ultimately make testthatfiltertestscript invert the supplied regexp Added listeners for these keydown events leftright arrow switch case shift arrow switch group v validate active case shift v validate active group esc quit app New helper nextelement to increment input widgets To address and As of the newest testthat I believe a context isnt required at the top of a test file and usethisusetest doesnt give you one by default The visual case manager seems not to know about the automatically derived contexts from the file and renders the validated images to the wrong location the root figs location When testing I get an error saying that the visual test case hasnt been validated and a folder with the correct context has been created in my testthatfigs directory The workaround is to add an explicit context but this take me a while to figure out I updated today to RStudio and progress bar of managecases the one with o X and N doesnt seem to respect console width very well After reaching consoles right side progress bar doesnt go on a new line like it used to Here is a screenshot of current output where it goes very far to the right in first and last lines all symbols outside the view are vdiffrprogressbarissue This problem doesnt occur in RStudio I reinstalled it with all the same R and package versions no progress symbol appeared outside of current console width I am not really sure if that is a problem with vdiffr implementation or RStudio change but decided to create issue anyway