we build our nginxpassengermodule with a lua module is it possible to do this in passengerdocker or is there a variant with a lua module Now the latest passengerdocker image uses Phusion Passenger Hey there Were using this image phusionpassengerruby to run a Rails app and we are not seeing the behavior documented at Environment variables that are set up through Docker Compose env mechanism are visible to the Rails app My question is if this expected If so should the documentation be updated happy to submit a PR otherwise should this be fixed My biggest concern is that this is fixed inadvertently in a further version and apps suddenly start breaking for obscure reasons when updating the Phusion Passenger image version Reproduction steps We are using dockercompose Here are relevant extracts and reproduction steps yaml dockercomposeyml services app build environment TESTENVVAR TESTENVVAR bash env TESTENVVARtest Dockerfile Dockerfile FROM phusionpassengerruby Allow nginx to pass environment variables to the app at runtime COPY dockerenvconf etcnginxmaindenvconf Copy the apps files install dependencies etc envconf does not contain any line like env TESTENVVAR yet the following is possible bash sudo dockercompose build sudo dockercompose up d sudo dockercompose exec app bash The environment variable is in the containers environment rootc f ehomeapp printenv grep TESTENVVAR TESTENVVARtest Our nginx config doesnt contain anything to pass the env var to the child processes rootc f ehomeapp cat etcnginxmainddbenvconf grep TESTENVVAR Yet Rails has loaded the environment variable rootc f ehomeapp cd webapp rootc f ehomeappwebapp binrails c Running via Spring preloader in process Loading production environment Rails ENV TESTENVVAR test Im not sure if this is related to phusionbaseimagedocker but Im getting the following error on the most recent phusionpassengerruby image Arch Linux host Docker version ce passenger Running etcmyinitd regensshhostkeyssh passenger Running etcmyinitd syslognginit passenger T Error opening control socket bind failed socketvarlibsyslogngsyslogngctl errorPermission denied passenger May a c c syslogng syslogng starting up version passenger etcmyinitd syslognginit failed with status passenger Killing all processes passenger May a c c syslogng syslogng shutting down version This error seems to block the container for continuing causing my application to not function with new builds From the Readmemd I get the impression that the attached Dockerfiletxt should build an image that can run containers I can SSH into Im not able to log in though even though my key is clearly added correctly What else do I need to do Could you please add to or correct the Readme to make this more obvious Here is what I did to create the image and the container GimliCentaur griesser docker build t linzertorte Sending build context to Docker daemon MB Step FROM phusionpassengerfull dff ec Step ENV HOME root Using cache d d f Step CMD sbinmyinit Using cache b a Step ADD keysidrsapub tmpidrsapub Using cache efcc d e Step RUN cat tmpidrsapub rootsshauthorizedkeys Running in fecd c c c Removing intermediate container fecd c c c ccf dfa c Step RUN rm f etcservicesshddown Running in c c e bf Removing intermediate container c c e bf f b d e Step RUN etcmyinitd regensshhostkeyssh Running in ab cd No SSH host key available Generating one Creating SSH RSA key this may take some time SHA jmfxpk tbzBoSP Iio tIsQf fmUf cPzwV Wie E root ab cd RSA Creating SSH ECDSA key this may take some time SHA yz WxTlYgQ AakvSEaHzikbqCMVxW nraLiZhDqHE root ab cd ECDSA Creating SSH ED key this may take some time SHA ZNCSDsGIFEI P q nqX WsGI bMrNebbgSktXOOM root ab cd ED invokercd could not determine current runlevel invokercd policyrcd denied execution of restart Removing intermediate container ab cd e e da f Step RUN aptget clean rm rf varlibaptlists tmp vartmp Running in a feb Removing intermediate container a feb d efef Successfully built d efef Successfully tagged linzertortelatest GimliCentaur griesser docker run name Sneezy linzertorte Running etcmyinitd regensshhostkeyssh Running etcmyinitd syslognginit Apr c f c d syslogng syslogng starting up version Running etcmyinitd presetupnginxsh Booting runit daemon Runit started as PID Apr c f c d cron CRON INFO pidfile fd Apr c f c d cron CRON INFO Running reboot jobs Then in another shell I attempted to log in via ssh GimliCentaur griesser docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c f c d linzertorte sbinmyinit seconds ago Up seconds tcp tcp Sneezy GimliCentaur griesser docker inspect f NetworkSettingsIPAddress c f c d GimliCentaur griesser ssh i Usersgriessersshidrsa root ssh connect to host port Operation timed out Since that failed I verified that my public key was indeed copied intorootsshauthorizedkeys GimliCentaur griesser docker exec it Sneezy bash l root c f c d more rootsshauthorizedkeys sshrsa AAAAB NzaC yc EAAAADAQABAAACAQC N E W rTUeQQs rv prVAuREDlMrzd fkEHfksLlblX eKqr DEECFBvnydLtxmRDo LAdTJxitCodjjiSkLj keSRoumzz CIVN r IZjay uwRC VCvMrcCqihjmr kWpgJ spu VmcntJtXvV hmHz oF Dw ObXhrHZdNN BmppcztjyOjOD DYOwHkAPEVuSHBxy tfbC A Slxz tNnwUY EEQO ljkX ptQxDlXBvxpvmVfp jGetOBv QXgHPVvV g hO NfTqyWgKYUxnQyBmOrRpbaO wXeDCc DG ElZGs jQm OrJkIe SU y URppYN s mrRd Y YtZAus OWGZs nVzStRcyEfxYy vVZ DEKuF keumo mZRvgEaf hf ys r k wv bzMbz sFWfwlEVzNqvrUbhZ XFM qlwszB wYQjubRclG oWyEsB zBFzHbh Ypp fazTJzqgYNW rN QZxAMkiiQrHIJ WqipIF t ZcMgtVzlD tel ToZqsui P xkwY TppeKGzmttCDS s iAbdUIxMln dONyysMxJIk W VYxFyqGCbiPCYW KD Rn t lLYpE wiHPhH CrL t rycOwSiCktzwjuJvMTHn Rw griesserGimlilocal root c f c d The main READMEmd in a couple of places suggests that to upgrade the OSPassenger in the image run this in your Dockerfile RUN aptget update aptget upgrade y o DpkgOptionsforceconfold suggests that the above will leave unmodified conf files untouched by any future upgrades and to upgrade these to their new defaults you should use RUN aptget update aptget upgrade y o DpkgOptionsforceconfdef o DpkgOptionsforceconfold ie you need to define both options bash dockercompose f dockercomposedevyml up build Building server Step FROM phusionpassengercustomizable a dbad Step RUN pdbuildnodejssh Running in c be echo Enabling Node Source APT repo Enabling Node Source APT repo run curl s echo curl s curl s aptkey add Warning aptkey output should not be parsed stdout is not a terminal OK echo deb bionic main echo debsrc bionic main aptget update Get bionicsecurity InRelease kB Err bionicsecurity InRelease Error writing to output file write No space left on device IP Get bionic InRelease kB Err bionic InRelease Error writing to output file write No space left on device IP Get bionic InRelease B Err bionic InRelease Error writing to output file write No space left on device IP Get bionicupdates InRelease kB Err bionicupdates InRelease Error writing to output file write No space left on device IP Ign bionic InRelease Get bionicbackports InRelease kB Err bionicbackports InRelease Error writing to output file write No space left on device IP Get bionic Release kB Err bionic Release Error writing to output file write No space left on device IP Reading package lists E The repository bionic Release does not have a Release file ERROR Service server failed to build The command binsh c pdbuildnodejssh returned a nonzero code this portion of my Dockerfile sets up nginx enterprise as I have for years ADD dockerconfigpassengerenterpriselicense etcpassengerenterpriselicense RUN echo deb bionic main etcaptsourceslistdpassengerlist RUN aptget update aptget install y o DpkgOptionsforceconfold passengerenterprise nginxextras Which installs fine but nginx starts with error Running etcmyinitd regensshhostkeyssh Running etcmyinitd syslognginit Jan c d d syslogng syslogng starting up version Running etcmyinitd presetupnginxsh Booting runit daemon Runit started as PID ok run etcservicenginxlogforwarder pid s Jan c d d cron CRON INFO pidfile fd Jan c d d cron CRON INFO Running reboot jobs nginx emerg open etcnginxmodulesenabled modhttppassengerconf failed No such file or directory in etcnginxnginxconf emerg open etcnginxmodulesenabled modhttppassengerconf failed No such file or directory in etcnginxnginxconf The file is indeed missing It seems that other people have run into this issue in the past and have fixed it with deleting files symlinks etc But we should not have to hack this image to get it to work Any suggestions fix I use passengercustomizable to build my docker image And I enabled the redis but when I run the image it keep reporting error in varlogredisserverlog Creating Server TCP listening socket bind Cannot assign requested address I checked the redisconf file and the default config is bind if I change it to bind everything restores normal so is it a configuration error