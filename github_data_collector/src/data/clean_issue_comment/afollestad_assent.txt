 xml javalangRuntimeException Failure delivering result ResultInfowhoandroidrequestPermissions request result dataIntent actandroidcontentpmactionREQUESTPERMISSIONS has extras to activity applicationMainActivity javalangIllegalStateException Can not perform this action after onSaveInstanceState at androidappActivityThreaddeliverResultsActivityThreadjava at androidappActivityThreadhandleSendResultActivityThreadjava at androidappservertransactionActivityResultItemexecuteActivityResultItemjava at androidappservertransactionTransactionExecutorexecuteCallbacksTransactionExecutorjava at androidappservertransactionTransactionExecutorexecuteTransactionExecutorjava at androidappActivityThreadHhandleMessageActivityThreadjava at androidosHandlerdispatchMessageHandlerjava at androidosLooperloopLooperjava at androidappActivityThreadmainActivityThreadjava at javalangreflectMethodinvokeNative Method at comandroidinternalosRuntimeInitMethodAndArgsCallerrunRuntimeInitjava at comandroidinternalosZygoteInitmainZygoteInitjava Caused by javalangIllegalStateException Can not perform this action after onSaveInstanceState at androidxfragmentappFragmentManagerImplcheckStateLossFragmentManagerImpljava at androidxfragmentappFragmentManagerImplenqueueActionFragmentManagerImpljava at androidxfragmentappBackStackRecordcommitInternalBackStackRecordjava at androidxfragmentappBackStackRecordcommitBackStackRecordjava at comafollestadassentinternalExtensionsKttransactExtensionskt at comafollestadassentinternalPermissionFragmentdetachcomafollestadassentPermissionFragmentkt at comafollestadassentinternalAssentCompanionforgetFragmentAssentkt at comafollestadassentinternalPermissionFragmentKtonPermissionsResponsePermissionFragmentkt at comafollestadassentinternalPermissionFragmentonRequestPermissionsResultPermissionFragmentkt at androidxfragmentappFragmentActivityonRequestPermissionsResultFragmentActivityjava at androidappActivitydispatchRequestPermissionsResultActivityjava at androidappActivitydispatchActivityResultActivityjava at androidappActivityThreaddeliverResultsActivityThreadjava at androidappActivityThreadhandleSendResultActivityThreadjava at androidappservertransactionActivityResultItemexecuteActivityResultItemjava at androidappservertransactionTransactionExecutorexecuteCallbacksTransactionExecutorjava at androidappservertransactionTransactionExecutorexecuteTransactionExecutorjava at androidappActivityThreadHhandleMessageActivityThreadjava at androidosHandlerdispatchMessageHandlerjava at androidosLooperloopLooperjava at androidappActivityThreadmainActivityThreadjava at javalangreflectMethodinvokeNative Method at comandroidinternalosRuntimeInitMethodAndArgsCallerrunRuntimeInitjava at comandroidinternalosZygoteInitmainZygoteInitjava Library Version Affected Devices Note with API Describe the Bug Permission dialog crashes after rotation To Reproduce Open a fragment that requires a permission with runWithPermissions Wait for the permissions alert Rotate the device Press Allow or deny RESULT Crash Expected Behavior No Crash Library Version Affected Devices XIAOMI note android Describe the Bug EAndroidRuntime FATAL EXCEPTION main Process comfoooobaaar PID javalangIllegalStateException Failure saving state active PermissionFragmentb a fa has cleared index at androidxfragmentappFragmentManagerImplsaveAllStateFragmentManagerjava at androidxfragmentappFragmentperformSaveInstanceStateFragmentjava at androidxfragmentappFragmentManagerImplsaveFragmentBasicStateFragmentManagerjava at androidxfragmentappFragmentManagerImplsaveAllStateFragmentManagerjava at androidxfragmentappFragmentControllersaveAllStateFragmentControllerjava at androidxfragmentappFragmentActivityonSaveInstanceStateFragmentActivityjava at androidxappcompatappAppCompatActivityonSaveInstanceStateAppCompatActivityjava at androidappActivityperformSaveInstanceStateActivityjava at androidappInstrumentationcallActivityOnSaveInstanceStateInstrumentationjava at androidappActivityThreadcallCallActivityOnSaveInstanceStateActivityThreadjava at androidappActivityThreadperformStopActivityInnerActivityThreadjava at androidappActivityThreadhandleStopActivityActivityThreadjava at androidappActivityThreadwrap ActivityThreadjava at androidappActivityThreadHhandleMessageActivityThreadjava at androidosHandlerdispatchMessageHandlerjava at androidosLooperloopLooperjava at androidappActivityThreadmainActivityThreadjava at javalangreflectMethodinvokeNative Method at comandroidinternalosZygoteInitMethodAndArgsCallerrunZygoteInitjava at comandroidinternalosZygoteInitmainZygoteInitjava To Reproduce using jetpack navigation launch fragment run runWithPermissionsPermissionWRITEEXTERNALSTORAGE doSomeStuff press home and save state with override fun onSaveInstanceStateoutState Bundle superonSaveInstanceStateoutState Save recycler view state outStateputParcelableLISTSTATEKEY mLayoutManageronSaveInstanceState crash Expected Behavior when i press home without doing runWithPermissionsPermissionWRITEEXTERNALSTORAGE doSomeStuff it works fine otherwise it crashes Implement a shouldShowRequestPermissionRationale callback and a information if the user ticked the Never ask againoption