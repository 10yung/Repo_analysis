Im having trouble with using packed ttc files in node canvas The design of registerFont api does not seem to work with packed fonts and I have tried numerous ways but it seems only selects the normal weight Im with node v on macOS Catalina btw Issue or Feature I couldnt install this package in my computer with Nodejs v x however I fixed it by downgrading Nodejs to v but I still dont know why I couldnt use Nodejs v x to compile install it First I met nodegyp rebuild errror and gyp ERR stack Error make failed with exit code contextify install UsershijiangtaoDocumentsgitworktutorcheerwebnodemodulescontextify nodegyp rebuild CXXtarget Releaseobjtargetcontextifysrccontextifyo In file included from srccontextifycc In file included from nannanh In file included from nannanconvertersh nannanconverters inlh error no viable conversion from Localv Context to v Isolate XBoolean fatal error too many errors emitted stopping now ferrorlimit warnings and errors generated make ReleaseobjtargetcanvassrcCanvaso Error gyp ERR build error gyp ERR stack Error make failed with exit code gyp ERR stack at ChildProcessonExit Usershijiangtaonvmversionsnodev libnodemodulesnpmnodemodulesnodegyplibbuildjs gyp ERR stack at ChildProcessemit eventsjs gyp ERR stack at ProcessChildProcesshandleonexit internalchildprocessjs gyp ERR System Darwin gyp ERR command Usershijiangtaonvmversionsnodev binnode Usershijiangtaonvmversionsnodev libnodemodulesnpmnodemodulesnodegypbinnodegypjs rebuild gyp ERR cwd UsershijiangtaoDocumentsgitworktutorcheerwebnodemodulesfabricnodemodulescanvas gyp ERR node v v gyp ERR nodegyp v v gyp ERR not ok As said in and I thought it may be a problem belongs to Mac OS X v so I tried npm install nodegyp g and xcodeselect install but it didnt work I also tried many solutions which contains some similar errors output such as etc One of them looks like this xcodeselect install I thought this was dumb but was key to one of my issues npm install nodegyp g brew install giflib cairo libjpeg giflib pixman export PKGCONFIGPATHoptX libpkgconfig OTHERCFLAGSIusrlocalinclude npm install canvas However it didnt work Steps to Reproduce js with nvm installed before nvm install v npm install canvas Your Environment Version of nodecanvas Environment macOS B Thanks The majority of issues opened in nodecanvas are for installation help This post is an experiment to see if we can help users help themselves to troubleshoot installations Installation fails with a in the log If youre on Alpine Linux or another distro using musllibc The log may look like nodepregyp WARN Tried to download Prebuilds are only available for glibc not musllibc See which includes information on building from source If youre using Electron The log may look like nodepregyp WARN Tried to download nodepregyp WARN Prebuilt binaries not found for canvas and electron electronv ABI unknown falling back to source compile with nodegyp There are no prebuilds available for Electron Please see the wiki for guides on building from source See also or If a new version of Nodejs was recently released The log may look like nodepregyp WARN Tried to download nodepregyp WARN Prebuilt binaries not found for canvas and node nodev ABI unknown falling back to source compile with nodegyp We manually publish prebuilt versions of nodecanvas and it can take some time for us to catch up In particular Appveyor used for Windows is slow to provide new Nodejs versions so Windows prebuilds may be delayed You can see the list of available prebuilds here expand the Assets section under the version youre trying to install If you have an ARM CPU Prebuilds arent available for ARM Please see the wiki for guides on building from source See also I get a permissions error EACCES Possibly your nodemodules or an npm or yarn cache or temp directory is owned by a different user Review the error log to see what folder you dont have permission to access See for an example or any of these issues If you were trying to install with sudo try without See issues I get a NODEMODULEVERSION error The log may look like was compiled against a different Nodejs version using NODEMODULEVERSION This version of Nodejs requires NODEMODULEVERSION Please try recompiling or reinstalling the module This could mean you upgraded Nodejs without reinstalling canvas Try running yarn or npm install again Installation fails with lots of compiler errors including was declared deprecated andor no viable conversion Youre probably trying to install an old version of nodecanvas Version x is required for Nodejs v x and later Check if your packagejson or lock file specifies a x version To keep this issue concise and ontopic comments asking for help will be deleted please open a separate issue instead comments with suggestions for improving the troubleshooting are welcome and will be hidden after incorporating into this top post ts width height scale const canvas createCanvaswidth scale height scale const ctx canvasgetContext d ctxscalescale scale ctxfillStyle white ctxfillRect width height if dev ctxfillStyle black ctxfont px SansSerif ctxfillTextdev height ctxfillStyle black ctxfont px SansSerif ctxfillTextwidthxheight Installing with npm install canvas After using npm install canvas buildfromsource Steps to Reproduce My repository Earliest commit with the issue Edit the indexts to have scaling enabled I used const imageStream renderwidth height dev scale When running locally open Environment canvas npm System Version macOS B P S While installing I had to manually execute export PKGCONFIGPATHusrlocaloptlibffilibpkgconfig Would make a simpler reproduction case but since the issues is solved just by recompiling I dont see it worth the effort Im trying to install canvas on macOS Mojave I executed brew install pkgconfig cairo pango libpng jpeg giflib librsvg but there is still an error Issue or Feature When i type npm i canvas the following log appears MACBOOKproject user npm i canvas canvas install UsersuserDesktopprojectnodemodulescanvas nodepregyp install fallbacktobuild nodepregyp WARN Using request for nodepregyp https download nodepregyp WARN Prebuilt binaries not installable for canvas and node nodev ABI unknown falling back to source compile with nodegyp nodepregyp WARN Hit error unable to get local issuer certificate Package zlib was not found in the pkgconfig search path Perhaps you should add the directory containing zlibpc to the PKGCONFIGPATH environment variable Package zlib required by libpng not found gyp Call to pkgconfig libpng libs returned exit status while in bindinggyp while trying to load bindinggyp gyp ERR configure error gyp ERR stack Error gyp failed with exit code gyp ERR stack at ChildProcessonCpExit usrlocallibnodemodulesnpmnodemodulesnodegyplibconfigurejs gyp ERR stack at ChildProcessemit eventsjs gyp ERR stack at ProcessChildProcesshandleonexit internalchildprocessjs gyp ERR System Darwin gyp ERR command usrlocalbinnode usrlocallibnodemodulesnpmnodemodulesnodegypbinnodegypjs configure fallbacktobuild moduleUsersuserDesktopprojectnodemodulescanvasbuildReleasecanvasnode modulenamecanvas modulepathUsersuserDesktopprojectnodemodulescanvasbuildRelease napiversion nodeabinapinapi napibuildversion nodenapilabelnodev pythonusrbinpython gyp ERR cwd UsersuserDesktopprojectnodemodulescanvas gyp ERR node v v gyp ERR nodegyp v v gyp ERR not ok nodepregyp ERR build error nodepregyp ERR stack Error Failed to execute usrlocalbinnode usrlocallibnodemodulesnpmnodemodulesnodegypbinnodegypjs configure fallbacktobuild moduleUsersuserDesktopprojectnodemodulescanvasbuildReleasecanvasnode modulenamecanvas modulepathUsersuserDesktopprojectnodemodulescanvasbuildRelease napiversion nodeabinapinapi napibuildversion nodenapilabelnodev pythonusrbinpython nodepregyp ERR stack at ChildProcessanonymous UsersuserDesktopprojectnodemodulesnodepregyplibutilcompilejs nodepregyp ERR stack at ChildProcessemit eventsjs nodepregyp ERR stack at maybeClose internalchildprocessjs nodepregyp ERR stack at ProcessChildProcesshandleonexit internalchildprocessjs nodepregyp ERR System Darwin nodepregyp ERR command usrlocalbinnode UsersuserDesktopprojectnodemodulesbinnodepregyp install fallbacktobuild nodepregyp ERR cwd UsersuserDesktopprojectnodemodulescanvas nodepregyp ERR node v v nodepregyp ERR nodepregyp v v nodepregyp ERR not ok Failed to execute usrlocalbinnode usrlocallibnodemodulesnpmnodemodulesnodegypbinnodegypjs configure fallbacktobuild moduleUsersuserDesktopprojectnodemodulescanvasbuildReleasecanvasnode modulenamecanvas modulepathUsersuserDesktopprojectnodemodulescanvasbuildRelease napiversion nodeabinapinapi napibuildversion nodenapilabelnodev pythonusrbinpython npm WARN project No license field npm ERR code ELIFECYCLE npm ERR errno npm ERR canvas install nodepregyp install fallbacktobuild npm ERR Exit status npm ERR npm ERR Failed at the canvas install script npm ERR This is probably not a problem with npm There is likely additional logging output above npm ERR A complete log of this run can be found in npm ERR Usersusernpmlogs T Zdebuglog Your Environment Version of nodecanvas Environment npm with node on macOS Mojave Issue or Feature When installing canvas on Linux the following error pops up nodepregyp WARN Tried to download Steps to Reproduce Do npm install canvas on linux Your Environment Environment Node v on linux Having trouble installing nodecanvas Please make sure you have read the installation instructions located here before asking for help Still having problems found a bug or want a feature Fill out the form below Provide a general summary of the issue in the Title above Issue or Feature Provide info about the bug or feature Error reporting when loading SVG with loadImage Steps to Reproduce For bugs provide a short complete code example to reproduce the issue js var Canvas requirecanvas var canvas CanvascreateCanvas var ctx canvasgetContext d etc var iconUrl dataimagesvgxmlbase PHN ZyB bWxucz iaHR cDovL d dy My vcmcvMjAwMC zdmciIHZpZXdCb g IjAgMCAxNi zOCAxNi zOCIPGRlZnMPHN eWxlPi jbHMtMXtmaWxsOiMyMmNiZmY c Ryb tlOiMwMDAwMzc c Ryb tlLW pdGVybGltaXQ MTA c Ryb tlLXdpZHRoOjAuMzhweDt LmNscy ye ZpbGw I ZmZjt PC zdHlsZT L RlZnMPHRpdGxlPui hOa kCAyNTwvdGl bGUPGcgaWQ IuWbvuWxgl yIiBkYXRhLW hbWU IuWbvuWxgiAyIj ZyBpZD i Zu bGCXzEtMiIgZGF YS uYW lPSLlm lsYIgMSIPGNpcmNsZSBjbGFzcz iY xzLTEiIGN PSI LjE IiBjeT iOC xOSIgcj iOCIvPjxwYXRoIGNsYXNzPSJjbHMtMiIgZD iTTEyLjY LDExLjhWNy OEgxMC OVYyLjc YS yOS yOSwwLDAsMC uMjktLjI SDUuNzhhLjI LjI LDAsMCwwLS yOS yOVY LjQ SDMuNzRWMTEuOEgzdi OEgxMy MlYxMS Wm tNC LjExSDkuOTRWNUg LjY Wm wLDEuODFIOS NFY Ljc SDguNjdabTAsMS SDkuOTRWOC N g LjY Wk LjI LDguODNsLjQ LjksMSwuMTUtLjcxLjcuMTYsMS uODgtLjQ LS OS Ny xNy xLS Mi uNywxLS xNVpNNi NCwzLjY SDcuNzFWNUg LjQ Wm wLDEuODFINy MVY Ljc SDYuNDRabTAsMS SDcuNzFWOC N g LjQ WiIvPjwvZz L cPC zdmc CanvasloadImageiconUrlthenimg ctxdrawImageimg Your Environment Version of nodecanvas output of npm list canvas or yarn list canvas canvas Environment eg node on Mac OS X Mac OS X Context Creating png images using custom fonts Not super familiar with nodecanvass c side of things so I may be way off but it seems there is some sort of caching going on Im having an issue where some fonts within a family all render using the exact same font face whichever font was registered first being the one that is used for all subsequent fonts While digging I found that these fonts have the same preferred family name and the same style properties within their meta info using FontForge Using FontForge to change the preferred family name I was able to get these to work properly but thats not a solution for how were using nodecanvas The above example hints that the family name and styles within the fonts meta info will be used Is there a way to override that behavior and provide predefined names instead of using whats provided inside the file itself Im using register font like this registerFontlocalFilepath family optionslocalFontName env canvas node OSX and FreeBSD I have a little problem with installing canvas on Debian canvas install optnodeserverblownodemodulescanvas nodepregyp install fallbacktobuild nodepregyp WARN Using needle for nodepregyp https download nodepregyp WARN Prebuilt binaries not installable for canvas and node nodev ABI glibc falling back to source compile with nodegyp nodepregyp WARN Hit error EACCES permission denied mkdir optnodeserverblownodemodulescanvasbuild gyp WARN EACCES user blow does not have permission to access the dev dir rootcachenodegyp gyp WARN EACCES attempting to reinstall using temporary dev dir optnodeserverblownodemodulescanvasnodegyp gyp WARN install got an error rolling back install gyp WARN install got an error rolling back install gyp ERR configure error gyp ERR stack Error EACCES permission denied mkdir optnodeserverblownodemodulescanvasnodegyp gyp ERR System Linux gyp ERR command usrbinnode usrlibnodemodulesnpmnodemodulesnodegypbinnodegypjs configure fallbacktobuild moduleoptnodeserverblownodemodulescanvasbuildReleasecanvasnode modulenamecanvas modulepathoptnodeserverblownodemodulescanvasbuildRelease napiversion nodeabinapinapi napibuildversion nodenapilabelnodev gyp ERR cwd optnodeserverblownodemodulescanvas gyp ERR node v v gyp ERR nodegyp v v gyp ERR not ok nodepregyp ERR build error nodepregyp ERR stack Error Failed to execute usrbinnode usrlibnodemodulesnpmnodemodulesnodegypbinnodegypjs configure fallbacktobuild moduleoptnodeserverblownodemodulescanvasbuildReleasecanvasnode modulenamecanvas modulepathoptnodeserverblownodemodulescanvasbuildRelease napiversion nodeabinapinapi napibuildversion nodenapilabelnodev nodepregyp ERR stack at ChildProcessanonymous usrlibnodemodulesnodepregyplibutilcompilejs nodepregyp ERR stack at ChildProcessemit eventsjs nodepregyp ERR stack at maybeClose internalchildprocessjs nodepregyp ERR stack at ProcessChildProcesshandleonexit internalchildprocessjs nodepregyp ERR System Linux nodepregyp ERR command usrbinnode usrbinnodepregyp install fallbacktobuild nodepregyp ERR cwd optnodeserverblownodemodulescanvas nodepregyp ERR node v v nodepregyp ERR nodepregyp v v nodepregyp ERR not ok Failed to execute usrbinnode usrlibnodemodulesnpmnodemodulesnodegypbinnodegypjs configure fallbacktobuild moduleoptnodeserverblownodemodulescanvasbuildReleasecanvasnode modulenamecanvas modulepathoptnodeserverblownodemodulescanvasbuildRelease napiversion nodeabinapinapi napibuildversion nodenapilabelnodev npm WARN ordersmanagement No repository field npm WARN optional SKIPPING OPTIONAL DEPENDENCY fsevents nodemodulesfsevents npm WARN notsup SKIPPING OPTIONAL DEPENDENCY Unsupported platform for fsevents wanted osdarwinarchany current oslinuxarchx npm ERR code ELIFECYCLE npm ERR errno npm ERR canvas install nodepregyp install fallbacktobuild npm ERR Exit status npm ERR npm ERR Failed at the canvas install script npm ERR This is probably not a problem with npm There is likely additional logging output above npm ERR A complete log of this run can be found in npm ERR rootnpmlogs T Zdebuglog Environment Debian Node NPM Having trouble installing nodecanvas Please make sure you have read the installation instructions located here before asking for help Still having problems found a bug or want a feature Fill out the form below Provide a general summary of the issue in the Title above Feature Provide info about the bug or feature Could the API for createImageData be replaced by or supplemented by ImageData for slightly easier parity with the browser constructor Steps to Produce For bugs provide a short complete code example to reproduce the issue js const ImageData requirecanvas const data new ImageData Your Environment Version of nodecanvas output of npm list canvas or yarn list canvas Environment eg node on Mac OS X Mac OS X 