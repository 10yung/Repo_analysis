Bumps typescript from rc to details summaryRelease notessummary pemSourced from a href releasesaemp blockquote h TypeScript h pFor the complete list of fixed issues check out thep ul lia href issues query for Typescript v Betaali lia href issues query for Typescript v RCali lia href issues query for Typescript v Finalali lia href issues query for Typescript v ali lia href issues query for Typescript v ali lia href issues query for Typescript v ali ul h TypeScript h pFor the complete list of fixed issues check out thep ul lia href issues query for Typescript v Betaali lia href issues query for Typescript v RCali lia href issues query for Typescript v Finalali lia href issues query for Typescript v ali lia href issues query for Typescript v ali ul pDownloads are available onp ul lia href lia href Studioa a href new version in project optionsali lia href packageali ul h TypeScript h pFor the complete list of fixed issues check out thep ul lia href issues query for Typescript v Betaali lia href issues query for Typescript v RCali lia href issues query for Typescript v Finalali lia href issues query for Typescript v ali ul pDownloads are available onp ul lia href lia href Studioa a href new version in project optionsali lia href packageali ul h TypeScript h pFor release notes check out the a href announcementap pFor new features check out the a href new in TypeScript v ap pFor the complete list of fixed issues check out thep ul lia href issues query for Typescript v Betaali lia href issues query for Typescript v RCali lia href issues query for Typescript v Finalali ul trtable truncated blockquote details details summaryCommitssummary ul liSee full diff in a href viewali ul details br Dependabot compatibility score Dependabot will resolve any conflicts with this PR as long as you dont alter it yourself You can also trigger a rebase manually by commenting dependabot rebase dependabotautomergestart dependabotautomergeend details summaryDependabot commands and optionssummary br You can trigger Dependabot actions by commenting on this PR dependabot rebase will rebase this PR dependabot recreate will recreate this PR overwriting any edits that have been made to it dependabot merge will merge this PR after your CI passes on it dependabot squash and merge will squash and merge this PR after your CI passes on it dependabot cancel merge will cancel a previously requested merge and block automerging dependabot reopen will reopen this PR if it is closed dependabot close will close this PR and stop Dependabot recreating it You can achieve the same result by closing it manually dependabot ignore this major version will close this PR and stop Dependabot creating any more for this major version unless you reopen the PR or upgrade to it yourself dependabot ignore this minor version will close this PR and stop Dependabot creating any more for this minor version unless you reopen the PR or upgrade to it yourself dependabot ignore this dependency will close this PR and stop Dependabot creating any more for this dependency unless you reopen the PR or upgrade to it yourself dependabot use these labels will set the current labels as the default for future PRs for this repo and language dependabot use these reviewers will set the current reviewers as the default for future PRs for this repo and language dependabot use these assignees will set the current assignees as the default for future PRs for this repo and language dependabot use this milestone will set the current milestone as the default for future PRs for this repo and language dependabot badge me will comment on this PR with code to add a Dependabot enabled badge to your readme Additionally you can set the following in your Dependabot dashboard Update frequency including time of day and day of week Pull request limits per update run andor open at any time Outofrange updates receive only lockfile updates if desired Security updates receive only security updates if desired details Bumps nock from to details summaryRelease notessummary pemSourced from a href releasesaemp blockquote h v h h a href h h Bug Fixesh ul liFix a regression due to Jest having different globals a href a href ul h v h h a href h h Bug Fixesh ul limake interceptors work in any order even when filteringScope a href a href closes a href ul blockquote details details summaryCommitssummary ul lia href fix Fix a regression due to Jest having different globals a href lia href Update dtslint to the latest version a href lia href Update sinon to the latest version a href lia href Update prettier to the latest version a href lia href fix make interceptors work in any order even when filteringScope a href lia href Update nyc to the latest version a href lia href minor typo in indexjs comment a href lia href Update eslintpluginnode to the latest version a href lia href choredeps bump handlebars from to li lia href refactor remove chai as a prod dependency a href liAdditional commits viewable in a href viewali ul details br Dependabot compatibility score Dependabot will resolve any conflicts with this PR as long as you dont alter it yourself You can also trigger a rebase manually by commenting dependabot rebase dependabotautomergestart dependabotautomergeend details summaryDependabot commands and optionssummary br You can trigger Dependabot actions by commenting on this PR dependabot rebase will rebase this PR dependabot recreate will recreate this PR overwriting any edits that have been made to it dependabot merge will merge this PR after your CI passes on it dependabot squash and merge will squash and merge this PR after your CI passes on it dependabot cancel merge will cancel a previously requested merge and block automerging dependabot reopen will reopen this PR if it is closed dependabot close will close this PR and stop Dependabot recreating it You can achieve the same result by closing it manually dependabot ignore this major version will close this PR and stop Dependabot creating any more for this major version unless you reopen the PR or upgrade to it yourself dependabot ignore this minor version will close this PR and stop Dependabot creating any more for this minor version unless you reopen the PR or upgrade to it yourself dependabot ignore this dependency will close this PR and stop Dependabot creating any more for this dependency unless you reopen the PR or upgrade to it yourself dependabot use these labels will set the current labels as the default for future PRs for this repo and language dependabot use these reviewers will set the current reviewers as the default for future PRs for this repo and language dependabot use these assignees will set the current assignees as the default for future PRs for this repo and language dependabot use this milestone will set the current milestone as the default for future PRs for this repo and language dependabot badge me will comment on this PR with code to add a Dependabot enabled badge to your readme Additionally you can set the following in your Dependabot dashboard Update frequency including time of day and day of week Pull request limits per update run andor open at any time Outofrange updates receive only lockfile updates if desired Security updates receive only security updates if desired details Is your feature request related to a problem I just started using Verdaccio on an AWS Amazon Linux EC instance and I have no idea on how to install plugins I installed Verdaccio using npm install g verdaccio and it runs fine I can access the web interface Now I want to add the github oauth plugin but I have no idea on how to get this working I tried npm install g verdacciogithuboauthui and modifying the config file for this plugin but restarting Verdaccio only gives me Error verdacciogithuboauthui plugin not found try npm install verdacciogithuboauthui I saw there is a plugins directory in the config file but I have no idea how to install a plugin there as running an npm install in that directory will just create a nodemodules subdirectory containing the plugin and all its dependencies I tried this too btw and it also didnt work Describe the solution youd like I would like to see a few lines of documentation on how to install plugins the same way the installation of Verdaccio itself is clearly explained The only ones I find are about using Docker and extending the image to add plugins Thanks a lot I use it on macOS and it works well but when I run verdaccio on centos system it doesnt work the error is as follows rootlocalhost verdaccio dockercompose f verdaccioyml logs f Attaching to verdaccio verdaccio warn config file verdaccioconfconfigyaml verdaccio warn experiments are enabled we recommend do not use experiments in production comment out this section to disable it verdaccio warn support for token is enabled verdaccio warn Verdaccio started verdaccio warn Plugin successfully loaded verdacciohtpasswd verdaccio warn Plugin successfully loaded verdaccioaudit verdaccio warn http address verdaccio verdaccio http user null req POST v login bytes verdaccio http user null req POST v login bytes verdaccio http user null req PUT userorgcouchdbuseradmin error username is already registered verdaccio http user null req PUT userorgcouchdbuseradmin error username is already registered verdaccio http user null req GET userorgcouchdbuseradminwritetrue bytes verdaccio http user null req GET userorgcouchdbuseradminwritetrue bytes verdaccio node DEP DeprecationWarning Buffer is deprecated due to security and usability issues Please use the Bufferalloc BufferallocUnsafe or Bufferfrom methods instead verdaccio http user admin req PUT userorgcouchdbuseradminrevundefined bytes verdaccio http user admin req PUT userorgcouchdbuseradminrevundefined bytes verdaccio node UnhandledPromiseRejectionWarning OpenError IO error verdacciostoragedatatokendbLOCK No such file or directory verdaccio at optverdaccionodemoduleslevelupliblevelupjs verdaccio at optverdaccionodemodulesabstractleveldownabstractleveldownjs verdaccio at optverdaccionodemodulesdeferredleveldowndeferredleveldownjs verdaccio at optverdaccionodemodulesencodingdownnodemodulesabstractleveldownabstractleveldownjs verdaccio at optverdaccionodemodulesleveldownnodemodulesabstractleveldownabstractleveldownjs verdaccio node UnhandledPromiseRejectionWarning Unhandled promise rejection This error originated either by throwing inside of an async function without a catch block or by rejecting a promise which was not handled with catch rejection id verdaccio node DEP DeprecationWarning Unhandled promise rejections are deprecated In the future promise rejections that are not handled will terminate the Nodejs process with a nonzero exit code My current processing method is to give it root permissions in order to create a tokendb directory This configuration makes it work but it is not secureThe dockercomposeyml I use is as follows version services verdaccio image verdaccioverdacciotokenfeat hostname verdaccio containername verdaccio user root ports volumes storageverdacciostorage pluginsverdaccioplugins confverdaccioconf restart always The configuration is as follows This is the config file used for the docker images It allows all users to do anything so dont use it on production systems Do not configure host and port under listen in this file as it will be ignored when using docker see Look here for more config file examples path to a directory with all packages storage verdacciostoragedata path to a directory with plugins to include plugins verdaccioplugins web WebUI is enabled as default if you want disable it just uncomment this line enable false title Verdaccio comment out to disable gravatar support gravatar false by default packages are ordercer ascendant ascdesc sortpackages asc auth htpasswd file verdaccioconfhtpasswd Maximum amount of users allowed to register defaults to infinity You can set this to to disable registration maxusers security api jwt sign expiresIn d notBefore web sign expiresIn d notBefore a list of other known repositories we can talk to uplinks npmjs url packages scoped packages access authenticated publish authenticated unpublish authenticated proxy npmjs allow all users including nonauthenticated users to read and publish all packages you can specify usernamesgroupnames depending on your auth plugin and three keywords all anonymous authenticated access authenticated allow all known users to publishpublish packages anyone can register by default remember publish authenticated unpublish authenticated if package is not available locally proxy requests to npmjs registry proxy npmjs middlewares audit enabled true log settings logs type stdout format pretty level http type file path verdacciolog level info experiments token true Describe the bug Once logged in using the latest version available on docker the user is not redirected to the package list The same happens when the user tries to logout Both approaches require a page refresh F for the redirection to work To Reproduce How to reproduce the issue Steps to reproduce the behavior Make sure to have docker installed I used the macos version pull the image with the command docker pull verdaccioverdaccio start a new container sh VPATHpathforverdaccio docker run it rm name verdaccio p v VPATHconfverdaccioconf v VPATHstorageverdacciostorage v VPATHpluginsverdaccioplugins verdaccioverdaccio Add a new user through the command npm adduser registry and fill in the required fields Open a new tab on your browser and access the web app Use the credentials from the step to login in the web app Expected behavior The user should be redirected to the package list once the login has been made Docker Kubernetes please complete the following information Docker verdaccio tag none Docker commands sh docker pull verdaccioverdaccio VPATHpathforverdaccio docker run it rm name verdaccio p v VPATHconfverdaccioconf v VPATHstorageverdacciostorage v VPATHpluginsverdaccioplugins verdaccioverdaccio Docker Version edge Engine Configuration File cat configverdaccioconfigyaml yaml storage storage maxusers auth htpasswd file htpasswd uplinks npmjs url packages access authenticated publish authenticated proxy npmjs access authenticated publish authenticated proxy npmjs logs type stdout format pretty level http web enable true title Verdaccio primarycolor b e scope sortpackages asc desc Environment information Docker command executed docker exec it verdaccio binverdaccio info Environment Info System OS Linux Alpine Linux CPU x IntelR CoreTM i U CPU GHz Binaries Node usrlocalbinnode Yarn usrlocalbinyarn npm usrlocalbinnpm Now I want to count the number of the package and the number of the developer in my server And I cant to login the server because its not allowed in my company So what do I need to do Goals accept bash npm deprecate pkg versionOrRange message yarn deprecate pkg versionOrRange message as i need to reverse engineer that for yarn anyway i can integrate it here fast also Algorythm offer the same api as npm does and add deprecated msg filds to the manifest on download Will need to check if the puted data is a deprecate reqest some how need examin headers its a Put request to the HTML escaped version of specname npmjsorgspecescapedName needs semver checks for the supplyed version range exprensiv operation need to check how the version range get suppyled by npm js npm cli implamentation a list versions spec type version registry true raw nameversion name nameversion escapedName xxx name scope scope part of name rawSpec saveSpec null fetchSpec body endpoint deprecate Update a package export function updatePackagestorage IStorageHandler config Config return functionreq RequestExtend res ResponseExtend next NextFunctionVer if ObjectprototypehasOwnPropertycallreqbody write delete reqbodywrite else return next const packageName reqparamspackage const metadata validateMetadatareqbody packageName storagechangePackagepackageName metadata deprecate functionerr if err return nexterr resstatusHTTPSTATUSOK return next ok APIMESSAGEPKGCHANGED success true this extends if there is no attachment in the afterchange function if isObjectattachments true Objectkeysattachmentslength resstatusHTTPSTATUSOK return next ok okMessage success true this at the end else if isObjectmetadataattachments Objectkeysmetadataattachmentslength storagechangePackagepackageName metadata DEPRECATE functionerror afterChangeerror APIMESSAGEPKGCHANGED metadata the example code dont handels semver range while npm does that js describeshould test deprecate api testshould deprecate a package done requestapp putscope fpk test setHEADERTYPECONTENTTYPE HEADERSJSON sendJSONstringify deprecateMetadata versions deprecated true expectHTTPSTATUSOKendfunctionerr if err expecterrtoBeNull return doneerr requestapp getscope fpk test setHEADERTYPECONTENTTYPE HEADERSJSON endfunctionerr res if err expecterrtoBeNull return doneerr expectresbodyversions deprecatedtoMatchtrue done testshould undeprecate a package done requestapp putscope fpk test setHEADERTYPECONTENTTYPE HEADERSJSON sendJSONstringify deprecateMetadata versions deprecated expectHTTPSTATUSOKendfunctionerr if err expecterrtoBeNull return doneerr requestapp getscope fpk test setHEADERTYPECONTENTTYPE HEADERSJSON endfunctionerr res if err expecterrtoBeNull return doneerr expectresbodyversions deprecatednottoBeDefined done Related diffs old implamentation diff From a d b bf aa cbe edbb d bdf d Mon Sep From Honza Hommer honzahommercz Date Tue May Subject PATCH feat remove write param from body srcapiendpointapipackagejs srcapiendpointapipublishjs files changed insertions deletions diff git asrcapiendpointapipackagejs bsrcapiendpointapipackagejs index add b df cb b asrcapiendpointapipackagejs bsrcapiendpointapipackagejs export default functionroute Router auth IAuth storage IStorageHandler co let queryVersion reqparamsversion if isNilqueryVersion if ObjectprototypehasOwnPropertycallreqquery write metadatawrite true return nextmetadata diff git asrcapiendpointapipublishjs bsrcapiendpointapipublishjs index e b e df asrcapiendpointapipublishjs bsrcapiendpointapipublishjs export default function publishrouter Router auth IAuth storage IStorageHa const can allowauth publishing a package routerput packagerevrevision canpublish mediamimegetTypejson expectJson updatePackagestorage config publishPackagestorage config routerputpackagerevrevision canpublish mediamimegetTypejson expectJson publishPackagestorage config unpublishing an entire package routerdeletepackagerev canunpublish unPublishPackagestorage export function publishPackagestorage IStorageHandler config Config if isObjectattachments true Objectkeysattachmentslength resstatusHTTPSTATUSOK return next ok okMessage success true npmregistryclient embeds tarball into the json upload issue dealing with it here export function publishPackagestorage IStorageHandler config Config storagechangePackagepackageName metadata reqparamsrevision functionerror afterChangeerror APIMESSAGEPKGCHANGED metadata else if isObjectmetadataattachments Objectkeysmetadataattachmentslength storagechangePackagepackageName metadata deprecate functionerror afterChangeerror APIMESSAGEPKGCHANGED metadata else storageaddPackagepackageName metadata functionerror afterChangeerror APIMESSAGEPKGCREATED metadata export function uploadPackageTarballstorage IStorageHandler Update a package export function updatePackagestorage IStorageHandler config Config return functionreq RequestExtend res ResponseExtend next NextFunctionVer if ObjectprototypehasOwnPropertycallreqbody write delete reqbodywrite else return next const packageName reqparamspackage const metadata validateMetadatareqbody packageName storagechangePackagepackageName metadata deprecate functionerr if err return nexterr resstatusHTTPSTATUSOK return next ok APIMESSAGEPKGCHANGED success true related tests for old implamentation diff From c cb bb e a bde d dc Mon Sep From Honza Hommer honzahommercz Date Tue May Subject PATCH feat add deprecate api tests testunitmodulesapiapispecjs testunitpartialsdeprecateapijs files changed insertions create mode testunitpartialsdeprecateapijs diff git atestunitmodulesapiapispecjs btestunitmodulesapiapispecjs index ebb c d atestunitmodulesapiapispecjs btestunitmodulesapiapispecjs import rimraf from rimraf import configDefault from partialsconfig import publishMetadata from partialspublishapi import starMetadata from partialsstarapi import deprecateMetadata from partialsdeprecateapi import endPointAPI from srcapi import HEADERS APIERROR HTTPSTATUS HEADERTYPE APIMESSAGE TOKENBEARER from srclibconstants describeendpoint unit test describeshould test deprecate api testshould deprecate a package done requestapp putscope fpk test setHEADERTYPECONTENTTYPE HEADERSJSON sendJSONstringify deprecateMetadata versions deprecated true expectHTTPSTATUSOKendfunctionerr if err expecterrtoBeNull return doneerr requestapp getscope fpk test setHEADERTYPECONTENTTYPE HEADERSJSON endfunctionerr res if err expecterrtoBeNull return doneerr expectresbodyversions deprecatedtoMatchtrue done testshould undeprecate a package done requestapp putscope fpk test setHEADERTYPECONTENTTYPE HEADERSJSON sendJSONstringify deprecateMetadata versions deprecated expectHTTPSTATUSOKendfunctionerr if err expecterrtoBeNull return doneerr requestapp getscope fpk test setHEADERTYPECONTENTTYPE HEADERSJSON endfunctionerr res if err expecterrtoBeNull return doneerr expectresbodyversions deprecatednottoBeDefined done testshould unpublish a new package with credentials async done diff git atestunitpartialsdeprecateapijs btestunitpartialsdeprecateapijs new file mode index f fe c devnull btestunitpartialsdeprecateapijs const json requirepublishapi attachments moduleexports json with spec body where body represents the packument a package manifest it looks like a packagejson but has a versions arrray with other package jsons will look inside the yarn project if that is a standard return value of npmjs later Related Yarn issue Current Development Branch Hi folk please read carefully the following points all this information is what you need to share and make the process efficient so everybody can understand your issue please notice if you dont fill any of this points our friendly boot will remind you to do it or close automatically the issue Removing the sections you consider are irrelevant for your issue is totally ok If you have questions you might rather join use over Discord As reminder we have code of conduct all of us we must follow Describe the bug When searching for jquer the search API correctly returns jquery If we input jquery it returns an empty array and so the search suggestions are also empty in the UI To Reproduce Search for jquery and jquery See the responses in the network tab Steps to reproduce the behavior Go to verdaccio frontend Input jquer Check results Input jquery Check results Expected behavior A direct match should return the packages Screenshots img width altBildschirmfoto um src img width altBildschirmfoto um src In the latest version the npm unpublish fails when a custom auth plugin is attached If I remove thispluginspush authUtilsgetDefaultPlugins it works Describe the bug Config must be given via a file Not all environments in which verdaccio is used allow for filebased configurations To Reproduce Try to pass uplinks configuration via command line realize that theres no option for any configuration options except host port via command line verdaccio V verdaccio help Usage verdaccio options Options i info prints debugging information about the local environment l listen host port hostport number to listen on default localhost c config configyaml use this configuration file default configyaml V version output the version number h help output usage information The only option is l listen The option c config only allows one to specify the path to a config file Expected behavior All configuration options available in the config file need to be able to passed via environment variables andor commandline options with the latter overriding the former Screenshots None Docker Kubernetes please complete the following information NA Configuration File cat configverdaccioconfigyaml NA Environment information Environment Info System OS macOS CPU x IntelR CoreTM i HK CPU GHz Binaries Node nvmversionsnodev binnode Yarn yarnbinyarn npm nvmversionsnodev binnpm Virtualization Docker usrlocalbindocker Browsers Chrome Safari npmGlobalPackages verdaccio Debugging output NA Additional context This issue is ultimately motivated by This issue is related to the fact that gitlabcom doesnt allow you to mount volumes into service containers see others Could be solved effectively by refactoring verdaccio to use to configure it That would at least take care of environment variable support via 