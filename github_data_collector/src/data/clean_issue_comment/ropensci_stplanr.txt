Its seems that is fast and powerful perhaps this is how we should be doing route networks Some of the most useful functions in stplanr revolve around handline OD data like od line odoneway and odmatrixtood I wonder if it would be useful based on the concept of modularity in software development to split such functions out into a new package with minimal dependencies eg called od Thoughts welcome Headsup mpadge richardellison rafapereirabr mem rCarto and anyone else watching this feedback welcome Running revdep checks for current rgdal on RForge see shows the errors in the attached check log related to use of PROJ GDAL and required changes to sp and rgdal If useful find a regerence to a docker image in this thread Changes will occur quite fast and packages need to be prepared checking examples ERROR Running examples in stplanrExR failed The error most likely occurred in Name buffgeo Title Create a buffer of n metres for nonprojected geographical spatial data Aliases buffgeo Examples r routesfast buff buffgeor width Transforming to CRS projaeqd lat lon x y datumWGS unitsm nodefs Warning in spTransformxSP CRSobj NULL source CRS comment falling back to PROJ string projcreate initepsginitIGNF syntax not supported in nonPROJ emulation mode Error in spTransformLineinput i toargs toargs fromargs fromargs source crs creation failed null Calls buffgeo spTransform spTransformLines spTransformLine Execution halted This may not be the best place to solve this but I can imagine non overlapping buffers that represent the area in which each linefeature is the nearest one with no overlaps would be useful Reproducible example plus sketch of what Im thinking below r question about buffer types librarysf Linking to GEOS GDAL PROJ librarystplanr l stplanrosmnetexample l stplanrosmnetexample l although coordinates are longitudelatitude stintersects assumes that they are planar lb geoprojectedshp l fun stbuffer dist lbflat geoprojectedshp l fun stbuffer dist endCapStyle FLAT plotstgeometryl plotstgeometrylb col sfcolorsnrowl alpha add TRUE r plotstgeometryl plotstgeometrylbflat col sfcolorsnrowl alpha add TRUE supCreated on by the reprex package v sup Very rough sketch of solution While I was experimenting with I faced this error r librarystplanr librarysf Linking to GEOS GDAL PROJ line pointsstlinestringmatrixc ncol byrow TRUE Error in UseMethodline points no applicable method for line points applied to an object of class cXY LINESTRING sfg stsfcstlinestringmatrixc ncol byrow TRUE line points Error in UseMethodline points no applicable method for line points applied to an object of class csfcLINESTRING sfc supCreated on by the reprex package v sup The reasons why its happening are quite clear but Im not sure what are the best practices Should I create adhoc methods for sfcLINESTRING Should I just ignore that and let line points work only on sf objects As demonstrated below r librarystplanr l osmnetexample llengthunits sfstlengthl llength asnumericllengthunits histlogllength lpoints linemidpointllongest fails plotlpoints For some types of analysis on networks very short segments are undesirable As discussed with agila it would be useful to have a function that could go in the opossite direction of rnetbreakubvertices and join short segments to the shortest segment it touches is plan A Reprex of the problem r packages librarysf Linking to GEOS GDAL PROJ librarystplanr create some fake data mysfclinestring stsfc stlinestringmatrixc ncol byrow TRUE mysflinestring stassfdataframeID geometry mysfclinestring line pointsmysflinestring Simple feature collection with features and field geometry type POINT dimension XY bbox xmin ymin xmax ymax epsg SRID NA proj string NA id geometry POINT POINT colnamesmysflinestring ID geometry save data stwritemysflinestring mysflinestringgpkg Updating layer mysflinestring to data source mysflinestringgpkg using driver GPKG Writing features with fields and geometry type Line String read that same data mysflinestring streadmysflinestringgpkg Reading layer mysflinestring from data source C Users Utente AppData Local Temp RtmpEJviv reprex fc f mysflinestringgpkg using driver GPKG Simple feature collection with feature and field geometry type LINESTRING dimension XY bbox xmin ymin xmax ymax epsg SRID NA proj string NA line pointsmysflinestring Error in xcoords oindices sapplylgeometry replacement has length zero colnamesmysflinestring ID geom supCreated on by the reprex package v sup The problem lies here I think I can fill a PR in the next days This will be very useful for road safety research using a variety of spatial network data sources including OSM which has a junction column but which may not always be marked as such The beginnings of a solution are shown below Note that the main problem with this solution is that it also returns start points of lines cul de sac r librarystplanr roadskey readRDSurl roadskey stplanrosmnetexample junctionsmaybe line pointsroadskey lengthuniquejunctionsmaybegeometry mapviewmapviewjunctionsmaybe r roadskeyvalue roadskeyrnet overline roadskey attrib value constructing segments building geometry simplifying geometry aggregating flows rejoining segments into linestrings junctionsmaybe line pointsroadskeyrnet lengthuniquejunctionsmaybe geometry mapviewmapviewjunctionsmaybe supCreated on by the reprex package v sup 