Is there a way to convert stars format file to netcdf or other raster format Im confused as to why a mutate example that is given for regular stars objects does not work on starsproxy objects r librarystars Loading required package abind Loading required package sf Linking to GEOS GDAL PROJ librarytidyverse systemfiletifL ETMstif package stars readstars proxy TRUE x x mutateband L ETMstif Error in L ETMstif nonnumeric argument to binary operator supCreated on by the reprex package v sup I have a case where when I use starsreadstars proxy TRUE I usually get a Cannot allocate memory error and R crashes Case use starsreadstars crashes Case use librarystars libraryncmeta readstars crashes Case use libraryncmeta starsreadstars works Case use libraryncmeta librarystars readstars works Any help troubleshooting the root cause of this While this workaround is fine Im sure others in the world will face this Its definitely somehow related to the particular netCDF build on my server as I can read the file fine on my desktop computer Is it just that stars uses a different strategy to read netCDF when ncmeta is loaded first Full output Case r kendonbellmahuika myproject R R version Action of the Toes Type q to quit R starsreadstarsfnnc var smd proxy TRUE netcdf NCvarshape Cannot allocate memory Case R version Action of the Toes Type q to quit R librarystars Loading required package abind Loading required package sf Linking to GEOS GDAL PROJ libraryncmeta Definition of au in scalewlgpersistentfilesetshomekendonbelludunitslocalshareudunitsudunits acceptedxml line overrides prefixedunit e kilogramDefinition of kt in scalewlgpersistentfilesetshomekendonbelludunitslocalshareudunitsudunits commonxml line overrides prefixedunit e kilogram readstarsfnnc var smd proxy TRUE netcdf NCvarshape Cannot allocate memory kendonbellmahuika myproject Case R version Action of the Toes Type q to quit R libraryncmeta Definition of au in scalewlgpersistentfilesetshomekendonbelludunitslocalshareudunitsudunits acceptedxml line overrides prefixedunit e kilogram Definition of nt in scalewlgpersistentfilesetshomekendonbelludunitslocalshareudunitsudunits commonxml line overrides prefixedunit e kilogram starsreadstarsfnnc var smd proxy TRUE starsproxy object with attribute in file SMDVCSNBCCCSM RCPpastnc fnnc dimensions from to offset delta refsys point values x NA NA NULL x y NA NA NULL y time UTC days POSIXct NA NULL Case R version Action of the Toes Type q to quit R libraryncmeta Definition of au in scalewlgpersistentfilesetshomekendonbelludunitslocalshareudunitsudunits acceptedxml line overrides prefixedunit e kilogram Definition of nt in scalewlgpersistentfilesetshomekendonbelludunitslocalshareudunitsudunits commonxml line overrides prefixedunit e kilogram librarystars Loading required package abind Loading required package sf Linking to GEOS GDAL PROJ readstarsfnnc var smd proxy TRUE starsproxy object with attribute in file SMDVCSNBCCCSM RCPpastnc fnnc dimensions from to offset delta refsys point values x NA NA NULL x y NA NA NULL y time UTC days POSIXct NA NULL I had an array with only one dimension named and I was getting an error converting it to a stars object After some digging I realized it was because I only had one dimension named It looks like stasstars works if all the dimensions are named as well as if the dimensions are not named but does not work if only one dimension is named ar arrayrunif dimc no dimnames works starsobject stasstarsar full dimnames also works dimnamesar listd ca b c d ca b c d ca b c starsobject stasstarsar partial dimnames fails dimnamesar listNULL NULL d ca b c starsobject stasstarsar Kind of a small thing but it would be nice if stars was flexible enough to handle these cases When executing writestarsdsn myfilegpkg driver GPKG I get not only a gpkg file which I would expect but also an xml file myfilegpkgauxxml with following contents PAMDataset Metadata domainIMAGESTRUCTURE MDI keyINTERLEAVEPIXELMDI Metadata Metadata MDI keyIDENTIFIERmyfileMDI Metadata PAMDataset What is this file In other usecases sf raster the file is not generated and at first sight it seems not necessary to me to have it Can it be prevented from being generated for the sake of neat workflows Is it GDAL doing this Thanks for your time and your splendid work The stars package implements methods slicestars pullstars etc for the generic dplyr verbs slice pull etc Since the dispatch starts with the generic function which is exported by dplyr before going to the classspecific method you cant slice or pull a stars object if dplyr isnt loaded That may be obvious to experienced R users but I dont think it would be obvious to a user just starting out in the use of R for interrogating NetCDFs Im not sure whether its possible to return a more informative error than Error in pull temperature could not find function pull when dplyr isnt loaded but it would be great to also explicitly document the fact that dplyr or tidyverse since Id expect that many beginners are using that interactively should be loaded on the reference page for these verbs rather than just implicitly referring to it by calling them dplyr verbs I have created this patch to ensure stapply to make sure units are retained I encountered the issue that all units are dropped when using apply functions I have added test for functions that drop the units or and attributes that do not have units I tried to be conservative with setting units This approach fails when FUN changes the units One could alternatively just assign the output units of FUN Building upon the code in I encountered an issue when converting the extracted values to dataframetibble Conversion to datatable fails in the first example but works with the multiband tif Both asdataframe and astibble works if stassf is called first r librarystars Loading required package abind Loading required package sf Linking to GEOS GDAL PROJ suppressPackageStartupMessageslibrarytidyverse tif systemfiletifolindademutm stif package stars tifproxy readstarstif proxy TRUE points stsamplestassfcstbboxstdimensionstifproxy size plottifproxy reset FALSE plotpoints add TRUE col red r Extract values vals aggregatetifproxy points functionx x aspoints FALSE classvals stars Convert to dataframe vals asdataframe Error in dataframestcoordinatesx addmax addmax center center arguments imply differing number of rows vals stassf asdataframe olindademutm stif geometry POINT POINT POINT POINT POINT POINT POINT POINT POINT POINT Convert to tibble vals astibble Error Argument must be length not vals stassf astibble A tibble x olindademutm stif geometry dbl POINT m With a multiband tif tif systemfiletifL ETMstif package stars tifproxy readstarstif proxy TRUE points stsamplestassfcstbboxstdimensionstifproxy size Extract values vals aggregatetifproxy points functionx x aspoints FALSE Conversion to dataframe vals asdataframe head geometry band L ETMstif POINT POINT POINT POINT POINT POINT vals astibble Error Argument must be a data frame or a named atomic vector not a sfcPOINTsfc vals stassf astibble A tibble x L ETMstifV L ETMstifV L ETMstifV L ETMstifV dbl dbl dbl dbl with more variables L ETMstifV dbl L ETMstifV dbl geometry POINT m supCreated on by the reprex package v sup details summarySession infosummary r devtoolssessioninfo Session info setting value version R version os macOS Mojave system x darwin ui X language EN collate enUSUTF ctype enUSUTF tz EuropeCopenhagen date Packages package version date lib source abind CRAN R assertthat CRAN R backports CRAN R broom CRAN R callr CRAN R cellranger CRAN R class CRAN R classInt CRAN R cli CRAN R colorspace CRAN R crayon CRAN R curl CRAN R DBI CRAN R desc CRAN R devtools CRAN R digest CRAN R dplyr CRAN R e CRAN R evaluate CRAN R fansi CRAN R forcats CRAN R fs CRAN R generics CRAN R ggplot CRAN R glue Github tidyverseglue ac a gtable CRAN R haven CRAN R highr CRAN R hms CRAN R htmltools CRAN R httr CRAN R jsonlite CRAN R KernSmooth CRAN R knitr CRAN R lattice CRAN R lazyeval CRAN R lubridate CRAN R lwgeom CRAN R magrittr CRAN R memoise CRAN R mime CRAN R modelr CRAN R munsell CRAN R nlme CRAN R pillar CRAN R pkgbuild CRAN R pkgconfig CRAN R pkgload CRAN R prettyunits CRAN R processx CRAN R ps CRAN R purrr CRAN R R CRAN R Rcpp CRAN R readr CRAN R readxl CRAN R remotes CRAN R rlang CRAN R rmarkdown CRAN R rprojroot CRAN R rvest CRAN R scales CRAN R sessioninfo CRAN R sf CRAN R stars Github rspatialstars ec stringi CRAN R stringr CRAN R testthat CRAN R tibble CRAN R tidyr CRAN R tidyselect CRAN R tidyverse CRAN R units CRAN R usethis CRAN R utf CRAN R vctrs CRAN R withr CRAN R xfun CRAN R xml CRAN R yaml CRAN R zeallot CRAN R LibraryFrameworksRframeworkVersions Resourceslibrary details There are two cases to consider The input stars objects either have same deltas and the offsets differ by deltaN N integer Above condition doesnt hold ie the input objects come from different parent grids One approach could be to get the bbox of the union of the bboxs of the objects to be combined Make a new stars object from this bbox with the smallest dx and dy in absolute value For use something similar to stwarp to get the stars objects into the new specification Fill in the values of the new stars object from the input objects in the right places A real life example that currently fails case elevationnzzip r librarystars libraryraster librarytidyverse librarycowplot starsobjects listfileselevationnz fullnames TRUE strsubsettif mapreadstars starsobjects starsobjects mapas Raster maprasteraggregate fact mapstasstars plot ggplot geomstarsdata starsobjects coordequal themelegendposition none axistitle elementblank axistext elementblank axisticks elementblank axisline elementblank ggtitleobject plot ggplot geomstarsdata starsobjects coordequal themelegendposition none axistitle elementblank axistext elementblank axisticks elementblank axisline elementblank ggtitleobject plot ggplot geomstarsdata starsobjects geomstarsdata starsobjects coordequal themelegendposition none axistitle elementblank axistext elementblank axisticks elementblank axisline elementblank ggtitleobjects and plotgridplotgridplot plot ncol relheights c plot nrow r Offsets dont quite align and dont have the same x range stdimensionsstarsobjects from to offset delta refsys point values x projtmerc lat lon NA NULL x y projtmerc lat lon NA NULL y stdimensionsstarsobjects from to offset delta refsys point values x projtmerc lat lon NA NULL x y projtmerc lat lon NA NULL y Fails cstarsobjects starsobjects Error in cstarsstarsobjects starsobjects dont know how to merge arrays please specify parameter along Fails cstarsobjects starsobjects along x Error in function along N revalong NULL newnames NULL arg X has dims but need dimsX supCreated on by the reprex package v sup I came upon this issue while trying to assign an sfc column dimension to a stars object derived from a pointtimeseries netCDF file Ideally sooner or later stars will understand these files directly but in the meantime I am trying to manually force the correct dimensions The object has two dimensions station number and time and I would like to assign latlon coordinates to each station Use this file MB for testing R libraryncdf librarystars fin nc nc ncopenfin lon ncvargetnc lon lat ncvargetnc lat ncclosenc s readncdffin sfc stassfdataframelon lon lat lat coords crs geometry s stsetdimensionss stat sfc point TRUE Returns this error Error in xyfromcolrowcbind seqxfrom xto where geotransform lengthgeotransform is not TRUE 