This was causing Oauth to no longer work on shopifyapp New session storage strategies do not take model names other than Shop into account This seems like a breaking change Hence session storage does not respond include ShopifyAppSessionStorage The solution is to override the store and retrieve methods in the controller and remove the SessionStorage call include ShopifyAppSessionStorage Override Shopify Session Storage def selfstoreauthsession args shop Integrationfindorinitializebyshopifydomain authsessiondomain shopshopifytoken authsessiontoken shopsave shopid end def selfretrieveid return unless id if shop Integrationfindbyid id ShopifyAPISessionnew domain shopshopifydomain token shopshopifytoken apiversion shopapiversion end end A simple fix might be removing Shop here or use self shop findorinitializebyshopifydomain authsessiondomain shopshopifytoken authsessiontoken shopsave shopid I am consistently getting invalid authenticity token from sessionscreate This is not hugely important considering that this route is only used in begining development and new can also be used but this should be fixed Hey So Im having a big issue here I am trying to update my app to to have the SameSiteNone Secure but I have a session error exactly on this version I have sure about this because I tried with and and the error just happens on The error is this I T INFO omniauth shopify Request phase initiated E T ERROR omniauth shopify Authentication failure invalidsite encountered OmniAuthError invalidsite omniauth libomniauthfailureendpointrb in raiseout omniauth libomniauthfailureendpointrb in call omniauth libomniauthfailureendpointrb in call omniauth libomniauthstrategyrb in fail omniauthshopifyoauth libomniauthstrategiesshopifyrb in requestphase omniauth libomniauthstrategyrb in requestcall omniauth libomniauthstrategyrb in call omniauth libomniauthstrategyrb in call newrelicrpm libnewrelicagentinstrumentationmiddlewaretracingrb in call omniauth libomniauthbuilderrb in call newrelicrpm libnewrelicagentinstrumentationmiddlewaretracingrb in call newrelicrpm libnewrelicrackagenthooksrb in tracedcall newrelicrpm libnewrelicagentinstrumentationmiddlewaretracingrb in call newrelicrpm libnewrelicrackbrowsermonitoringrb in tracedcall newrelicrpm libnewrelicagentinstrumentationmiddlewaretracingrb in call rack libracktempfilereaperrb in call newrelicrpm libnewrelicagentinstrumentationmiddlewaretracingrb in call rack libracketagrb in call newrelicrpm libnewrelicagentinstrumentationmiddlewaretracingrb in call rack librackconditionalgetrb in call I did some investigation For all this versions I have debug the file configinitializersomniauthrb This line shopifyauthparams strategysession shopifyomniauthparams withindifferentaccess Basically for all versions the value of shopifyauthparams is getting the shop parameter the value is shopmyshopmyshopifycom But for shopifyauthparams is just nil and that seems to be the cause of the error why there is the error I dont have idea Just for the sake of information Im using ShopifyAppSessionStorage on the Shop model as session storage But I have tried using configsessionrepository ShopifyAppInMemorySessionStore but dont work either Thank you guys for the awesome job on this piece of code and I really hope we can solve this until Chrome make it mandatory to use version SameSiteNone Secure Addresses We updated the instructions for step in the quickstartmd file With the release of public apps we now restrict the usage of copying and pasting installation urls as a way to install apps You must now go through the UI to install these apps on dev stores for testing cc lyninx since we paired on this Instructions for adding the app to the store from the partners dashboard install link doesnt work if this is not done first cc ShayneP stevehaase Maybe related to emilybulger and RyaGershcovich flagged some content and copy issues with the cookie screen Rya has been delegated to propose some copy improvements and there s also a functional problem with the app variable not rendering Emily took a screenshot and Ive annotated it below img width altScreen Shot at PM src Note Im just filing this issue to introduce the relevant people Im unsubscribing from the thread so you can all take it from here With Rails and using App Proxies I get the following error Blocked host newdevelopmentstoremyshopifycom To allow requests to newdevelopmentstoremyshopifycom add the following to your environment configuration confighosts newdevelopmentstoremyshopifycom Its a new feauture in Rails Host Authorization new middleware included in Rails to prevent against DNS rebinding attacks We can disable the feature with Railsapplicationconfigure do confighostsclear end but then the new security feauture is lost Is there a way to allow all request from Shopify Are requests made from myshopifycomdomains eg nikemyshopifycom or from individual domains eg nikecom Steps to reproduce Set up the clean Shopify app on Rails x using the shopifyapp setup instructions Run the app and tunnel using Ngrok Open it on Chrome see that the sample works Open the Safari Go to Safari Preferences Privacy Manage Website Data and clear all the data related to domains ngrok and myshopifycom Make sure that in Safari Privacy preferences its not blocking cookies and not preventing crosssite tracking img width altScreenshot at src Open the app via Shopify Admin on Safari See that it shows the fullscreen page telling Your browser needs to authenticate My Shopify App img width altScreenshot at src Press the blue Continue button See that the browser loops the redirect times and then Shopify Admin shows the error toast The application can t be loaded with the current version of Safari try clearing your cookies or using another browser img width altScreenshot at src Expected result When opening with Safari after pressing Continue on the page Your browser needs to authenticate My Shopify App it should show another page inside the iframe asking to press the button there telling that it needs to accept cookies Then Safari should show the ITP cookies confirmation popup But that is not happening Alternatives attempted Clearing all cookies and website data same result Opening Safari in Private Window same result Tried with Safari Technology Preview Release Safari WebKit there it just refreshed once and opened the app It didnt ask to confirm cookies even though I set to disable all rd party cookies ITP under Develop Experimental features Proof that others have this issue During the last days we had at least customers complaining about the same issue I maintain an app used privately by a shopify plus customer Since we have a lot of staff and some parts of the app are accessed in a nonembedded context and not all users of the app have shopify accounts and shopifyapp is not set up to do user authentication we use Devise authentication in addition to shopify authentication and link our devise users to corresponding shopify users when they exist After installing this weeks Safari upgrade devise login no longer works in an embedded context seems the CSRF token is getting reset AND after logging in in a nonembeddded context the devise authentication is not working in subsequent embedded pages The session is not discarded altogether if I go back to a nonembedded page Im still logged in Everything still works correctly in Chrome Rails shopifyapp 