I noticed that the TCP server connects by calling Socketpacksockaddrin with the usersupplied host name packsockaddrin only returns a single packed address so if the name has more than one address ie its a roundrobin address or dualstack IPv IPv the user might be surprised if the address they expected wasnt used I think Dalli should notice when the user passed an ambiguous hostname and warn about it It would be nice if Dalli expanded hostnames to addresses and created a server connection for each added them to the ring or if it used Socketgetaddrinfo and let the user pass which address family theyd prefer in the config I believe this is the cause of where Dalli tried to connect to the first entry returned for localhost either or but memcached was listening only on the other one A gemfile for Rails doesnt exist in gemfiles so I presume that Rails appraisal isnt needed anymore Add a new appraisal for Rails Run appraisal generate to generate new gemfiles Set Rails as a dev dependency Test Rails on Travis I found these while I was browsing the code and Ive noticed that they are not used anymore Hi Caching using a single item array as the key doesnt properly uses the cachekey method but calls toparam only Eg model model is properly expanded to model cachekey model cachekey toparam model is properly expanded to model cachekey model is expanded to model toparam instead of model cachekey See line vs Problem It is not possible to properly instrument ValueOverMaxSize errors Reason In according to Only subclasses of DalliError are instrumented but ValueOverMaxSize is a subclass of RuntimeError Solution Change parent of ValueOverMaxSize from RuntimeError to DalliError Hi Im running a rails app on Heroku Under heavy load Ive seen this error a few times The ruby vm is locked and the only thing that works is restarting the server The code that triggers the error is similar to ruby Railscachefetchsomecachekey expiresin getcachevaluekey The full error is the following deadlock recursive locking appvendorruby libruby monitorrb in lock appvendorruby libruby monitorrb in monenter appvendorruby libruby monitorrb in monsynchronize appvendorbundleruby gemsdalli libdallioptionsrb in alive appvendorbundleruby gemsdalli libdalliringrb in serverforkey appvendorbundleruby gemsnewrelicrpm libnewrelicagentinstrumentationmemcachedallirb in serverforkey appvendorbundleruby gemsdalli libdalliclientrb in perform appvendorbundleruby gemsdalli libdalliclientrb in get appvendorbundleruby gemsnewrelicrpm libnewrelicagentinstrumentationmemcacherb in block levels in instrumentmethods appvendorbundleruby gemsdalli libactivesupportcachedallistorerb in block in readentry appvendorbundleruby gemsdalli libdalliclientrb in with appvendorbundleruby gemsdalli libactivesupportcachedallistorerb in with appvendorbundleruby gemsdalli libactivesupportcachedallistorerb in readentry appvendorbundleruby gemsactivesupport libactivesupportcachestrategylocalcacherb in block in readentry appvendorbundleruby gemsactivesupport libactivesupportcachestrategylocalcacherb in block in fetchentry appvendorbundleruby gemsactivesupport libactivesupportcachestrategylocalcacherb in fetch appvendorbundleruby gemsactivesupport libactivesupportcachestrategylocalcacherb in fetchentry appvendorbundleruby gemsactivesupport libactivesupportcachestrategylocalcacherb in readentry appvendorbundleruby gemsdalli libactivesupportcachedallistorerb in readentry appvendorbundleruby gemsdalli libactivesupportcachedallistorerb in block in fetch appvendorbundleruby gemsdalli libactivesupportcachedallistorerb in block in instrumentwithlog appvendorbundleruby gemsdalli libactivesupportcachedallistorerb in block in instrument appvendorbundleruby gemsactivesupport libactivesupportnotificationsrb in block in instrument appvendorbundleruby gemsactivesupport libactivesupportnotificationsinstrumenterrb in instrument appvendorbundleruby gemsactivesupport libactivesupportnotificationsrb in instrument appvendorbundleruby gemsdalli libactivesupportcachedallistorerb in instrument appvendorbundleruby gemsdalli libactivesupportcachedallistorerb in instrumentwithlog appvendorbundleruby gemsdalli libactivesupportcachedallistorerb in fetch Seems related to petergoldsteindalli but in that case there seems to be no exception like this one Is this a Dalli bug