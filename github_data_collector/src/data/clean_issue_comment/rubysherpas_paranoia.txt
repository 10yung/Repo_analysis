 Hi I call throwabort in beforedestroy callback and wait rollback for restore hasmany dependent destroy records but rollback does not occur bb f ea fcd a a but I expect a rollback gem update system fails with Ruby This should also make succeed Trigger aftercommit on destroy to work with rails This addresses Using the recoverywindow option with a custom column name raises an exception since the deletedat value is hard coded Can I set a future date to soft delete an object ruby objectdeletedat DateTimetomorrow So the gem would check if deletedat nil and DateTimetoday deletedat Rails Ruby paranoia MySQL I have the following model setup ruby class Parent ApplicationRecord actsasparanoid hasmany children dependent destroy acceptsnestedattributesfor children rejectif allblank allowdestroy true end class Child ApplicationRecord actsasparanoid belongsto parent end Im seeing issues when trying to do get the associated children records for a given parent ruby parent Parentfind One record in the associatedchildren collection is softdeleted but the others are not ruby parentchildrencount returns even though I can see nondeleted associatedchildren records in the DB and Rails console parentchildrenwithdeletedcount So there should be records returned for associatedchildren but instead I see ruby parentchildrenwithoutdeletedcount parentchildrenwithdeletedpluckdeletedat nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil Thu Jan UTC nil nil nil nil nil nil nil nil nil nil nil The kicker is this is only happening on table of my database and only on production When I copy the production database locally the exact same queries as above work just fine for the same models that are failing on production When a freshly loaded record is destroyed then aftercommit callbacks are not called Ie ruby user Userfirst userdestroy aftercommit callbacks dont work However if the record is updated after it has been loaded then everything works as expected ruby user Userfirst usertouch userdestroy aftercommit callbacks work It works also on freshly created records therefore the current test suite did not catch this bug ruby user Usercreate userdestroy aftercommit callbacks work This happens only on Rails It works as expected with Rails Steps to reproduce Run the following ruby script ruby frozenstringliteral true require bundlerinline gemfiletrue do source gitsourcegithub repo Activate the gem you are reporting the issue against gem activerecord gem activerecord this version works gem paranoia gem sqlite end require activerecord require minitestautorun require paranoia ActiveRecordBaseestablishconnectionadapter sqlite database memory ActiveRecordSchemadefine do createtable users force true do t tdatetime updatedat tdatetime deletedat end end class User ActiveRecordBase actsasparanoid aftercommit aftercommitcalled true def resetcallbackvariables aftercommitcalled nil end def aftercommitcallbackcalled aftercommitcalled end end class BugTest MinitestTest def setup Usercreate user Userfirst refute useraftercommitcallbackcalled end def testfreshlyloadedmodel userdestroy assert useraftercommitcallbackcalled end def testtouchedmodel usertouch userdestroy assert useraftercommitcallbackcalled end end When a model has no dependent option in their association this is nil targetsendoptions dependent will fail in this case