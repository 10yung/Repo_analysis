your code was not working correctly for clusters Fixes some issues so it works on clustered scenarios and also adds some informational outputs when it cant find SQL Server instances or gets connection errors Tested on SQL Server R SQL Server and SQL Server Cluster I came from this post and GetMSSQLCredentialPasswords does not return anything After I while I found the following query returns empty result SqlCmd SELECT namecredentialidentitysubstringimageval ivlen iv substringimagevalivlen lenimagevalivlen pass from mastersyscredentials cred inner join mastersyssysobjvalues obj on credcredentialid objobjid where valclass and valnum Any ideas I got no exceptions or errors If the user you are using for the DAC does not have the default database set to master the SQL query SELECT substringcryptproperty lencryptproperty FROM syskeyencryptions WHERE keyid and thumbprint x or thumbprint x returns empty resultset Please add catalog name to the from clause FROM mastersyskeyencryptions The script will fail if running on a shared cluster running sql server as FCI For a shared cluster the computer and cluster names are different My smk just got cut by the len function You have to use datalength instead in both queries Get the following error PS C Windows system GetMSSQLAllCredentials Exception calling Close with arguments Padding is invalid and cannot be removed At line char if null ne LocalBROut BROutClose CategoryInfo NotSpecified ParentContainsErrorRecordException FullyQualifiedErrorId CryptographicException Will see if I can follow manual steps but wont be able to share the value 