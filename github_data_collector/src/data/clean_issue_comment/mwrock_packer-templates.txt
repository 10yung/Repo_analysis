packer template vbox json doesnt specify what version of of chefclient to install with chefsolo provisioner so it installs latest chef client version which is incompatible with windows cookbook in Berksfilelock also incompatible with windows so packer build fails eg virtualboxiso Synchronizing Cookbooks virtualboxiso wsusclient virtualboxiso packertemplates virtualboxiso windows virtualboxiso chefhandler virtualboxiso Installing Cookbook Gems virtualboxiso Compiling Cookbooks virtualboxiso virtualboxiso virtualboxiso Recipe Compile Error in cwindowstemppackerchefsololocalmodecachecachecookbookswindowslibrarieswindowspackagerb virtualboxiso virtualboxiso virtualboxiso LoadError virtualboxiso virtualboxiso cannot load such file chefmixinlanguage virtualboxiso virtualboxiso System Info virtualboxiso virtualboxiso chefversion virtualboxiso platformwindows virtualboxiso platformversion virtualboxiso rubyruby p revision x mingw virtualboxiso programnamecopscodechefbinchefsolo virtualboxiso executablecopscodechefbinchefsolo Specifying earlier chefclient versions still fails but removing the windows cookbook dependency altogether from packertemplates cookbook and letting build run with chefclient seems to work to complete the build virtualboxiso Uploading VirtualBox version info virtualboxiso Provisioning with chefsolo virtualboxiso Installing Chef virtualboxiso virtualboxiso ModuleType Version Name ExportedCommands virtualboxiso virtualboxiso Script Omnitruck GetProjectMetadata InstallProject install virtualboxiso Installing chef from C Users vagrant AppData Local Temp chefclient x msi virtualboxiso Starting Chef Infra Client version virtualboxiso resolving cookbooks for run list wsusclientconfigure packertemplatesinstallpsmodules packertemplatesvboxguestadditions packertemplatesuninstallpowershellise packertemplatesdeletepagefile virtualboxiso T WARN Child with name packertemplates found in multiple directories CWindowsTemppackerchefsolocookbooks packertemplates and CWindowsTemppackerchefsolocookbooks packertemplates virtualboxiso Synchronizing Cookbooks virtualboxiso wsusclient virtualboxiso packertemplates virtualboxiso Installing Cookbook Gems virtualboxiso Compiling Cookbooks virtualboxiso Converging resources virtualboxiso Creating JSON attribute file virtualboxiso Executing Chef copscodechefbinchefsolobat nocolor c CWindowsTemppackerchefsolosolorb j CWindowsTemppackerchefsolonodejson virtualboxiso Starting Chef Infra Client version virtualboxiso resolving cookbooks for run list packertemplatesenablefilesharing packertemplatesremotedesktop packertemplatescleansxs packertemplatesaddpostunattend packertemplatesaddpagefile packertemplatessetlocalaccounttokenfilterpolicy packertemplatesremovedirs packertemplatesaddsetupcomplete virtualboxiso T WARN Child with name packertemplates found in multiple directories cwindowstemppackerchefsolocookbooks packertemplates and cwindowstemppackerchefsolocookbooks packertemplates virtualboxiso T WARN Child with name packertemplates found in multiple directories cwindowstemppackerchefsolocookbooks packertemplates and cwindowstemppackerchefsolocookbooks packertemplates virtualboxiso Synchronizing Cookbooks virtualboxiso packertemplates virtualboxiso wsusclient virtualboxiso Installing Cookbook Gems virtualboxiso Compiling Cookbooks virtualboxiso Converging resources Build virtualboxiso finished Builds finished The artifacts of successful builds are virtualboxiso VM files in directory outputvirtualboxiso virtualboxiso virtualbox provider box windows minvirtualboxbox but not sure if removing this dependency would break other builds besides win Seems like not since windows cookbook is obsolete by chef but I didnt try it Hello I have added two commits for the HyperV provisioning that you may find useful b c Use the same ISO that the VirtualBox template uses Increase the RAM to GB from GB Regards Robert Conde ISO path is broken see the website itself cmd packer build force only virtualboxiso vbox json virtualboxiso output will be in this color virtualboxiso Retrieving Guest additions virtualboxiso Using file inplace fileCProgram FilesOracleVirtualBoxVBoxGuestAdditionsiso virtualboxiso Retrieving ISO virtualboxiso Error downloading Error making HTTP GET request Not Found virtualboxiso ISO download failed Build virtualboxiso errored ISO download failed Some builds didnt complete successfully and had errors virtualboxiso ISO download failed Builds finished but no artifacts were created Tried replacing it but still doesnt seem to work for me My issue may be somewhere else though Im new to VM orchestration Hi I run the packer template for the nano server in order to obtain a base image with MB This are the latest lines of the build virtualboxiso Connected to WinRM virtualboxiso Uploading VirtualBox version info virtualboxiso Gracefully halting virtual machine virtualboxiso Removing floppy drive virtualboxiso Preparing to export machine virtualboxiso Deleting forwarded port mapping for the communicator SSH WinRM etc host port virtualboxiso Exporting virtual machine virtualboxiso Executing export packervirtualboxiso output outputvirtualboxisopackervirtualboxiso ovf virtualboxiso Deregistering and deleting VM virtualboxiso Running postprocessor vagrant virtualboxiso vagrant Creating Vagrant box for virtualbox provider virtualboxiso vagrant Copying from artifact outputvirtualboxisopackervirtualboxiso disk vmdk virtualboxiso vagrant Copying from artifact outputvirtualboxisopackervirtualboxiso ovf virtualboxiso vagrant Renaming the OVF to boxovf virtualboxiso vagrant Using custom Vagrantfile vagrantfilewindowsnanotemplate virtualboxiso vagrant Compressing Vagrantfile virtualboxiso vagrant Compressing boxovf virtualboxiso vagrant Compressing metadatajson virtualboxiso vagrant Compressing packervirtualboxiso disk vmdk Build virtualboxiso finished Can someone help in order to configure the output of the image Regards Hi It seems to me that download url do not working Here what i got packer build force only virtualboxiso vbox r json virtualboxiso output will be in this color virtualboxiso Downloading or copying Guest additions virtualboxiso Downloading or copying fileCProgram FilesOracleVirtualBoxVBoxGuestAdditionsiso virtualboxiso Downloading or copying ISO virtualboxiso Downloading or copying virtualboxiso Error downloading Bad Gateway virtualboxiso ISO download failed Build virtualboxiso errored ISO download failed Some builds didnt complete successfully and had errors virtualboxiso ISO download failed Builds finished but no artifacts were created I suggest to change url to proposed After that change i got iso file downloading packer build force only virtualboxiso vbox r json virtualboxiso output will be in this color virtualboxiso Downloading or copying Guest additions virtualboxiso Downloading or copying fileCProgram FilesOracleVirtualBoxVBoxGuestAdditionsiso virtualboxiso Downloading or copying ISO virtualboxiso Downloading or copying virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress virtualboxiso Download progress Hi There is a problem with path to psake tools in your scripts On my Windows system psake tools with all related files was installed on C ProgramData chocolatey lib psake tools psake not C ProgramData chocolatey lib psake tools SUMMARY Building Windows fails in current Chef Recommend jettisoning Chef as seems too cumbersome to maintain and use something similar to Windows w powershell scripts STEPS bash cd cookbookspackertemplates rm Berksfilelock berks berks vendor vendorcookbooks cd packer build var isourlpathto RS RELEASESERVEREVALX FREENUSISO force only virtualboxiso vbox json RESULT bash virtualboxiso Provisioning with chefsolo virtualboxiso Installing Chef virtualboxiso virtualboxiso ModuleType Version Name ExportedCommands virtualboxiso virtualboxiso Script Omnitruck GetProjectMetadata InstallProject install virtualboxiso Installing chef from C Users vagrant AppData Local Temp chefclient x msi virtualboxiso virtualboxiso virtualboxiso Creating directory CWindowsTemppackerchefsolo virtualboxiso virtualboxiso virtualboxiso Directory C Windows Temp virtualboxiso virtualboxiso virtualboxiso Mode LastWriteTime Length Name virtualboxiso virtualboxiso d AM packerchefsolo virtualboxiso virtualboxiso virtualboxiso skipping chmod CWindowsTemppackerchefsolo virtualboxiso Creating directory CWindowsTemppackerchefsolocookbooks virtualboxiso virtualboxiso virtualboxiso Directory C Windows Temp packerchefsolo virtualboxiso virtualboxiso virtualboxiso Mode LastWriteTime Length Name virtualboxiso virtualboxiso d AM cookbooks virtualboxiso virtualboxiso virtualboxiso skipping chmod CWindowsTemppackerchefsolocookbooks virtualboxiso Creating directory CWindowsTemppackerchefsolocookbooks virtualboxiso virtualboxiso virtualboxiso Directory C Windows Temp packerchefsolo virtualboxiso virtualboxiso virtualboxiso Mode LastWriteTime Length Name virtualboxiso virtualboxiso d AM cookbooks virtualboxiso virtualboxiso virtualboxiso skipping chmod CWindowsTemppackerchefsolocookbooks virtualboxiso Creating configuration file solorb virtualboxiso Creating JSON attribute file virtualboxiso Executing Chef copscodechefbinchefsolobat nocolor c CWindowsTemppackerchefsolosolorb j CWindowsTemppackerchefsolonodejson virtualboxiso Starting Chef Client version virtualboxiso resolving cookbooks for run list wsusclientconfigure packertemplatesinstallpsmodules packertemplatesvboxguestadditions packertemplatesuninstallpowershellise packertemplatesdeletepagefile virtualboxiso T WARN Child with name packertemplates found in multiple directories CWindowsTemppackerchefsolocookbooks packertemplates and CWindowsTemppackerchefsolocookbooks packertemplates virtualboxiso T WARN Child with name packertemplates found in multiple directories CWindowsTemppackerchefsolocookbooks packertemplates and CWindowsTemppackerchefsolocookbooks packertemplates virtualboxiso T WARN Child with name packertemplates found in multiple directories CWindowsTemppackerchefsolocookbooks packertemplates and CWindowsTemppackerchefsolocookbooks packertemplates virtualboxiso T WARN Child with name packertemplates found in multiple directories CWindowsTemppackerchefsolocookbooks packertemplates and CWindowsTemppackerchefsolocookbooks packertemplates virtualboxiso Synchronizing Cookbooks virtualboxiso wsusclient virtualboxiso packertemplates virtualboxiso windows virtualboxiso Installing Cookbook Gems virtualboxiso Compiling Cookbooks virtualboxiso virtualboxiso virtualboxiso Recipe Compile Error in cwindowstemppackerchefsololocalmodecachecachecookbookswindowslibrarieswindowspackagerb virtualboxiso virtualboxiso virtualboxiso LoadError virtualboxiso virtualboxiso cannot load such file chefmixinlanguage virtualboxiso virtualboxiso System Info virtualboxiso virtualboxiso chefversion virtualboxiso platformwindows virtualboxiso platformversion virtualboxiso rubyruby p revision x mingw virtualboxiso programnamecopscodechefbinchefsolo virtualboxiso executablecopscodechefbinchefsolo virtualboxiso virtualboxiso virtualboxiso Running handlers virtualboxiso T ERROR Running exception handlers virtualboxiso T ERROR Running exception handlers virtualboxiso Running handlers complete virtualboxiso T ERROR Exception handlers complete virtualboxiso T ERROR Exception handlers complete virtualboxiso Chef Client failed resources updated in seconds virtualboxiso T FATAL Stacktrace dumped to cwindowstemppackerchefsololocalmodecachecachechefstacktraceout virtualboxiso T FATAL Stacktrace dumped to cwindowstemppackerchefsololocalmodecachecachechefstacktraceout virtualboxiso T FATAL Please provide the contents of the stacktraceout file if you file a bug report virtualboxiso T FATAL Please provide the contents of the stacktraceout file if you file a bug report virtualboxiso T FATAL LoadError cannot load such file chefmixinlanguage virtualboxiso T FATAL LoadError cannot load such file chefmixinlanguage virtualboxiso Deregistering and deleting VM virtualboxiso Deleting output directory Build virtualboxiso errored Error executing Chef Nonzero exit status consistent failure in creation of Windows image Creation of Windows r is fine so I do not believe it is locally related to the Chef DK PC that is performing the operation executed packer build force only virtualboxiso vbox json removed lines that seemed normal but can post them if needed Only snipped around where is seemed to start to go haywire virtualboxiso Creating configuration file solorb virtualboxiso Creating JSON attribute file virtualboxiso Executing Chef copscodechefbinchefsolobat nocolor c CWindowsTemppackerchefsolosolorb j CWindowsTemppackerchefsolonodejson virtualboxiso Starting Chef Client version virtualboxiso resolving cookbooks for run list wsusclientconfigure packertemplatesinstallpsmodules packertemplatesvboxguestadditions packertemplatesuninstallpowershellise packertemplatesdeletepagefile virtualboxiso T WARN Child with name packertemplates found in multiple directories CWindowsTemppackerchefsolocookbooks packertemplates and CWindowsTemppackerchefsolocookbooks packertemplates the last line of the block above above duplicates dozens of times before moving to the following virtualboxiso Synchronizing Cookbooks virtualboxiso wsusclient virtualboxiso packertemplates virtualboxiso windows virtualboxiso Installing Cookbook Gems virtualboxiso Compiling Cookbooks virtualboxiso virtualboxiso virtualboxiso Recipe Compile Error in cwindowstemppackerchefsololocalmodecachecachecookbookswindowslibrarieswindowspackagerb virtualboxiso virtualboxiso LoadError virtualboxiso virtualboxiso cannot load such file chefmixinlanguage virtualboxiso virtualboxiso System Info virtualboxiso virtualboxiso chefversion virtualboxiso platformwindows virtualboxiso platformversion virtualboxiso rubyruby p revision x mingw virtualboxiso programnamecopscodechefbinchefsolo virtualboxiso executablecopscodechefbinchefsolo virtualboxiso virtualboxiso virtualboxiso Running handlers virtualboxiso T ERROR Running exception handlers virtualboxiso T ERROR Running exception handlers virtualboxiso Running handlers complete virtualboxiso T ERROR Exception handlers complete virtualboxiso T ERROR Exception handlers complete virtualboxiso Chef Client failed resources updated in seconds virtualboxiso T FATAL Stacktrace dumped to cwindowstemppackerchefsololocalmodecachecachechefstacktraceout virtualboxiso T FATAL Stacktrace dumped to cwindowstemppackerchefsololocalmodecachecachechefstacktraceout virtualboxiso T FATAL Please provide the contents of the stacktraceout file if you file a bug report virtualboxiso T FATAL Please provide the contents of the stacktraceout file if you file a bug report virtualboxiso T FATAL LoadError cannot load such file chefmixinlanguage virtualboxiso T FATAL LoadError cannot load such file chefmixinlanguage virtualboxiso Deregistering and deleting VM virtualboxiso Deleting output directory Build virtualboxiso errored Error executing Chef Nonzero exit status Some builds didnt complete successfully and had errors virtualboxiso Error executing Chef Nonzero exit status Builds finished but no artifacts were created I think maybe for newer chef clients theres no msi file left behind to run that will allow you to uninstall the chef client in scriptscleanupps I added the following bit below the existing uninstall attempt and it seems to have resolved the issue Modern chef clients should be uninstalled through AddRemove Programs chef GetWmiObject Class Win Product WhereObject Name match Chef if chef chefuninstall 