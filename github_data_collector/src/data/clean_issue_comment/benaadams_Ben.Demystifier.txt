This is only the initial PR with a proposal to make BenDemystifier aware of F async engines Example form the samples folder produces a raw exception stack trace of SystemException BOOM at Programcall InvokeUnit arg in D projects dev contrib BenDemystifier sample FSharpStackTrace Programfsline at MicrosoftFSharpControlAsyncPrimitivesCallThenInvokeNoHijackCheck ab AsyncActivation ctxt FSharpFunc userCode b result in E A work s src fsharp FSharpCore asyncfsline at MicrosoftFSharpControlTrampolineExecuteFSharpFunc firstAction in E A work s src fsharp FSharpCore asyncfsline End of stack trace from previous location where exception was thrown at PlyTplPrimitivesTplAwaitable GetNext at PlyTplPrimitivesContinuationStateMachine SystemRuntimeCompilerServicesIAsyncStateMachineMoveNext End of stack trace from previous location where exception was thrown at ProgrammainString argv in D projects dev contrib BenDemystifier sample FSharpStackTrace Programfsline While after this PR SystemException BOOM at async Asyncint Programcall in DprojectsdevcontribBenDemystifiersampleFSharpStackTraceProgramfsline at int Programmainstring argv in DprojectsdevcontribBenDemystifiersampleFSharpStackTraceProgramfsline Some notes and thoughts F stack traces doesnt seem to be complete If youll take a look at sample and demystified stack trace youll see that some of the function calls are lost This is because they dont show in the original stack traces either Something that problably could be improved directly in F compiler I guess The entire logic around inclusionexclusion of method and its formatting feels clunky I know that this would take a lot of work but maybe it would be feasible to rearrange BenDemystifier around visitor pattern and make demystifier open to user extensions While ToString could be used if using in an external library that is building a stack trace calling the string builder method is more performant I mainly have updated to use it but would like to change the line Right now when an exception is Demystify it exposes a cleaned up stack trace The issue is Im using Bugsnag probably not the only library that takes the exception and builds some internal structure StackTraceLine before logging it Therefore the Demystifier has no effect Can we please get a Demystify that cleans up the stack frames as well so that if the exception is used in another library it will not include the unnecessary stack frames The typeIsDefinedtypeofCompilerGeneratedAttribute check removed since it led to the exclusion of async lambdas Is it possible to sign the assemblies with Authenticode C Program Files x Windows Kits bin x signtool verify C Users sezhezhe nuget packages bendemystifier lib netstandard BenDemystifierdll File C Users sezhezhe nuget packages bendemystifier lib netstandard BenDemystifierdll Index Algorithm Timestamp SignTool Error No signature found Number of errors onovotny who helped with strongname signing for this project and maintains Is there any particular reason why src folder is included into the nuget package Attempting to use BenDemystifier version installed via NuGet I am getting the following error at runtime Looks like the version number is not getting set correctly Could not load file or assembly BenDemystifier Version Cultureneutral PublicKeyTokena d e a or one of its dependencies The system cannot find the file specified Consider the following LINQPad code void Main try Foo catch Exception e eToStringDumpToString eToStringDemystifiedDumpToStringDemystified eDemystifyToStringDumpDemystifyToString public void Foo try Bar catchException e throw new InvalidOperationExceptionSomething failed while trying to Bar e public void Bar try Baz catch Exception e throw new InvalidOperationExceptionSomething failed while trying to Baz e public void Baz throw new InvalidOperationExceptionSomething went wrong in here Output for DemystifyToString looks like this SystemInvalidOperationException Something failed while trying to Bar SystemInvalidOperationException Something failed while trying to Baz SystemInvalidOperationException Something went wrong in here at void UserQueryBar in CUsersjamesjensenAppDataLocalTempLINQPad pwdvgudaquerywparcicsline End of inner exception stack trace at void UserQueryBar in CUsersjamesjensenAppDataLocalTempLINQPad pwdvgudaquerywparcicsline at void UserQueryFoo in CUsersjamesjensenAppDataLocalTempLINQPad pwdvgudaquerywparcicsline End of inner exception stack trace at void UserQueryFoo in CUsersjamesjensenAppDataLocalTempLINQPad pwdvgudaquerywparcicsline at void UserQueryMain in CUsersjamesjensenAppDataLocalTempLINQPad pwdvgudaquerywparcicsline Output for ToStringDemystified looks like this SystemInvalidOperationException Something failed while trying to Bar at void UserQueryFoo in CUsersjamesjensenAppDataLocalTempLINQPad pwdvgudaquerywparcicsline at void UserQueryMain in CUsersjamesjensenAppDataLocalTempLINQPad pwdvgudaquerywparcicsline SystemInvalidOperationException Something failed while trying to Baz at void UserQueryBar in CUsersjamesjensenAppDataLocalTempLINQPad pwdvgudaquerywparcicsline at void UserQueryFoo in CUsersjamesjensenAppDataLocalTempLINQPad pwdvgudaquerywparcicsline SystemInvalidOperationException Something went wrong in here at void UserQueryBar in CUsersjamesjensenAppDataLocalTempLINQPad pwdvgudaquerywparcicsline End of inner exception stack trace End of inner exception stack trace I believe this changed in a recent patch version update Tested on Hi Is it possible to improve readability of the bold marked lines Application startup exception SystemNetSocketsSocketException Connection refused at NpgsqlNpgsqlConnectorConnectNpgsqlTimeout timeout in C projects npgsql src Npgsql NpgsqlConnectorcsline at NpgsqlNpgsqlConnectorRawOpenNpgsqlTimeout timeout Boolean async CancellationToken cancellationToken in C projects npgsql src Npgsql NpgsqlConnectorcsline at NpgsqlNpgsqlConnectorOpenNpgsqlTimeout timeout Boolean async CancellationToken cancellationToken in C projects npgsql src Npgsql NpgsqlConnectorcsline at NpgsqlNpgsqlConnectioncDisplayClass OpengOpenLong dMoveNext in C projects npgsql src Npgsql NpgsqlConnectioncsline End of stack trace from previous location where exception was thrown at NpgsqlNpgsqlConnectionOpen in C projects npgsql src Npgsql NpgsqlConnectioncsline at NpgsqlEntityFrameworkCorePostgreSQLStorageInternalNpgsqlDatabaseCreatorExists in C projects npgsqlentityframeworkcorepostgresql src EFCorePG Storage Internal NpgsqlDatabaseCreatorcsline at MicrosoftEntityFrameworkCoreMigrationsHistoryRepositoryExists at MicrosoftEntityFrameworkCoreMigrationsInternalMigratorMigrateString targetMigration at MicrosoftEntityFrameworkCoreRelationalDatabaseFacadeExtensionsMigrateDatabaseFacade databaseFacade at SapphireEntityFrameworkCoreExtensionsServiceProviderExtensionsMigrateDatabase TContext IServiceProvider serviceProvider in UserskrisztiankocsisDocumentsProjectsmiwcloudmodulessapphiresrcSapphireEntityFrameworkCoreExtensionsServiceProviderExtensionscsline at MIWCloudWebBootstrapConfigureIApplicationBuilder applicationBuilder in UserskrisztiankocsisDocumentsProjectsmiwcloudsrcMIWCloudWebBootstrapcsline End of stack trace from previous location where exception was thrown at MicrosoftAspNetCoreHostingConventionBasedStartupConfigureIApplicationBuilder app at MicrosoftAspNetCoreHostFilteringStartupFiltercDisplayClass Configureb IApplicationBuilder app at MicrosoftAspNetCoreHostingInternalAutoRequestServicesStartupFiltercDisplayClass Configureb IApplicationBuilder builder at MicrosoftAspNetCoreHostingInternalWebHostBuildApplication SystemInvalidOperationException HResult x MessageLate bound operations cannot be performed on fields with types for which TypeContainsGenericParameters is true SourceSystemPrivateCoreLib StackTrace at SystemReflectionRtFieldInfoInternalGetValueObject obj StackCrawlMark stackMark at SystemReflectionRtFieldInfoGetValueObject obj at SystemDiagnosticsEnhancedStackTraceGetMethodDisplayStringMethodBase originMethod in C GitHub BenDemystifier src BenDemystifier EnhancedStackTraceFramescsline at SystemDiagnosticsEnhancedStackTraceGetFramesStackTrace stackTrace in C GitHub BenDemystifier src BenDemystifier EnhancedStackTraceFramescsline at SystemDiagnosticsEnhancedStackTracectorStackTrace stackTrace in C GitHub BenDemystifier src BenDemystifier EnhancedStackTracecsline at SystemDiagnosticsEnhancedStackTraceCurrent in C GitHub BenDemystifier src BenDemystifier EnhancedStackTracecsline at SparrowNativeAllocator InitializeNativeAllocator allocator in F ravendb src Sparrow AllocatorsNativecsline The real stack trace is at SystemEnvironmentgetStackTrace at SystemReflectionRtFieldInfoInternalGetValueObject obj StackCrawlMark stackMark at SystemReflectionRtFieldInfoGetValueObject obj at SystemDiagnosticsEnhancedStackTraceGetMethodDisplayStringMethodBase originMethod in C GitHub BenDemystifier src BenDemystifier EnhancedStackTraceFramescsline at SystemDiagnosticsEnhancedStackTraceGetFramesStackTrace stackTrace in C GitHub BenDemystifier src BenDemystifier EnhancedStackTraceFramescsline at SystemDiagnosticsEnhancedStackTracectorStackTrace stackTrace in C GitHub BenDemystifier src BenDemystifier EnhancedStackTracecsline at SystemDiagnosticsEnhancedStackTraceCurrent in C GitHub BenDemystifier src BenDemystifier EnhancedStackTracecsline at SparrowNativeAllocator InitializeNativeAllocator allocator in F ravendb src Sparrow AllocatorsNativecsline at SparrowArenaAllocator InitializeArenaAllocator allocator in F ravendb src Sparrow AllocatorsArenacsline at SparrowAllocator Initialize TAllocatorOptions TAllocatorOptions options in F ravendb src Sparrow Allocatorscsline at SparrowJsonJsonOperationContextRenew in F ravendb src Sparrow Json JsonOperationContextcsline at SparrowJsonJsonContextPoolBase TryReuseExistingContextFromContextStack stack T context IDisposable disposable in F ravendb src Sparrow Json JsonContextPoolBasecsline at SparrowJsonJsonContextPoolBase AllocateOperationContextT context in F ravendb src Sparrow Json JsonContextPoolBasecsline at SparrowJsonJsonOperationContextManagedPinnedBufferClone T JsonContextPoolBase pool in F ravendb src Sparrow Json JsonOperationContextcsline at RavenServerDocumentsReplicationIncomingReplicationHandlerctorTcpConnectionOptions options ReplicationLatestEtagRequest replicatedLastEtag ReplicationLoader parent ManagedPinnedBuffer bufferToCopy in F ravendb src RavenServer Documents Replication IncomingReplicationHandlercsline at RavenServerDocumentsReplicationReplicationLoaderAcceptIncomingConnectionTcpConnectionOptions tcpConnectionOptions ManagedPinnedBuffer buffer in F ravendb src RavenServer Documents Replication ReplicationLoadercsline at RavenServerRavenServerDispatchDatabaseTcpConnectionTcpConnectionOptions tcp TcpConnectionHeaderMessage header ManagedPinnedBuffer bufferToCopy in F ravendb src RavenServer RavenServercsline at SystemRuntimeCompilerServicesAsyncMethodBuilderCoreStart TStateMachine TStateMachine stateMachine at RavenServerRavenServerDispatchDatabaseTcpConnectionTcpConnectionOptions tcp TcpConnectionHeaderMessage header ManagedPinnedBuffer bufferToCopy at RavenServerRavenServercDisplayClass ListenToNewTcpConnectionb dMoveNext in F ravendb src RavenServer RavenServercsline at SystemThreadingExecutionContextRunInternalExecutionContext executionContext ContextCallback callback Object state at SystemRuntimeCompilerServicesAsyncTaskMethodBuilder AsyncStateMachineBox MoveNext at SystemRuntimeCompilerServicesTaskAwaitercOutputWaitEtwEventsb Action innerContinuation Task innerTask at SystemThreadingTasksAwaitTaskContinuationRunOrScheduleActionAction action Boolean allowInlining at SystemThreadingTasksTaskRunContinuationsObject continuationObject at SystemThreadingTasksTask TrySetResultTResult result at SystemRuntimeCompilerServicesAsyncTaskMethodBuilder SetExistingTaskResultTResult result at SparrowJsonJsonOperationContextParseToMemoryAsyncStream stream String documentId UsageMode mode ManagedPinnedBuffer bytes Nullable token Int maxSize in F ravendb src Sparrow Json JsonOperationContextcsline at SystemThreadingExecutionContextRunInternalExecutionContext executionContext ContextCallback callback Object state at SystemRuntimeCompilerServicesAsyncTaskMethodBuilder AsyncStateMachineBox MoveNext at SystemRuntimeCompilerServicesTaskAwaitercOutputWaitEtwEventsb Action innerContinuation Task innerTask at SystemThreadingTasksAwaitTaskContinuationRunOrScheduleActionAction action Boolean allowInlining at SystemThreadingTasksTaskRunContinuationsObject continuationObject at SystemThreadingTasksTask TrySetResultTResult result at SystemThreadingTasksValueTask ValueTaskSourceAsTaskccctorb Object state at SystemNetSocketsSocketAwaitableSocketAsyncEventArgsInvokeContinuationAction continuation Object state Boolean forceAsync at SystemNetSocketsSocketAwaitableSocketAsyncEventArgsOnCompletedSocketAsyncEventArgs at SystemNetSocketsSocketAsyncEventArgsFinishOperationAsyncSuccessInt bytesTransferred SocketFlags flags at SystemNetSocketsSocketAsyncEventArgsccctorb UInt errorCode UInt numBytes NativeOverlapped nativeOverlapped at SystemThreadingIOCompletionCallbackPerformIOCompletionCallbackUInt errorCode UInt numBytes NativeOverlapped pOVERLAP 