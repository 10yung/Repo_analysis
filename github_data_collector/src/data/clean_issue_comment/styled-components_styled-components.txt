 HOLD UP PLEASE BEFORE DELETING THIS TEMPLATE Thank you for contributing and please follow this guide before creating an issue Do you have a usage question Look for prior or closed issues but please avoid replying to them if theyre old Check the docs Look forask questions on stack overflow Start a thread on our Spectrum help channel Is this about Typescript TS types are provided by DefinitelyTyped all issues opened about TS will be closed and referred there Think you found a bug Consider submitting a PR with a failing test instead Use the BUG TEMPLATE below to report a test Dont forget to PROVIDE A REPRODUCTION PLEASE Codesandbox links are provided and most useful repositories are ok If you cant provide a reproduction snippets of code can help but are incomplete reports Do you have a feature request Look for old closed issues replying might be ok if theyre not too old or have no conclusion Otherwise Remove the template below and provide thoughtful commentary and code samples on what this feature means for your product What will it allow you to do that you cant do today How will it make current workarounds straightforward What potential bugs and edge cases does it help to avoid Please keep it productcentric BUG TEMPLATE Environment Please run this command inside your project and paste its contents here it automatically copies to your clipboard npx envinfo system binaries npmPackages styledcomponentsbabelpluginstyledcomponents markdown clipboard System OS macOS CPU x IntelR CoreTM i U CPU GHz Memory MB GB Shell binzsh Binaries Node usrlocalbinnode Yarn usrlocalbinyarn npm usrlocalbinnpm Reproduction If you cant reproduce your bug make sure to add details on how youve set up your project styledcomponents v styledcomponents v Changes made between both deployments Source code where StylesheetManager is used Steps to reproduce Clone Switch to branch styledcomponentsv Run yarn yarn start in repo root Navigate to in browser Expected Behavior CSS is rendered into head of each iframe Actual Behavior Some CSS is rendered and some not I couldnt find a pattern in which CSS is rendered and which isnt unfortunately Also if I delete the first iframe in other CSS is being rendered in the second one So the StylesheetManager instances seem to interfere with each other BUG TEMPLATE Environment System OS macOS CPU x IntelR CoreTM i HK CPU GHz Memory GB GB Shell binbash Binaries Node nvmversionsnodev binnode Yarn yarnbinyarn npm nvmversionsnodev binnpm Reproduction Steps to reproduce Inside the given repo run yarn add styledcomponents yarn start visit BROWSER FREEZES Expected Behavior Works like v Everything is rendered correctly You see If you see this everything is working in your app Actual Behavior Browser freezes You see the loading state forever Do you have a feature request Look for old closed issues replying might be ok if theyre not too old or have no conclusion Otherwise Remove the template below and provide thoughtful commentary and code samples on what this feature means for your product What will it allow you to do that you cant do today How will it make current workarounds straightforward What potential bugs and edge cases does it help to avoid Please keep it productcentric This is a feature request I have just discovered a code base that abuses global class names all over the place like this tsx const StyledDiv styleddiv display flex customername margintop em StyledDiv div classNamecustomername name div StyledDiv I propose that styledcomponents makes it impossible to do this by default It could offer a configuration flag to turn this behavior on for legacy code bases already relying on it For the case where one truly needs to use global class names styledcomponents could follow the cssmodules approach and introduce a global pseudoclass tsx const StyledDiv styleddiv display flex globalbtn btnprimary margintop em BUG TEMPLATE Environment System OS macOS CPU x IntelR CoreTM i U CPU GHz Memory MB GB Shell binzsh Binaries Node nvmversionsnodev binnode Yarn usrlocalbinyarn npm nvmversionsnodev binnpm Watchman usrlocalbinwatchman npmPackages babelpluginstyledcomponents styledcomponents Reproduction When importing a compiled react app into a seperate div on the page the development versionn of styledcomponents is going crazy I do not get an error or warning but some rollover styles are broken This doesnt seem to happen when building production builds I have looked through other issues but since this is a compiled app being imported it is not quite the same Is this safe to do in production builds Will this PR fix Im making a library of components that uses styledcomponents I have styled components installed as a dependency in the app but Im using externals in rollup to make sure they dont get packaged up When I npm link a local version of the library so I can work on it and install it in an example app I get the warnings about multiple versions of styledcomponents This makes a proper dev workflow for making a React component npm package very difficult It works fine when I npm install normally so I imagine this is something to do with how npm link works I would just remove styledcomponents from my library and list it as a peer dependency only but I need it to make my librarys storybook work I thought this was a Storybook issue for a while until I saw that the problem doesnt occur in some older versions of styledcomponents such as Heres an issue I opened there Steps to reproduce Make some styled components in one place package it up and npm link it In an example app install and import that package with npm link packagename and you should find the error Expected Behavior I dont see any errors because styledcomponents is correctly removed from the built module like Im specifying in my rollup config Actual Behavior Somehow styledcomponents is leaking out of my library anyway and getting mixed up with the version running in the main example app by mirroring attribute key in value This fixes xhtml support as xml doesnt support attribute minimization excluding the attribute value More specifically from xhtml spec Attribute Minimization XML does not support attribute minimization Attributevalue pairs must be written in full Attribute names such as compact and checked cannot occur in elements without their value being specified Without this xhtml is not supported rendering the hbbtv tv platform outside the scope of styledcomponents This worked in v as we are currently running it and are very pleased so thanks for all the good work Environment ssr of any page with xhtml doctype Steps to reproduce Borked v with xhtml doctype on codesandboxio Expected Behavior styledcomponents ssr renders xhtml compatible markup Working v with xhtml doctype code Actual Behavior styledcomponents ssr renders xhtml incompatible markup Borked v with xhtml doctype code This update breaks attrs being overwritten for input types I have this input component export const Input styledinputattrs type text formControl which then gets overwritten in other instances with typenumber This update doesnt respect the overwrite This is shown in this snapshot change where the only difference is moving from v to v idfinanceValue namefinanceValue placeholdereg typenumber typetext Environment System OS macOS Mojave CPU x IntelR CoreTM i H CPU GHz Memory MB GB Shell binzsh Binaries Node usrlocalbinnode npm usrlocalbinnpm Watchman usrlocalbinwatchman npmPackages babelpluginstyledcomponents styledcomponents I searched old issues commits etc but couldnt find any reason this was omitted so I propose adding it This avoid TypeError Cannot read property withConfig of undefined when doing js const RedCenteredText styledcenter color red export default RedCenteredTextRed Centered TextRedCenteredText or with the babel plugin js export default center csscolor redRed Centered Textcenter Dark Mode with SSR is broken in styledcomponents Browsers have a way of picking the right styles based on user preference using media queries Either with media attribute on link elements or using media queries in CSS files As far as I know styledcomponent has no way of extracting CSS files so the only choice is to repeat our CSS once in default theme and once in dark theme but wrapped with a media directive in generated style element Currently it is suggested that we have a dark theme and decide if user prefers dark or light theme and then pass a proper theme to ThemeProvider This breaks in the server where we dont know what user preference is Im suggesting that we extend the ThemeProvider in a way that it can accept multiple themes and each theme is associated with a media query The resulting CSS will be sum of all generated CSS each themes generated CSS wrapped in its associated media query The themes prop on ThemeProvider Instead of a single theme object let there be a themes prop that accepts a map of media query to theme objects The default theme property key can be a Symbol exported from styledcomponents module Example ts import ThemeProvider DEFAULTKEYSYMBOL from styledcomponents ThemeProvider themes DEFAULTKEYSYMBOL theme colors color black background white dark theme colors color white background black media preferscolorscheme dark ThemeProvider With this when calling sheetgetStyleElement we will get both themess CSS In client this will be unnecessary because we can use JavaScript windowmatchMedia API to pick the right theme In future if browsers send UserAgent Client Hint to indicate dark mode preference or any other media query we can use that to pick a theme Ideally styledcomponetns should allow extracting CSS files and sending CSS with link elements which would avoid shipping unnecessary CSS Related BUG TEMPLATE Environment System OS macOS CPU x IntelR CoreTM i U CPU GHz Memory GB GB Shell binbash Binaries Node usrlocalbinnode Yarn usrlocalbinyarn npm usrlocalbinnpm Watchman usrlocalbinwatchman Reproduction Upgrade to v start app Steps to reproduce Upgrade to v start app Expected Behavior Styles should be collected on server Actual Behavior The genereated style tag was empty We are using next and I upgraded today to styledcomponents seeing that there were no breaking changes I expected everything to work as before however collecting styles on the server no longer works Only this is created Screenshot at 