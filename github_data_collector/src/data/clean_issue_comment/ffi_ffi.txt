Hi there Im attempting to make a FFI binding for SQLite and I ran into a big problem that seems to stem from FFI itself Specifically I seem to be getting a segfault whenever a attached function with varargs as one of the arguments receives a callback as one of the parameters The code below is the minimal code needed to replicate this This code when run as is currently produces a segfault ruby require ffi module SQLite extend FFILibrary ffilib sqlite callback sqlite configlogxFunc pointer int string void attachfunction sqlite config int varargs int end def sqlogdata op str print SQLITE p data op str end p SQLite sqlite config SQLITECONFIGLOG sqlite configlogxFunc methodsqlog To ensure this wasnt just me being stupid or SQLite being stupid I tried changing the parameter list for sqlite config around a bit When the parameter list is int sqlite configlogxFunc varargs and the function call is edited appropriately FFI will still segfault and in fact will always segfault even when you dont specify the callback parameter in the function call However when the parameter list is int sqlite configlogxFunc with no varargs the function will work as intended Even if I enter in invalid parameters to sqlite config assuming their type matches up with what FFI expects the parameters to be I no longer get a segfault from FFI and SQLite receives the function call as expected Except now Ive lost access to all the other config options that Im meant to change via sqlite config as the parameter list isnt compatible with any of the other configuration verbs offered for sqlite config PS I am running ffi x mingw on Windows as well as SQLite in case the version numbers make any difference they shouldnt though Is there still a mailing list I tried going to the google group linked in the Wiki and google says it doesnt exist or its private Id like to update the wiki if its no longer accurate or lacking details I though about adding some loading mechanism with ABI version like this extracted from rubyvips ruby Generate a library name for ffi Platform notes linux Some distros allow libvipsso but only if the dev headers have been installed To work everywhere you must include the ABI number Confusingly the file extension is not at the end ffi adds the lib prefix mac As linux but the extension is at the end and is added by ffi windows The ABI number must be included but with a hyphen ffi does not add a lib prefix or a dll suffix def librarynamename abinumber if FFIPlatformwindows libnameabinumberdll elsif FFIPlatformmac nameabinumber else namesoabinumber end end For libvips the library file names are libvips dll on Windows libvipsso on Linux libvips dylib on Macos This file name pattern is pretty standard on Linux and other UNIXes and the corresponding Windows pattern is getting more common these days at least on MINGWMSYS Not sure how library naming is done on MSVC They change DLL loading mechanisms every some years SxS explicit DLL version names API sets Do you know how common the MacOSpattern is I dont know much about MacOS On windows when using Ruby built with mingw FFILIBC returns msvcrtdll When using Ruby built with MSVC FFILIBC returns vcruntimeversiondll Neither is correct Starting in Visual Studio the C runtime library migrated to ucrtbasedll See for more information Or I assume this hasnt been reported as a bug since almost no one uses a MSVC Ruby build and attachfunction for functions like malloc does actually work using msvcrtdll but does not with vcruntimeversiondll This patch changes mingw and mswin to use ucrtbasedll for the C library Tested both with mswin and mingw Ruby builds The one downside of this patch is that it would break for anyone running a version of Windows that hasnt been updated since Spring when Microsoft introduced this change the dll ships with Windows and was back ported to older windows versions via Windows update So seems to me a very very low risk LoadErrorRuby x librubygems gemsffi x mingw libffilibraryrb in block in ffilib Could not open library sodium The specified module could not be found Could not open library sodiumdll The specified module could not be found Hello Im unsure what to do to solve this issue and help would be greatly appreciated Thank you dockerfile Author noraj Official verified image FROM ruby alpine hardening RUN chmod tmp date RUN ln fs usrsharezoneinfoEuropeParis etclocaltime copy files COPY website usrsrcapp WORKDIR usrsrcapp INSTALL Print out ruby version for debugging RUN ruby v Bundler is not installed with the image RUN gem install bundler nodocument install nproc coreutils for bundle j install git for building the gemspec install make gcc for building gem native extension commonmarker libcdev for musldev dependency stdlibh needed by gcc install g and libstdc for building eventmachine RUN apk nocache add coreutils git buildbase libstdc libffidev RUN bundle install j nproc path vendor Install dependencies into vendorruby Install node LTS and npm RUN apk nocache add nodejs npm Print out node version for debugging RUN node version Print out npm version for debugging RUN npm version Install gulp RUN npm install g gulpcli Install dependencies RUN npm install BUILD RUN gulp build RUN bundle exec middleman build RUN mv build public drop privileges RUN groupadd g appuser useradd r u g appuser appuser USER appuser EXPOSE CMD bundle exec middleman server Step RUN bundle exec middleman build Running in f ce f a bundler failed to load command middleman usrsrcappvendorruby binmiddleman LoadError Error relocating usrsrcappvendorruby gemsffi libfficso sprintfchk symbol not found usrsrcappvendorruby gemsffi libfficso usrsrcappvendorruby gemsffi libffirb in require usrsrcappvendorruby gemsffi libffirb in rescue in top required usrsrcappvendorruby gemsffi libffirb in top required usrsrcappvendorruby gemsrbinotify librbinotifynativerb in require usrsrcappvendorruby gemsrbinotify librbinotifynativerb in top required usrsrcappvendorruby gemsrbinotify librbinotifyrb in require usrsrcappvendorruby gemsrbinotify librbinotifyrb in top required usrsrcappvendorruby gemslisten liblistenadapterlinuxrb in require usrsrcappvendorruby gemslisten liblistenadapterlinuxrb in configure usrsrcappvendorruby gemslisten liblistenadapterbaserb in block in configure usrsrcappvendorruby gemslisten liblistenadapterbaserb in each usrsrcappvendorruby gemslisten liblistenadapterbaserb in configure usrsrcappvendorruby gemslisten liblistenadapterbaserb in start usrsrcappvendorruby gemslisten liblistenbackendrb in start usrsrcappvendorruby gemslisten liblistenlistenerrb in block in classListener usrsrcappvendorruby gemslisten liblistenfsmrb in instanceeval usrsrcappvendorruby gemslisten liblistenfsmrb in call usrsrcappvendorruby gemslisten liblistenfsmrb in transitionwithcallbacks usrsrcappvendorruby gemslisten liblistenfsmrb in transition usrsrcappvendorruby gemslisten liblistenlistenerrb in start usrsrcappvendorruby gemsmiddlemancore libmiddlemancoresourcessourcewatcherrb in listen usrsrcappvendorruby gemscontracts libcontractsmethodreferencerb in sendto usrsrcappvendorruby gemscontracts libcontractscallwithrb in callwith usrsrcappvendorruby gemscontracts libcontractsmethodhandlerrb in block in redefinemethod usrsrcappvendorruby gemsmiddlemancore libmiddlemancoresourcesrb in each usrsrcappvendorruby gemsmiddlemancore libmiddlemancoresourcesrb in start usrsrcappvendorruby gemscontracts libcontractsmethodreferencerb in sendto usrsrcappvendorruby gemscontracts libcontractscallwithrb in callwith usrsrcappvendorruby gemscontracts libcontractsmethodhandlerrb in block in redefinemethod usrsrcappvendorruby gemsmiddlemancore libmiddlemancorecoreextensionsfilewatcherrb in afterconfiguration usrsrcappvendorruby gemscontracts libcontractsmethodreferencerb in sendto usrsrcappvendorruby gemscontracts libcontractscallwithrb in callwith usrsrcappvendorruby gemscontracts libcontractsmethodhandlerrb in block in redefinemethod usrsrcappvendorruby gemsmiddlemancore libmiddlemancoreextensionrb in block in bindafterconfiguration usrsrcappvendorruby gemsmiddlemancore libmiddlemancorecallbackmanagerrb in instanceexec usrsrcappvendorruby gemsmiddlemancore libmiddlemancorecallbackmanagerrb in block in execute usrsrcappvendorruby gemshamster libhamstervectorrb in each usrsrcappvendorruby gemshamster libhamstervectorrb in traversedepthfirst usrsrcappvendorruby gemshamster libhamstervectorrb in each usrsrcappvendorruby gemsmiddlemancore libmiddlemancorecallbackmanagerrb in execute usrsrcappvendorruby gemscontracts libcontractsmethodreferencerb in sendto usrsrcappvendorruby gemscontracts libcontractscallwithrb in callwith usrsrcappvendorruby gemscontracts libcontractsmethodhandlerrb in block in redefinemethod usrsrcappvendorruby gemsmiddlemancore libmiddlemancorecallbackmanagerrb in block in installmethods usrsrcappvendorruby gemsmiddlemancore libmiddlemancoreapplicationrb in initialize usrsrcappvendorruby gemsmiddlemancli binmiddleman in new usrsrcappvendorruby gemsmiddlemancli binmiddleman in top required usrsrcappvendorruby binmiddleman in load usrsrcappvendorruby binmiddleman in top required ERROR Service cracking failed to build The command binsh c bundle exec middleman build returned a nonzero code i get this error on startup while require typhoeus bash vendorbundleruby gemsffi libffilibraryrb in attach unhandled exception from vendorbundleruby gemsffi libffilibraryrb in attachfunction from vendorbundleruby gemsethon libethonlibcrb in moduleLibc from vendorbundleruby gemsethon libethonlibcrb in moduleEthon from vendorbundleruby gemsethon libethonlibcrb in top required from vendorbundleruby gemsethon libethonrb in require from vendorbundleruby gemsethon libethonrb in top required from vendorbundleruby gemstyphoeus libtyphoeusrb in require from vendorbundleruby gemstyphoeus libtyphoeusrb in top required from appmainrb in require from appmainrb in top required from configru in require from configru in block in main from vendorbundleruby gemsrack librackbuilderrb in instanceeval from vendorbundleruby gemsrack librackbuilderrb in initialize from configruin new from configruin main from vendorbundleruby gemsrack librackbuilderrb in eval from vendorbundleruby gemsrack librackbuilderrb in newfromstring from vendorbundleruby gemsrack librackbuilderrb in parsefile from dispatchfcgirb in main replaced my folder with check installed version dpkg l grep libcurl ii libcurl gnutlsamd ubuntu amd easytouse clientside URL transfer library GnuTLS flavour ii libcurl amd ubuntu amd easytouse clientside URL transfer library OpenSSL flavour ii libcurl gnutlsdevamd ubuntu amd development files and documentation for libcurl GnuTLS flavour ii libwwwcurlperl build amd Perl bindings to libcurl ii pythonpycurl amd Python bindings to libcurl ii rubycurb build amd Ruby libcurl bindings Hi thanks for this gem In JRuby it looks like the writeint and readint methods are missing but writearrayofint and readarrayofint are available Same situation with uint as well ruby ptr FFIMemoryPointernewint both missing p ptrwriteint p ptrreadint both succeed p ptrwritearrayofint p ptrreadarrayofint FFI version java JRuby version Platform Mac Hi Im trying to install ffi on my macbook pro but I get the following error output current directory usrlocallibrubygems gemsffi extffic usrlocaloptrubybinruby I usrlocallibrubysiteruby r siteconf tiuylvrb extconfrb checking for ffih no checking for ffih in usrlocalincludeusrincludeffi yes checking for fficall in lffi yes checking for fficlosurealloc no checking for shlwapih no checking for rbthreadcallwithoutgvl yes checking for rubynativethreadp yes checking for rubythreadhasgvlp yes creating extconfh creating Makefile current directory usrlocallibrubygems gemsffi extffic make DESTDIR clean current directory usrlocallibrubygems gemsffi extffic make DESTDIR Configuring libffi clang error unsupported option printmultiosdirectory clang error no input files cd usrlocallibrubygems gemsffi extfficlibffix darwin make make Entering directory usrlocallibrubygems gemsffi extfficlibffix darwin make ARFLAGS CCFORBUILD CFLAGSWall fexceptions CXXFLAGSfnocommon O ggdb CFLAGSFORBUILD CFLAGSFORTARGET INSTALLusrbininstall c INSTALLDATAusrbininstall c m INSTALLPROGRAMusrbininstall c INSTALLSCRIPTusrbininstall c JC FLAGS LDFLAGSLusrlocaloptlibffilib LIBCFLAGS LIBCFLAGSFORTARGET MAKEmake MAKEINFObinsh usrlocallibrubygems gemsffi extfficlibffimissing makeinfo PICFLAG PICFLAGFORTARGET RUNTESTFLAGS SHELLbinsh execprefixusrlocal infodirusrlocalshareinfo libdirusrlocallib mandirusrlocalshareman prefixusrlocal ARlibtool static ASanaconda binx appledarwin as CCclang CXXclang LDanaconda binx appledarwin ld NManaconda binx appledarwin nm RANLIBanaconda binx appledarwin ranlib DESTDIR allrecursive make Entering directory usrlocallibrubygems gemsffi extfficlibffix darwin Making all in include make Entering directory usrlocallibrubygems gemsffi extfficlibffix darwin include make Nothing to be done for all make Leaving directory usrlocallibrubygems gemsffi extfficlibffix darwin include Making all in testsuite make Entering directory usrlocallibrubygems gemsffi extfficlibffix darwin testsuite make Nothing to be done for all make Leaving directory usrlocallibrubygems gemsffi extfficlibffix darwin testsuite Making all in man make Entering directory usrlocallibrubygems gemsffi extfficlibffix darwin man make Nothing to be done for all make Leaving directory usrlocallibrubygems gemsffi extfficlibffix darwin man make Entering directory usrlocallibrubygems gemsffi extfficlibffix darwin binsh libtool tagCC modecompile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT Wall fexceptions c o srcprepciflo usrlocallibrubygems gemsffi extfficlibffisrcprepcifc libtool compile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT Wall fexceptions c usrlocallibrubygems gemsffi extfficlibffisrcprepcifc fnocommon DPIC o srclibsprepcifo binsh libtool tagCC modecompile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT Wall fexceptions c o srctypeslo usrlocallibrubygems gemsffi extfficlibffisrctypesc libtool compile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT Wall fexceptions c usrlocallibrubygems gemsffi extfficlibffisrctypesc fnocommon DPIC o srclibstypeso binsh libtool tagCC modecompile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT Wall fexceptions c o srcrawapilo usrlocallibrubygems gemsffi extfficlibffisrcrawapic libtool compile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT Wall fexceptions c usrlocallibrubygems gemsffi extfficlibffisrcrawapic fnocommon DPIC o srclibsrawapio binsh libtool tagCC modecompile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT Wall fexceptions c o srcjavarawapilo usrlocallibrubygems gemsffi extfficlibffisrcjavarawapic libtool compile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT Wall fexceptions c usrlocallibrubygems gemsffi extfficlibffisrcjavarawapic fnocommon DPIC o srclibsjavarawapio binsh libtool tagCC modecompile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT Wall fexceptions c o srcclosureslo usrlocallibrubygems gemsffi extfficlibffisrcclosuresc libtool compile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT Wall fexceptions c usrlocallibrubygems gemsffi extfficlibffisrcclosuresc fnocommon DPIC o srclibsclosureso binsh libtool tagCC modecompile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT Wall fexceptions c o srcx ffi lo usrlocallibrubygems gemsffi extfficlibffisrcx ffi c libtool compile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT Wall fexceptions c usrlocallibrubygems gemsffi extfficlibffisrcx ffi c fnocommon DPIC o srcx libsffi o binsh libtool modecompile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc c o srcx unix lo usrlocallibrubygems gemsffi extfficlibffisrcx unix S libtool compile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc c usrlocallibrubygems gemsffi extfficlibffisrcx unix S fnocommon DPIC o srcx libsunix o binsh libtool tagCC modecompile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT Wall fexceptions c o srcx ffiw lo usrlocallibrubygems gemsffi extfficlibffisrcx ffiw c libtool compile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT Wall fexceptions c usrlocallibrubygems gemsffi extfficlibffisrcx ffiw c fnocommon DPIC o srcx libsffiw o binsh libtool modecompile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc c o srcx win lo usrlocallibrubygems gemsffi extfficlibffisrcx win S libtool compile clang DHAVECONFIGH I Iusrlocallibrubygems gemsffi extfficlibffi I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc DRUBYEXTCONFH extconfh Iusrlocaloptlibyamlinclude Iusrlocaloptopenssl include Iusrlocaloptreadlineinclude DXOPENSOURCE DDARWINCSOURCE DDARWINUNLIMITEDSELECT DREENTRANT I Iusrlocallibrubygems gemsffi extfficlibffiinclude Iinclude Iusrlocallibrubygems gemsffi extfficlibffisrc c usrlocallibrubygems gemsffi extfficlibffisrcx win S fnocommon DPIC o srcx libswin o binsh libtool tagCC modelink clang Wall fexceptions Lusrlocaloptlibffilib o libfficonveniencela srcprepciflo srctypeslo srcrawapilo srcjavarawapilo srcclosureslo srcx ffi lo srcx unix lo srcx ffiw lo srcx win lo libtool link libtool static cru libslibfficonveniencea srclibsprepcifo srclibstypeso srclibsrawapio srclibsjavarawapio srclibsclosureso srcx libsffi o srcx libsunix o srcx libsffiw o srcx libswin o error ApplicationsXcodeappContentsDeveloperToolchainsXcodeDefaultxctoolchainusrbinlibtool no output file specified specify with o output Usage ApplicationsXcodeappContentsDeveloperToolchainsXcodeDefaultxctoolchainusrbinlibtool static file filelist listfile dirname archonly arch sacLT nowarningfornosymbols Usage ApplicationsXcodeappContentsDeveloperToolchainsXcodeDefaultxctoolchainusrbinlibtool dynamic file filelist listfile dirname archonly arch o output installname name compatibilityversion currentversion seg addr x segsreadonlyaddr x segsreadwriteaddr x segaddrtable filename segaddrtablefilename filesystempath allload noallload make Makefile libfficonveniencela Error make Leaving directory usrlocallibrubygems gemsffi extfficlibffix darwin make Makefile allrecursive Error make Leaving directory usrlocallibrubygems gemsffi extfficlibffix darwin make Makefile all Error make Leaving directory usrlocallibrubygems gemsffi extfficlibffix darwin make libffidarwinmk usrlocallibrubygems gemsffi extfficlibffix darwin libslibfficonveniencea Error make failed exit code I tried cloning the repo and installing with rake but I get the same error Any ideas what might be failing Cheers I have read the wiki on library loading My question is if one were to develop an FFIbased ruby gem how would one expose to end users the ability to select a different library version to be loaded For example Typhoeus uses libcurl and loads it from the system How would one change this load instruction to allow the end user to use nonsystem libcurl Thanks for your time