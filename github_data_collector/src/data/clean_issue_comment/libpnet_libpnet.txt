TLDR Is a function for getting the default network interface neededwanted Im working on a project where I use libpnet for packet sniffing While porting from pcap to libpnet I was missing an implementation to get the default network interface capable of capturing packets With some research I found out that pcap uses a call to the pcaplookupdev function sup sup Looking at the C code I saw that they deprecated it anyway and use the first interface capable available that is not loopback sup sup With this in mind I implemented the following naive helperfunction in my project that works well Filtering for valid IPs was necessary for me but I dont know if this is the general case or only for sniffing rust Tries to find the best suitable candidate for the default network interface It should be the first interface that is up not loopback and has an ip fn defaultinterfaceinterfaces VecNetworkInterface Option NetworkInterface interfaces iter filtere eisup eisloopback eipslen next I wondered if you may wantneedplan a helper like this in the library If this is the case and if you tell me a good place for adding it Id add a PR sup sup sup sup This fixes the panic that was happening when the memory used in checksum calculations was not bit aligned The code no longer uses raw pointers so we dont need any checks for alignment I ran the pnetpacket unit tests Fixes Problem Types imported from ipnetwork are in the public interface of pnet but are not reexported This forces users to manually add ipnetwork to their dependencies to use those parts of pnets interface Changes the crate ipnetwork is reexported Benefits Usability Users wont have to manually add their own ipnetwork dependency to their Cargotoml Compatibility Avoids versioning conflicts if users already use an incompatible version of ipnetwork I cant think of any downsides for this change tbf Updates the requirements on ipnetwork to permit the latest version details summaryRelease notessummary pemSourced from a href releasesaemp blockquote h Release v h pChangelog a href a href a href a href a href a href a href a href a href blockquote details details summaryCommitssummary ul lia href Uprev for a new releaseli lia href Merge pull request a href from achandacleanupli lia href Cleanup comment on IPv implementationli lia href Merge pull request a href from achandamaintenanceli lia href Set a maintenance statusli lia href Merge pull request a href from achandaipv netmaskli lia href Run cargo fmtli lia href Check against specific errors in parsing testli lia href Merge pull request a href from achandabenchnetmaskli lia href Add a benchmark for parsing IPv netmaskli liAdditional commits viewable in a href viewali ul details br Dependabot will resolve any conflicts with this PR as long as you dont alter it yourself You can also trigger a rebase manually by commenting dependabot rebase dependabotautomergestart dependabotautomergeend details summaryDependabot commands and optionssummary br You can trigger Dependabot actions by commenting on this PR dependabot rebase will rebase this PR dependabot recreate will recreate this PR overwriting any edits that have been made to it dependabot merge will merge this PR after your CI passes on it dependabot squash and merge will squash and merge this PR after your CI passes on it dependabot cancel merge will cancel a previously requested merge and block automerging dependabot reopen will reopen this PR if it is closed dependabot close will close this PR and stop Dependabot recreating it You can achieve the same result by closing it manually dependabot ignore this major version will close this PR and stop Dependabot creating any more for this major version unless you reopen the PR or upgrade to it yourself dependabot ignore this minor version will close this PR and stop Dependabot creating any more for this minor version unless you reopen the PR or upgrade to it yourself dependabot ignore this dependency will close this PR and stop Dependabot creating any more for this dependency unless you reopen the PR or upgrade to it yourself dependabot use these labels will set the current labels as the default for future PRs for this repo and language dependabot use these reviewers will set the current reviewers as the default for future PRs for this repo and language dependabot use these assignees will set the current assignees as the default for future PRs for this repo and language dependabot use this milestone will set the current milestone as the default for future PRs for this repo and language dependabot badge me will comment on this PR with code to add a Dependabot enabled badge to your readme Additionally you can set the following in your Dependabot dashboard Update frequency including time of day and day of week Pull request limits per update run andor open at any time Automerge options neverpatchminor and devruntime dependencies Outofrange updates receive only lockfile updates if desired Security updates receive only security updates if desired details Updates the requirements on pnetbase to permit the latest version details summaryRelease notessummary pemSourced from a href releasesaemp blockquote h v h pFixes a href and a href blockquote details details summaryCommitssummary ul liSee full diff in a href viewali ul details br Dependabot will resolve any conflicts with this PR as long as you dont alter it yourself You can also trigger a rebase manually by commenting dependabot rebase dependabotautomergestart dependabotautomergeend details summaryDependabot commands and optionssummary br You can trigger Dependabot actions by commenting on this PR dependabot rebase will rebase this PR dependabot recreate will recreate this PR overwriting any edits that have been made to it dependabot merge will merge this PR after your CI passes on it dependabot squash and merge will squash and merge this PR after your CI passes on it dependabot cancel merge will cancel a previously requested merge and block automerging dependabot reopen will reopen this PR if it is closed dependabot close will close this PR and stop Dependabot recreating it You can achieve the same result by closing it manually dependabot ignore this major version will close this PR and stop Dependabot creating any more for this major version unless you reopen the PR or upgrade to it yourself dependabot ignore this minor version will close this PR and stop Dependabot creating any more for this minor version unless you reopen the PR or upgrade to it yourself dependabot ignore this dependency will close this PR and stop Dependabot creating any more for this dependency unless you reopen the PR or upgrade to it yourself dependabot use these labels will set the current labels as the default for future PRs for this repo and language dependabot use these reviewers will set the current reviewers as the default for future PRs for this repo and language dependabot use these assignees will set the current assignees as the default for future PRs for this repo and language dependabot use this milestone will set the current milestone as the default for future PRs for this repo and language dependabot badge me will comment on this PR with code to add a Dependabot enabled badge to your readme Additionally you can set the following in your Dependabot dashboard Update frequency including time of day and day of week Pull request limits per update run andor open at any time Automerge options neverpatchminor and devruntime dependencies Outofrange updates receive only lockfile updates if desired Security updates receive only security updates if desired details Upgrade to broke things for ex I got a panic in ipv checksum thread main panicked at assertion failed left right left right Cannot sum misaligned words at x b homepolluxcargoregistrysrcgithubcom ecc db ec pnetpacket srcutilrs stack backtrace backtracebacktracelibunwindtrace at cargoregistrysrcgithubcom ecc db ec backtrace srcbacktracelibunwindrs backtracebacktracetraceunsynchronized at cargoregistrysrcgithubcom ecc db ec backtrace srcbacktracemodrs stdsyscommonbacktraceprintfmt at srclibstdsyscommonbacktracers stdsyscommonbacktraceprintDisplayBacktrace as corefmtDisplayfmt at srclibstdsyscommonbacktracers corefmtwrite at srclibcorefmtmodrs stdioWritewritefmt at srclibstdiomodrs stdsyscommonbacktraceprint at srclibstdsyscommonbacktracers stdsyscommonbacktraceprint at srclibstdsyscommonbacktracers stdpanickingdefaulthookclosure at srclibstdpanickingrs stdpanickingdefaulthook at srclibstdpanickingrs stdpanickingrustpanicwithhook at srclibstdpanickingrs stdpanickingcontinuepanicfmt at srclibstdpanickingrs stdpanickingbeginpanicfmt at srclibstdpanickingrs pnetpacketutilchecksum at homepolluxcargoregistrysrcgithubcom ecc db ec pnetpacket srcutilrs pnetpacketipv checksum at targetdebugbuildpnetpacketa d outipv rs The same code works with Unfortunately I cannot downgrade my dependencies to because of Hi In latest release there are several crates depending on pnetbase This breaks crates including for ex pnetpacket and pnetbase since they will end up including multiple and conflicting versions Example of build error caused by these problems libpcapanalyzersrcanalyzerrs match dest this match expression has type pnetbasemacaddrMacAddr MacAddr x x x c xcd xcd xd expected struct pnetbasemacaddrMacAddr found a different struct pnetbasemacaddrMacAddr note expected type pnetbasemacaddrMacAddr struct pnetbasemacaddrMacAddr found type pnetbasemacaddrMacAddr struct pnetbasemacaddrMacAddr note Perhaps two different versions of crate pnetbase are being used This PR updates all dependencies to Hey JuxhinDB possibly related to the conversation here Im trying make a PR to upgrade libpnet on and not really managing The farthest Ive got is with these dependencies dependencies derivenew ipnetwork pnet pnetdatalink pnetbase pnetmacrossupport At which point when I do cargo test I get cpacketbuilder on master cargo test Compiling packetbuilder v homearamcodepacketbuilder Finished dev unoptimized debuginfo targets in s Running targetdebugdepspacketbuildereff d d e c running tests test arptestsmacroarpbasic ok test ethernettestsmacroetherbasic ok test icmptestsmacroicmpbasic ok test tcptestsmacrotcpbasic ok test udptestsmacroudpbasic ok test vlantestsmacrovlanbasic ok test ipv testsmacroipv basic FAILED failures ipv testsmacroipv basic stdout thread ipv testsmacroipv basic panicked at assertion failed left right left right Cannot sum misaligned words at x fb f ed fe homearamcargoregistrysrcgithubcom ecc db ec pnetpacket srcutilrs note run with RUSTBACKTRACE environment variable to display a backtrace failures ipv testsmacroipv basic test result FAILED passed failed ignored measured filtered out error test failed to rerun pass lib Do you have a suggestion for a direction Hi This pull request adds initial support for the Dhcp packet Dhcp options are not yet supported as I wasnt sure what the best method to do this would be as such they are in the payload at this moment in time Feedback welcome This is WIP Im still planning to test it on Windows and FreeBSD but havent done so yet And therere a couple of TODOs in the code But what bothers me the most is how to name new enum value The existing Layer is IPv and I wasnt able to solve this without either breaking compatibility by refactoring layer related enum values into something similar to what already exists for layer or introducing badly named identifiers This WIP has the latter the new value is Ipv Layer Something that Ive observed that might worth mentioning in the docs Unlike IPv source address is not filled in automatically for IPv layer packets HDRINC aka Layer has no effect for receiving IPv on Linux IPv header is always stripped If this is also the case with other OS then there is no point adding Ipv TransportChannelIterator By the way is there a way to construct an iterator over raw packets Like ipv iterator but with byte slice instead of Ipv Packet With HDRINC not working it seems to be crucial for IPv Not to mention that its generally useful for layer protocols See ping JuxhinDB 