I had an issue today with macros in Bindingscala see have a look at Open playfieldSampleAppscala Uncomment the line and try to do a fastOpsJS With the line commented it works for me with the line uncommented it breaks Is this behaviour known Hello I was trying to follow the first step of but with scala However it does not seem to behave as on the linked page I do not see the macroparadise in the list of phases Is this expected scala binscalac Xpluginparadise jar Xshowphases phase name id description parser parse source into ASTs perform simple desugaring namer resolve names attach symbols to named trees packageobjects load package objects typer the meat and potatoes type the trees patmat translate match expressions superaccessors add super accessors in traits and nested classes extmethods add extension methods for inline classes pickler serialize symbol tables refchecks referenceoverride checking translate nested objects uncurry uncurry translate function values to anonymous classes fields synthesize accessors and fields add bitmaps for lazy vals tailcalls replace tail calls by jumps specialize specializeddriven class and method specialization explicitouter this refs to outer pointers erasure erase types add interfaces for traits posterasure clean up erased inline classes lambdalift move nested functions to top level constructors move field definitions into constructors flatten eliminate inner classes mixin mixin composition cleanup platformspecific cleanups generate reflective calls delambdafy remove lambdas jvm generate JVM bytecode terminal the last phase during a compilation run I have a macro annotation with paradise which typechecks an annotated ValDef It compiles in scala but gives an illegal cyclic reference error in I am not sure whether this a scala bug or because of paradise A short example scala import scalareflectmacroswhiteboxContext import scalalanguageexperimentalmacros import scalaannotationStaticAnnotation compileTimeOnly object Macro def implc Contextannottees cExpr Any cExpr Any import cuniverse annotteesmaptree match case valDef ValDef this works in scala and ctypecheckvalDef withMacrosDisabled true this works in scala but not in val unmodValDef ValDefModifiers valDefname valDeftpt valDefrhs ctypecheckunmodValDef withMacrosDisabled true annotteeshead case cabortcenclosingPosition unsupported annotation compileTimeOnlyonly for compile time expansion class example extends StaticAnnotation def macroTransformannottees Any Any macro Macroimpl Using this annotation on a val scala using a trait instead of a class compiles in class Wrap example val x Int In this leads to an illegal cyclic reference error error scalaExampleSpecscala illegal cyclic reference involving class Wrap This is the failing code scala val unmodValDef ValDefModifiers valDefname valDeftpt valDefrhs this works in scala but not in ctypecheckunmodValDef withMacrosDisabled true An example project with repro because it depends on the scalarepl which isnt by default in the runner script error javalangNoClassDefFoundError scalatoolsnscinterpreterReplReporter at orgscalamacrosparadisereflectReplIntegrationtellReplAboutExpansionReplIntegrationscala at orgscalamacrosparadisereflectReplIntegrationtellReplAboutExpansionReplIntegrationscala at orgscalamacrosparadisePlugintellReplAboutExpansionPluginscala at orgscalamacrosparadisetypecheckerNamersNameranon maybeExpandNamersscala at orgscalamacrosparadisetypecheckerNamersNamerMaybeExpandeeCompletercompleteImplNamersscala at orgscalamacrosparadisetypecheckerNamersNamerMaybeExpandeeCompletercompleteNamersscala at orgscalamacrosparadisetypecheckerNamersNamerRichTypecompleteOnlyExpansionsNamersscala at orgscalamacrosparadisetypecheckerNamersNamerMaybeExpandeeCompleterloadNamersscala at scalareflectinternalSymbolsSymbolexistsSymbolsscala at scalatoolsnsctypecheckerTypersTyperreallyExistsTypersscala at scalatoolsnsctypecheckerTypersTyperqualifies Typersscala at scalatoolsnsctypecheckerTypersTyperanonfuntyped Typersscala at scalatoolsnsctypecheckerTypersTyperanonfuntyped adaptedTypersscala at scalatoolsnsctypecheckerContextsContextanonfunlookupSymbol Contextsscala at scalatoolsnsctypecheckerContextsContextanonfunlookupSymbol adaptedContextsscala at scalacollectionIteratoranon hasNextIteratorscala With Scala and Macro Paradise the following snippet scala package hmmm final class anyAnnot extends scalaannotationStaticAnnotation object Hmmm anyAnnot class X val X class Y val Y results in this compilation error error X is already defined as compilergenerated case class companion object X error val X error This issue originally raised as I am seeing a lot exception from the presentation compiler in the Scala IDE that look like the one below It happens across many classes and as you can see it often fails to complete standard library classes I cant tell if this is a problem in the paradise plugin or in the presentation compiler or simply the interaction between the two It sounds like the Scala IDE arent planning on supporting paradise so I thought Id file an issue here Hopefully this is a simple fix scalareflectinternalFatalError no progress in completing object IndexedSeq at scalareflectinternalReportingclassabortReportingscala at scalareflectinternalSymbolTableabortSymbolTablescala at scalareflectinternalSymbolsSymbolinfoSymbolsscala at scalareflectinternalSymbolsSymbolinitializeSymbolsscala at orgscalamacrosparadisetypecheckerNamersNamerclasspatchedCompanionSymbolOfNamersscala at orgscalamacrosparadisetypecheckerNamersanon patchedCompanionSymbolOfNamersscala at orgscalamacrosparadisetypecheckerNamersNamerclassfinishSymbolNamersscala at orgscalamacrosparadisetypecheckerNamersanon finishSymbolNamersscala at orgscalamacrosparadisetypecheckerNamersNamerclassdispatch Namersscala at orgscalamacrosparadisetypecheckerNamersNamerclassenterSymNamersscala at orgscalamacrosparadisetypecheckerNamersanon enterSymNamersscala at orgscalamacrosparadisetypecheckerAnalyzerPluginsMacroPluginpluginsEnterSymAnalyzerPluginsscala at scalatoolsnsctypecheckerAnalyzerPluginsanon customAnalyzerPluginsscala at scalatoolsnsctypecheckerAnalyzerPluginsanonfun applyAnalyzerPluginsscala at scalatoolsnsctypecheckerAnalyzerPluginsanonfun applyAnalyzerPluginsscala at scalacollectionimmutableListmapListscala at scalatoolsnsctypecheckerAnalyzerPluginsclassinvokeAnalyzerPluginsscala at scalatoolsnsctypecheckerAnalyzerPluginsclasspluginsEnterSymAnalyzerPluginsscala at orgscalaidecoreinternalcompilerScalaPresentationCompileranon pluginsEnterSymScalaPresentationCompilerscala at scalatoolsnsctypecheckerNamersNamerenterSymNamersscala at scalatoolsnsctypecheckerNamersNameranonfunenterSyms applyNamersscala at scalatoolsnsctypecheckerNamersNameranonfunenterSyms applyNamersscala at scalacollectionLinearSeqOptimizedclassfoldLeftLinearSeqOptimizedscala at scalacollectionimmutableListfoldLeftListscala at scalatoolsnsctypecheckerNamersNamerenterSymsNamersscala at scalatoolsnsctypecheckerNamersNamertemplateSigNamersscala at scalatoolsnsctypecheckerNamersNamermoduleSigNamersscala at scalatoolsnsctypecheckerNamersNamergetSig Namersscala at scalatoolsnsctypecheckerNamersNamertypeSigNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter anonfunapply applymcVspNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter anonfunapply applyNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter anonfunapply applyNamersscala at scalatoolsnsctypecheckerNamersNamerscalatoolsnsctypecheckerNamersNamerlogAndValidateNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter applyNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter applyNamersscala at scalatoolsnsctypecheckerNamersanon completeImplNamersscala at scalatoolsnsctypecheckerNamersLockingTypeCompleterclasscompleteNamersscala at scalatoolsnsctypecheckerNamersanon completeNamersscala at scalareflectinternalSymbolsSymbolinfoSymbolsscala at scalareflectinternalSymbolsSymboltpetimesSymbolsscala at scalareflectinternalSymbolsSymboltpeSymbolsscala at scalareflectinternalSymbolsSymbolhasVolatileTypeSymbolsscala at scalareflectinternaltpeFindMembersFindMembershortCircuitFindMembersscala at scalareflectinternaltpeFindMembersFindMemberBasewalkBaseClassesFindMembersscala at scalareflectinternaltpeFindMembersFindMemberBasesearchConcreteThenDeferredFindMembersscala at scalareflectinternaltpeFindMembersFindMemberBaseapplyFindMembersscala at scalareflectinternalTypesTypescalareflectinternalTypesTypefindMemberInternal Typesscala at scalareflectinternalTypesTypefindMemberTypesscala at scalareflectinternaltpeTypeMapsadaptToNewRunMapadaptToNewRunTypeMapsscala at scalareflectinternaltpeTypeMapsadaptToNewRunMapapplyTypeMapsscala at scalareflectinternaltpeTypeMapsadaptToNewRunMapapplyTypeMapsscala at scalareflectinternalSymbolsSymboladaptInfosSymbolsscala at scalareflectinternalSymbolsSymbolrawInfoSymbolsscala at scalatoolsnsctypecheckerTypersTyperisStaleTypersscala at scalatoolsnsctypecheckerTypersTyperreallyExistsTypersscala at scalatoolsnsctypecheckerTypersTyperscalatoolsnsctypecheckerTypersTyperqualifies Typersscala at scalatoolsnsctypecheckerTypersTyperanonfun applyTypersscala at scalatoolsnsctypecheckerTypersTyperanonfun applyTypersscala at scalareflectinternalSymbolsSymbolfilterSymbolsscala at scalatoolsnsctypecheckerContextsContextlookupImport Contextsscala at scalatoolsnsctypecheckerContextsContextlookupSymbolContextsscala at scalatoolsnsctypecheckerTypersTypertypedIdent Typersscala at scalatoolsnsctypecheckerTypersTypertypedIdentOrWildcard Typersscala at scalatoolsnsctypecheckerTypersTypertypedInAnyMode Typersscala at scalatoolsnsctypecheckerTypersTypertyped Typersscala at scalatoolsnsctypecheckerTypersTyperrunTyper Typersscala at scalatoolsnsctypecheckerTypersTyperscalatoolsnsctypecheckerTypersTypertypedInternalTypersscala at scalatoolsnsctypecheckerTypersTyperbody Typersscala at scalatoolsnsctypecheckerTypersTypertypedTypersscala at scalatoolsnsctypecheckerTypersTyperanonfun applyTypersscala at scalatoolsnsctypecheckerTypersTyperanonfun applyTypersscala at scalatoolsnsctypecheckerTypersTypersilentTypersscala at scalatoolsnsctypecheckerTypersTypernormalTypedApply Typersscala at scalatoolsnsctypecheckerTypersTypertypedApply Typersscala at scalatoolsnsctypecheckerTypersTypertypedInAnyMode Typersscala at scalatoolsnsctypecheckerTypersTypertyped Typersscala at scalatoolsnsctypecheckerTypersTyperrunTyper Typersscala at scalatoolsnsctypecheckerTypersTyperscalatoolsnsctypecheckerTypersTypertypedInternalTypersscala at scalatoolsnsctypecheckerTypersTyperbody Typersscala at scalatoolsnsctypecheckerTypersTypertypedTypersscala at scalatoolsnsctypecheckerTypersTypertypedTypersscala at scalatoolsnsctypecheckerTypersTypercomputeTypeTypersscala at scalatoolsnsctypecheckerNamersNamerassignTypeToTreeNamersscala at scalatoolsnsctypecheckerNamersNamervalDefSigNamersscala at scalatoolsnsctypecheckerNamersNamergetSig Namersscala at scalatoolsnsctypecheckerNamersNamertypeSigNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter anonfunapply applymcVspNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter anonfunapply applyNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter anonfunapply applyNamersscala at scalatoolsnsctypecheckerNamersNamerscalatoolsnsctypecheckerNamersNamerlogAndValidateNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter applyNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter applyNamersscala at scalatoolsnsctypecheckerNamersanon completeImplNamersscala at scalatoolsnsctypecheckerNamersLockingTypeCompleterclasscompleteNamersscala at scalatoolsnsctypecheckerNamersanon completeNamersscala at scalareflectinternalSymbolsSymbolinfoSymbolsscala at scalareflectinternalSymbolsSymbolinitializeSymbolsscala at scalatoolsnsctypecheckerTypersTypertyped Typersscala at scalatoolsnsctypecheckerTypersTyperrunTyper Typersscala at scalatoolsnsctypecheckerTypersTyperscalatoolsnsctypecheckerTypersTypertypedInternalTypersscala at scalatoolsnsctypecheckerTypersTyperbody Typersscala at scalatoolsnsctypecheckerTypersTypertypedTypersscala at scalatoolsnsctypecheckerTypersTypertypedByValueExprTypersscala at scalatoolsnsctypecheckerTypersTyperscalatoolsnsctypecheckerTypersTypertypedStat Typersscala at scalatoolsnsctypecheckerTypersTyperanonfun applyTypersscala at scalatoolsnsctypecheckerTypersTyperanonfun applyTypersscala at scalacollectionimmutableListloop Listscala at scalacollectionimmutableListmapConserveListscala at scalatoolsnsctypecheckerTypersTypertypedStatsTypersscala at scalatoolsnsctypecheckerTypersTypertypedBlockTypersscala at scalatoolsnsctypecheckerTypersTyperanonfuntypedOutsidePatternMode applyTypersscala at scalatoolsnsctypecheckerTypersTyperanonfuntypedOutsidePatternMode applyTypersscala at scalatoolsnsctypecheckerTypersTypertypedOutsidePatternMode Typersscala at scalatoolsnsctypecheckerTypersTypertypedInAnyMode Typersscala at scalatoolsnsctypecheckerTypersTypertyped Typersscala at scalatoolsnsctypecheckerTypersTyperrunTyper Typersscala at scalatoolsnsctypecheckerTypersTyperscalatoolsnsctypecheckerTypersTypertypedInternalTypersscala at scalatoolsnsctypecheckerTypersTyperbody Typersscala at scalatoolsnsctypecheckerTypersTypertypedTypersscala at scalatoolsnsctypecheckerTypersTypertypedTypersscala at scalatoolsnsctypecheckerTypersTypercomputeTypeTypersscala at scalatoolsnsctypecheckerNamersNamerassignTypeToTreeNamersscala at scalatoolsnsctypecheckerNamersNamermethodSigNamersscala at scalatoolsnsctypecheckerNamersNamergetSig Namersscala at scalatoolsnsctypecheckerNamersNamertypeSigNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter anonfunapply applymcVspNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter anonfunapply applyNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter anonfunapply applyNamersscala at scalatoolsnsctypecheckerNamersNamerscalatoolsnsctypecheckerNamersNamerlogAndValidateNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter applyNamersscala at scalatoolsnsctypecheckerNamersNameranonfunmonoTypeCompleter applyNamersscala at scalatoolsnsctypecheckerNamersanon completeImplNamersscala at scalatoolsnsctypecheckerNamersLockingTypeCompleterclasscompleteNamersscala at scalatoolsnsctypecheckerNamersanon completeNamersscala at scalareflectinternalSymbolsSymbolinfoSymbolsscala at scalareflectinternalSymbolsSymbolinitializeSymbolsscala at scalatoolsnsctypecheckerTypersTypertyped Typersscala at scalatoolsnsctypecheckerTypersTyperrunTyper Typersscala at scalatoolsnsctypecheckerTypersTyperscalatoolsnsctypecheckerTypersTypertypedInternalTypersscala at scalatoolsnsctypecheckerTypersTyperbody Typersscala at scalatoolsnsctypecheckerTypersTypertypedTypersscala at scalatoolsnsctypecheckerTypersTypertypedByValueExprTypersscala at scalatoolsnsctypecheckerTypersTyperscalatoolsnsctypecheckerTypersTypertypedStat Typersscala at scalatoolsnsctypecheckerTypersTyperanonfun applyTypersscala at scalatoolsnsctypecheckerTypersTyperanonfun applyTypersscala at scalacollectionimmutableListloop Listscala at scalacollectionimmutableListmapConserveListscala at scalatoolsnsctypecheckerTypersTypertypedStatsTypersscala at scalatoolsnsctypecheckerTypersTypertypedTemplateTypersscala at scalatoolsnsctypecheckerTypersTypertypedModuleDefTypersscala at scalatoolsnsctypecheckerTypersTypertypedMemberDef Typersscala at scalatoolsnsctypecheckerTypersTypertyped Typersscala at scalatoolsnsctypecheckerTypersTyperrunTyper Typersscala at scalatoolsnsctypecheckerTypersTyperscalatoolsnsctypecheckerTypersTypertypedInternalTypersscala at scalatoolsnsctypecheckerTypersTyperbody Typersscala at scalatoolsnsctypecheckerTypersTypertypedTypersscala at scalatoolsnsctypecheckerTypersTypertypedByValueExprTypersscala at scalatoolsnsctypecheckerTypersTyperscalatoolsnsctypecheckerTypersTypertypedStat Typersscala at scalatoolsnsctypecheckerTypersTyperanonfun applyTypersscala at scalatoolsnsctypecheckerTypersTyperanonfun applyTypersscala at scalacollectionimmutableListloop Listscala at scalacollectionimmutableListmapConserveListscala at scalatoolsnsctypecheckerTypersTypertypedStatsTypersscala at scalatoolsnsctypecheckerTypersTypertypedPackageDef Typersscala at scalatoolsnsctypecheckerTypersTypertypedMemberDef Typersscala at scalatoolsnsctypecheckerTypersTypertyped Typersscala at scalatoolsnsctypecheckerTypersTyperrunTyper Typersscala at scalatoolsnsctypecheckerTypersTyperscalatoolsnsctypecheckerTypersTypertypedInternalTypersscala at scalatoolsnsctypecheckerTypersTyperbody Typersscala at scalatoolsnsctypecheckerTypersTypertypedTypersscala at scalatoolsnsctypecheckerTypersTypertypedTypersscala at scalatoolsnsctypecheckerAnalyzertyperFactoryanon applyAnalyzerscala at scalatoolsnscGlobalGlobalPhaseanonfunapplyPhase applymcVspGlobalscala at scalatoolsnscGlobalGlobalPhasewithCurrentUnitGlobalscala at scalatoolsnscGlobalGlobalPhaseapplyPhaseGlobalscala at scalatoolsnscinteractiveGlobalTyperRunanonfunapplyPhase applyGlobalscala at scalatoolsnscinteractiveGlobalTyperRunanonfunapplyPhase applyGlobalscala at scalareflectinternalSymbolTableenteringPhaseSymbolTablescala at scalatoolsnscinteractiveGlobalTyperRunapplyPhaseGlobalscala at scalatoolsnscinteractiveGlobalTyperRuntypeCheckGlobalscala at scalatoolsnscinteractiveGlobaltypeCheckGlobalscala at scalatoolsnscinteractiveGlobaltypedTreeAtGlobalscala at scalatoolsnscinteractiveGlobalanonfungetTypedTreeAt applyGlobalscala at scalatoolsnscinteractiveGlobalanonfungetTypedTreeAt applyGlobalscala at scalatoolsnscinteractiveGlobalanonfunrespond applyGlobalscala at scalatoolsnscinteractiveGlobalanonfunrespond applyGlobalscala at scalatoolsnscinteractiveGlobalrespondGraduallyGlobalscala at scalatoolsnscinteractiveGlobalrespondGlobalscala at scalatoolsnscinteractiveGlobalgetTypedTreeAtGlobalscala at scalatoolsnscinteractiveCompilerControlAskTypeAtItemapplymcVspCompilerControlscala at scalatoolsnscinteractiveGlobalanonfunpollForWork applymcVspGlobalscala at scalautilcontrolBreaksbreakableBreaksscala at scalatoolsnscinteractiveGlobalpollForWorkGlobalscala at scalatoolsnscinteractiveGlobalcheckForMoreWorkGlobalscala at scalatoolsnscinteractiveGlobalsignalParseProgressGlobalscala at scalatoolsnscastparserParsersParserfunDefRestParsersscala at scalatoolsnscastparserParsersParserfunDefOrDclParsersscala at scalatoolsnscastparserParsersParserdefOrDclParsersscala at scalatoolsnscastparserParsersParsernonLocalDefOrDclParsersscala at scalatoolsnscastparserParsersParseranonfuntemplateStat anonfunapplyOrElse applyParsersscala at scalatoolsnscastparserParsersParseranonfuntemplateStat anonfunapplyOrElse applyParsersscala at scalatoolsnscdocScaladocSyntaxAnalyzerScaladocUnitParserjoinCommentScaladocAnalyzerscala at scalatoolsnscastparserParsersParseranonfuntemplateStat applyOrElseParsersscala at scalatoolsnscastparserParsersParseranonfuntemplateStat applyOrElseParsersscala at scalatoolsnscastparserParsersParserstatSeqParsersscala at scalatoolsnscastparserParsersParsertemplateStatsParsersscala at scalatoolsnscastparserParsersParseranonfuntemplateStatSeq applyParsersscala at scalatoolsnscastparserParsersParseranonfuntemplateStatSeq applyParsersscala at scalatoolsnscastparserParsersParsercheckNoEscapingPlaceholdersParsersscala at scalatoolsnscastparserParsersParsertemplateStatSeqParsersscala at scalatoolsnscastparserParsersParsertemplateBodyParsersscala at scalatoolsnscastparserParsersParsertemplateBodyOptParsersscala at scalatoolsnscastparserParsersParsertemplateOptParsersscala at scalatoolsnscastparserParsersParserobjectDefParsersscala at scalatoolsnscastparserParsersParsertmplDefParsersscala at scalatoolsnscastparserParsersParsertopLevelTmplDefParsersscala at scalatoolsnscastparserParsersParseranonfuntopStat anonfunapplyOrElse applyParsersscala at scalatoolsnscastparserParsersParseranonfuntopStat anonfunapplyOrElse applyParsersscala at scalatoolsnscdocScaladocSyntaxAnalyzerScaladocUnitParserjoinCommentScaladocAnalyzerscala at scalatoolsnscastparserParsersParseranonfuntopStat applyOrElseParsersscala at scalatoolsnscastparserParsersParseranonfuntopStat applyOrElseParsersscala at scalatoolsnscastparserParsersParserstatSeqParsersscala at scalatoolsnscastparserParsersParsertopStatSeqParsersscala at scalatoolsnscastparserParsersParseranonfuncompilationUnit topstats Parsersscala at scalatoolsnscastparserParsersParseranonfuncompilationUnit topstats Parsersscala at scalatoolsnscastparserParsersParseranonfuncompilationUnit applyParsersscala at scalatoolsnscastparserParsersParseranonfuncompilationUnit applyParsersscala at scalatoolsnscastparserParsersParsercheckNoEscapingPlaceholdersParsersscala at scalatoolsnscastparserParsersParsercompilationUnitParsersscala at scalatoolsnscastparserParsersSourceFileParseranonfunparseStartRule applyParsersscala at scalatoolsnscastparserParsersSourceFileParseranonfunparseStartRule applyParsersscala at scalatoolsnscastparserParsersParseranonfunparse applyParsersscala at scalatoolsnscastparserParsersParseranonfunparse applyParsersscala at scalatoolsnscastparserParsersParserparseRuleParsersscala at scalatoolsnscastparserParsersParserparseParsersscala at scalatoolsnscastparserParsersUnitParsersmartParseParsersscala at scalatoolsnscastparserSyntaxAnalyzerscalatoolsnscastparserSyntaxAnalyzerinitialUnitBodySyntaxAnalyzerscala at scalatoolsnscastparserSyntaxAnalyzerParserPhaseapplySyntaxAnalyzerscala at scalatoolsnscGlobalGlobalPhaseanonfunapplyPhase applymcVspGlobalscala at scalatoolsnscGlobalGlobalPhasewithCurrentUnitGlobalscala at scalatoolsnscGlobalGlobalPhaseapplyPhaseGlobalscala at scalatoolsnscGlobalRunanonfuncompileLate anonfunapply applyGlobalscala at scalatoolsnscGlobalRunanonfuncompileLate anonfunapply applyGlobalscala at scalareflectinternalSymbolTableenteringPhaseSymbolTablescala at scalatoolsnscGlobalRunanonfuncompileLate applyGlobalscala at scalatoolsnscGlobalRunanonfuncompileLate applyGlobalscala at scalacollectionIteratorclassforeachIteratorscala at scalacollectionAbstractIteratorforeachIteratorscala at scalatoolsnscGlobalRuncompileLateGlobalscala at scalatoolsnscinteractiveGlobalscalatoolsnscinteractiveGlobalparseAndEnterGlobalscala at scalatoolsnscinteractiveGlobalbackgroundCompileGlobalscala at scalatoolsnscinteractivePresentationCompilerThreadrunPresentationCompilerThreadscala Annotations cause equalsStructure to return false scala qenum object Test equalsStructureqenum object Test res Boolean false Whereas this works as expected scala qobject Test equalsStructureqobject Test res Boolean true Also while loops seem to have the same issue raised in a SO question here I have a macro annotation with parameters class AnnotationType extends StaticAnnotation Since cprefixtree in the macro implementation is the tree for the annotation constructor Ive tried cevalcExpr AnnotationType cprefixtree and cevalcprefixasInstanceOf cExpr AnnotationType The compiler complains that it cant expand AnnotationType even though it isnt used as an annotation and shouldnt be expanded If this worked it would simplify and The issue is described in more detail at This project demonstrates a Typersscala assertion error with a quasiquote generated inner class sbt compile compiles macro sbt testcompile attempts compilation of object annotated with macro The problem has been reproduced for Scala and M generating and bytecode For Scala the assertion fails on Typersscala and for Scala M it fails on Typersscala The essence of this bug is the instantiation of an anonymous inner class Eg in the context of trait Trait def something Int an attempt to generate new Trait override def something Int with quasiquotes or ClassDef will fail The corresponding handcrafted code compiles fine Our initial implementation of macro annotations includes YOLOsupport for ctypecheck we do our best effort to call the typechecker so that it doesnt crash occasionally losing precision because the typechecker resists our efforts When I released SNAPSHOT with this limitation my hope was that our experience with ctypecheck will let us understand it better and come up with a strategy that is consistent reasonable and implementable in scalac Unfortunately it looks that my hope was ungrounded because its been two years and nothing satisfying has come up Related issues are 