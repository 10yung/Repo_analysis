Lets assume we have a WebSocket consumer wrapped in a AuthMiddlewareStack SessionMiddleware application ProtocolTypeRouter websocket AllowedHostsOriginValidator AuthMiddlewareStack URLRouter As an anonymous user I connect to my consumer modify the session store and save it selfscope session test selfscope session save This will create default Django configuration a new row in the database table publicdjangosession Doing this in a traditional view Django will take care to send the sessionid cookie back to the user by setting the corresponding host header in the response object Channels with a WebSocket consumer behaves differently as the client will never get informed about his sessionid and therefore his corresponding store The session for an anonymous user is lost when the user reconnects One hacky workaround could look like this def connectself headers if settingsSESSIONCOOKIENAME not in selfscope cookies sessionstore selfscope session sessionstore test sessionstoresave headers SetCookie fsettingsSESSIONCOOKIENAMEsessionstoresessionkey selfscope cookies settingsSESSIONCOOKIENAME sessionstoresessionkey selfacceptsubprotocolNone headers Any thoughts on that Is there a better way to handle such a scenario Update Maybe the following code is a bit better headers sessionstore selfscope session if not sessionstoresessionkey sessionstorecreate headers SetCookie fsettingsSESSIONCOOKIENAMEsessionstoresessionkey selfacceptsubprotocolNone headers In Custom Authentication section of documentation there is database query in call method def callself scope user Userobjectsgetidintscope querystring Its OK with Django but in Django it cause djangocoreexceptionsSynchronousOnlyOperation error please update docs and explain how to use database query in Custom Authentications Thanks I have done pip install django pip install channels djangoadmin start project mysite cd mysite python managepy startapp chat Added the new chat app in installedapps Created chatindexhtml Then created chatviewspy Added channels in installedapps Added ASGIAPPLICATION mysiteroutingapplication in mysitesettingspy At this point when I execute python managepy runserver Im using this on Win machine Im getting the following error Exception in thread djangomainthread Traceback most recent call last File c users win appdata local programs python python Lib threadingpy line in bootstrapinner selfrun File c users win appdata local programs python python Lib threadingpy line in run selftargetselfargs selfkwargs File C Users win PycharmProjects profilics chatenv lib sitepackages django utils autoreloadpy line in wrapper fnargs kwargs File C Users win PycharmProjects profilics chatenv lib sitepackages django core management commands runserverpy line in innerrun autoreloadraiselastexception File C Users win PycharmProjects profilics chatenv lib sitepackages django utils autoreloadpy line in raiselastexception raise exception File C Users win PycharmProjects profilics chatenv lib sitepackages django core management initpy line in execute autoreloadcheckerrorsdjangosetup File C Users win PycharmProjects profilics chatenv lib sitepackages django utils autoreloadpy line in wrapper fnargs kwargs File C Users win PycharmProjects profilics chatenv lib sitepackages django initpy line in setup appspopulatesettingsINSTALLEDAPPS File C Users win PycharmProjects profilics chatenv lib sitepackages django apps registrypy line in populate appconfig AppConfigcreateentry File C Users win PycharmProjects profilics chatenv lib sitepackages django apps configpy line in create mod importmodulemodpath File C Users win PycharmProjects profilics chatenv lib importlib initpy line in importmodule return bootstrapgcdimportname level package level File frozen importlibbootstrap line in gcdimport File frozen importlibbootstrap line in findandload File frozen importlibbootstrap line in findandloadunlocked File frozen importlibbootstrap line in loadunlocked File frozen importlibbootstrapexternal line in execmodule File frozen importlibbootstrap line in callwithframesremoved File C Users win PycharmProjects profilics chatenv lib sitepackages channels appspy line in module import daphneserver File C Users win PycharmProjects profilics chatenv lib sitepackages daphne serverpy line in module asyncioreactorinstalltwistedloop File C Users win PycharmProjects profilics chatenv lib sitepackages twisted internet asyncioreactorpy line in install reactor AsyncioSelectorReactoreventloop File C Users win PycharmProjects profilics chatenv lib sitepackages twisted internet asyncioreactorpy line in init superinit File C Users win PycharmProjects profilics chatenv lib sitepackages twisted internet basepy line in init selfinstallWaker File C Users win PycharmProjects profilics chatenv lib sitepackages twisted internet posixbasepy line in installWaker selfaddReaderselfwaker File C Users win PycharmProjects profilics chatenv lib sitepackages twisted internet asyncioreactorpy line in addReader selfasyncioEventloopaddreaderfd callWithLogger reader File c users win appdata local programs python python Lib asyncio eventspy line in addreader raise NotImplementedError NotImplementedError Does anyone have idea why Im getting this error I have put my code to this repos master branch You may also check the code if you wish to Im using windows machine For the same change in Django see PR djangodjango and issue I tried to convert setuppy to setupcfg with the following exceptions Add longdescription Add classifier Programming Language Python Only PR moved minimum supported Django to so these old code paths can be removed I recently used Django channels for the first time and there was a gap in the documentation which made things a fair bit harder than it could have been I wanted to send a message to a single channel Eventually I found the a section in the docs on this page where it says To send to a single channel just find its channel name for the example above we could crawl the database and use channellayersend However the code sample included the type parameter I didnt realize for a long time that this type parameter has to match the name of a function of the consumer I think it would really help if there was an extra sentence in the docs which could explain this I think I spent about hours stumped by putting the wrong value into the type field or getting type field missing errors If you want me to make a PR with a few sentences explaining the type field Ill give it a go PS On the whole I had a very good experience using channels The tutorial was especially good Thanks for your work python channels channelsredis daphne Django Entrypoint is daphne on alpine linux Consumer is quite simple class ConsumerAsyncWebsocketConsumer async def connectself selfuser selfscope user selfname selfscope urlroute kwargs name this line is changed by different subclasses selfgroupname ss chat selfname await selfaccept Join group await selfchannellayergroupaddselfgroupname selfchannelname if not True auth check await selfsendtextdatanot authorized await selfclose Receive message from group async def mself event message event m Send message to WebSocket await selfsendtextdatajsondumpsmessage This is the error that comes up after a random amount of disconnects WARNING Application instance Task pending nameTask coroSessionMiddlewareInstancecall running at usrlocallibpython sitepackageschannelssessionspy waitforFuture pending cb chainfuturelocalscallcheckcancel at usrlocallibpython asynciofuturespy TaskWakeupMethWrapper object at x f ebec for connection WebSocketProtocol client pathbapiwschatddd ce d ab d a d e took too long to shut down and was killed ERROR Exception in callback AsyncioSelectorReactorcallLaterlocalsrun at usrlocallibpython sitepackagestwistedinternetasyncioreactorpy handle TimerHandle when AsyncioSelectorReactorcallLaterlocalsrun at usrlocallibpython sitepackagestwistedinternetasyncioreactorpy Traceback most recent call last File usrlocallibpython asyncioeventspy line in run selfcontextrunselfcallback selfargs File usrlocallibpython sitepackagestwistedinternetasyncioreactorpy line in run fargs kwargs File usrlocallibpython sitepackagesdaphneserverpy line in applicationchecker exception applicationinstanceexception asyncioexceptionsCancelledError Subsequent requests http and ws arent served anymore Timeout Any insight into this at all is greatly appreciated I am using channels with daphne which I can confirm fixed Unfortunately while it doesnt hang anymore it segfaults when the server connects to a PostgreSQL server with psycopg built on OSX not using the provided binaries It only happens specifically on OSX and when running a ChannelsLiveServerTestCase not on debian or when using runserver Im not able to provide logs as of now but if you need it I can provide them tomorrow with a minimal project to try and reproduce this issue Reproduction Repo Minimal reproducible example with steps Bug Most probably relate to Consider a multipart request as such Body d f ac d c ab a cc ContentDisposition formdata namecontent ContentType multipartformdata charsetutf Anything d f ac d c ab a cc Header ContentType multipartformdata boundaryd f ac d c ab a cc And any simple handlerview in Django For example one that just returns Hello World without even processing the request data For Python tested with Python and the channels server dev server runserver and daphne both handle multipart requests correctly The specified view is called and the request is handled and correct response with OK status code is returned For the same channels and Django version if the Python version is switched to tested with Python the server returns Bad Request and empty response body The request does not even reach any view or middleware regardless of the view processing the request or statically returning content like in the example repo above No exception is raised even with django log level set to DEBUG Although I have not tested if the channels logger is separate and logs anything else At least it does not log in default settings or throw any exception As seen in the example repo the entire environment is same except the python version And hence the behaviour of channels should be same across Python versions as well Environment pip freeze Identical for both versions Python asgiref attrs autobahn Automat certifi cffi channels chardet constantly cryptography daphne Django hyperlink idna incremental pyasn pyasn modules pycparser PyHamcrest pyOpenSSL pytz requests serviceidentity six sqlparse Twisted txaio urllib zopeinterface Python asgiref attrs autobahn Automat certifi cffi channels chardet constantly cryptography daphne Django hyperlink idna incremental pyasn pyasn modules pycparser PyHamcrest pyOpenSSL pytz requests serviceidentity six sqlparse Twisted txaio urllib zopeinterface OS Tested on LinuxUbuntu LinuxMint Hi I faced with some issue when run ASGIChannels development server When request with different method POST PATH Always get GET method in my code I try to print my method with this sample code csrfexempt def testrequest return JsonResponsemethod requestmethod