 SUMMARY Describe the change below including rationale and design decisions Added module ecstag and the integrations tests HINT Include Fixes nnn if you are fixing an existing issue ISSUE TYPE Pick one below and delete the rest New Module Pull Request COMPONENT NAME Write the short name of the module plugin task or feature below ecstag implements the boto rvs tagresrouce and untagresource ADDITIONAL INFORMATION Include additional information to help people understand the change here A stepbystep reproduction of the problem is helpful if there is no related issue Paste verbatim command output below eg before and after your change paste below Verify first that your issue is not already reported on GitHub Also test if the latest release and devel branch are affected too Complete all sections as described this form is processed automatically SUMMARY Explain the problem briefly below The winxml task fails when trying to insert an element into an existing element on v but not v ISSUE TYPE Bug Report COMPONENT NAME Write the short name of the module plugin task or feature below use your best guess if unsure ansiblemoduleswindowswinxmlps ANSIBLE VERSION Paste verbatim output from ansible version between quotes paste below ansible config file homescottgitvivioansibleansiblecfg configured module search path uhomescottgitvivioansiblelib ansible python module location usrlib python sitepackagesansible executable location usrlibpythonexecpython ansible python version default Dec GCC CONFIGURATION Paste verbatim output from ansibleconfig dump onlychanged between quotes paste below ANSIBLECOWSELECTIONenv ANSIBLECOWSELECTION random ANSIBLECOWWHITELISTgitvivioansibleansiblecfg ubudfrogs ubunny ucheese udaemon udefault udragon uelephantinsnake uelephant ueyes u nhellokitty ukitty ulukekoala umeow umilk ANSIBLENOCOWSenv ANSIBLENOCOWS True CACHEPLUGINgitvivioansibleansiblecfg jsonfile CACHEPLUGINCONNECTIONgitvivioansibleansiblecfg cache COLORVERBOSEgitvivioansibleansiblecfg bright blue DEFAULTACTIONPLUGINPATHgitvivioansibleansiblecfg ugitvivioansibleactionplugins DEFAULTCALLBACKPLUGINPATHgitvivioansibleansiblecfg ugitvivioansiblecallbackplugins DEFAULTCALLBACKWHITELISTgitvivioansibleansiblecfg utimer uchecklistbuilder DEFAULTCONNECTIONPLUGINPATHgitvivioansibleansiblecfg ugitvivioansibleconnectionplugins DEFAULTFILTERPLUGINPATHgitvivioansibleansiblecfg ugitvivioansiblefilterplugins DEFAULTFORKSgitvivioansibleansiblecfg DEFAULTGATHERINGgitvivioansibleansiblecfg implicit DEFAULTHASHBEHAVIOURgitvivioansibleansiblecfg merge DEFAULTHOSTLISTenv ANSIBLEINVENTORY ugitvivioansibleviviohostsyml DEFAULTINVENTORYPLUGINPATHgitvivioansibleansiblecfg ugitvivioansiblevivio DEFAULTLOCALTMPgitvivioansibleansiblecfg tmptansiblelocal J fZUy DEFAULTLOGPATHgitvivioansibleansiblecfg gitvivioansiblelogansiblelog DEFAULTLOOKUPPLUGINPATHgitvivioansibleansiblecfg ugitvivioansiblelookupplugins DEFAULTMANAGEDSTRgitvivioansibleansiblecfg Ansible managed file modified on Ymd HMS by uid on host DEFAULTMODULEPATHgitvivioansibleansiblecfg ugitvivioansiblelib DEFAULTPOLLINTERVALgitvivioansibleansiblecfg DEFAULTSCPIFSSHgitvivioansibleansiblecfg True DEFAULTTIMEOUTgitvivioansibleansiblecfg DEFAULTTRANSPORTgitvivioansibleansiblecfg smart DEFAULTVARSPLUGINPATHgitvivioansibleansiblecfg ugitvivioansiblevarsplugins DEFAULTVAULTPASSWORDFILEenv ANSIBLEVAULTPASSWORDFILE ansiblevk INVENTORYENABLEDgitvivioansibleansiblecfg uscript uhostlist uyaml uconstructed uportalinventory INVENTORYIGNOREEXTSgitvivioansibleansiblecfg upyc upyo uswp ubak u urpm umd utxt u uorig uini ucfg uretry INVENTORYUNPARSEDISFAILEDgitvivioansibleansiblecfg True PARAMIKOHOSTKEYAUTOADDgitvivioansibleansiblecfg True OS ENVIRONMENT Provide all relevant information below eg target OS versions network device firmware etc uname a Linux scottvivio viviotechnet gentoo SMP Fri Dec PST x IntelR XeonR CPU E v GHz GenuineIntel GNULinux lsbrelease a LSB Version na Distributor ID Gentoo Description Gentoo Base System release Release Codename na STEPS TO REPRODUCE Describe exactly how to reproduce the problem using a minimal testcase Paste example playbooks or commands between quotes below yaml name Update lucee to connect to the local mail system winxml path C Lucee tomcat luceeserver context luceeserverxml xpath mail fragment server idle life password port reuseconnectiontrue smtp sslfalse tlsfalse username state present type element with this error HINT You can paste gistgithubcom links for larger files EXPECTED RESULTS Describe what you expected to happen when running the steps above This content in the file xml mail spoolenableyes spoolinterval timeout server idle life password port reuseconnectiontrue smtp sslfalse tlsfalse username mail ACTUAL RESULTS Describe what actually happened If possible run with extra verbosity vvvv Paste verbatim command output between quotes paste below The full traceback is Method invocation failed because SystemXmlXmlChildNodes does not contain a method named getOuterXml At line char nstatus node nodegetValue element CategoryInfo InvalidOperation ParentContainsErrorRecordException FullyQualifiedErrorId MethodNotFound ScriptStackTrace at ScriptBlock No file line fatal hallowedsepiadeguviviotechus FAILED changed false msg Unhandled exception while executing module Method invocation failed because SystemXmlXmlChildNodes does not contain a method named getOuterXml SUMMARY Fixes a bug introduced in Also adds basic tests which would have prevented this No changelog since that PR was Ansible only ISSUE TYPE Bugfix Pull Request COMPONENT NAME dockercontainer SUMMARY Fixes This is similar to and what was discussed in the comments except that it covers another case anonymous volumes with permissions which wasnt covered in the original discussion This seems to work fine and doesnt seem to restart existing containers except if the user specified volumes strict or implicitly via wildcard in comparisons Therefore I think this PR should not be backported to stable ISSUE TYPE Bugfix Pull Request COMPONENT NAME dockercontainer SUMMARY Fixes The issue is for dockercontainer but I think dockerswarmservice will have exactly the same problem ISSUE TYPE Bugfix Pull Request COMPONENT NAME dockercontainer dockerswarmservice SUMMARY If I use the alternatives module for the first time and the default autoselected alternative is already correct then Ansible changes nothing Ie the link stays in the auto mode pointing to the correct alternative But this is fragile the link can still change on installation of new packages Instead of the current outcome the link should be switched to the manual mode ISSUE TYPE Bug Report COMPONENT NAME alternatives ANSIBLE VERSION paste below ansible dev config file etcansibleansiblecfg configured module search path etcansiblelibrary ansible python module location usrlocallibpython distpackagesansible executable location usrlocalbinansible python version default Apr GCC CONFIGURATION paste below DEFAULTFORKSetcansibleansiblecfg DEFAULTMANAGEDSTRetcansibleansiblecfg This file is managed by Ansible Date Ymd HMS file by uid on host DEFAULTMODULEPATHetcansibleansiblecfg etcansiblelibrary HOSTKEYCHECKINGetcansibleansiblecfg False RETRYFILESENABLEDetcansibleansiblecfg False OS ENVIRONMENT A mix of Debian and Fedora hosts STEPS TO REPRODUCE See the example playbook fragment below Run this against one Debian host which defaults to iptablesnft and one Fedora host which already defaults to iptableslegacy yaml name Switch to the legacy variant of iptables because of a bug in the nft version alternatives name iptables path usrsbiniptableslegacy link etcalternativesiptables notify Reboot to avoid messedup firewall EXPECTED RESULTS On both hosts the alternative must be in the manual mode like this updatealternatives display iptables iptables manual mode link best version is usrsbiniptablesnft link currently points to usrsbiniptableslegacy link iptables is usrsbiniptables slave iptablesrestore is usrsbiniptablesrestore slave iptablessave is usrsbiniptablessave usrsbiniptableslegacy priority slave iptablesrestore usrsbiniptableslegacyrestore slave iptablessave usrsbiniptableslegacysave usrsbiniptablesnft priority slave iptablesrestore usrsbiniptablesnftrestore slave iptablessave usrsbiniptablesnftsave In fact this is what happens on Debian ACTUAL RESULTS On Debian the actual results are exactly as expected But on Fedora they are not exactly as wanted paste below updatealternatives display iptables iptables status is auto link currently points to usrsbiniptableslegacy usrsbiniptableslegacy priority slave ip tables usrsbinip tableslegacy slave ip tablesrestore usrsbinip tableslegacyrestore slave ip tablessave usrsbinip tableslegacysave slave iptablesrestore usrsbiniptableslegacyrestore slave iptablessave usrsbiniptableslegacysave Current best version is usrsbiniptableslegacy That is nothing changed ADDITIONAL INFORMATION There is also an interesting question when the module should report the changed flag Technically changing an alternative from the auto mode to the manual mode is a change even if the selected alternative stays the same But I dont want to reboot a host just because of that and I should be able to express this SUMMARY Describe the change below including rationale and design decisions Add Pacman package manager to packagefacts HINT Include Fixes nnn if you are fixing an existing issue ISSUE TYPE Pick one below and delete the rest Feature Pull Request COMPONENT NAME Write the short name of the module plugin task or feature below libansiblemodulespackagingospackagefactspy ADDITIONAL INFORMATION Include additional information to help people understand the change here A stepbystep reproduction of the problem is helpful if there is no related issue Paste verbatim command output below eg before and after your change Example yml name Gather pacman package facts packagefacts manager pacman name Print the pacman package facts debug var ansiblefactspackages Result json zeromq arch x name zeromq provides null source pacman version zip arch x name zip provides null source pacman version SUMMARY Describe the change below including rationale and design decisions Backport of for Ansible cherry picked from commit f b e HINT Include Fixes nnn if you are fixing an existing issue ISSUE TYPE Pick one below and delete the rest Bugfix Pull Request COMPONENT NAME Write the short name of the module plugin task or feature below testintegrationtargetssetupdocker SUMMARY Ansible crashes when gatherfacts is true for a playbook targeting virtual Nexus switches I believe this is because it s looking for information about fans but it s virtual so there are no fans ISSUE TYPE Bug Report COMPONENT NAME nxosfacts ANSIBLE VERSION Paste verbatim output from ansible version between quotes paste below ansible config file Userskbreitdevelopmentgitlabdevnetworkconfigurationansiblecfg configured module search path Userskbreitansiblepluginsmodules usrshareansiblepluginsmodules ansible python module location usrlocallibpython sitepackagesansible executable location usrlocalbinansible python version default Nov Clang clang OS ENVIRONMENT Control node is macOS Target is NXOS STEPS TO REPRODUCE Paste example playbooks or commands between quotes below yaml name Configure Access Devices connection networkcli gatherfacts true hosts all tasks debug var hostvars EXPECTED RESULTS I expect the playbook to execute even if it s a single task It should collect facts ACTUAL RESULTS Describe what actually happened If possible run with extra verbosity vvvv Paste verbatim command output between quotes paste below e csco nxos datalinklabslocal EXEC binsh c rm f r Userskbreitansibletmpansiblelocal vavbd gvansibletmp devnull sleep fatal e csco nxos datalinklabslocal FAILED ansiblefacts changed false failedmodules nxosfacts ansiblefacts discoveredinterpreterpython usrbinpython exception Traceback most recent call last n File Userskbreitansibletmpansiblelocal vavbd gvansibletmp AnsiballZnxosfactspy line in module n ansiballzmain n File Userskbreitansibletmpansiblelocal vavbd gvansibletmp AnsiballZnxosfactspy line in ansiballzmain n invokemodulezippedmod temppath ANSIBALLZPARAMS n File Userskbreitansibletmpansiblelocal vavbd gvansibletmp AnsiballZnxosfactspy line in invokemodule n runpyrunmodulemodnameansiblemodulesnetworknxosnxosfacts initglobalsNone runnamemain altersysTrue n File SystemLibraryFrameworksPythonframeworkVersions libpython runpypy line in runmodule n fname loader pkgname n File SystemLibraryFrameworksPythonframeworkVersions libpython runpypy line in runmodulecode n modname modfname modloader pkgname n File SystemLibraryFrameworksPythonframeworkVersions libpython runpypy line in runcode n exec code in runglobals n File varfoldersmvcqcg q t b bn y ksb gqTansiblenxosfactspayloadYMZD mansiblenxosfactspayloadzipansiblemodulesnetworknxosnxosfactspy line in module n File varfoldersmvcqcg q t b bn y ksb gqTansiblenxosfactspayloadYMZD mansiblenxosfactspayloadzipansiblemodulesnetworknxosnxosfactspy line in main n File varfoldersmvcqcg q t b bn y ksb gqTansiblenxosfactspayloadYMZD mansiblenxosfactspayloadzipansiblemoduleutilsnetworknxosfactsfactspy line in getfacts n File varfoldersmvcqcg q t b bn y ksb gqTansiblenxosfactspayloadYMZD mansiblenxosfactspayloadzipansiblemoduleutilsnetworkcommonfactsfactspy line in getnetworklegacyfacts n File varfoldersmvcqcg q t b bn y ksb gqTansiblenxosfactspayloadYMZD mansiblenxosfactspayloadzipansiblemoduleutilsnetworknxosfactslegacybasepy line in populate n File varfoldersmvcqcg q t b bn y ksb gqTansiblenxosfactspayloadYMZD mansiblenxosfactspayloadzipansiblemoduleutilsnetworknxosfactslegacybasepy line in parsestructuredfaninfo nKeyError TABLEfaninfo n failed true modulestderr Traceback most recent call last n File Userskbreitansibletmpansiblelocal vavbd gvansibletmp AnsiballZnxosfactspy line in module n ansiballzmain n File Userskbreitansibletmpansiblelocal vavbd gvansibletmp AnsiballZnxosfactspy line in ansiballzmain n invokemodulezippedmod temppath ANSIBALLZPARAMS n File Userskbreitansibletmpansiblelocal vavbd gvansibletmp AnsiballZnxosfactspy line in invokemodule n runpyrunmodulemodnameansiblemodulesnetworknxosnxosfacts initglobalsNone runnamemain altersysTrue n File SystemLibraryFrameworksPythonframeworkVersions libpython runpypy line in runmodule n fname loader pkgname n File SystemLibraryFrameworksPythonframeworkVersions libpython runpypy line in runmodulecode n modname modfname modloader pkgname n File SystemLibraryFrameworksPythonframeworkVersions libpython runpypy line in runcode n exec code in runglobals n File varfoldersmvcqcg q t b bn y ksb gqTansiblenxosfactspayloadYMZD mansiblenxosfactspayloadzipansiblemodulesnetworknxosnxosfactspy line in module n File varfoldersmvcqcg q t b bn y ksb gqTansiblenxosfactspayloadYMZD mansiblenxosfactspayloadzipansiblemodulesnetworknxosnxosfactspy line in main n File varfoldersmvcqcg q t b bn y ksb gqTansiblenxosfactspayloadYMZD mansiblenxosfactspayloadzipansiblemoduleutilsnetworknxosfactsfactspy line in getfacts n File varfoldersmvcqcg q t b bn y ksb gqTansiblenxosfactspayloadYMZD mansiblenxosfactspayloadzipansiblemoduleutilsnetworkcommonfactsfactspy line in getnetworklegacyfacts n File varfoldersmvcqcg q t b bn y ksb gqTansiblenxosfactspayloadYMZD mansiblenxosfactspayloadzipansiblemoduleutilsnetworknxosfactslegacybasepy line in populate n File varfoldersmvcqcg q t b bn y ksb gqTansiblenxosfactspayloadYMZD mansiblenxosfactspayloadzipansiblemoduleutilsnetworknxosfactslegacybasepy line in parsestructuredfaninfo nKeyError TABLEfaninfo n modulestdout msg MODULE FAILURE nSee stdoutstderr for the exact error rc warnings Platform darwin on host e csco nxos datalinklabslocal is using the discovered Python interpreter at usrbinpython but future installation of another Python interpreter could change this See for more information msg The following modules failed to execute nxosfacts n SUMMARY Encoding parameter to jsonloads is ignored and deprecated to be removed in Python jsonloadsjsondumps encodingutf stdin DeprecationWarning encoding is ignored and deprecated It will be removed in Python ISSUE TYPE Bug Report COMPONENT NAME ipa ANSIBLE VERSION devel branch STEPS TO REPRODUCE 