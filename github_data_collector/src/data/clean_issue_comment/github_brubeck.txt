This fixes build errors unknown size of ctx on distributions that use OpenSSL which includes Ubuntu Bionic see problem manifestation description in nature of the fix ensure that code does not iterate thru elements that either have not been initialized or have residual values from previous recvmmsg call I propose adding support for environment variable config substitutions using a basklike syntax to obviate the need for any external config template solutions when using brubeck in a container deployment where environment variables are the norm This feature is toggled via BRUBECKCONFIGSUBSTITUTEENV so users may optin to this behavior since any config using this syntax is not technically valid json and could theoretically be a breaking change though unlikely in practice A simple local test case does the right thing and is valgrindclean GRAPHITESERVERfoo GRAPHITEPORT BRUBECKCONFIGSUBSTITUTEENV valgrind brubeck conf brubeckjson Memcheck a memory error detector Copyright C and GNU GPLd by Julian Seward et al Using Valgrind and LibVEX rerun with h for copyright info Command brubeck conf brubeckjson instancenull replaced config GRAPHITESERVER with foo from environment instancenull replaced config GRAPHITEPORT with from environment FATAL failed to resolve address foo HEAP SUMMARY in use at exit bytes in blocks total heap usage allocs frees bytes allocated LEAK SUMMARY definitely lost bytes in blocks indirectly lost bytes in blocks possibly lost bytes in blocks still reachable bytes in blocks suppressed bytes in blocks Rerun with leakcheckfull to see details of leaked memory For counts of detected and suppressed errors rerun with v ERROR SUMMARY errors from contexts suppressed from and cat brubeckjson sharding false servername brubeck dumpfile varlogbrubeckbrubeckdump capacity expire http backends type carbon address GRAPHITESERVER port GRAPHITEPORT frequency samplers type statsd address port workers multisock true multimsg By default the http endpoint is started on the IPv wildcard address It may be desirable to restrict this to a specific address see issue Clearly state that sampling is supported Allows for creating a debian package Trying to create a debian package for this and default it runs make test Which has failed tests perhaps because of this from compile step gcc g Wall O Wnostrictaliasing Isrc Ivendorckinclude DNDEBUG DGITSHA DBRUBECKHAVEMICROHTTPD c srchttpc o srchttpo srchttpc In function expiremetric srchttpc warning MHDcreateresponsefromdata is deprecated Wdeprecateddeclarations return MHDcreateresponsefromdata In file included from srchttpc usrincludemicrohttpdh note declared here MHDcreateresponsefromdata sizet size srchttpc In function sendmetric srchttpc warning MHDcreateresponsefromdata is deprecated Wdeprecateddeclarations return MHDcreateresponsefromdata In file included from srchttpc usrincludemicrohttpdh note declared here MHDcreateresponsefromdata sizet size srchttpc In function sendstats srchttpc warning MHDcreateresponsefromdata is deprecated Wdeprecateddeclarations return MHDcreateresponsefromdata In file included from srchttpc usrincludemicrohttpdh note declared here MHDcreateresponsefromdata sizet size srchttpc In function sendping srchttpc warning MHDcreateresponsefromdata is deprecated Wdeprecateddeclarations return MHDcreateresponsefromdata In file included from srchttpc usrincludemicrohttpdh note declared here MHDcreateresponsefromdata sizet size srchttpc In function handlerequest srchttpc warning MHDcreateresponsefromdata is deprecated Wdeprecateddeclarations response MHDcreateresponsefromdata In file included from srchttpc usrincludemicrohttpdh note declared here MHDcreateresponsefromdata sizet size gcc g Wall O Wnostrictaliasing Isrc Ivendo Test output Entering suite histogram timedata series aggregation testhistogramsingleelement histogram size pass testhistogramsingleelement histogram value count pass testhistogramsingleelement samplemin pass testhistogramsingleelement samplemax pass testhistogramsingleelement samplepercentile pass testhistogramsingleelement samplemean pass testhistogramsingleelement samplecount pass testhistogramsingleelement samplesum pass testhistogramlargerange samplemin pass testhistogramlargerange samplemax pass testhistogramlargerange samplemedian pass testhistogrammultisamples histogram size pass testhistogrammultisamples histogram value count pass testhistogrammultisamples samplemin pass testhistogrammultisamples samplemax pass testhistogrammultisamples samplepercentile FAIL Type failunless Condition samplepercentile Line testhistogrammultisamples samplemean pass testhistogrammultisamples samplecount pass testhistogrammultisamples samplesum pass testhistogrammultisamples histogram size pass testhistogrammultisamples histogram value count pass testhistogrammultisamples samplemin pass testhistogrammultisamples samplemax pass testhistogrammultisamples samplepercentile FAIL Type failunless Condition samplepercentile Line testhistogrammultisamples samplemean pass testhistogrammultisamples samplecount pass testhistogrammultisamples samplesum pass testhistogrammultisamples histogram size pass testhistogrammultisamples histogram value count pass testhistogrammultisamples samplemin pass testhistogrammultisamples samplemax pass testhistogrammultisamples samplepercentile FAIL Type failunless Condition samplepercentile Line testhistogrammultisamples samplemean pass testhistogrammultisamples samplecount pass testhistogrammultisamples samplesum pass testhistogrammultisamples histogram size pass testhistogrammultisamples histogram value count pass testhistogrammultisamples samplemin pass testhistogrammultisamples samplemax pass testhistogrammultisamples samplepercentile FAIL Type failunless Condition samplepercentile Line testhistogrammultisamples samplemean pass testhistogrammultisamples samplecount pass testhistogrammultisamples samplesum pass testhistogrammultisamples histogram size pass testhistogrammultisamples histogram value count pass testhistogrammultisamples samplemin pass testhistogrammultisamples samplemax pass testhistogrammultisamples samplepercentile FAIL Type failunless Condition samplepercentile Line testhistogrammultisamples samplemean pass testhistogrammultisamples samplecount pass testhistogrammultisamples samplesum pass testhistogrammultisamples histogram size pass testhistogrammultisamples histogram value count pass testhistogrammultisamples samplemin pass testhistogrammultisamples samplemax pass testhistogrammultisamples samplepercentile FAIL Type failunless Condition samplepercentile Line testhistogrammultisamples samplemean pass testhistogrammultisamples samplecount pass testhistogrammultisamples samplesum pass testhistogrammultisamples histogram size pass testhistogrammultisamples histogram value count pass testhistogrammultisamples samplemin pass testhistogrammultisamples samplemax pass testhistogrammultisamples samplepercentile FAIL Type failunless Condition samplepercentile Line testhistogrammultisamples samplemean pass testhistogrammultisamples samplecount pass testhistogrammultisamples samplesum pass testhistogrammultisamples histogram size pass testhistogrammultisamples histogram value count pass testhistogrammultisamples samplemin pass testhistogrammultisamples samplemax pass testhistogrammultisamples samplepercentile FAIL Type failunless Condition samplepercentile Line testhistogrammultisamples samplemean pass testhistogrammultisamples samplecount pass testhistogrammultisamples samplesum pass testhistogramwithsamplerate histogram size pass testhistogramwithsamplerate histogram value count pass testhistogramwithsamplerate samplemin pass testhistogramwithsamplerate samplemax pass testhistogramwithsamplerate samplepercentile FAIL Type failunless Condition samplepercentile Line testhistogramwithsamplerate samplemean pass testhistogramwithsamplerate samplecount pass testhistogramwithsamplerate samplesum pass testhistogramcapacity histogram size pass testhistogramcapacity histogram value count pass testhistogramcapacity samplemin pass testhistogramcapacity samplemax pass testhistogramcapacity samplecount pass testhistogramcapacity histogram size pass testhistogramcapacity histogram value count pass testhistogramcapacity samplemin pass testhistogramcapacity samplemax pass testhistogramcapacity samplecount pass checks ok failed Entering suite mstore concurrency test for metrics hash table testmstoresave stored metrics in table pass testmstoresave lookup all metrics from table pass checks ok failed Entering suite atomic atomic primitives testatomicspinlocks spinlock doesnt race pass checks ok failed Entering suite ftoa doubletostring conversion testftoa pass testftoa pass testftoa pass testftoa pass testftoa pass testftoa pass testftoa pass testftoa pass checks ok failed Entering suite statsd packet parsing teststatsdmsgparsestrings githubauthfingerprintsha c pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings githubauthfingerprintsha c pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings githubauthfingerprintsha g pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings lol ms pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisissparta C pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisissparta h pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisissparta g pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisissparta g pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisaresomefloatsg pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings gaugeincrement g pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings gaugedecrement g pass teststatsdmsgparsestrings msgvalue expected pass teststatsdmsgparsestrings msgsamplerate expected pass teststatsdmsgparsestrings msgmodifiers expected pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings thisaresomefloats a pass teststatsdmsgparsestrings thisaresomefloats msdos pass teststatsdmsgparsestrings thisaresomefloats gg pass teststatsdmsgparsestrings thisaresomefloats pass teststatsdmsgparsestrings thisaresomefloats pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings thisaresomefloatsg pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings thisaresomefloats g pass teststatsdmsgparsestrings thisaresomefloats g pass checks ok failed checks in suites finished after seconds succeeded failed FAILURE Makefile recipe for target test failed make test Error configjson http Expected brubeck should bind only to the loopback interface Actual brubeck binds its http listener on all interfaces see below localhost ss tulpn grep brubeck udp UNCONN usersbrubeckpid fd tcp LISTEN usersbrubeckpid fd Possible fix is to parse out the address from the http bind string and pass along as MHDOPTIONSOCKADDR in brubeckhttpendpointinit See Hi Seems like brubeck got overflow when handling gaugevalue more than I did not find in statsd specification max values for gauge and in my production envs we often sent values more than How to reproduce Send metric to brubeck and watch network packets I use ngrep echo complexdeletememem g nc u q U complexdeletememem g Watch network traffic from brubeck to storage T AP complexdeletememem brubeck send instead of My investigation lead me to this function May you provide fix for that case Thanks in advance for i i SIMPACKETS i 