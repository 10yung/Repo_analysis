This PR contains the following updates Package Type Update Change mocha source devDependencies major Release Notes details summarymochajsmochasummary v Compare Source boom Breaking Changes Drop Nodejs v x support mojosoeun Remove Nodejs debugrelated flags debugdebugbrk and deprecate debug argument juergba Changes to commandline options ParkSB listinterfaces replaces interfaces listreporters replaces reporters Hook pattern of thisskip juergba When conditionally skipping in a it test related afterEach hooks are now executed When conditionally skipping in a beforeEach hook subsequent inner beforeEach hooks are now skipped and related afterEach hooks are executed Disallow thisskip within after hooks Remove deprecated getOptions and libclioptionsjs juergba Uncaught exception in pending test dont swallow but retrospectively fail the test for correct exit code juergba Align Mocha constructors option names with commandline options juergba tada Enhancements Refactor and improve watch mode with chokidar geigerzaehler adds commandline options watchfiles and watchignore removes watchextensions Type rs n to restart tests broofa fax Deprecations These are softdeprecated and will emit a warning upon use Support will be removed in likely the next major version of Mocha Deprecate legacy configuration via mochaopts juergba bug Fixes Fix timeout handling with inspectbrkinspect juergba Mocha constructor improve browser setup juergba XUnit reporter should handle exceptions during diff generation rgroothuijsen Fix allowuncaught with thisskip juergba mag Coverage Add Nodejs v x to CI test matrix juergba book Documentation Fix broken links SaeromB Add reporter alias names to docs khg Clarify invalid usage of done jgehrcke Replace coffee with emoji pzrq Initial draft of project charter boneskull Change sh to bash for code block in docsindexmd HyunSangHan Update READMEmd concerning GraphicsMagick installation HyunSangHan Fix sponsors background color for readability outsideris nutandbolt Other Update nodeenvironmentflags to kylef Add GH Funding Metadata SheetJSDev Add funding information to packagejson Munter Improve integration tests soobing v Compare Source bug Fixes Fix duplicate EVENTRUNEND events upon uncaught exception juergba Fix unhide function in html reporter browser pec Fix use of esm in Nodejs v x boneskull Fix output when multiple async exceptions are thrown juergba book Documentation Site accessibility fixes Miajeong Update docs for custom reporters in browser LindsayNeedsSleep Adopt new OpenJS Foundation Code of Conduct craigtaub v Compare Source bug Fixes ttygetWindowSize is not a function inside a workerthreads worker remove extraGlobals juergba Update yargsunparser to v juergba Package esm spawn childprocess for correct loading juergba Update yargs to v and yargsparser to v juergba book Documentation fix styles on mochajsorg outsideris Remove jsdoc indexhtml placeholder from eleventy file structure and fix broken link in jsdoc tutorial Munter Add Matomo to website MarioDiaz Clarify effect of skip oliversalzburg v Compare Source tada Enhancements Do not fork childprocess if no Node flags are present boneskull Base reporter store ref to consolelog see mochawiki craigtaub bug Fixes Fix No test files found Error when file is passed via file gabegorelick Modify Mocha constructor to accept options global or globals pascalpp Fix parsing of config files with mocha binary juergba Fix CLI parsing with default values boneskull juergba Fix timeoutslow string values and duplicate arguments boneskull juergba book Documentation Document option to define custom report name for XUnit reporter pkuczynski Adds doc links for mochaexamples craigtaub Fix broken links toyjhlee Fix anchors to configuration section trescube mag Coverage Increase tests coverage for watch options geigerzaehler nutandbolt Other Collect test files later prepares improvements to the watch mode behavior geigerzaehler Upgrade for npm audit boneskull Extract runWatch into separate module geigerzaehler Add mochaminjs file to stacktrace filter brianlagerman Update CI config files to use Node x plroebuck Rework reporter tests plroebuck Rename exclude to ignore and create alias boneskull Hide stacktrace when cli args are missing outsideris Do not redeclare variable in docs array example DanielRuf Remove duplicate lineheight property in mochacss DanielRuf Dont reinitialize grep option on watch rerun geigerzaehler v Compare Source lock Security Fixes Upgrade jsyaml addressing code injection vulnerability bjornstar v Compare Source bug Fixes Fix yargsrelated global scope pollution inukshuk Fix failure when installed w pnpm boneskull v Compare Source bug Fixes Republish v from POSIX OS to avoid dropped executable flags boneskull v Compare Source bug Fixes Fix Windows EndofLine publishing issue juergba cspotcode v Compare Source lock Security Fixes Update dependency jsyaml to v per npm security advisory plroebuck tada Enhancements Make reporter constructor support optional options parameter plroebuck Add support for config files with jsonc extension sstephant fax Deprecations These are softdeprecated and will emit a warning upon use Support will be removed in likely the next major version of Mocha Deprecate thisskip for after all hooks juergba bug Fixes Use cwdrelative pathname to load config file plroebuck Fix async calls of thisskip in before each hooks juergba Enable allowuncaught for uncaught exceptions thrown inside hooks givanse and some regressions Fix Suite cloning by copying root property fatso Guard against undefined timeout option boneskull Update yargs in order to avoid deprecation message boneskull Fix support for multiple node flags aginzberg book Documentation mochajsmochaexamples New repository of working examples of common configurations using mocha craigtaub Remove pound icon showing on header hover on docs jd rogers Add autoprefixer to documentation page CSS Munter Update doc examples testshtml DavidLi Mocha website HTML tweaks plroebuck Update config file example mocharcyml cspotcode nutandbolt Other Replace dependency findupsync with findup for faster startup cspotcode Update devDependencies to fix many npm vulnerabilities XhmikosR v Compare Source bug Fixes Two more regressions fixed Test file paths no longer dropped from mochaopts boneskull require does not break on module names that look like certain node flags boneskull v Compare Source The obligatory round of postmajorrelease bugfixes bug Fixes These issues were regressions Mocha again finds testjs when run without arguments plroebuck Mocha again supports thirdparty interfaces via ui boneskull Fix broken watch boneskull Fix unwelcome deprecation notice when Mocha run against languages CoffeeScript with implicit return statements returning a nonundefined value from a describe callback is no longer considered deprecated boneskull book Documentation Upgrade to mochadocdash tendonstrength Use preferred names for example config files Szauka v Compare Source tada Enhancements Add ability to unload files from require cache plroebuck bug Fixes Fix falsy values from options globals plroebuck Fix encapsulation issues for SuiteonlyTests and SuiteonlySuites vkarpov Fix diagnostic messages dealing with plurality and markup of output plroebuck Fix reporteroption to allow commaseparated options boneskull Fix code quality and performance of lookupFiles and files plroebuck Fix noisy error message when no files found craigtaub Tests having an empty title are no longer confused with the root suite juergba Fix missing error codes vkarpov Fix exiting problem in Nodejs v addaleax Fix delay and other boolean options not working in all cases boneskull Fix invalid commandline argument usage not causing actual errors boneskull Fix debugrelated Nodejs options not working in all cases boneskull Growl notifications now show the correct number of tests run outsideris Avoid potential ReDoS when diffing large objects cyjake Fix incorrect order of emitted events when used programmatically boneskull Fix regression wherein reporteroptionreporteroptions did not support commaseparated keyvalue pairs boneskull book Documentation Switch from Jekyll to Eleventy Munter nutandbolt Other Add error objects for createUnsupportedError and createInvalidExceptionError boneskull Removed unnecessary processing in postprocessing hook wanseob Update nyc to latest version coreyfarrell Fixes to support latest versions of unexpected and unexpectedsinon sunesimonsen Add meta tag to site MartijnCuppens Fix parts of test suite failing to run on Windows boneskull v Compare Source tada Enhancements Add support for comments in mochaopts plroebuck bug Fixes Exit correctly from before hooks when using bail outsideris book Documentation Mochaflavored API docs Munter nutandbolt Other Use Bufferfrom harrysarson Remove redundant folder DavNej Refactoring plroebuck v Compare Source bug Fixes Revert change which broke watch boneskull v Compare Source tada Enhancements Add exclude option metalex bug Fixes Fix failures in circular objects in JSON reporter jeversmann boneskull book Documentation Publish actual API documentation dfberry Munter Improve docs around exclusive tests nicgirault nutandbolt Other Build matrix improvements more info outsideris boneskull Refactor reporter tests jMuzsik v Compare Source Welcome outsideris to the team bug Fixes Fix bail failing to bail within hooks outsideris Dont skip too many suites using describeskip outsideris book Documentation Improve docs regarding pending behavior ematicipo Fix broken stuff in CHANGELOGmd tagoro honzajavorek nutandbolt Other Improve test coverage for AMD users outsideris Remove vestiges of PhantomJS from CI anishkny Fix a debug message boneskull v Compare Source bug Fixes Fixes regression in watch functionality introduced in v outsideris v Compare Source This patch features a fix to address a potential low severity ReDoS vulnerability in the diff package a dependency of Mocha lock Security Fixes Bump diff to v anishkny nutandbolt Other Expose generateDiff in Base reporter harrysarson v Compare Source This release fixes a class of tests which report as false positives Certain tests will now break though they would have previously been reported as passing Details below Sorry for the inconvenience bug Fixes Do not swallow errors that are thrown asynchronously from passing tests boneskull Example js itshould actually fail sorry function done passing assertion asserttrue true test complete is marked as passing done but something evil lurks within setTimeout throw new Errorchaos Previously to this version Mocha would have silently swallowed the chaos exception and you wouldnt know Well now you know Mocha cannot recover from this gracefully so it will exit with a nonzero code Maintainers of external reporters If a test of this class is encountered the Runner instance will emit the end event twice you may need to change your reporter to use runneronceend intead of runneronend Fix stack trace reformatting problem outsideris nutandbolt Other Update browserstdout to v honzajavorek v Compare Source your gardenvariety patch release Special thanks to Wallabyjs for their continued support heart bug Fixes delay now works with only silviom Plug memory leak present in v boneskull book Documentation Update glob docs outsideris Update Wallabyjs docs ArtemGovorov Remove outdated cruft boneskull nutandbolt Other Add proper Wallabyjs config ArtemGovorov Update copyright year josephlin v Compare Source Mocha starts off right by again dropping support for unmaintained rubbish Welcome vkarpov to the team boom Breaking Changes Drop support for IE and IE Bamieh Practically speaking only code which consumes through bundling or otherwise the userland buffer module should be affected However Mocha will no longer test against these browsers nor apply fixes for them tada Enhancements Add useful new file command line argument documentation hswolff bug Fixes Fix inaccurate test duration reporting FND Fix bad markup in HTML reporter DanielRuf sunglasses Developer Experience Ditch GNU Make for nps to manage scripts TedYav book Documentation Add missing notimeouts docs dfberry Improve done callback docs maraisr Fix crossreferences vkarpov Fix tpyos tbroadley Tweak READMEmd organization xxczaki Misc updates boneskull nutandbolt Other Move TextMate Integration to its own repo Bamieh Add Nodejs v to build matrix remove v xxczaki Markdown linting boneskull Test Netlify updates Munter boneskull v Compare Source This is mainly a housekeeping release Welcome Bamieh and xxczaki to the team bug Fixes progress reporter now accepts reporter options canoztokmak xit in bdd interface now properly returns its Test object Bamieh Diffs now computed eagerly to avoid misinformation when reported abrady help will now help you even if you have a mochaopts Zarel tada Enhancements The nodiff flag will completely disable diff output CapacitorSet All setters in Mochas API are now also getters if called without arguments makepanic book Documentation Optimization and site speed improvements Munter Moved the old site repo into the main repo under docs boneskull Add maintainer guide boneskull Various fixes and updates xxczaki maty leedm nutandbolt Other Test improvements and fixes eugenet k ngeor elements Gerhut ScottFreeCode boneskull Refactoring and cruft excision elements Bamieh finnigantime boneskull v Compare Source bug Fixes Upgrade Growl to v to fix its peer dep problems dpogue v Compare Source You might want to read this before filing a new bug stuckouttongueclosedeyes boom Breaking Changes For more info please read this article Compatibility Drop support for unmaintained versions of Nodejs boneskull x x x iojs any xx Drop support for nonES compliant browsers boneskull IE IE PhantomJS x Drop Bower support old versions x etc will remain available ScottFreeCode boneskull Default Behavior By default Mocha will no longer force the process to exit once all tests complete This means any test code or code under test which would normally prevent node from exiting will do so when run in Mocha Supply the exit flag to revert to prev behavior ScottFreeCode boneskull Reporter Output Remove stdout prefix from browser reporter logs skeggse Add separator in unified diff output olsonpm Print failure message when forbidpending or forbidonly is specified ScottFreeCode Indent contexts for better readability when reporting failures charlierudolph Deprecations The compilers commandline option is now softdeprecated and will emit a warning on STDERR Read this for more info and workarounds ScottFreeCode boneskull tada Enhancements Allow override of default test suite name in XUnit reporter ngeor book Documentation Link to CLA in READMEmd and CONTRIBUTINGmd skeggse nutandbolt Other Speed up build by reconsolidating SauceLabs tests boneskull details Renovate configuration date Schedule At any time no schedule defined verticaltrafficlight Automerge Disabled by config Please merge this manually once you are satisfied recycle Rebasing Whenever PR becomes conflicted or if you modify the PR title to begin with rebase nobell Ignore Close this PR and you wont be reminded about this update again rebasecheck If you want to rebaseretry this PR check this box This PR has been generated by WhiteSource Renovate View repository job log here followredirects defaults maxBodyLength to MB httpproxy does not expose a way to set any options for this module whats worse is that the error is actually swallowed silently and the request aborted Converted urlparse over to URL object Updated var to letconst where appropriate TODO Review Discuss this change then perform cleanup I have some strange problem if I launch AXIOS or proxy twice it doesnt send the correct headers to the second one My logic Server httpcreateServer get client petition Launch proxy to jsonserver using the proxy ALTERNATIVE CODE Use AXIOS to get jsonserver data BOTH Duplicates with lodash cloneDeep the request If I use it directly it not work If I use clonedheaders dont work If I do nothing not clone it doesnt work If mock reply error launch the second proxy If I launch directly the second proxy development environment the server cant handle the correct reply so break the petition If I launch TWO AXIOS simply imitating the original request it WORKS So when you launch SOME headers proxy dont launch correctly the query if I remove from the first axios it works Example code one of the multiple tests Ive done js const PORT const TARGETURL const TIMEOUT Load the mock server instance const MOCKSERVER requiremockserver This will launch an jsonserver on other port Script dependences const http requirehttp const httpProxy requirehttpproxy const axios requireaxiosdefault const requirelodash const httpStatus requirehttpstatus Create proxy for mock server currently not used but AXIOS var proxyMock httpProxycreateProxyServer target selfHandleResponse true preserveHeaderKeyCase true proxyTimeout timeout ignorePath true Create proxy for back end var proxyBackEnd httpProxycreateProxyServer target TARGETURL selfHandleResponse false proxyTimeout timeout Create the server listener which will proxy to mocks or BE const httpServer httpcreateServerreq res consolelogrequest requrl const requestOr cloneDeepreq Launch the proxy request to mock server mockServerRequestreq res consolelogRedirecting to backend proxyBackEndwebreq res requestOr The latest try error reqflushHeaders consoleerrorBACKEND error httpServerlistenPORT err consolelogMain server is running on port PORT function mockServerRequestreq res realBackendCallback null const requestCopy cloneDeepreq const requestAxios method requestCopymethod url requestCopyurl headers requestCopyheaders WITH THIS COMMENTED IT WILL WORK withCredentials true baseURL data requestCopybody consolelogrequestAxios axiosrequestAxios axiosrequestreq then consolelogresponse consolelogsuccess res consolelogsuccess TODO Set response headers This wont work if headers send realBackendCallbackreq resendOK catcherror consolelogAXIOS ERROR error if realBackendCallback realBackendCallbackreq Temporal solution As I mentioned we found a method create AXIOS instance for mockserver if it doesnt work we recreate another AXIOS to the backend in our case dont need cookies or something hard This PR contains the following updates Package Type Update Change nyc devDependencies major Release Notes details summaryistanbuljsnycsummary v Compare Source BREAKING CHANGES The flow and jsx parser plugins are no longer enabled by default Nodejs is now required to run nyc Remove NYCROOTID and NYCINSTRUMENTER environmental variables The root field has been removed from processinfo files Features Add usespawnwraptrue option df de d Add cjs mjs ts tsx jsx to default extensions b closes Allow nyc instrument to instrument code in place Drop nodejs upgrade dependencies c b Filenames relative to project cwd in coverage reports e f Use istanbuljsschema for yargs setup fd d Use istanbullibprocessinfo Use source base name to prefix cache files c b a Bug Fixes Avoid sourcemap module during signalexit handler eb Better error handling for main execution reporting dfd d Correct handling of sourcemaps for preinstrumented files a closes Drop coverage produced by nyc all for files that were tested fc bbbf closes Honor eager setting false by default c fb a Remove vestigial environment variables cfd da details Renovate configuration date Schedule At any time no schedule defined verticaltrafficlight Automerge Disabled by config Please merge this manually once you are satisfied recycle Rebasing Whenever PR becomes conflicted or if you modify the PR title to begin with rebase nobell Ignore Close this PR and you wont be reminded about this update again rebasecheck If you want to rebaseretry this PR check this box This PR has been generated by WhiteSource Renovate View repository job log here I have been able to write a proxy for one domain that supports HTTPS but I have two domains and only server cant find how this might be supported or even if it is All my starter code is here I can proxy HTTP with domains but what about HTTPS Following issues and currently the library does not support async handler for the proxyReqWs event for modifying the request before proxying it forward This suggested PR solved the problem without breaking backward compatibility by introducing a new argument asyncContext which is used as follows js onProxyReqWs proxyReq req socket options head asyncContext asyncContextasync code const result await anyAsyncOperation code proxyReqsetHeaderkey result This PR contains the following updates Package Type Update Change semver devDependencies major Release Notes details summarynpmnodesemversummary v Compare Source v Compare Source Add requiresemverpreload to load the entire module without using lazy getter methods v Compare Source Refactor module into separate files for better treeshaking Drop support for very old node versions use constlet functions and classes v Compare Source Expose the token enum on the exports v Compare Source Coerce numbers to strings when passed to semvercoerce Add rtl option to coerce from right to left v Compare Source Handle Xranges properly in includePrerelease mode v Compare Source Do not throw when testing invalid version strings v Compare Source Add options support for semvercoerce Handle undefined version passed to Rangetest v Compare Source Add semvercompareBuild function Support in semverintersects v Compare Source details Renovate configuration date Schedule At any time no schedule defined verticaltrafficlight Automerge Disabled by config Please merge this manually once you are satisfied recycle Rebasing Whenever PR becomes conflicted or if you modify the PR title to begin with rebase nobell Ignore Close this PR and you wont be reminded about this update again rebasecheck If you want to rebaseretry this PR check this box This PR has been generated by WhiteSource Renovate View repository job log here In order to measure the duration of a proxified request request sent to backend and reponse back useful for logs it might be nice to have the request object given back to end event callback to discriminate concurrente requests Another solution would be to simply implement such valueproperty given back to end event callback What do you think Need to sniff WebSocket messages from client to server Tried following snippet from the documentation But its giving Reference Error hybiParseAndLogMessage is not defined proxyonopen function proxySocket listen for messages coming FROM the target here proxySocketondata hybiParseAndLogMessage does that mean writing my own WebSocket stream parser and use it there