Im experimenting with upspinserverdrive and have been writing files over and over again Im encountering outofmemory error like so on a standard GCP instance At the moment Im not quite sure where the issue is Filing this bug so youre aware that it exists and if I find more information Ill backfill dirserverPut Error removing group file fREDACTEDGroupsharing accessRemoveGroup item does not exist group does not exist fatal error runtime out of memory runtime stack runtimethrow xb b e x homefmillocaloptgosrcruntimepanicgo x runtimesysMap xc x x e db homefmillocaloptgosrcruntimememlinuxgo xc runtimemheapsysAlloc x cf x x x homefmillocaloptgosrcruntimemallocgo x cd runtimemheapgrow x cf x xffffffff homefmillocaloptgosrcruntimemheapgo xa runtimemheapallocSpanLocked x cf x x e dc x homefmillocaloptgosrcruntimemheapgo x runtimemheapallocm x cf x x efd cd x efd e fdc homefmillocaloptgosrcruntimemheapgo xc runtimemheapallocfunc homefmillocaloptgosrcruntimemheapgo x c runtimemheapalloc x cf x xc x efd cd a homefmillocaloptgosrcruntimemheapgo x a runtimelargeAlloc x x efd cb x efd cd a homefmillocaloptgosrcruntimemallocgo x runtimemallocgcfunc homefmillocaloptgosrcruntimemallocgo x runtimesystemstack x homefmillocaloptgosrcruntimeasmamd s x runtimemstart homefmillocaloptgosrcruntimeprocgo goroutine running runtimesystemstackswitch homefmillocaloptgosrcruntimeasmamd s fp xc fb sp xc fb pc x a runtimemallocgc x xa xc fb x e c homefmillocaloptgosrcruntimemallocgo x fp xc fb sp xc fb pc x dfd runtimemakeslice xa x x x b homefmillocaloptgosrcruntimeslicego x c fp xc fb sp xc fb pc x fc googlegolangorgapiinternalgensupportNewMediaBuffer homefmilcodegopkgmodgooglegolangorgapiv internalgensupportbuffergo googlegolangorgapiinternalgensupportPrepareUpload xc f xc aaa x x xc f xc aaa xb c e homefmilcodegopkgmodgooglegolangorgapiv internalgensupportmediago x e fp xc fb sp xc fb pc x c e googlegolangorgapiinternalgensupportNewInfoFromMedia xc f xc aaa xc fb x x xc e homefmilcodegopkgmodgooglegolangorgapiv internalgensupportmediago x c fp xc fb e sp xc fb pc x cafc googlegolangorgapidrivev FilesCreateCallMedia homefmilcodegopkgmodgooglegolangorgapiv drivev drivegengo driveupspiniocloudstoragedrivedriveImplPut xc a a xc c x xc xc e xd x xba homefmilcodegopkgmoddriveupspiniov bf f f acloudstoragedrivedrivego x fp xc fb c sp xc fb e pc x de upspiniostoreserverserverPut xc ce xc xc e xd x x x homefmilcodegosrcupspiniostoreserverservergo x a fp xc fb sp xc fb c pc x f ba upspinioserverutilpermstoreWrapperPut xc aa xc xc e xd x xc fb a x homefmilcodegosrcupspinioserverutilpermstorego x a fp xc fb sp xc fb pc x daef upspiniorpcstoreserverserverPut xc c c xc be xc d xc f xc xe xc fb d xc b ec x x homefmilcodegosrcupspiniorpcstoreserverservergo x fp xc fb a sp xc fb pc x d upspiniorpcstoreserverserverPutfm xc be xc d xc f xc xe xe x x xb homefmilcodegosrcupspiniorpcstoreserverservergo x fp xc fb ac sp xc fb a pc x d fe upspiniorpcserverImplServeHTTP xc b xc xc c xc b b homefmilcodegosrcupspiniorpcservergo x ec fp xc fb bb sp xc fb ac pc x ca c nethttpServeMuxServeHTTP x c ec xc xc c xc b b homefmillocaloptgosrcnethttpservergo x bd fp xc fb c sp xc fb bb pc x d nethttpserverHandlerServeHTTP xc c e xc xc c xc b b homefmillocaloptgosrcnethttpservergo xa fp xc fb c sp xc fb c pc x b nethttpconnserve xc f xc a xc fc homefmillocaloptgosrcnethttpservergo x fp xc fb fc sp xc fb c pc x e runtimegoexit homefmillocaloptgosrcruntimeasmamd s x fp xc fb fd sp xc fb fc pc x c created by nethttpServerServe homefmillocaloptgosrcnethttpservergo x e If someone puts an Access file at their root Access and forgets to include read access for the user the dir server runs as upspin groups dont work and fail in fairly impossible to debug ways I posit that we should add an implicit access rule that the users in the Writers file always have read access to Group regardless of the permissions While I dislike adding exceptions I think this may be a necessary one since it is too easy to lock the server out of the Groups directory and generate a quite confusing situation In order to successfully invoke upspin setupwriters domain myhostname I needed to create upspindeploymyhostname and copy upspinconfigupspinserver to upspindeploymyhostnameconfig I kinda just guessed to do that based on the error messages and upspin setupwriters help It seems that either setupwriters should take a config flag like upspin or the setup wizard should initialize the upspindeploy directory structure when it sets the server up on GCP Im trying to follow to allow a second account to use my personal upspin server but getting stuck Repro steps Create a server on GCP with upspinui Sign up as user examplecom Readingwriting files works as expected On a second computer create a new user user examplecom with upspinui Back on the first computer copy upspinconfigupspinserver to upspindeploymyhostnameconfig Should the initial setup have done this upspin setupwriters seems to assume the config lives in a upspindeploy subdirectory or maybe this is my problem Run upspin setupwriters domain myhostname user examplecom user examplecom If I upspin get the GroupWriters file I see that both users are now in it Back on the second computer choose the option to specify the servers Enter myhostname in both Directory Server and Store Server fields Click Continue After a short delay an error appears in the bottom of the dialog with a message like error communicating with myhostname storeremotemyhostname Get fetching Forbidden Did I miss a step Not sure how much of an interest there is for git to be fully functional on an upspinfs mount but in case there is some here goes I noticed that the upspinfs permission system interacts badly with the git diffs Namely on many occasions if the git repo contains permissions that cant be modeled in upspin checking out a git repo to the upspin filesystem results in a set of bogus permission diffs This issue is kind of similar except in the git case I think bogus diffs are things one really does not want Since upspin is switching to go modules a gomod file should be added to the dropbox storage backend If ok I will send a CL later this week for this As part of migrating to Go modules I had to break the version flag for both of our upspinui and upspinservergcp distributions see upspingcp f d aa c a d b df b d d f This bug tracks the fix My upspinserver has been busy for months in the following loop Sadly I had to restart the machine so only have recent server logs to show But this is what transpires Once upspinserver is started it prints the messages below then goes on to a manyweekslong read spree Where the tail end of the log excerpt above is repeated ad infinitum except different hashes every time In the past I kept the machine up for months with upspinserver running and it just kept going I wouldnt mind it since its not a cloud machine except that the read spree seems to starve completely any other clients that attempt to connect So upspin utility and upspinfs become unusable as they wait indefinitely for something to happen What to do LOGLEVELdebug UPSPINSERVERgobinupspinserver sudo gobinupspinserver letscachehomefupspinletsencrypt confighomefconfig serverconfighomefupspinserver http https web logdebug Store and Directory servers initialized Store server configuration backendDisk basePathhomefupspinserverstorage https serving HTTPS on using Lets Encrypt certificates https caching Lets Encrypt certificates in homefupspinletsencrypt recoverFromLog Recovering from log recoverFromLog Putting dirEntry fsnapshotfilmarus storeremoteDialupspinfilmarus remoteudirfilmarus storeremoteudirfilmarus Get E C C E E F DD AE BB B CBF C A E storeremoteudirfilmarus GetmetadataHTTPBase rpcstoreserver upspinfilmarus storeGetmetadataHTTPBase rpcstoreserver upspinfilmarus storeGetmetadataHTTPBase rpcstoreserver upspinfilmarus storeGet E C C E E F DD AE BB B CBF C A E storeremoteudirfilmarus Get E F C D AAF E C BC EA FA B E A C FE rpcstoreserver upspinfilmarus storeGet E F C D AAF E C BC EA FA B E A C FE storeremoteudirfilmarus GetB B B A EEF E BA D D B CBABDAAF B FC B AEB rpcstoreserver upspinfilmarus storeGetB B B A EEF E BA D D B CBABDAAF B FC B AEB recoverFromLog Recovering from log recoverFromLog Putting dirEntry fsnapshotfilmarus recoverFromLog Recovering from log recoverFromLog entries recovered Tree is current storeremoteudirfilmarus GetDDB E D BD A BF C BC D E DB A C D D C B D A FB rpcstoreserver upspinfilmarus storeGetDDB E D BD A BF C BC D E DB A C D D C B D A FB storeremoteudirfilmarus Get FC BB D DAD EB FC E C DA BBDCC B D FDDF rpcstoreserver upspinfilmarus storeGet FC BB D DAD EB FC E C DA BBDCC B D FDDF storeremoteudirfilmarus Get D A C F A AA E D F EF B A D F E B D EB C rpcstoreserver upspinfilmarus storeGet D A C F A AA E D F EF B A D F E B D EB C storeremoteudirfilmarus Get C FF CDF D D CA AE BE E EF rpcstoreserver upspinfilmarus storeGet C FF CDF D D CA AE BE E EF storeremoteudirfilmarus GetA B F A DDB FBD AC C E AEAD AEB A DA C FD D C FC rpcstoreserver upspinfilmarus storeGetA B F A DDB FBD AC C E AEAD AEB A DA C FD D C FC storeremoteudirfilmarus Get F DB D CFE B A F C D DEB FC BACED CF rpcstoreserver upspinfilmarus storeGet F DB D CFE B A F C D DEB FC BACED CF storeremoteudirfilmarus Get DEEC FE E BA A B AC CC B C DBD A FC F rpcstoreserver upspinfilmarus storeGet DEEC FE E BA A B AC CC B C DBD A FC F storeremoteudirfilmarus GetE DD E FC B F D D EEB A BD A A D E CE rpcstoreserver upspinfilmarus storeGetE DD E FC B F D D EEB A BD A A D E CE storeremoteudirfilmarus Get C C FB FBDB B A CE F AA C BA FEFA DBCD C C rpcstoreserver upspinfilmarus storeGet C C FB FBDB B A CE F AA C BA FEFA DBCD C C Was the mailing list deleted From one machine upspin get ffilmarusworkfingitrefsheadsmaster upspin get clientGet ffilmarusworkfingitrefsheadsmaster item does not exist storestorecacheGet AB A AC CB CE FC EAA F DF DD EC FBC C A BC storeserverGet cloudstoragediskDownload AB A AC CB CE FC EAA F DF DD EC FBC C A BC Serverside log rpcstoreserver ffilmarus storeGet AB A AC CB CE FC EAA F DF DD EC FBC C A BC no error is shown apparently From another upspin get ffilmarusworkfingitrefsheadsmaster d d af c c f f ffe d c f Worth noting that the second upspin get leaves no trace on the server And upspin info ffilmarusworkfingitrefsheadsmaster ffilmarusworkfingitrefsheadsmaster packing ee size time Wed Apr PDT writer ffilmarus attributes none plain file sequence access file ffilmarusworkAccess key holders ffilmarus key hashes d cfb can read same can write same can list same can create same can delete same Block Offset Size Location remoteudirfilmarus AB A AC CB CE FC EAA F DF DD EC FBC C A BC 