 What problem does this PR solve add issue link with summary if exists Duplication requires timetag to be encoded in value for mastermaster writeconflict resolution This PR introduces a readbeforewrite mechanism on every duplicated write What is changed and how it works For our readbeforewrite implementation we read the record from RocksDB and decodes its timetag If new timetag in duplicated write is larger than the old timetag this duplicated write can be applied Otherwise the duplicate will be ignored Check List REMOVE the items that are not applicable Tests At least one of them must be included Unit test Integration test Manual test add detailed scripts or steps below Code changes Has persistent data change Side effects Breaking backward compatibility Related changes Need to cherrypick to the release branch Need to update the documentation Need to be included in the release note Heres the Weekly Digest for XiaoMipegasus ISSUES Last week issues were created Of these issues have been closed and issues are still open OPEN ISSUES greenheart coredump on onappendlogcompleted by neverchanje greenheart featdup implement server handling of duplicate rpc part by neverchanje CLOSED ISSUES heart fix fix the bug that threads dont stop when pegasusioservice is released by levy PULL REQUESTS Last week pull requests were created updated or merged UPDATED PULL REQUEST Last week pull requests were updated yellowheart featdup implement server handling of duplicate rpc part by neverchanje yellowheart featcollector add statistics for partition hotspot by Smityz MERGED PULL REQUEST Last week pull requests were merged purpleheart fix fix the bug that threads dont stop when pegasusioservice is released by levy purpleheart featrocksdb Select the option of DirectIO in Rocksdb by Smityz purpleheart featdup implement pegasusmutationduplicator by neverchanje COMMITS Last week there were commits hammerandwrench featrocksdb Select the option of DirectIO in Rocksdb by Smityz hammerandwrench fix fix the bug that threads dont stop when pegasusioservice is released by levy hammerandwrench featdup implement pegasusmutationduplicator by neverchanje CONTRIBUTORS Last week there were contributors bustinsilhouette Smityz bustinsilhouette levy bustinsilhouette neverchanje STARGAZERS Last week there were stagazers star dmqm star wangtuo star skyrocknroll You all are the stars star RELEASES Last week there were no releases Thats all for last week please kbdeyes Watchkbd and kbdstar Starkbd the repository XiaoMipegasus to receive next weekly updates smiley You can also view all Weekly Digests by clicking here Your Weekly Digest bot calendar Bug Report Please answer these questions before submitting your issue Thanks What did you do If possible provide a recipe for reproducing the error Compaction writes per second GB Max flushed writes per second GB MultiSet CU K MultiSet QPS K What did you expect to see No coredump What did you see instead Coredump stack x f eb b d in raise from lib libcso x f eb c c in abort from lib libcso x f ef cb be in dsncoredump at homewutao pegasusreleaserdsnsrccorecoreserviceapiccpp x f ef d bde in dsnreplicationreplicastubhandlelogfailure thisoptimized out err at homewutao pegasusreleaserdsnsrcdistreplicationlibreplicastubcpp x f ef in dsnreplicationreplicaonappendlogcompleted this x c mu err sizeoptimized out at homewutao pegasusreleaserdsnsrcdistreplicationlibreplica pccpp x f ef dfd in operator args optimized out args thisoptimized out at homewutao appincludec functional dsnaiotaskexec thisoptimized out at homewutao pegasusreleaserdsnincludedsntoolapitaskh x f ef dd a in dsntaskexecinternal thisthisentry xb ed acd at homewutao pegasusreleaserdsnsrccorecoretaskcpp x f ef f a d in dsntaskworkerloop this x e f c at homewutao pegasusreleaserdsnsrccorecoretaskworkercpp x f ef f c in dsntaskworkerruninternal this x e f c at homewutao pegasusreleaserdsnsrccorecoretaskworkercpp x f ec in stdanonymous namespaceexecutenativethreadroutine poptimized out at homeqinzuoyangitxiaomipegasustoolchainobjdirgcc libstdcv srcc threadcc x f eccf dc in startthread from lib libpthreadso x f eb fd d in clone from lib libcso The mutation to append approdatabytes The error internalcode ERRFILEOPERATIONFAILED What version of Pegasus are you using Related codes cpp void replicastubhandlelogfailureerrorcode err derrorhandle log failure s errtostring if snotexitonlogfailure dassertfalse TODO better log failure handling cpp void replicaonappendlogcompletedmutationptr mu errorcode err sizet size if err ERROK musetlogged else derrors append shared log failed for mutation s err s name muname errtostring if err ERROK mutation log failure propagate to all replicas stubhandlelogfailureerr cpp mulogtask stublogappendmu LPCWRITEREPLICATIONLOG tracker stdbind replicaonappendlogcompleted this mu stdplaceholders stdplaceholders getgpidthreadhash pendingsize Heres the Weekly Digest for XiaoMipegasus ISSUES Last week issue was created It is closed now CLOSED ISSUES heart fix retry starting zookeeper if it failed on onebox environment by neverchanje PULL REQUESTS Last week pull requests were created updated or merged UPDATED PULL REQUEST Last week pull requests were updated yellowheart featrocksdb Select the option of DirectIO in Rocksdb by Smityz yellowheart featdup implement pegasusmutationduplicator by neverchanje MERGED PULL REQUEST Last week pull request was merged purpleheart fix retry starting zookeeper if it failed on onebox environment by neverchanje COMMITS Last week there was commit hammerandwrench fix retry starting zookeeper if it failed on onebox environment by neverchanje CONTRIBUTORS Last week there was contributor bustinsilhouette neverchanje STARGAZERS Last week there were stagazers star my star codievilky star anoriqq star sntdevco You all are the stars star RELEASES Last week there was release rocket v v Thats all for last week please kbdeyes Watchkbd and kbdstar Starkbd the repository XiaoMipegasus to receive next weekly updates smiley You can also view all Weekly Digests by clicking here Your Weekly Digest bot calendar Heres the Weekly Digest for XiaoMipegasus ISSUES Last week issues were created Of these issues have been closed and issues are still open OPEN ISSUES greenheart build error in thirdparty zk when using gcc by vagetablechicken greenheart featrocksdb Select the option of DirectIO in Rocksdb by Smityz CLOSED ISSUES heart featrocksdb Select the option of DirectIO in Rocksdb by Smityz PULL REQUESTS Last week pull requests were created updated or merged UPDATED PULL REQUEST Last week pull requests were updated yellowheart featrocksdb Select the option of DirectIO in Rocksdb by Smityz yellowheart featdup implement pegasusmutationduplicator by neverchanje COMMITS Last week there were no commits CONTRIBUTORS Last week there were no contributors STARGAZERS Last week there were stagazers star dneht star frank star guanbear You all are the stars star RELEASES Last week there were no releases Thats all for last week please kbdeyes Watchkbd and kbdstar Starkbd the repository XiaoMipegasus to receive next weekly updates smiley You can also view all Weekly Digests by clicking here Your Weekly Digest bot calendar Bug Report Please answer these questions before submitting your issue Thanks What did you do gcc build thirdparty zk What did you expect to see No error What did you see instead What version of Pegasus are you using Fix solutions Heres the Weekly Digest for XiaoMipegasus ISSUES Last week issues were created Of these issues have been closed and issues are still open OPEN ISSUES greenheart Coredump in c client by qinzuoyan greenheart by Smityz greenheart featcollector add statistics for partition hotspot by Smityz CLOSED ISSUES heart build add sanitizer support by ShuoJia LIKED ISSUE by Smityz It received x smile x tada x and heart x NOISY ISSUE speaker by Smityz It received comments PULL REQUESTS Last week pull requests were created updated or merged UPDATED PULL REQUEST Last week pull requests were updated yellowheart featcollector add statistics for partition hotspot by Smityz yellowheart featcollector add statistics for partition hotspot by levy MERGED PULL REQUEST Last week pull requests were merged purpleheart build add sanitizer support by ShuoJia purpleheart featrocksdb Adapt prefix bloom filter to speedup scans by hashkey by acelyc COMMITS Last week there were commits hammerandwrench build add sanitizer support by ShuoJia hammerandwrench featrocksdb Adapt prefix bloom filter to speedup scans by hashkey by acelyc CONTRIBUTORS Last week there were contributors bustinsilhouette ShuoJia bustinsilhouette acelyc STARGAZERS Last week there were stagazers star YiHunter star fuxiangduan star yaocong You all are the stars star RELEASES Last week there were no releases Thats all for last week please kbdeyes Watchkbd and kbdstar Starkbd the repository XiaoMipegasus to receive next weekly updates smiley You can also view all Weekly Digests by clicking here Your Weekly Digest bot calendar Bug Report yuyongrong coredump Pegasus Cilent Please answer these questions before submitting your issue Thanks What did you do If possible provide a recipe for reproducing the error What did you expect to see What did you see instead coredump gdb bt x f b e d d in raise from lib libcso x f b e e c in abort from lib libcso x f ba dfa in gnucxxverboseterminatehandler at homeqinzuoyangitxiaomipegasustoolchainobjdirgcc libstdcv libsupcvterminatecc x f ba ddc in cxxabiv terminate handleroptimized out at homeqinzuoyangitxiaomipegasustoolchainobjdirgcc libstdcv libsupcehterminatecc x f ba ddc in stdterminate at homeqinzuoyangitxiaomipegasustoolchainobjdirgcc libstdcv libsupcehterminatecc x f ba in stdanonymous namespaceexecutenativethreadroutine poptimized out at homeqinzuoyangitxiaomipegasustoolchainobjdirgcc libstdcv srcc threadcc x f b d dc in startthread from lib libpthreadso x f b eff d in clone from lib libcso What version of Pegasus are you using pegasus falcon partition partition falcon partition infocollectorcpp stdmapstdstring hotpotcalculator calculatorstore app hotpotcalculator app app app hotpotcalculator c class hotpotcalculator public stdvectorstdqueueDatastore datastores hotpotcalculatorconst stdstring name const int appsize void aggregatestdvectorrowdata partitions void startalg private stdstring appname Hotspotpolicy policy stdvectordsnperfcounter hotpotpoints appname app policy hotpotpoints app perfcounter partition datastores app partition queue paritition partition datastore c double totalgetqps double totalmultigetqps double totalputqps double totalmultiputqps double totalremoveqps double totalmultiremoveqps double totalincrqps double totalcheckandsetqps double totalcheckandmutateqps double totalscanqps double totalrecentreadcu double totalrecentwritecu Screenshot from c stdmapstdstring stdvectorrowdata allrows if getapppartitionstat shellcontext allrows derrorcall getappstat failed return app for auto approws allrows hotpotcalculator appstore nullptr map app getstorehandlerapprowsfirst approwssecondsize appstore app partition appstoreaggregateapprowssecond appstorestartalg What problem does this PR solve add issue link with summary if exists What is changed and how it works Check List REMOVE the items that are not applicable Tests At least one of them must be included Unit test Integration test Manual test add detailed scripts or steps below No code Code changes Has exported functionmethod change Has exported variablefields change Has interface methods change Has persistent data change Side effects Possible performance regression Increased code complexity Breaking backward compatibility Related changes Need to cherrypick to the release branch Need to update the documentation Need to be included in the release note 