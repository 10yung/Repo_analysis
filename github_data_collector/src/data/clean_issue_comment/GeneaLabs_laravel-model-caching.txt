Describe the bug Some records are persisted and not updatedexpired in the cache despite a timeout being set Eloquent Query With necessary information about the models php class Item extends Model not cacheable itself public function properties HasMany return thishasManyPropertyclass class Property extends Model use Cacheable protected cacheCooldownSeconds public function value BelongsTo return thisbelongsToValueclass property string name the database field that keeps getting old values from cache class Value extends Model use Cacheable protected cacheCooldownSeconds returns items with old property values Older than a day or so itemwithpropertiesvaluefind App Item id name t h Item properties Illuminate Database Eloquent Collection all App Value id name Still old value shown App Value id name Another old value I had this problem with more than one model In one case I disabled caching of Value model removed Cacheable trait In the other case I flushed the cache manually only for the Value model with php artisan modelCacheclear modelApp Value Environment PHP ubuntu OS Ubuntu LTS Laravel Model Caching memcached Yes and seem to be related at around at around Issue summarize your issue here Environment Laravel Version Laravel Model Caching Package Version PHP Version Homestead Version xy Operating System Version win Stack Trace paste the relevant complete stack trace here i set cacheCooldownSeconds but after edit database manually after minute cache not rest Issue I would like to connect to DB when the cache connection fails or there is a timeout Is it possible to do it It would be like a fallback connection Environment Laravel Version Laravel Model Caching Package Version PHP Version Operating System Version mac OS Catalina Describe the bug When using constrained eager loading the first cached result is always return regardless of any changes to the constraint I could not find any other issues relating to this and the docs only mentioned lazyloaded relationships are unsupported at the moment so I thought it wise to raise this as a bug Eloquent Query Ive provided a test that you can copy and paste into testsIntegrationCachedBuilderRelationshipsTestphp which should show my problem php public function testConstrainedEagerLoads factoryBookclass create authorid publisherid title Jason Bourne factoryBookclass create authorid publisherid title Bason Journe jasonBourneBooks Publisherwith books function q qwheretitle Jason Bourne getpluckbooksflatten thisassertCount jasonBourneBooks thisassertEqualsJason Bourne jasonBourneBooksfirsttitle basonJournBooks Publisherwith books function q qwheretitle Bason Journe getpluckbooksflatten thisassertCount basonJournBooks thisassertEqualsBason Journe basonJournBooksfirsttitle Then when running vendorbinphpunit filter CachedBuilderRelationshipsTest I get the following result There was failure GeneaLabs LaravelModelCaching Tests Integration CachedBuilderRelationshipsTesttestConstrainedEagerLoads Failed asserting that two strings are equal Expected Actual Bason Journe Jason Bourne UserssomepathlaravelmodelcachingtestsIntegrationCachedBuilderRelationshipsTestphp FAILURES Tests Assertions Failures Environment PHP OS Alpine Laravel Model Caching Additional context Can use php result appmodelcacherunDisabledfunction return Publisherwith books function q qwheretitle Bason Journe get to workaround the problem for my specific query at the moment but for some reason disableCache did not work Thanks for the great library has been working great so far Wish I had more time to look into this more or do a PR but even as it is I have probably got a little too side tracked Describe the bug Im not sure if this is a feature request or bug I hope you dont mind I put it in bugs Were currently using Dynamic Local Query scopes Dynamic scopes However it seems that the cache key does not take the dynamic aspect into account making it rather static I could imagine that the cache key generation method can check for additional parameters when generating the key as a possible solution Eloquent Query php public function scopeOfLessonquery Lesson lesson return querywherelessonid lessonid php return Student whereid with progress static function HasMany model use lesson modelofLessonlesson get The results is that when given two different lessons that the cache results will return the result of the first requested lesson Stack Trace na Environment PHP OS na Laravel Model Caching Additional context Thank you for making this package we use it in every Laravel project to speed things up heart Describe the bug When applying scopes if there is a join it is applied twice Eloquent Query Please provide the complete eloquent query that caused the bug for example php Order is a model with trait Cachable OrderwithOrderRELATIONS relations selectAll this is a scope that just selects all columns it is not applied twice withCompany the join here is applied twice withGlobalScopewithcreateduser new ScopeWithCreatedUser the join here is also applied twice simplePaginate Stack Trace The stacktrace below was generated with a dd inside Illuminate Database Query Builderjoin only on the second time the function is fired for the same table I confirmed that the scope is not being applied twice in the scopes handler using the same method It is also in reverse order so the last line is the most recent function call array file homemyprojectvendorlaravelframeworksrcIlluminatePipelinePipelinephp line function handle class App Http Middleware FrameOptions object App Http Middleware FrameOptions type args array Dingo Api Http Request Closurepassable array file homemyprojectappHttpMiddlewareFrameOptionsphp line function Illuminate Pipeline closure class Illuminate Pipeline Pipeline object Illuminate Pipeline Pipeline type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminatePipelinePipelinephp line function handle class App Http Middleware Timezone object App Http Middleware Timezone type args array Dingo Api Http Request Closurepassable array file homemyprojectappHttpMiddlewareTimezonephp line function Illuminate Pipeline closure class Illuminate Pipeline Pipeline object Illuminate Pipeline Pipeline type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminatePipelinePipelinephp line function Dingo Api Http Middleware closure class Dingo Api Http Middleware Request object Dingo Api Http Middleware Request type args array Dingo Api Http Request array file homemyprojectvendordingoapisrcHttpMiddlewareRequestphp line function dispatch class Dingo Api Routing Router object Dingo Api Routing Router type args array Dingo Api Http Request array file homemyprojectvendordingoapisrcRoutingRouterphp line function dispatch class Dingo Api Routing Adapter Laravel object Dingo Api Routing Adapter Laravel type args array Dingo Api Http Request v array file homemyprojectvendordingoapisrcRoutingAdapterLaravelphp line function dispatch class Illuminate Routing Router object Illuminate Routing Router type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingRouterphp line function dispatchToRoute class Illuminate Routing Router object Illuminate Routing Router type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingRouterphp line function runRoute class Illuminate Routing Router object Illuminate Routing Router type args array Dingo Api Http Request Illuminate Routing Route array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingRouterphp line function runRouteWithinStack class Illuminate Routing Router object Illuminate Routing Router type args array Illuminate Routing Route Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingRouterphp line function then class Illuminate Pipeline Pipeline object Illuminate Routing Pipeline container Illuminate Foundation Application passable Dingo Api Http Request pipes array Dingo Api Http Middleware PrepareController Tymon JWTAuth Http Middleware Authenticate App Http Middleware SentryContext App Http Middleware UserIsActive Illuminate Routing Middleware SubstituteBindings method handle type args array Closurerequest class Illuminate Routing Router this Illuminate Routing Router use file vendorlaravelframeworksrcIlluminateRoutingRouterphp line to array file homemyprojectvendorlaravelframeworksrcIlluminatePipelinePipelinephp line function Illuminate Routing closure class Illuminate Routing Pipeline object Illuminate Routing Pipeline type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingPipelinephp line function Illuminate Pipeline closure class Illuminate Pipeline Pipeline object Illuminate Routing Pipeline type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminatePipelinePipelinephp line function handle class Dingo Api Http Middleware PrepareController object Dingo Api Http Middleware PrepareController type args array Dingo Api Http Request Closurepassable class Illuminate Routing Pipeline this Illuminate Routing Pipeline use file vendorlaravelframeworksrcIlluminateRoutingPipelinephp line to array file homemyprojectvendordingoapisrcHttpMiddlewarePrepareControllerphp line function Illuminate Routing closure class Illuminate Routing Pipeline object Illuminate Routing Pipeline type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingPipelinephp line function Illuminate Pipeline closure class Illuminate Pipeline Pipeline object Illuminate Routing Pipeline type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminatePipelinePipelinephp line function handle class Tymon JWTAuth Http Middleware Authenticate object Tymon JWTAuth Http Middleware Authenticate auth Tymon JWTAuth JWTAuth type args array Dingo Api Http Request Closurepassable class Illuminate Routing Pipeline this Illuminate Routing Pipeline use file vendorlaravelframeworksrcIlluminateRoutingPipelinephp line to array file homemyprojectvendortymonjwtauthsrcHttpMiddlewareAuthenticatephp line function Illuminate Routing closure class Illuminate Routing Pipeline object Illuminate Routing Pipeline type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingPipelinephp line function Illuminate Pipeline closure class Illuminate Pipeline Pipeline object Illuminate Routing Pipeline type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminatePipelinePipelinephp line function handle class App Http Middleware SentryContext object App Http Middleware SentryContext type args array Dingo Api Http Request Closurepassable class Illuminate Routing Pipeline this Illuminate Routing Pipeline use file vendorlaravelframeworksrcIlluminateRoutingPipelinephp line to array file homemyprojectappHttpMiddlewareSentryContextphp line function Illuminate Routing closure class Illuminate Routing Pipeline object Illuminate Routing Pipeline type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingPipelinephp line function Illuminate Pipeline closure class Illuminate Pipeline Pipeline object Illuminate Routing Pipeline type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminatePipelinePipelinephp line function handle class App Http Middleware UserIsActive object App Http Middleware UserIsActive type args array Dingo Api Http Request Closurepassable class Illuminate Routing Pipeline this Illuminate Routing Pipeline use file vendorlaravelframeworksrcIlluminateRoutingPipelinephp line to array file homemyprojectappHttpMiddlewareUserIsActivephp line function Illuminate Routing closure class Illuminate Routing Pipeline object Illuminate Routing Pipeline type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingPipelinephp line function Illuminate Pipeline closure class Illuminate Pipeline Pipeline object Illuminate Routing Pipeline type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminatePipelinePipelinephp line function handle class Illuminate Routing Middleware SubstituteBindings object Illuminate Routing Middleware SubstituteBindings router Illuminate Routing Router type args array Dingo Api Http Request Closurepassable class Illuminate Routing Pipeline this Illuminate Routing Pipeline use file vendorlaravelframeworksrcIlluminateRoutingPipelinephp line to array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingMiddlewareSubstituteBindingsphp line function Illuminate Routing closure class Illuminate Routing Pipeline object Illuminate Routing Pipeline type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingPipelinephp line function Illuminate Routing closure class Illuminate Routing Router object Illuminate Routing Router type args array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingRouterphp line function run class Illuminate Routing Route object Illuminate Routing Route type args array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingRoutephp line function runController class Illuminate Routing Route object Illuminate Routing Route type args array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingRoutephp line function dispatch class Illuminate Routing ControllerDispatcher object Illuminate Routing ControllerDispatcher type args array Illuminate Routing Route App Api Controllers OrderController index array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingControllerDispatcherphp line function callAction class Illuminate Routing Controller object App Api Controllers OrderController type args array index array Dingo Api Http Request array file homemyprojectvendorlaravelframeworksrcIlluminateRoutingControllerphp line function calluserfuncarray args array array App Api Controllers OrderController index array Dingo Api Http Request array function index class App Api Controllers OrderController object App Api Controllers OrderController type args array Dingo Api Http Request array file homemyprojectappApiControllersOrderControllerphp line function simplePaginate class Illuminate Database Eloquent Builder object GeneaLabs LaravelModelCaching CachedBuilder query Illuminate Database Query Builder connection Illuminate Database MySqlConnection pdo Doctrine DBAL Driver PDOConnection readPdo null database ac n dev tablePrefix config array reconnector Closureconnection queryGrammar Illuminate Database Query Grammars MySqlGrammar operators array selectComponents array tablePrefix schemaGrammar Illuminate Database Schema Grammars MySqlGrammar postProcessor Illuminate Database Query Processors MySqlProcessor events Illuminate Events Dispatcher fetchMode transactions recordsModified true queryLog array loggingQueries true pretending false doctrineConnection null grammar Illuminate Database Query Grammars MySqlGrammar processor Illuminate Database Query Processors MySqlProcessor bindings array aggregate null columns array distinct false from orders joins array wheres array groups array havings null orders array limit offset unions null unionLimit null unionOffset null unionOrders null lock null operators array useWritePdo false model App Order table orders fillable array dates array appends array hidden array casts array connection null primaryKey id keyType int incrementing true with withCount perPage exists false wasRecentlyCreated false attributes original changes dateFormat null dispatchesEvents observables relations touches timestamps true visible guarded array isCachable true scopesAreApplied false macroKey forceDeleting false eagerLoad localMacros array restore ClosureBuilder builder withTrashed ClosureBuilder builder withTrashed true withoutTrashed ClosureBuilder builder onlyTrashed ClosureBuilder builder onDelete ClosureBuilder builder class Illuminate Database Eloquent SoftDeletingScope this Illuminate Database Eloquent SoftDeletingScope file vendorlaravelframeworksrcIlluminateDatabaseEloquentSoftDeletingScopephp line to passthru array insert insertOrIgnore insertGetId insertUsing getBindings toSql dump dd exists doesntExist count min max avg average sum getConnection scopes array Illuminate Database Eloquent SoftDeletingScope Illuminate Database Eloquent SoftDeletingScope Scopes RecentScope Scopes RecentScope Scopes RestrictByCompany Scopes RestrictByCompany withcreateduser Scopes ScopeWithCreatedUser withcontact Scopes ScopeWithContact restrictdraftsandcart Scopes RestrictDraftsAndCart commentcount Scopes ScopeWithCommentCount removedScopes isCachable true scopesAreApplied true macroKey type args array array page array file homemyprojectvendorlaravelframeworksrcIlluminateDatabaseEloquentBuilderphp line function get class GeneaLabs LaravelModelCaching CachedBuilder object GeneaLabs LaravelModelCaching CachedBuilder type args array array array file homemyprojectvendorgenealabslaravelmodelcachingsrcTraitsBuildablephp line function cachedValue class GeneaLabs LaravelModelCaching CachedBuilder object GeneaLabs LaravelModelCaching CachedBuilder type args array array array genealabslaravelmodelcachingmysqlac n devordersapporderordersselect companiesname as companyname from companies where companiesid orderscompanyid as companynameselect countdistinct permitscarrierid from permits where permitsorderid ordersid and permitsdeletedat is null as carriercountconcatcoalescecufirstname coalesceculastname as createdbynameselect CONCATCOALESCEusersfirstname COALESCEuserslastname as contactname from users where usersid orderscontactid as contactnamecountdistinct commentsid as commentcountselect countdistinct commentsid as important where commentsimportant limit as importantordersdeletedatnullorderscompanyid nestednestedordersstatusidindraftincartstaffcartselect usersaccounttypeid from users where usersid orderscreatedbyincustomercustomeradminordersstatusidnotindraftincartstaffcartorderBycreatedatdescorderByordersiddescoffset limit array file homemyprojectvendorgenealabslaravelmodelcachingsrcTraitsBuildablephp line function retrieveCachedValue class GeneaLabs LaravelModelCaching CachedBuilder object GeneaLabs LaravelModelCaching CachedBuilder type args array array array genealabslaravelmodelcachingmysqlac n devordersapporderordersselect companiesname as companyname from companies where companiesid orderscompanyid as companynameselect countdistinct permitscarrierid from permits where permitsorderid ordersid and permitsdeletedat is null as carriercountconcatcoalescecufirstname coalesceculastname as createdbynameselect CONCATCOALESCEusersfirstname COALESCEuserslastname as contactname from users where usersid orderscontactid as contactnamecountdistinct commentsid as commentcountselect countdistinct commentsid as important where commentsimportant limit as importantordersdeletedatnullorderscompanyid nestednestedordersstatusidindraftincartstaffcartselect usersaccounttypeid from users where usersid orderscreatedbyincustomercustomeradminordersstatusidnotindraftincartstaffcartorderBycreatedatdescorderByordersiddescoffset limit array genealabslaravelmodelcachingmysqlac n devapporder b d b e bd f e d aaa ce get array file homemyprojectvendorgenealabslaravelmodelcachingsrcTraitsBuildablephp line function rememberForever class Illuminate Cache Repository object Illuminate Cache RedisTaggedCache tags Illuminate Cache TagSet store Illuminate Cache RedisStore redis Illuminate Redis RedisManager prefix laravel connection default names array store Illuminate Cache RedisStore events Illuminate Events Dispatcher default type args array b d b e bd f e d aaa ce Closure class GeneaLabs LaravelModelCaching CachedBuilder this GeneaLabs LaravelModelCaching CachedBuilder use file vendorgenealabslaravelmodelcachingsrcTraitsBuildablephp line to array file homemyprojectvendorlaravelframeworksrcIlluminateCacheRepositoryphp line function GeneaLabs LaravelModelCaching Traits closure class GeneaLabs LaravelModelCaching CachedBuilder object GeneaLabs LaravelModelCaching CachedBuilder type args array file homemyprojectvendorgenealabslaravelmodelcachingsrcTraitsBuildablephp line function get class Illuminate Database Eloquent Builder object GeneaLabs LaravelModelCaching CachedBuilder type args array array array file homemyprojectvendorlaravelframeworksrcIlluminateDatabaseEloquentBuilderphp line function applyScopes class Illuminate Database Eloquent Builder object GeneaLabs LaravelModelCaching CachedBuilder type args array file homemyprojectvendorlaravelframeworksrcIlluminateDatabaseEloquentBuilderphp line function callScope class Illuminate Database Eloquent Builder object GeneaLabs LaravelModelCaching CachedBuilder query Illuminate Database Query Builder connection Illuminate Database MySqlConnection grammar Illuminate Database Query Grammars MySqlGrammar processor Illuminate Database Query Processors MySqlProcessor bindings array select from join where array having order union aggregate null columns array orders Illuminate Database Query Expression Illuminate Database Query Expression Illuminate Database Query Expression Illuminate Database Query Expression Illuminate Database Query Expression Illuminate Database Query Expression distinct false from orders joins array Illuminate Database Query JoinClause Illuminate Database Query JoinClause wheres array array array array array array groups array ordersid havings null orders array array array array limit offset unions null unionLimit null unionOffset null unionOrders null lock null operators array like like binary not like ilike rlike not rlike regexp not regexp similar to not similar to not ilike useWritePdo false model App Order eagerLoad localMacros array restore ClosureBuilder builder withTrashed ClosureBuilder builder withTrashed true withoutTrashed ClosureBuilder builder onlyTrashed ClosureBuilder builder onDelete ClosureBuilder builder passthru array insert insertOrIgnore insertGetId insertUsing getBindings toSql dump dd exists doesntExist count min max avg average sum getConnection scopes array Illuminate Database Eloquent SoftDeletingScope Illuminate Database Eloquent SoftDeletingScope Scopes RecentScope Scopes RecentScope Scopes RestrictByCompany Scopes RestrictByCompany withcreateduser Scopes ScopeWithCreatedUser withcontact Scopes ScopeWithContact restrictdraftsandcart Scopes RestrictDraftsAndCart commentcount Scopes ScopeWithCommentCount removedScopes isCachable true scopesAreApplied true macroKey type args array Closureself builder class Illuminate Database Eloquent Builder this GeneaLabs LaravelModelCaching CachedBuilder use file vendorlaravelframeworksrcIlluminateDatabaseEloquentBuilderphp line to array file homemyprojectvendorlaravelframeworksrcIlluminateDatabaseEloquentBuilderphp line function Illuminate Database Eloquent closure class Illuminate Database Eloquent Builder object GeneaLabs LaravelModelCaching CachedBuilder type args array GeneaLabs LaravelModelCaching CachedBuilder array file homemyprojectvendorlaravelframeworksrcIlluminateDatabaseEloquentBuilderphp line function apply class Scopes ScopeWithCreatedUser object Scopes ScopeWithCreatedUser type args array GeneaLabs LaravelModelCaching CachedBuilder App Order array file homemyprojectappScopesScopeWithCreatedUserphp line function call class GeneaLabs LaravelModelCaching CachedBuilder object GeneaLabs LaravelModelCaching CachedBuilder type args array join array Illuminate Database Query Expression value users cu cuid orderscreatedby array file homemyprojectvendorgenealabslaravelmodelcachingsrcTraitsCachingphp line function call class Illuminate Database Eloquent Builder object GeneaLabs LaravelModelCaching CachedBuilder type args array join array Illuminate Database Query Expression cuid orderscreatedby array file homemyprojectvendorlaravelframeworksrcIlluminateDatabaseEloquentBuilderphp line function forwardCallTo class Illuminate Database Eloquent Builder object GeneaLabs LaravelModelCaching CachedBuilder type args array Illuminate Database Query Builder join array Illuminate Database Query Expression cuid orderscreatedby array file homemyprojectvendorlaravelframeworksrcIlluminateSupportTraitsForwardsCallsphp line function join class Illuminate Database Query Builder object Illuminate Database Query Builder type args array Illuminate Database Query Expression cuid orderscreatedby Environment PHP OS Ubuntu Laravel Model Caching 