 Change Description When validation of block produces a different block id digest of block header then report a diff of the attributes of the block header of debugging Consensus Changes Consensus Changes API Changes API Changes Documentation Additions Documentation Additions Change Description Remove new block id notify feature as it doesnt actually improve performance and actually causes issues with large of connections Since this was the only new net protocol feature added in the net protocol version has been reverted to version Consensus Changes Consensus Changes API Changes API Changes Documentation Additions Documentation Additions PLEASE FILL OUT THE FOLLOWING MARKDOWN TEMPLATE PR title alone should be sufficient to understand changes Change Description Describe your changes their justification AND their impact Reference issues or pull requests where possible use XX or GHXX where XX is the issue or pull request number Minor changes to update EOS VM OC to work with LLVM Tested against rc passed all tests ORCv the LLVM API EOS VM OC is using was expected to be removed in but it has survived Sounds like almost certain it will be removed for though so updating to the ORCv API will be a requirement soon Consensus Changes Consensus Changes checked x Consensus changes unchecked no changes ignore this section If this PR introduces a change to the validation of blocks in the chain or consensus in general please describe the impact API Changes API Changes checked x API changes unchecked no changes ignore this section If this PR introduces API changes please describe the changes here What will developers need to know before upgrading to this version Documentation Additions Documentation Additions checked x Documentation changes unchecked no changes ignore this section Describe what must be added to the documentation after merge I upgraded a dapp infrastructure that consisted of several nodes on EOS mainnet All servers are in the same datacenter I deleted the old data downloaded a recent snapshot from EOS Nation and EOS Sweden then enabled wasmruntime eosvmjit eosvmocenable true and started nodeos from snapshot Some nodes have state history plugin enabled others do not So first upgrades went alright and synched against public p p quite quickly although not occupying the CPU at all the time The last servers synched very slowly while I tried to use direct peers in the same datacenter It looks like a node synching from is affected and when the remote peer is it synchronizes much faster So even with a remote peer in the same datacenter over a gigabit link and only one peer configured the node goes to CPU for few seconds and then waits for something keeping the CPU at for about seconds During this idling time the head is not advancing Then it resumes for few seconds and then idles again This results in a very slow resync I tried various values for syncfetchspan between and and it didnt change the picture I push my transaction success and also find the trxid in mongo but it lost This is the link info T thread httpplugincpp plugininitialize configured http to listen on info T thread chainplugincpp plugininitialize initializing chain plugin info T thread blocklogcpp open Log is nonempty info T thread blocklogcpp open Index is nonempty warn T thread chainplugincpp plugininitialize St outofrange basicstringsubstr pos which is thissize which is rethrow basicstringsubstr pos which is thissize which is whatbasicstringsubstr pos which is thissize which is thread chainplugincpp plugininitialize error T thread maincpp main St outofrange basicstringsubstr pos which is thissize which is rethrow basicstringsubstr pos which is thissize which is whatbasicstringsubstr pos which is thissize which is thread chainplugincpp plugininitialize Failed to msync DB file Cannot allocate memory PLEASE FILL OUT THE FOLLOWING MARKDOWN TEMPLATE PR title alone should be sufficient to understand changes Change Description Add a last block field last status string and copy of the outgoing handshake message Resolves Consensus Changes Consensus Changes checked x Consensus changes unchecked no changes ignore this section If this PR introduces a change to the validation of blocks in the chain or consensus in general please describe the impact API Changes x API Changes checked x API changes unchecked no changes ignore this section lasthandshake field has been renamed to lasthandshakerecv to better characterize it alongside the new lasthandshakesent field Documentation Additions x Documentation Additions checked x Documentation changes unchecked no changes ignore this section Samples of results of v netconnections API need to be updated and expanded to include the various common scenarios PLEASE FILL OUT THE FOLLOWING MARKDOWN TEMPLATE PR title alone should be sufficient to understand changes Change Description Describe your changes their justification AND their impact Reference issues or pull requests where possible use XX or GHXX where XX is the issue or pull request number Problem The Blockchain team will make changes to a submodule in the eosiosecurity repo and then push with a new SHACOMMIT The security mirror repo for EOS uses the public repossubmodules remotes since its synced with the public repo Because of this buildkite will prepare a working directory with the public repo urls If the commit id of the submodule is not in the public repo this preparation step will fail to find the commit Goal Replicate in a script the preparation of the working directory Additionally support adding the security remote so that commits are available for submodule update Here is how we accomplish this The Pipeline Upload step becomes env SKIPCONTRACTBUILDER true steps label pipeline Pipeline Upload command curl s o prepsh chmod x prepsh prepsh cicdgeneratepipelinesh pipelineyml buildkiteagent artifact upload pipelineyml buildkiteagent pipeline upload pipelineyml agents queueautomationbasicbuilderfleet plugins thedyrtskipcheckoutv cd This pulls the script we use to prep the working directory from S and executes it The repo for these scripts can be found at The script when running in buildkite using CI true will rm itself The folders in the S bucket are for the branches in the EOSIObuildkiteprepareworkingdirectoryscripts repo It is run for both mac and linux platforms We will have a pipeline that automatically uploads changes in the EOSIObuildkiteprepareworkingdirectoryscripts repo to S As of right now its a manual upload process Once its pulled other commands are then executed as normal You can see a run with EOSVM pointing to a branch in the eosvmsecurity repo here You can also see it running without changing the EOSVM submodule Note Compared to buildkites prep working dir step there is only a second increase in time Consensus Changes Consensus Changes checked x Consensus changes unchecked no changes ignore this section If this PR introduces a change to the validation of blocks in the chain or consensus in general please describe the impact API Changes API Changes checked x API changes unchecked no changes ignore this section If this PR introduces API changes please describe the changes here What will developers need to know before upgrading to this version Documentation Additions Documentation Additions checked x Documentation changes unchecked no changes ignore this section Describe what must be added to the documentation after merge When you have exceeded maxclientcount and clients keep trying to connect there is too much noise in the logs It would be better to say X number of connections were rejected in the last minute or something This is with default logging Could presumably cause a DOS by simply connecting to the P P port over and over and then filling up the logs setup p p node on public internet set max connections to a low number connect valid p p clients to fill up all those connections then watch what happens when you connect more clients over the limit Jan mar nodeos info T net netplugincpp connection accepted network connection Jan mar nodeos error T net netplugincpp operator Error maxclientcount exceeded Jan mar nodeos info T net netplugincpp connection accepted network connection Jan mar nodeos error T net netplugincpp operator Error maxclientcount exceeded Jan mar nodeos info T net netplugincpp connection accepted network connection Jan mar nodeos error T net netplugincpp operator Error maxclientcount exceeded Jan mar nodeos info T net netplugincpp connection accepted network connection Jan mar nodeos error T net netplugincpp operator Error maxclientcount exceeded Jan mar nodeos info T net netplugincpp connection accepted network connection Jan mar nodeos error T net netplugincpp operator Error maxclientcount exceeded Jan mar nodeos info T net netplugincpp connection accepted network connection Jan mar nodeos error T net netplugincpp operator Error maxclientcount exceeded Jan mar nodeos info T net netplugincpp connection accepted network connection Jan mar nodeos error T net netplugincpp operator Error maxclientcount exceeded Jan mar nodeos info T net netplugincpp connection accepted network connection Jan mar nodeos error T net netplugincpp operator Error maxclientcount exceeded Jan mar nodeos info T net netplugincpp connection accepted network connection Jan mar nodeos error T net netplugincpp operator Error maxclientcount exceeded Jan mar nodeos info T net netplugincpp connection accepted network connection Jan mar nodeos error T net netplugincpp operator Error maxclientcount exceeded Jan mar nodeos info T net netplugincpp connection accepted network connection Jan mar nodeos error T net netplugincpp operator Error maxclientcount exceeded Jan mar nodeos info T net netplugincpp connection accepted network connection Jan mar nodeos error T net netplugincpp operator Error maxclientcount exceeded Jan mar nodeos info T net netplugincpp connection accepted network connection Jan mar nodeos error T net netplugincpp operator Error maxclientcount exceeded Jan mar nodeos info T net netplugincpp connection accepted network connection Jan mar nodeos error T net netplugincpp operator Error maxclientcount exceeded Jan mar nodeos info T net netplugincpp connection accepted network connection To reproduce compile start nodeos with databasemapmode locked stop nodeos normally and let it shutdown observe the logs Files are stored on ext SSD Please advise if any additional environmental information is needed Note using systemd here to manage nodeos Jan mar nodeos info T nodeos netplugincpp pluginshutdown exit shutdown Jan mar nodeos CHAINBASE Writing reversible database file this could take a moment Jan mar nodeos complete Jan mar nodeos Syncing buffers Jan mar nodeos Complete Jan mar nodeos CHAINBASE Writing state database file this could take a moment Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos complete Jan mar nodeos Syncing buffers Jan mar nodeos Complete Jan mar nodeos corrupted size vs prevsize Jan mar systemd nodeosservice Main process exited codekilled status ABRT 