Help maintain consistency readability and efficiency in the codes smile minikube and microk s Update READMEmd accordingly docker changed the way inspect works and will now query all components for information on given input this will cause things like volume drivers to get spammed with queries about containersimages and other things this keeps it tidier by specifying what you actually want to inspect In our scenario we use multistage docker builds and intermediate containers are not created are never executed In those scenario we would like to keep those containers till GRACEPERIODSECONDS file ChangeId I a a b fd b d eac cf Currently the code to remove dangling images works okay but if you are excluding repositories images with tags set to you will not be removing all dangling images This change adds the dangling images to the imagesreap list after the nondangling images are processed The changelog looks huge but basically its just wrapping existing code inside main function while supporting passing flags like h help force etc Currently supported ENV variables should work as before but it should be much easier to add new CLI flags Addresses issue This pull request comes from the discussion had in the previous one about updating the dockerfile to take into consideration the latest docker community edition versions As davidcaste commented there itd be a good idea to use said official images in order to clean up the dockerfile and avoid maintaining it through the different docker versions and repositories this is my approach The rationale behind this PR is that in environment managed by orchestration tools like for example Rancher its responsibility of the orchestrator to decide what containers should be removed and when In the Rancher specific case for example there are sidekick containers that are normally shut down and the dockergc would otherwise remove those see for example This PR adds the possibility to exclude all the containers from GC using an environment variable EXCLUDEALLCONTAINERS For our workflow the required graceperiod for images and containers are different So we added the CONTAINERGRACEPERIODSECONDS and IMAGEGRACEPERIODSECONDS settings in a backward compatible way Solution for issue 