 Redmine Issue Ready for review IPsec IPv dynamic FQDN Remote Gateways support by adding IPv FQDN resolution ability to resolveretry Redmine Issue Ready for review This PR changes filterdeletestatesfordowngateways by adding failover group checking in this case if for example Tier is up but Tier is down it doesnt kill all states It kill states only if all tiers in failover group are equal loadbalance configuration or if failed Tier Tier with lower value high priority This avoid state killing in case when primary Tier link works fine but secondary Tier link is flapping This pull request implement synchronization for connected users when enabling High Availability and fix multiple bugs related to HA with captive portal in general x Main redmine issue Captive Portal should sync its database to other members of clusters x Also fix HA sync files vouchercpzonecfg and vouchercpzonepublic are not created on secondary node HA sync changing a voucher roll on master does not reset active tickets on secondary HA sync disabling captive portal HA sync does remove all zones on secondary Ready for review x Forum thread I am looking for testers even if you are not using High Availability Please refer to the forum for more info Redmine Issue Ready for review strip ipsec hash algo from swanctlconf Phase proposals Redmine Issue Ready for review If I adjust the MTU of an assigned interface only link route for IPv on the interface has its MTU adjusted not others This PR set correct MTU for static and default IPv routes of interface Redmine Issue Ready for review Description This pull request resolves issues with the widget refresh system The refresh system uses flawed logic see below for an indepth explanation Widgets despite using ajax callbacks are not truly async one widget can lock another if it takes too long to run Session timeouts result in the dashboard continuing to attempt ajax callbacks despite access being blocked due to the aforementioned session timeout History This pull request is a simplified rework of from my old Github account but does not not default to a second refresh interval for the Firewall Logs and Gateways widgets in fact it doesnt directly modify those widgets at all Changes usrlocalwwwindexphp Widget locking Removed global mutex preventing one longrunning widget from hanging up others and ensuring true asynchronous operation Added perwidget lock allowing a widget to execute only if its not already executing Widget refreshing Renamed function executewidget to executewidgets for the sake of grammar Changed execution to a setInterval instead of a selfcalling setTimeout as it is cleaner this way allows for clearInterval upon session timeout if desired Fixed refresh logic as it is logically flawed in its current implementation The function executewidget is called every second freq is defined as the desired number of seconds between each execution of the ajaxidxth widget If ajaxcntr freq is equal to the ajaxidxth widget will run At the end of executewidget ajaxidx is increased If ajaxidx is greater than the number of widgets it is reset to and ajaxcntr is also increased If ajaxcntr is greater than is it reset to The end result is that each call of executewidget takes n seconds to run where n is the number of widgets on the dashboard and each widget will only execute every t times executewidget is run resulting in an actual update time of n t Example for further illustration Suppose that there are widgets present on the pfSense dashboard and the Firewall Logs widget is configured to have an Update interval of seconds A single call of executewidget takes seconds second per widget widgets total and Firewall Logs only refreshes every times updatewidget is called Thus Firewall Logs only refreshes every seconds or seconds This is a bug and incorrect behavior This has been fixed through the use of a single for loop each time executewidget is called that passes over all widgets and decides on a perwidget basis if they should be executed based on ajaxcntr In short this change allows all widgets to operate independently of each other Session timeouts Dont try to execute ajax callbacks if session timed out Removed ajaxtimeout variable as it was not referenced Checklist X Redmine Issue X Ready for review x Redmine Issue x Ready for review Redmine Issue Ready for review default current behavior if checkbox disabled pfSense Cisco IOS tunnel tested