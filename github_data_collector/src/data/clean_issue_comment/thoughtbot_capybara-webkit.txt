Im trying to use CucumberCapybaraWebKit under an Ubuntu installation in WSL so its possible theres something about the WSL environment thats creating the following issue Ive already tried following the solutions here and here and as best as I can tell everything installed correctly xvfb Qt I then uninstalled and reinstalled capybarawebkit and I have added the headless gem At the command line of the WSL instance webkitserver still reports QStandardPaths XDGRUNTIMEDIR not set defaulting to tmpruntimederrell qtqpascreen QXcbConnection Could not connect to display Could not connect to any X display And running xvfbrun a cucumber reports in part Received Visit Started Visit Load started Visit started page load Started request to Finished Visit with response Success Received from Page finished with true Load finished Page load from command finished Wrote response false class TimeoutError message Request timed out after seconds javascript Scenario Going to the page and entering a number in the form results in the display of the current weather for that many locations featuresdisplayweatheratrandomlocationsfeature Given I have a page that has a form that accepts a number featuresstepdefinitionsdisplayweatherstepsrb Request timed out after seconds CapybaraWebkitTimeoutError Im open to any suggestions for whats missing and for trying anything you can suggest Id wager Im unusual in attempting to use this environment in this way Im upgrading my Capybara to the latest version up from This causes the normalizedwhitespace deprecation running to show up a lot when running my tests I read that pulling the master branch of the gem fixes the issue effectively it does but now my CI on Gitlab fails with ErrnoENOENT No such file or directory buildsproductsmicheticketvendorruby bundlergemscapybarawebkit fdac cd binwebkitserver Does anyone have any Idea on how to fix this Hello Theres already a couple of issues related with the problematic usage of flexbox Were in and now everyone either uses it or display grid for creating layouts floats are dead I am migrating an old Rails codebase from sprockets to webpacker and without changing a single line of CSS just migrating the bundling part i was breaking a lot of tests Just spend a full day bashing my head against the screen trying to figure out what have i done as everything was working before The issue was that my new autoprefixer config had this subtle difference flexbox no Which made total sense were in browser support as per browserlistrc of the project is last version not ie so why add garbage css to my bundles According to Autoprefixer flexbox no will add prefixes only for final and IE versions of specification Which is not enough to make correct tests rendering Proposal Using this I got the following output Capybara capybarawebkit Qt WebKit QtWebKit A quick google search for WebKit lead me to believe that were taking about a circa engine which matches to something like Safari kind of browser according to this table The comment also states Which CSS properties are supported will depend on the version of Qt you have installed We cant have a one size fits all be we can advise sensible defaults Based on all this i think adding a section to readme would be really helpful heres a sample Flexbox For testing bundles use the oldest flexbox syntax possible If youre using autoprefixer make sure that for test environment thats last versions as browser targets and also make sure you havent set flex no config property Happy to make a PR if you guys agree Thanks for the work on this Cheers Currently I am unable to maximize the window I tried maximum functionsresizewindow Capybaracurrentwindowmaximize executescriptwindowresizeTo screenheight to maximize the window with no luck Gem version capybarawebkit Hello Im having some issues with a few tests The weird thing is that on my other development machine everythings working smoothly Heres the version output Capybara capybarawebkit Qt WebKit QtWebKit Whats interesting is that on my laptop the one that runs without issues both Qt and QtWebkit are at Heres the output Error Onboarding Testtestregistrolayouttest EOFError end of file reached testintegrationonboarding testrb in block levels in classOnboarding Test testintegrationonboarding testrb in block in classOnboarding Test Error Onboarding Testtestregistrolayouttest CapybaraWebkitCrashError The webkitserver process crashed Broken pipe This is a bug in capybarawebkit For help with this crash please visit testtesthelperrb in teardown And heres the debug output Hi Since this commit on Capybara first released with capybara rc this deprecation warning is thrown DEPRECATED CapybaraHelpersnormalizewhitespace is deprecated please update your driver This seems to be fixed on master in this commit Any chance of a new release Thank you If a crash occurs during reset options such as allowedurls blockedurls etc arent correctly set for the next test This adds a retry to reset in an attempt to work around the crashes The CapybaraWebkitBrowser command method used to send commands and read responses over the socket to the Webkit process can become outofsync When this happens readresponse returns a prior response which does not match up to the most recent command This often manifests to the user as errors such as JSONParserError unexpected token at true or JSONParserError A JSON text must at least contain two octets or possibly issues such as There may be other errors possible since it depends on what the code does with response message Im not sure what conditions this occurs under but can almost reliably reproduce it locally by calling pageevaluatescript followed by a call to pagedriverconsolemessages on a page that is performing AJAX requests The response for the first Evaluate command is accidentally read by the subsequent ConsoleMessages command which attempts to parse the evaluate response as JSON Here is an example with logging I added Note how the CHECK COMMAND Evaluate never finishes reading a response and READ COMMAND ConsoleMessages reads the evaluate response string STARTING COMMAND Evaluate CHECK COMMAND Evaluate Received from Started request to Received from Started request to Page is CapybaraSession Page driver is CapybaraWebkitDriver DEPRECATION CapybaraWebkitDriverbrowser is deprecated STARTING COMMAND ConsoleMessages CHECK COMMAND ConsoleMessages Received from Started request to Received EvaluateangularelementdocumentquerySelector ngapp injectorgethttppendingRequestslength Started EvaluateangularelementdocumentquerySelector ngapp injectorgethttppendingRequestslength Finished EvaluateangularelementdocumentquerySelector ngapp injectorgethttppendingRequestslength with response Success Wrote response true Received ConsoleMessages Received from Started request to Started ConsoleMessages Finished ConsoleMessages with response Success linenumber message This page does not have a Lish metricspagename or pageidentityjs set and will not be enabled for UTM attribution tracking source Wrote response true linenumber message This page does not have a Lish metricspagename or pageidentityjs set and will not be enabled for UTM attribution tracking source Received from Started request to checkok READ COMMAND ConsoleMessages responselength response FINISHED COMMAND ConsoleMessages with response This appears to happen because the rescue IOWaitReadable in connectionread never triggers for the Evaluate command When I remove the evaluatescript call everything works as expected Im using ruby p revision x darwin with pagedriverversion Capybara capybarawebkit Qt WebKit QtWebKit In our test environment we inject a javascript file into the page to provide us with some extra support code This works great when I run the application locally without SSL However when attempting to do the same with the application deployed to the test environment the debug output reports a status code of when trying to fetch the file over HTTPS The server logs do not show any request I tried to use wireshark and I see a certification negotiation but couldnt glean anything else from the capture since the payloads are encrypted The server certificate is self signed but I have set the ignoresslerrors option I will start digging into the code but any pointers on where to look would be appreciated screen shot at pm When a preflight CORS request fails capybara webkit crashes CapybaraWebkitCrashError The webkitserver process crashed Connection reset by peer This is a bug in capybarawebkit For help with this crash please visit If it helps this is the preflight options check that appears to kill webkit curl v X OPTIONS insecure Rebuilt URL to Trying TCPNODELAY set Connection failed connect to port failed Connection refused Failed to connect to localhost port Connection refused Closing connection curl Failed to connect to localhost port Connection refused Example I have made the following project as an example git clone b webkitcrasheswithpreflightfailure gitgithubcomAlanFosterrspeccapybarafeaturetestinggit cd rspeccapybarafeaturetestingwebsite bundle Running the following command will cause webkit to crash of the time FORCEWEBKITCRASHtrue DEBUGtrue rspec specfeaturesjavascriptspecrb FailureError expectpageto havecontentSuccessfully retrieved server response CapybaraWebkitCrashError The webkitserver process crashed Broken pipe This is a bug in capybarawebkit For help with this crash please visit Whilst correctly stubbing the preflight CORS request will not crash webkit DEBUGtrue rspec specfeaturesjavascriptspecrb Finished in seconds files took seconds to load example failures Context I am using puffing billy to stub requests made during feature tests