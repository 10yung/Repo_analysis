 Hi For at least a year Ive been meeting the same problem if there is an NSDate stub and test fails test run failscrashes with something like this Class NSDate has a superclass that supports secure coding but NSDate overrides initWithCoder and does not override supportsSecureCoding The class must implement supportsSecureCoding and return YES to verify that its implementation of initWithCoder is secure coding compliant Today Ive finally decided to figure out what is the problem It all ended up with this patch Maybe someone has any idea about how to solve the problem more properly allow the use of notification matcher with async verifier in constructs like my notification shouldEventually bePosted or even shouldNotEventually by keeping observer alive when evaluated multiple times until first notification received Fixes Using kiwi When running the Unit Tests for my app Xcode crash when framework try to verifyTheProbe Details backstrace attached issue producible easily not img width altscreen shot at pm src HI friends PPSFPSLabelm rninit Created by on Copyright Facebook All rights reserved import PPSFPSLabelh import PPSWeakProxyh static const NSInteger kFPSLabelHeight f interface PPSFPSLabel NSUInteger count NSTimeInterval lastTime UIFont font UIFont subFont end implementation PPSFPSLabel idfpsLabel UIScreen mainScreen UIScreen mainScreen PPSFPSLabel fpsLabel PPSFPSLabel alloc initWithFrameCGRectMake mainScreenboundssizeheight kFPSLabelHeight kFPSLabelHeight return fpsLabel idinitWithFrameCGRectframe if self super initWithFrameframe selfframe frame selflayercornerRadius selfclipsToBounds YES selftextAlignment NSTextAlignmentCenter selfuserInteractionEnabled NO selfbackgroundColor UIColor colorWithWhite alpha font UIFont fontWithNameCourier size subFont UIFont fontWithNameCourier size self addTimer return self voidaddTimer selffpsLink CADisplayLink displayLinkWithTarget PPSWeakProxy proxyWithTargetself selectorselectortick selffpsLink addToRunLoop NSRunLoop mainRunLoop forModeNSRunLoopCommonModes voiddealloc selffpsLink invalidate NSLogtimer release voidtickCADisplayLink link NSLogtick f lastTime if lastTime lastTime linktimestamp return count NSTimeInterval delta linktimestamp lastTime if delta return lastTime linktimestamp float fps count delta count CGFloat progress fps UIColor color UIColor colorWithHue progress saturation brightness alpha NSString text NSString stringWithFormatd FPSintroundfps NSLog text NSMutableAttributedString text NSMutableAttributedString alloc initWithString NSString stringWithFormatd FPSintroundfps text addAttributeNSForegroundColorAttributeName valuecolor rangeNSMakeRange textlength text addAttributeNSForegroundColorAttributeName value UIColor whiteColor rangeNSMakeRangetextlength text addAttributeNSFontAttributeName valuefont rangeNSMakeRange textlength text addAttributeNSFontAttributeName valuesubFont rangeNSMakeRangetextlength selfattributedText text end How to write unit test for CADisplayLink I write the kiwi is describePPSFPSLabel letfpsLabel id return PPSFPSLabel fpsLabel itlayout on the leftbottom screen UIScreen mainScreen UIScreen mainScreen theValue fpsLabel frame should equaltheValueCGRectMake mainScreenboundssizeheight contextshould add a timer PPSFPSLabel label PPSFPSLabel fpsLabel label should receiveselectoraddTimer labelfpsLink shouldNot beNil ittime target PPSFPSLabel label PPSFPSLabel fpsLabel whiletrue But the function tick cannot code coverage Using Kiwi When trying to run the Unit Tests on a real device Xcode trows an error saying You must rebuild it with bitcode enabled Running the tests on simulator works fine Nimble had a similar issue They way I solved this is setting the ENABLEBITCODE to NO using cocoapods if Kiwi include targetname targetbuildconfigurationseach do config configbuildsettings ENABLEBITCODE NO end end ld ApplicationsXcodeappContentsDeveloperPlatformsiPhoneOSplatformDeveloperLibraryFrameworksXCTestframeworkXCTest does not contain bitcode You must rebuild it with bitcode enabled Xcode setting ENABLEBITCODE obtain an updated library from the vendor or disable bitcode for this target file ApplicationsXcodeappContentsDeveloperPlatformsiPhoneOSplatformDeveloperLibraryFrameworksXCTestframeworkXCTest for architecture arm Is Bitcode actually really required Hey guys I have the following issue code does implementation SomeLocationManagerWrapperClass void someMethod selflocationManager setAllowsBackgroundLocationUpdatesTRUE end test does SomeLocationManagerWrapperClass lm SomeLocationManagerWrapperClass new lmlocationManager CLLocationManager nullMock lmlocationManager should receiveselectorsetAllowsBackgroundLocationUpdates withArgumentstheValueTRUE lm someMethod The problem is that this shouldreceive validation fails with expected subject to receive setAllowsBackgroundLocationUpdates exactly time but received it times Interestingly enough if I replace the CLLocationManager nullMock with a regular mock CLLocationManager mock I get the following error KWMockException mock received unexpected message setAllowsBackgroundLocationUpdates raised So it seems to me like the mapping of theValueTRUE is not working correctly here Is there a way to stop tests execution if any test is failed My first couple tests are checking for correct app setup and if there something wrong server is down or an error occurred I have no need to continue testing because all other test will fail for sure Hi ecaselles Thanks for the implement of sharedExample this is useful for me But when I used it I face some question Is possible used a sharedExample in another sharedExample malloc error for object x d e Invalid pointer dequeued from free list set a breakpoint in mallocerrorbreak to debug thread queue comapplemainthread stop reason signal SIGABRT frame x d libsystemkerneldylibpthreadkill frame x libsystempthreaddylibpthreadkill frame x e f libsystemcdylibabort frame x ab libsystemmallocdylibnanozoneerror frame x be libsystemmallocdylibnanomalloccheckclear frame x b d libsystemmallocdylibnanocalloc frame x e libsystemmallocdylibmalloczonecalloc frame x libsystemmallocdylibcalloc frame x dfb c libobjcAdyliballocateBucketsunsigned int frame x dfb b f libobjcAdylibcachetreallocateunsigned int unsigned int frame x dfb f a libobjcAdylibcachefill frame x dfc libobjcAdyliblookUpImpOrForward frame x dfcf libobjcAdylibobjcmsgSenduncached frame x a KiwiKWInterceptClassForCanonicalClasscanonicalClassXXXXXXXXXXXXXXX at KWInterceptm frame x a a KiwiKWSetupObjectInterceptSupportanObject x ada ab at KWInterceptm frame x b Kiwi NSObjectselfXXXXXXXXXXXXXXX cmdstubMessagePatternandReturnoverrideExisting aMessagePattern x ea aValue x d b overrideYES stubMessagePatternandReturnoverrideExisting at NSObjectKiwiStubAdditionsm frame x Kiwi NSObjectselfYNWireframeManager cmdstubMessagePatternandReturn aMessagePattern x ea aValue x d b stubMessagePatternandReturn at NSObjectKiwiStubAdditionsm frame x f fb Kiwi NSObjectselfXXXXXXXXXXXXXXX cmdstubandReturn aSelectorsharedManager aValue x d b stubandReturn at NSObjectKiwiStubAdditionsm 