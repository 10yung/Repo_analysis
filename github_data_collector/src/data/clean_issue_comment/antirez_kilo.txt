Still under kloc change style if this pull request will be approved whole file style will change to kernel style in less than one week There is a heap overflow caused by integer overflow in kiloc POC python c print t exp In command line make CCclang fsanitizeaddress kilo exp Output ERROR AddressSanitizer heapbufferoverflow on address x at pc x f bp x ffd fe sp x ffd fe WRITE of size at x thread T x f homekirinkilokilo x f x fde homekirinkilokilo x fde x ae homekirinkilokilo x ae x homekirinkilokilo x x f a a b libx linuxgnulibcso x b x c homekirinkilokilo x c x is located bytes to the right of byte region x x allocated by thread T here x d homekirinkilokilo x d x f e homekirinkilokilo x f e x fde homekirinkilokilo x fde x ae homekirinkilokilo x ae x homekirinkilokilo x x f a a b libx linuxgnulibcso x b SUMMARY AddressSanitizer heapbufferoverflow homekirinkilokilo x f Shadow bytes around the buggy address x c fff fb x c fff fc x c fff fd x c fff fe x c fff ff x c fff fa fa fa fa fa x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa x c fff fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend one shadow byte represents application bytes Addressable Partially addressable Heap left redzone fa Freed heap region fd Stack left redzone f Stack mid redzone f Stack right redzone f Stack after return f Stack use after scope f Global redzone f Global init order f Poisoned by user f Container overflow fc Array cookie ac Intra object redzone bb ASan internal fe Left alloca redzone ca Right alloca redzone cb ABORTING Analyze There is an integer overflow in function editorUpdateRow for j j rowsize j if rowchars j TAB tabs rowrender mallocrowsize tabs nonprint idx for j j rowsize j if rowchars j TAB rowrender idx The space size being malloc will be calculated based on the number of TABs in one row When the number of TAB is too bigit will lead to Integer Overflow And it will lead to heapbufferoverflow finally I tried to debug the program using GDB and VS Code but since the code uses escape sequences on Terminal for display it can interfere with GDB output For example when a program calls write x b n GDB will just hang there and not continue How can I debug in this case Thanks just for the records Fedora release gcc GCC Red Hat In file included from usrincludetermiosh from kiloc usrincludefeaturesh warning warning BSDSOURCE and SVIDSOURCE are deprecated use DEFAULTSOURCE Wcpp warning BSDSOURCE and SVIDSOURCE are deprecated use DEFAULTSOURCE kiloc In function editorRefreshScreen kiloc warning implicit declaration of function time did you mean tee Wimplicitfunctiondeclaration if msglen timeNULLEstatusmsgtime tee I get an error when kilo is compiled but why does it work Why is that The compiler I are using is Clang this picture is a from original version img width alt src this picture is a fixed version img width alt src The only need for BSDSOURCE is a single use of the trivial but nonstandard strdup The only need for GNUSOURCE is for getline This function was standardized by POSIX years ago so you only need to ask for it with POSIXCSOURCE Also added timeh which is only included by luck via the removed feature test macros This is better than PR because DEFAULTSOURCE isnt needed at all When characters like or are typed in the editor the showable cursor shifts times to the right one time more than it should However the characters typed after this will not appear right before the showable cursor but two or more columns to the left depending on how many nonEnglish characters you have typed I didnt investigate what was causing this problem Call FINDRESTOREHL make a memory leak