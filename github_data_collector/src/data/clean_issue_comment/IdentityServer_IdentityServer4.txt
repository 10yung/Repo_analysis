Hello I have implemented a simple identity server in aspnet core application after local login the page keeps redirecting to login page instead of grants page I know its a simple things which I am missing but cant figure out I do see the idsrv and idsrvsession cookies here is the configuration Startupcs public IServiceProvider ConfigureServicesIServiceCollection services servicesAddMvc servicesConfigureIISOptionsiis iisAuthenticationDisplayName Windows iisAutomaticAuthentication false servicesAddExternalIdentityProvidersConfiguration servicesAddMvcoptions optionsMaxModelValidationErrors return servicesBuildServiceProvidervalidateScopes false public void ConfigureIApplicationBuilder app IHostingEnvironment env ILoggerFactory loggerFactory if envIsDevelopment appUseDeveloperExceptionPage appUseBrowserLink appUseDatabaseErrorPage else loggerFactoryAddLambdaLoggerConfigurationGetLambdaLoggerOptions appUseExceptionHandlerHomeError appUseIdentityServer appUseMvcroutes routesMapRoute name default template controllerHomeactionIndexid public static class ServiceExtensions public static IServiceCollection AddExternalIdentityProvidersthis IServiceCollection services IConfiguration configuration configures the OpenIdConnect handlers to persist the state parameter into the serverside IDistributedCache servicesAddOidcStateDataFormatterCacheaad demoidsrv servicesAddAuthentication AddGoogleGoogle options optionsSignInScheme IdentityConstantsExternalScheme optionsClientId configuration ExternalIdentityProvidersGoogleAppKey optionsClientSecret configuration ExternalIdentityProvidersGoogleAppSecret AddFacebookFacebook options optionsSignInScheme IdentityConstantsExternalScheme optionsClientId configuration ExternalIdentityProvidersFacebookAppKey optionsClientSecret configuration ExternalIdentityProvidersFacebookAppSecret optionsScopeAdduserbirthday optionsScopeAdduserfriends optionsScopeAddreadcustomfriendlists optionsSaveTokens true AddOpenIdConnectaad WPSPublish User options optionsSignInScheme IdentityConstantsExternalScheme optionsSignOutScheme IdentityConstantsExternalScheme optionsAuthority optionsClientId fbd d c f de optionsResponseType idtoken optionsCallbackPath signinaad optionsSignedOutCallbackPath signoutcallbackaad optionsRemoteSignOutPath signoutaad optionsTokenValidationParameters new TokenValidationParameters NameClaimType name RoleClaimType role return services AccountController I am rendering cookies by using AuthenticationProperties props null if AccountOptionsAllowRememberLogin modelRememberLogin props new AuthenticationProperties IsPersistent true ExpiresUtc DateTimeOffsetUtcNowAddAccountOptionsRememberMeLoginDuration issue authentication cookie with subject ID and username await HttpContextSignInAsyncSubjectId Email props ClaimsToArray Bumps EntityFrameworkVersion from to Updates MicrosoftEntityFrameworkCoreSqlServer from to details summaryCommitssummary ul lia href Merge pull request from darcinternalrelease bea b de e f bb li lia href Merged PR internalrelease Update dependencies from dncenginternli lia href Update dependencies from a href lia href Merged PR release Stabilize package versionsli lia href Merge pull request from darcinternalrelease e f df f dli lia href Stabilize package versionsli lia href Merge in release changesli lia href Sort pinned dependency to bottom a href a href lia href Merge pull request from darcinternalrelease b ffbb f e da li lia href Merge pull request from darcinternalrelease ef a e deb f bf li liAdditional commits viewable in a href viewali ul details br Updates MicrosoftEntityFrameworkCoreRelational from to details summaryCommitssummary ul lia href Merge pull request from darcinternalrelease bea b de e f bb li lia href Merged PR internalrelease Update dependencies from dncenginternli lia href Update dependencies from a href lia href Merged PR release Stabilize package versionsli lia href Merge pull request from darcinternalrelease e f df f dli lia href Stabilize package versionsli lia href Merge in release changesli lia href Sort pinned dependency to bottom a href a href lia href Merge pull request from darcinternalrelease b ffbb f e da li lia href Merge pull request from darcinternalrelease ef a e deb f bf li liAdditional commits viewable in a href viewali ul details br Updates MicrosoftEntityFrameworkCoreSqlite from to details summaryCommitssummary ul lia href Merge pull request from darcinternalrelease bea b de e f bb li lia href Merged PR internalrelease Update dependencies from dncenginternli lia href Update dependencies from a href lia href Merged PR release Stabilize package versionsli lia href Merge pull request from darcinternalrelease e f df f dli lia href Stabilize package versionsli lia href Merge in release changesli lia href Sort pinned dependency to bottom a href a href lia href Merge pull request from darcinternalrelease b ffbb f e da li lia href Merge pull request from darcinternalrelease ef a e deb f bf li liAdditional commits viewable in a href viewali ul details br Updates MicrosoftEntityFrameworkCoreInMemory from to details summaryCommitssummary ul lia href Merge pull request from darcinternalrelease bea b de e f bb li lia href Merged PR internalrelease Update dependencies from dncenginternli lia href Update dependencies from a href lia href Merged PR release Stabilize package versionsli lia href Merge pull request from darcinternalrelease e f df f dli lia href Stabilize package versionsli lia href Merge in release changesli lia href Sort pinned dependency to bottom a href a href lia href Merge pull request from darcinternalrelease b ffbb f e da li lia href Merge pull request from darcinternalrelease ef a e deb f bf li liAdditional commits viewable in a href viewali ul details br Updates MicrosoftEntityFrameworkCoreDesign from to details summaryCommitssummary ul lia href Merge pull request from darcinternalrelease bea b de e f bb li lia href Merged PR internalrelease Update dependencies from dncenginternli lia href Update dependencies from a href lia href Merged PR release Stabilize package versionsli lia href Merge pull request from darcinternalrelease e f df f dli lia href Stabilize package versionsli lia href Merge in release changesli lia href Sort pinned dependency to bottom a href a href lia href Merge pull request from darcinternalrelease b ffbb f e da li lia href Merge pull request from darcinternalrelease ef a e deb f bf li liAdditional commits viewable in a href viewali ul details br Dependabot will resolve any conflicts with this PR as long as you dont alter it yourself You can also trigger a rebase manually by commenting dependabot rebase dependabotautomergestart dependabotautomergeend details summaryDependabot commands and optionssummary br You can trigger Dependabot actions by commenting on this PR dependabot rebase will rebase this PR dependabot recreate will recreate this PR overwriting any edits that have been made to it dependabot merge will merge this PR after your CI passes on it dependabot squash and merge will squash and merge this PR after your CI passes on it dependabot cancel merge will cancel a previously requested merge and block automerging dependabot reopen will reopen this PR if it is closed dependabot close will close this PR and stop Dependabot recreating it You can achieve the same result by closing it manually dependabot ignore this major version will close this PR and stop Dependabot creating any more for this major version unless you reopen the PR or upgrade to it yourself dependabot ignore this minor version will close this PR and stop Dependabot creating any more for this minor version unless you reopen the PR or upgrade to it yourself dependabot ignore this dependency will close this PR and stop Dependabot creating any more for this dependency unless you reopen the PR or upgrade to it yourself dependabot use these labels will set the current labels as the default for future PRs for this repo and language dependabot use these reviewers will set the current reviewers as the default for future PRs for this repo and language dependabot use these assignees will set the current assignees as the default for future PRs for this repo and language dependabot use this milestone will set the current milestone as the default for future PRs for this repo and language dependabot badge me will comment on this PR with code to add a Dependabot enabled badge to your readme Additionally you can set the following in your Dependabot dashboard Update frequency including time of day and day of week Pull request limits per update run andor open at any time Outofrange updates receive only lockfile updates if desired Security updates receive only security updates if desired details Bumps ExtensionsVersion from to Updates MicrosoftExtensionsCachingMemory from to details summaryCommitssummary ul lia href Merge in release changesli lia href Move MicrosoftNETPlatforms above pinned a href lia href Merge in release changesli lia href Set IsShippingfalse for all TestingUtils projects a href lia href Merge remotetracking branch upstreamrelease into internalrelease li lia href Sort pinned dependency at bottom a href a href lia href Merge in release changesli lia href Stabilize package versions a href lia href Merge pull request from darcinternalrelease ffe f bc f b bli lia href Update dependencies from a href build li liAdditional commits viewable in a href viewali ul details br Updates MicrosoftExtensionsHttp from to details summaryCommitssummary ul lia href Merge in release changesli lia href Move MicrosoftNETPlatforms above pinned a href lia href Merge in release changesli lia href Set IsShippingfalse for all TestingUtils projects a href lia href Merge remotetracking branch upstreamrelease into internalrelease li lia href Sort pinned dependency at bottom a href a href lia href Merge in release changesli lia href Stabilize package versions a href lia href Merge pull request from darcinternalrelease ffe f bc f b bli lia href Update dependencies from a href build li liAdditional commits viewable in a href viewali ul details br Updates MicrosoftExtensionsHttpPolly from to details summaryCommitssummary ul lia href Merge in release changesli lia href Move MicrosoftNETPlatforms above pinned a href lia href Merge in release changesli lia href Set IsShippingfalse for all TestingUtils projects a href lia href Merge remotetracking branch upstreamrelease into internalrelease li lia href Sort pinned dependency at bottom a href a href lia href Merge in release changesli lia href Stabilize package versions a href lia href Merge pull request from darcinternalrelease ffe f bc f b bli lia href Update dependencies from a href build li liAdditional commits viewable in a href viewali ul details br Updates MicrosoftExtensionsLogging from to details summaryCommitssummary ul lia href Merge in release changesli lia href Move MicrosoftNETPlatforms above pinned a href lia href Merge in release changesli lia href Set IsShippingfalse for all TestingUtils projects a href lia href Merge remotetracking branch upstreamrelease into internalrelease li lia href Sort pinned dependency at bottom a href a href lia href Merge in release changesli lia href Stabilize package versions a href lia href Merge pull request from darcinternalrelease ffe f bc f b bli lia href Update dependencies from a href build li liAdditional commits viewable in a href viewali ul details br Updates MicrosoftExtensionsLoggingConsole from to details summaryCommitssummary ul lia href Merge in release changesli lia href Move MicrosoftNETPlatforms above pinned a href lia href Merge in release changesli lia href Set IsShippingfalse for all TestingUtils projects a href lia href Merge remotetracking branch upstreamrelease into internalrelease li lia href Sort pinned dependency at bottom a href a href lia href Merge in release changesli lia href Stabilize package versions a href lia href Merge pull request from darcinternalrelease ffe f bc f b bli lia href Update dependencies from a href build li liAdditional commits viewable in a href viewali ul details br Updates MicrosoftExtensionsOptionsConfigurationExtensions from to details summaryCommitssummary ul lia href Merge in release changesli lia href Move MicrosoftNETPlatforms above pinned a href lia href Merge in release changesli lia href Set IsShippingfalse for all TestingUtils projects a href lia href Merge remotetracking branch upstreamrelease into internalrelease li lia href Sort pinned dependency at bottom a href a href lia href Merge in release changesli lia href Stabilize package versions a href lia href Merge pull request from darcinternalrelease ffe f bc f b bli lia href Update dependencies from a href build li liAdditional commits viewable in a href viewali ul details br Dependabot will resolve any conflicts with this PR as long as you dont alter it yourself You can also trigger a rebase manually by commenting dependabot rebase dependabotautomergestart dependabotautomergeend details summaryDependabot commands and optionssummary br You can trigger Dependabot actions by commenting on this PR dependabot rebase will rebase this PR dependabot recreate will recreate this PR overwriting any edits that have been made to it dependabot merge will merge this PR after your CI passes on it dependabot squash and merge will squash and merge this PR after your CI passes on it dependabot cancel merge will cancel a previously requested merge and block automerging dependabot reopen will reopen this PR if it is closed dependabot close will close this PR and stop Dependabot recreating it You can achieve the same result by closing it manually dependabot ignore this major version will close this PR and stop Dependabot creating any more for this major version unless you reopen the PR or upgrade to it yourself dependabot ignore this minor version will close this PR and stop Dependabot creating any more for this minor version unless you reopen the PR or upgrade to it yourself dependabot ignore this dependency will close this PR and stop Dependabot creating any more for this dependency unless you reopen the PR or upgrade to it yourself dependabot use these labels will set the current labels as the default for future PRs for this repo and language dependabot use these reviewers will set the current reviewers as the default for future PRs for this repo and language dependabot use these assignees will set the current assignees as the default for future PRs for this repo and language dependabot use this milestone will set the current milestone as the default for future PRs for this repo and language dependabot badge me will comment on this PR with code to add a Dependabot enabled badge to your readme Additionally you can set the following in your Dependabot dashboard Update frequency including time of day and day of week Pull request limits per update run andor open at any time Outofrange updates receive only lockfile updates if desired Security updates receive only security updates if desired details We want to give the ability to an User to revoke the refreshtokenlogin for a specific deviceapp So it would be nice to have the useragent of that to device to be able to determine the used device Describe the solution youd like Add a new Column Useragent to the PersistedGrants table and fill it when a new token gets saved into it Is this something that is interesting to implement it here or should it be better done by the consumer of identityserver I am working on finding the equivalents of Identity Server IUserService functionality in Identity Server The recommended path seems to be to use IProfileService and IResourceOwnerPasswordValidator However IResourceOwnerPasswordValidator does not appear to work for Implicit and other standard work flows Is there an alternative I have been reading the documents and so far I have not come up with the Identity Server equivalent of IUserServices AuthenticateExternalAsync and AuthenticateLocalAsync methods What issue does this PR address Added footnote about registering your own ASPNET Identity IUserClaimsPrincipalFactory Addresses Does this PR introduce a breaking change No Please check if the PR fulfills these requirements x The commit follows our guidelines Unit Tests for the changes have been added for bug fixes features What issue does this PR address Addresses race condition reported in Does this PR introduce a breaking change No Please check if the PR fulfills these requirements x The commit follows our guidelines x Unit Tests for the changes have been added for bug fixes features Reminder to compare check and update hostQS UI to match latest MVC template What issue does this PR address Adds notification for device codes being cleaned up Does this PR introduce a breaking change Yes Please check if the PR fulfills these requirements x The commit follows our guidelines Unit Tests for the changes have been added for bug fixes features 