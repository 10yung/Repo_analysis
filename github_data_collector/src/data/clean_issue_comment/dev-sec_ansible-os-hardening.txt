This PR makes the role compatible with ArchLinux systems Im a bit new to Ansible but experienced with coding and CM tools in general so I could be wrong here It appears that the check for the UIDMIN value in logindefs assigns a data object JSON to the uidmin variable regardless of whether the file exists or not Therefore the test for when uidmin is defined ALWAYS passes The other tests for when not uidmin NEVER pass since the variable always has some value Also even if the two tasks to set uidmax were able to run they would likely always set the value for ANY system to Even though Debian systems have more specific logic that task comes first so the value may get set to but the very next task will still set it to when logindefs does not exist Is your feature request related to a problem Please describe Currently in the default audit logs from this project theres a ton of events with auid which is because they start before the audit daemon is up ausearch uideffective justone timeTue Jan typeDAEMONSTART msgaudit opstart ver formatraw kernel amd auid pid uid ses subjunconfined ressuccess Describe the solution youd like Add audit as an additional grub kernel parameter Describe alternatives youve considered NA at that time Additional context See NOTES A boot param of audit should be added to ensure that all processes that run before the audit daemon starts is marked as auditable by the kernel Not doing that will make a few processes impossible to properly audit Describe the bug Modifying etcpamdsystemauthac as seen here is wrong as it breaks the authconfig way Apparently a symptom was also witnessed in Normally the file begins with PAM This file is autogenerated User changes will be destroyed the next time authconfig is run Which quite clearly states that you shouldnt go modify it Expected behavior Configure PAM in RHCentOS as it is supposed to by using etcpamdsystemauthlocal and including from systemauthac as instructed here and in SYSTEMAUTHAC EXAMPLE Configure system to use pamtally for configuration of maximum number of failed logins Also call pamaccess to verify if access is allowed Make systemauth symlink point to systemauthlocal which contains auth requisite pamaccessso auth requisite pamtally so deny locktime unlocktime auth include systemauthac account required pamtally so account include systemauthac password include systemauthac session include systemauthac Actual behavior Hardening PAM by writing to a system managed configuration file etcpamdsystemauthac Running authconfig updateall will remove the abovementioned hardening OS Environment RHCentOS Seems this doesnt support OpenSUSE Tumbleweed yet maybe we could get this included This fixes Describe the bug The packer build fails with a nonzero exist status Expected behavior Ansible runs with errors Actual behavior Paste verbatim command output between quotes vagrant TASK devsecoshardening remove pamcracklib because it does not play nice with passwdqc vagrant fatal default FAILED msg The conditional check ansibleosfamily RedHat and ansibledistributionversion is versioncompare and not ansibledistribution Amazon and osauthpampasswdqcenable failed The error was Version comparison not supported between instances of str and int n nThe error appears to have been in Usersrfinchansiblerolesdevsecoshardeningtaskspamyml line column but may nbe elsewhere in the file depending on the exact syntax problem n nThe offending line appears to be n n n name remove pamcracklib because it does not play nice with passwdqc n here n Example Playbook Paste an example playbook that can be used to reproduce the problem between quotes hosts all roles devsecoshardening OS Environment Mac OS X Ansible Version Paste verbatim output from ansible version between quotes ansible config file None configured module search path Usersrfinchansiblepluginsmodules usrshareansiblepluginsmodules ansible python module location usrlocallibpython sitepackagesansible executable location usrlocalbinansible python version default Sep Clang clang Role Version Paste version of the role between quotes latest Additional context The problem is due to the order of checks in some when clauses in taskspamyaml It is attempting to do a numerical comparison on an Amazon linux version string I have a PR upcoming that will demonstrate the problem and fix it Describe the bug After executing the role a permission error appears see below Expected behavior I would like to be able to disable certain parts of the role Actual behavior Paste verbatim command output between quotes failed xxxx itemkey netipv tcptimestamps value ansibleloopvar item changed false item key netipv tcptimestamps value msg Failed to reload sysctl netipv ipforward nnetipv confallforwarding nnetipv confallacceptra nnetipv confdefaultacceptra nnetipv confallrpfilter nnetipv confdefaultrpfilter nnetipv icmpechoignorebroadcasts nnetipv icmpignoreboguserrorresponses nnetipv icmpratelimit nnetipv icmpratemask nnetipv confalldisableipv nnetipv confallarpignore nnetipv confallarpannounce nnetipv confallsharedmedia nnetipv confdefaultsharedmedia nnetipv confallacceptsourceroute nnetipv confdefaultacceptsourceroute nnetipv confdefaultacceptredirects nnetipv confallacceptredirects nnetipv confallsecureredirects nnetipv confdefaultsecureredirects nnetipv confdefaultacceptredirects nnetipv confallacceptredirects nnetipv confallsendredirects nnetipv confdefaultsendredirects nnetipv confalllogmartians nnetipv confdefaultlogmartians nnetipv confdefaultroutersolicitations nnetipv confdefaultacceptrartrpref nnetipv confdefaultacceptrapinfo nnetipv confdefaultacceptradefrtr nnetipv confdefaultautoconf nnetipv confdefaultdadtransmits nnetipv confdefaultmaxaddresses nkernelrandomizevaspace nvmmmapminaddr nsysctl permission denied on key netipv tcptimestamps nsysctl permission denied on key netipv tcprfc nsysctl permission denied on key kernelsysrq nsysctl permission denied on key fssuiddumpable nsysctl permission denied on key kernelcoreusespid nsysctl permission denied on key kernelkptrrestrict n failed xxxx itemkey netipv tcprfc value ansibleloopvar item changed false item key netipv tcprfc value msg Failed to reload sysctl netipv ipforward nnetipv confallforwarding nnetipv confallacceptra nnetipv confdefaultacceptra nnetipv confallrpfilter nnetipv confdefaultrpfilter nnetipv icmpechoignorebroadcasts nnetipv icmpignoreboguserrorresponses nnetipv icmpratelimit nnetipv icmpratemask nnetipv confalldisableipv nnetipv confallarpignore nnetipv confallarpannounce nnetipv confallsharedmedia nnetipv confdefaultsharedmedia nnetipv confallacceptsourceroute nnetipv confdefaultacceptsourceroute nnetipv confdefaultacceptredirects nnetipv confallacceptredirects nnetipv confallsecureredirects nnetipv confdefaultsecureredirects nnetipv confdefaultacceptredirects nnetipv confallacceptredirects nnetipv confallsendredirects nnetipv confdefaultsendredirects nnetipv confalllogmartians nnetipv confdefaultlogmartians nnetipv confdefaultroutersolicitations nnetipv confdefaultacceptrartrpref nnetipv confdefaultacceptrapinfo nnetipv confdefaultacceptradefrtr nnetipv confdefaultautoconf nnetipv confdefaultdadtransmits nnetipv confdefaultmaxaddresses nkernelrandomizevaspace nvmmmapminaddr nsysctl permission denied on key netipv tcptimestamps nsysctl permission denied on key netipv tcprfc nsysctl permission denied on key kernelsysrq nsysctl permission denied on key fssuiddumpable nsysctl permission denied on key kernelcoreusespid nsysctl permission denied on key kernelkptrrestrict n OS Environment Debian Jessie amd running on OpenVZ I actually think that OpenVZ is my real issue here Maybe it is possible to detect that and ignore some of the parts when running on top of OpenVZ Ansible Version Paste verbatim output from ansible version between quotes paste below ansible config file etcansibleansiblecfg configured module search path homexxxxansiblepluginsmodules usrshareansiblepluginsmodules ansible python module location usrlibpython sitepackagesansible executable location usrbinansible python version default Jul GCC I am running on Arch Linux with the latest updates applied Fixes System user UID range was extended from to In the template rhelsystemauthj there is a harcoded I think there should be a variable with the max system UID number or depending the OS version and use that variable instead of the hardcoded here and here Or maybe dont define a new variable and just use osauthuidmin In both cases the variable must be defined in the OS specific version var file Redhat and Redhat instead of the general Redhat I can submit a PR with the changes once I get feedback from this CC rndmh ro 