 This is a draft for percentile computation Usually the average query time is not very useful while percentile can give more insights about slow queries In this PR I use sampling for query times this is not a very efficient algorithm like Tdigest I think in future we will implement something more precise Im looking into this project for production use and one thing Im not sure about is how we can get monitoring data out of this system We currently use pgbouncer and the pgbouncerexporter to monitor it in Prometheus Is there a similar level of functionality here Would it be possible for Odyssey to expose Prometheus data directly OS info cat etcredhatrelease CentOS Linux release Core uname a Linux node el x SMP Fri Feb UTC x x x GNULinux rootnode build cmake version cmake version CMake suite maintained and supported by Kitware kitwarecomcmake rootnode build gcc version gcc GCC Red Hat Copyright C Free Software Foundation Inc This is free software see the source for copying conditions There is NO warranty not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE rootnode opt git clone Cloning into odyssey remote Enumerating objects done remote Counting objects done remote Compressing objects done remote Total delta reused delta packreused Receiving objects MiB KiBs done Resolving deltas done rootnode opt cd odyssey rootnode odyssey mkdir p build rootnode odyssey cd build rootnode build cd optapppg bin include lib share rootnode build cd optapppg C rootnode build cmake DPOSTGRESQLLIBRARYoptapppg lib DPOSTGRESQLINCLUDEDIRoptapppg include DPQLIBRARYoptapppg lib DCMAKEBUILDTYPERelease The C compiler identification is GNU Check for working C compiler bincc Check for working C compiler bincc works Detecting C compiler ABI info Detecting C compiler ABI info done Detecting C compile features Detecting C compile features done Looking for pthreadh Looking for pthreadh found Performing Test CMAKEHAVELIBCPTHREAD Performing Test CMAKEHAVELIBCPTHREAD Failed Looking for pthreadcreate in pthreads Looking for pthreadcreate in pthreads not found Looking for pthreadcreate in pthread Looking for pthreadcreate in pthread found Found Threads TRUE Found POSTGRESQL optapppg lib Found OpenSSL usrlib libcryptoso found version k Found PAM usrlib libpamso Use shipped libmachinarium optodysseythirdpartymachinarium Use shipped libkiwi optodysseythirdpartykiwi Odyssey version eb release CMAKEBUILDTYPE Release BUILDDEBIAN OFF POSTGRESQLINCLUDEDIR optapppg include POSTGRESQLLIBRARY optapppg lib PQLIBRARY optapppg lib USEBORINGSSL OFF BORINGSSLROOTDIR BORINGSSLINCLUDEDIR OPENSSLVERSION k OPENSSLROOTDIR OPENSSLINCLUDEDIR usrinclude PAMLIBRARY usrlib libpamso PAMINCLUDEDIR usrincludesecurity Configuring done WARNING Target odyssey requests linking to directory optapppg lib Targets may link only to libraries CMake is dropping the item WARNING Target odyssey requests linking to directory optapppg lib Targets may link only to libraries CMake is dropping the item WARNING Target odysseytest requests linking to directory optapppg lib Targets may link only to libraries CMake is dropping the item WARNING Target odysseytest requests linking to directory optapppg lib Targets may link only to libraries CMake is dropping the item WARNING Target odysseystress requests linking to directory optapppg lib Targets may link only to libraries CMake is dropping the item WARNING Target odysseystress requests linking to directory optapppg lib Targets may link only to libraries CMake is dropping the item Generating done Build files have been written to optodysseybuild rootnode build make Scanning dependencies of target libkiwi Generating thirdpartykiwikiwilibkiwia The C compiler identification is GNU Check for working C compiler bincc Check for working C compiler bincc works Detecting C compiler ABI info Detecting C compiler ABI info done Detecting C compile features Detecting C compile features done Kiwi PostgreSQL protocol interaction library CMAKEBUILDTYPE Release MACHINARIUMINCLUDEDIRS optodysseythirdpartymachinariumsources MACHINARIUMLIBRARIES optodysseybuildthirdpartymachinariumsourceslibmachinariuma Configuring done Generating done Build files have been written to optodysseybuildthirdpartykiwi Scanning dependencies of target kwlibrarystatic Building C object kiwiCMakeFileskwlibrarystaticdirmd co Linking C static library libkiwia Built target kwlibrarystatic Built target libkiwi Scanning dependencies of target libmachinarium Generating thirdpartymachinariumsourceslibmachinariuma The C compiler identification is GNU Check for working C compiler bincc Check for working C compiler bincc works Detecting C compiler ABI info Detecting C compiler ABI info done Detecting C compile features Detecting C compile features done Looking for pthreadh Looking for pthreadh found Performing Test CMAKEHAVELIBCPTHREAD Performing Test CMAKEHAVELIBCPTHREAD Failed Looking for pthreadcreate in pthreads Looking for pthreadcreate in pthreads not found Looking for pthreadcreate in pthread Looking for pthreadcreate in pthread found Found Threads TRUE Found OpenSSL usrlib libcryptoso found version k Machinarium Cooperative multitasking framework CMAKEBUILDTYPE Release BUILDSHARED OFF BUILDVALGRIND ON USEBORINGSSL OFF BORINGSSLROOTDIR BORINGSSLINCLUDEDIR OPENSSLVERSION k OPENSSLROOTDIR OPENSSLINCLUDEDIR usrinclude Configuring done Generating done Build files have been written to optodysseybuildthirdpartymachinarium Scanning dependencies of target machinelibrarystatic Building C object sourcesCMakeFilesmachinelibrarystaticdirthreadco Building C object sourcesCMakeFilesmachinelibrarystaticdirpgrand co Building C object sourcesCMakeFilesmachinelibrarystaticdirlrand co Building C object sourcesCMakeFilesmachinelibrarystaticdirloopco Building C object sourcesCMakeFilesmachinelibrarystaticdirclockco optodysseybuildthirdpartymachinariumsourcesclockc warning mmclocklistissorted defined but not used Wunusedfunction static int mmclocklistissortedmmtimert list int count Building C object sourcesCMakeFilesmachinelibrarystaticdirsocketco Building C object sourcesCMakeFilesmachinelibrarystaticdirepollco Building C object sourcesCMakeFilesmachinelibrarystaticdircontextstackco Building C object sourcesCMakeFilesmachinelibrarystaticdircontextco Building C object sourcesCMakeFilesmachinelibrarystaticdircoroutineco Building C object sourcesCMakeFilesmachinelibrarystaticdircoroutinecacheco Building C object sourcesCMakeFilesmachinelibrarystaticdirschedulerco Building C object sourcesCMakeFilesmachinelibrarystaticdircallco Building C object sourcesCMakeFilesmachinelibrarystaticdirsignalmgrco Building C object sourcesCMakeFilesmachinelibrarystaticdireventmgrco Building C object sourcesCMakeFilesmachinelibrarystaticdirmachineco Building C object sourcesCMakeFilesmachinelibrarystaticdirmmco Building C object sourcesCMakeFilesmachinelibrarystaticdirmachinemgrco Building C object sourcesCMakeFilesmachinelibrarystaticdirmsgcacheco Building C object sourcesCMakeFilesmachinelibrarystaticdirmsgco Building C object sourcesCMakeFilesmachinelibrarystaticdirchannelfastco Building C object sourcesCMakeFilesmachinelibrarystaticdirchannelco Building C object sourcesCMakeFilesmachinelibrarystaticdirchannelapico Building C object sourcesCMakeFilesmachinelibrarystaticdirtaskmgrco Building C object sourcesCMakeFilesmachinelibrarystaticdirtlsco Building C object sourcesCMakeFilesmachinelibrarystaticdirioco Building C object sourcesCMakeFilesmachinelibrarystaticdiriovco Building C object sourcesCMakeFilesmachinelibrarystaticdircloseco Building C object sourcesCMakeFilesmachinelibrarystaticdirconnectco Building C object sourcesCMakeFilesmachinelibrarystaticdirbindco Building C object sourcesCMakeFilesmachinelibrarystaticdireventfdco Building C object sourcesCMakeFilesmachinelibrarystaticdircondco Building C object sourcesCMakeFilesmachinelibrarystaticdirreadco Building C object sourcesCMakeFilesmachinelibrarystaticdirwriteco Building C object sourcesCMakeFilesmachinelibrarystaticdiracceptco Building C object sourcesCMakeFilesmachinelibrarystaticdirdnsco Linking C static library libmachinariuma Built target machinelibrarystatic Built target libmachinarium Scanning dependencies of target buildlibs Built target buildlibs Scanning dependencies of target odyssey Building C object sourcesCMakeFilesodysseydirdaemonco In file included from optodysseysourcesodysseyh from optodysseysourcesdaemonc optodysseysourcespostgresh fatal error commonbase h No such file or directory include commonbase h compilation terminated make sourcesCMakeFilesodysseydirdaemonco Error make sourcesCMakeFilesodysseydirall Error make all Error Hello Problem There is no access to the public schema of another users database When connecting to a postgresql server without odyssey there is access Users are postgres superuser and zabbix The zabbix user is the owner of the zabbix database When connecting via odyssey by postgres you cannot read the public schema of the zabbix database Connect to postgresql server without odyssey roothlpgconpool psql h p U postgres d zabbix c d head n Password for user postgres List of relations Schema Name Type Owner public acknowledges table zabbix public actions table zabbix public alerts table zabbix Connect to postgresql server via odyssey roothlpgconpool psql h p U postgres d zabbix c d head n Password for user postgres Did not find any relations roothlpgconpool psql h p U zabbix d zabbix c d head n Password for user zabbix List of relations Schema Name Type Owner public acknowledges table zabbix public actions table zabbix public alerts table zabbix At the same time with any attempt to log in by any user in the logs the following messages Dec hlpgconpool odyssey Dec error c b b d a f none user zabbix db zabbix auth read error Resource temporarily unavailable Dec hlpgconpool odyssey Dec error ce c none user postgres db zabbix auth read error Resource temporarily unavailable Dec hlpgconpool odyssey Dec error cf fc a none user zabbix db zabbix auth read error Resource temporarily unavailable I use Centos odyssey rpm package compiled with pgsql PGDG odyssey version roothlpgconpool odyssey git log n commit f ab d c d d cab b Author Dima Starkov dvstarkyandexru Date Sun Nov Add integration tests for SCRAM Authentication Add integration tests for SCRAM Authentication Made tests independent of the postgresql version configuration file SERVICE daemonize no priority pidfile varrunodysseypid unixsocketdir tmp unixsocketmode LOGGING logfile varlogodysseylog logformat p t l i s user u db d c m n logconfig yes logdebug yes logsession yes logquery yes logstats yes logdebug no logsession no logquery no logstats no statsinterval statsinterval PERFORMANCE workers resolvers readahead cachecoroutine nodelay yes keepalive GLOBAL LIMITS clientmax clientmaxrouting LISTEN listen tls disable host port port ROUTING storage local type local tls disable database console user odyssey authentication none authentication md password odyssey pool session storage local storage postgresserver type remote tls disable host port database postgres user postgres authentication md password postgrespassword storage postgresserver storageuser postgres storagepassword postgrespassword pool session clientmax poolsize pooltimeout poolttl poolcancel yes pooldiscard yes poolrollback yes clientfwderror yes logdebug no database zabbix user postgres authentication md password postgrespassword storage postgresserver storageuser postgres storagedb postgres storagepassword postgrespassword pool transaction pool session clientmax poolsize pooltimeout poolttl poolcancel yes pooldiscard no pooldiscard yes poolrollback yes clientfwderror yes logdebug no user zabbix authentication md password zabbixpassword storage postgresserver storageuser zabbix storagepassword zabbixpassword pool transaction pool session clientmax poolsize pooltimeout poolttl poolcancel yes pooldiscard no pooldiscard yes poolrollback yes clientfwderror yes logdebug no Trying to build on CentOS on dev machine getting this error OS Info Linux my el x SMP Mon Jul UTC x x x GNULinux GNULinux cmake version gcc GCC Red Hat openssl version k Postgres Pro Standard select version PostgreSQL on x pclinuxgnu compiled by gcc GCC Red Hat bit Steps to reproduce rootmy build pwd vartmp rootmy tmp git clone gitgithubcomyandexodysseygit Cloning into odyssey remote Enumerating objects done remote Counting objects done remote Compressing objects done remote Total delta reused delta packreused Receiving objects MiB KiBs done Resolving deltas done rootmy tmp cd odyssey rootmy odyssey mkdir build rootmy odyssey cd build rootmy build cmake DPOSTGRESQLLIBRARYoptpgprostd libplpgsqlso DPOSTGRESQLINCLUDEDIRoptpgprostd binpsql DCMAKEBUILDTYPERelease The C compiler identification is GNU Check for working C compiler bincc Check for working C compiler bincc works Detecting C compiler ABI info Detecting C compiler ABI info done Looking for include file pthreadh Looking for include file pthreadh found Looking for pthreadcreate Looking for pthreadcreate not found Looking for pthreadcreate in pthreads Looking for pthreadcreate in pthreads not found Looking for pthreadcreate in pthread Looking for pthreadcreate in pthread found Found Threads TRUE Found POSTGRESQL optpgprostd libplpgsqlso Found OpenSSL usrlib libsslsousrlib libcryptoso found version k Found PAM usrlib libpamso Use shipped libmachinarium vartmpodysseythirdpartymachinarium Use shipped libkiwi vartmpodysseythirdpartykiwi Odyssey version a release CMAKEBUILDTYPE Release BUILDDEBIAN OFF POSTGRESQLINCLUDEDIR optpgprostd binpsql POSTGRESQLLIBRARY optpgprostd libplpgsqlso USEBORINGSSL OFF BORINGSSLROOTDIR BORINGSSLINCLUDEDIR OPENSSLVERSION k OPENSSLROOTDIR OPENSSLINCLUDEDIR usrinclude PAMLIBRARY usrlib libpamso PAMINCLUDEDIR usrincludesecurity Configuring done Generating done Build files have been written to vartmpodysseybuild rootmy build make Scanning dependencies of target libkiwi Generating thirdpartykiwikiwilibkiwia The C compiler identification is GNU Check for working C compiler bincc Check for working C compiler bincc works Detecting C compiler ABI info Detecting C compiler ABI info done Kiwi PostgreSQL protocol interaction library CMAKEBUILDTYPE Release MACHINARIUMINCLUDEDIRS vartmpodysseythirdpartymachinariumsources MACHINARIUMLIBRARIES vartmpodysseybuildthirdpartymachinariumsourceslibmachinariuma Configuring done Generating done Build files have been written to vartmpodysseybuildthirdpartykiwi Scanning dependencies of target kwlibrarystatic Building C object kiwiCMakeFileskwlibrarystaticdirmd co Linking C static library libkiwia Built target kwlibrarystatic Built target libkiwi Scanning dependencies of target libmachinarium Generating thirdpartymachinariumsourceslibmachinariuma The C compiler identification is GNU Check for working C compiler bincc Check for working C compiler bincc works Detecting C compiler ABI info Detecting C compiler ABI info done Looking for include file pthreadh Looking for include file pthreadh found Looking for pthreadcreate Looking for pthreadcreate not found Looking for pthreadcreate in pthreads Looking for pthreadcreate in pthreads not found Looking for pthreadcreate in pthread Looking for pthreadcreate in pthread found Found Threads TRUE Found OpenSSL usrlib libsslsousrlib libcryptoso found version k Machinarium Cooperative multitasking framework CMAKEBUILDTYPE Release BUILDSHARED OFF BUILDVALGRIND ON USEBORINGSSL OFF BORINGSSLROOTDIR BORINGSSLINCLUDEDIR OPENSSLVERSION k OPENSSLROOTDIR OPENSSLINCLUDEDIR usrinclude Configuring done Generating done Build files have been written to vartmpodysseybuildthirdpartymachinarium Scanning dependencies of target machinelibrarystatic Building C object sourcesCMakeFilesmachinelibrarystaticdirthreadco Building C object sourcesCMakeFilesmachinelibrarystaticdirpgrand co Building C object sourcesCMakeFilesmachinelibrarystaticdirlrand co Building C object sourcesCMakeFilesmachinelibrarystaticdirloopco Building C object sourcesCMakeFilesmachinelibrarystaticdirclockco Building C object sourcesCMakeFilesmachinelibrarystaticdirsocketco Building C object sourcesCMakeFilesmachinelibrarystaticdirepollco Building C object sourcesCMakeFilesmachinelibrarystaticdircontextstackco Building C object sourcesCMakeFilesmachinelibrarystaticdircontextco Building C object sourcesCMakeFilesmachinelibrarystaticdircoroutineco Building C object sourcesCMakeFilesmachinelibrarystaticdircoroutinecacheco Building C object sourcesCMakeFilesmachinelibrarystaticdirschedulerco Building C object sourcesCMakeFilesmachinelibrarystaticdircallco Building C object sourcesCMakeFilesmachinelibrarystaticdirsignalmgrco Building C object sourcesCMakeFilesmachinelibrarystaticdireventmgrco Building C object sourcesCMakeFilesmachinelibrarystaticdirmachineco Building C object sourcesCMakeFilesmachinelibrarystaticdirmmco Building C object sourcesCMakeFilesmachinelibrarystaticdirmachinemgrco Building C object sourcesCMakeFilesmachinelibrarystaticdirmsgcacheco Building C object sourcesCMakeFilesmachinelibrarystaticdirmsgco Building C object sourcesCMakeFilesmachinelibrarystaticdirchannelfastco Building C object sourcesCMakeFilesmachinelibrarystaticdirchannelco Building C object sourcesCMakeFilesmachinelibrarystaticdirchannelapico Building C object sourcesCMakeFilesmachinelibrarystaticdirtaskmgrco Building C object sourcesCMakeFilesmachinelibrarystaticdirtlsco Building C object sourcesCMakeFilesmachinelibrarystaticdirioco Building C object sourcesCMakeFilesmachinelibrarystaticdiriovco Building C object sourcesCMakeFilesmachinelibrarystaticdircloseco Building C object sourcesCMakeFilesmachinelibrarystaticdirconnectco Building C object sourcesCMakeFilesmachinelibrarystaticdirbindco Building C object sourcesCMakeFilesmachinelibrarystaticdireventfdco Building C object sourcesCMakeFilesmachinelibrarystaticdircondco Building C object sourcesCMakeFilesmachinelibrarystaticdirreadco Building C object sourcesCMakeFilesmachinelibrarystaticdirwriteco Building C object sourcesCMakeFilesmachinelibrarystaticdiracceptco Building C object sourcesCMakeFilesmachinelibrarystaticdirdnsco Linking C static library libmachinariuma Built target machinelibrarystatic Built target libmachinarium Scanning dependencies of target buildlibs Built target buildlibs Scanning dependencies of target odyssey Building C object sourcesCMakeFilesodysseydirdaemonco cc warning optpgprostd binpsql not a directory enabled by default In file included from vartmpodysseysourcesodysseyh from vartmpodysseysourcesdaemonc vartmpodysseysourcespostgresh fatal error postgresql servercommonbase h No such file or directory include postgresql servercommonbase h compilation terminated make sourcesCMakeFilesodysseydirdaemonco Error make sourcesCMakeFilesodysseydirall Error make all Error rootmy build Subj Ive tried to make formatting as close to current as possible Usage find regex cpp hpp cu c h exec clangformat stylefile i Hello assume you have a powerful machine and about clients or more What would be a good configuration and which parameters can harm Right now I can see that clients are disconnected often Not sure if the problem is on client side or on server side Soe here are some settings that I modified in the odyssey config from git poolsize does it make sense to set this value to zero Wouldnt it be the same like connecting directly to the database workers I think that value is way to high but can it harm resolvers Not sure what they do and what the optimal value should be Are there maybe some parameters that should be modified in the use case that a lot of clients are keeping the SQL connection and fetching or inserting data to the database Also what would be the best way to start odyssey Right now started it from the console Thanks a lot for any hint 