Hi there We are doing stress test for quorumraft We send contract function transactions per second to nodes last for hours Txs to each node In the beginning all the transactions are confirmed But after while one of the raft nodes broadcasts leader change msg all the nodes fall into leader change loop and cant mine the block System information Quorum version v OS Version Ubuntu Expected behaviour Leader change mechanism can exactly decide a leader Actual behaviour The election organizernode cant receive the MsgVoteResp from some other nodes The following is part of the log the raft log and block information are in the repository node raft INFO term received a MsgVote message with higher term from term raft INFO became follower at term raft INFO logterm index vote cast MsgVote for logterm index at term raft INFO raftnode lost leader at term raft INFO term ignored a MsgApp message with lower term from term raft INFO term received a MsgVote message with higher term from term raft INFO became follower at term raft INFO logterm index vote cast MsgVote for logterm index at term raft INFO term received a MsgVote message with higher term from term node raft INFO term received a MsgVote message with higher term from term raft INFO became follower at term raft INFO logterm index vote cast MsgVote for logterm index at term raft INFO raftnode lost leader at term raft INFO term received a MsgVote message with higher term from term raft INFO became follower at term raft INFO logterm index vote cast MsgVote for logterm index at term raft INFO term received a MsgVote message with higher term from term node raft INFO term received a MsgVote message with higher term from term raft INFO became follower at term raft INFO logterm index vote cast MsgVote for logterm index at term raft INFO raftnode lost leader at term raft INFO term received a MsgVote message with higher term from term raft INFO became follower at term raft INFO logterm index vote cast MsgVote for logterm index at term raft INFO term received a MsgVote message with higher term from term node raft INFO is starting a new election at term raft INFO became candidate at term raft INFO received MsgVoteResp from at term raft INFO logterm index sent MsgVote request to at term raft INFO logterm index sent MsgVote request to at term raft INFO logterm index sent MsgVote request to at term raft INFO raftnode lost leader at term raft INFO term ignored a MsgApp message with lower term from term raft INFO received MsgVoteResp from at term raft INFO quorum has received MsgVoteResp votes and vote rejections raft INFO is starting a new election at term raft INFO became candidate at term raft INFO received MsgVoteResp from at term raft INFO logterm index sent MsgVote request to at term raft INFO logterm index sent MsgVote request to at term raft INFO logterm index sent MsgVote request to at term raft INFO is starting a new election at term raft INFO became candidate at term Steps to reproduce the behaviour Deploy the following smart contract Use different address to send create contract function transaction to each node in one second last for more than hours Note We have tried blockTime ms ms and the same problem occurs Smart Contract solidity pragma solidity contract TestContract uint SNLength function createbytes SN bytes operator bytes dataHash uint timestamp external returnsSNLog SNLength return new SNLogSN operator dataHash timestamp function retrieveSNLength external view returns uint return SNLength contract SNLog bytes public SN bytes operator bytes dataHash uint timestamp constructorbytes SN bytes operator bytes dataHash uint timestamp public SN SN operator operator dataHash dataHash timestamp timestamp Add a new subsection named Howto Guides that will contain tutorials on how to perform various tasks in Quorum Added a tutorial on how to add Quorum nodes to an existing network both for Raft IBFT along with various extra options eg permissioning Depends on resources added in This enhancement provides a number of benefits including Allowing the implementation of certain components of the Quorum client to be changed at configuration time Supporting our community to improve the Quorum client with their own innovative implementations of the supported pluggable components Decoupling new Quorumspecific features from core geth thereby simplifying the process of pulling in changes from upstream geth Hi there I run a Quorum Network with ibft then I want backup my Network useing export commandlike geth export enodebin datadir enode with the same genesis configi init network with command like geth datadir inode init genesisjson then I import the backup file with command like geth import enodebin datadir inode but failed the error message see Actual behaviour System information Geth version stable e f OS Version OSX Expected behaviour Restore network Actual behaviour geth import enodebin datadir inode INFO Maximum peer count ETH LES total INFO Allocated cache and file handles databaseUserslinjingjingDocumentsprojectsoftfromscratchistanbulenodegethchaindata cache handles INFO Disk storage enabled for ethash caches dirUserslinjingjingDocumentsprojectsoftfromscratchistanbulenodegethethash count INFO Disk storage enabled for ethash DAGs dirUserslinjingjingethash count INFO Loaded most recent local header number hash b bb a td age h m s INFO Loaded most recent local full block number hash b bb a td age h m s INFO Loaded most recent local fast block number hash b bb a td age h m s INFO Importing blockchain fileenodebin ERROR BAD BLOCK Chain config ChainID Homestead DAO nil DAOSupport false EIP EIP EIP Byzantium IsQuorum true Constantinople TransactionSizeLimit MaxCodeSize Engine istanbul Number Hash xff b f cc c ecd ab d d bc a a fb a cdf ea Error extradata too long ERROR Import error errinvalid block extradata too long INFO Blockchain manager stopped Import done in ms System information Geth version geth version sh Geth Version stable Git Commit f fd a ee d c e d cd b Quorum Version Architecture amd Protocol Versions Network Id Go Version go Operating System linux GOPATH GOROOTusrlocalgo OS Version WindowsLinuxOSX Ubuntu Branch Commit Hash or Release git status Tried and Cannot downgrade to any older versions because of the gas limit bug in that breaks other things Expected behaviour Contract deployment works Actual behaviour Contract deployment is broken because geth shuts down the WebSocket connection assuming that it does so due to Steps to reproduce the behaviour Pull up a quorum network with raft Compile contracts with solidity npm package solc Instantiate Web with WebSocketProvider pointing at network set up in Attempt to deploy contracts watch it burn Specific contract Im deploying Potentially Relevant Issues Backtrace The exact JSON RPC request payload is bytes long and is pasted below json jsonrpc id method ethsendTransaction params from xed d e b e b a c fe e f d gas x data x fd b c c b f d e d fd b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff d b b e b d e f fe e c b c ea ff ae d ed c cd a d b d d ffad ed ca aad ced eeafaa d cebfb ea da cb b c e a aa d a b f cd d be b fd b f fd b fd b e fd b fd b fd b f f f c fd b db fd b fe fd b f f f fd b fd b fd b f f f fc fd b f fd b fd b f f f f b b fd b da ad fd b ffffffffffffffffffffffffffffffffffffffff a b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff f b fd b da b b c b f b a fd b e b fd b d fd b e fd b fd b f f f b fd b e fd b a fd b f f f fd b fd b b fd b f f f a b b d fd b b fd b d fd b e fd b a fd b f f f e fd b fd b a fd b f f f fd b b fd b e fd b f f f a b b a fd b ab c b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff f b fa fd b a fd b fd b fd b fd b f f f cb fd b de fd b a fd b f f f cbf b b a a c b f b aba fd b ceb c ad fd b af fd b b fd b b fd b f f f b b fd b b e fd b bc fd b f f f ffffffffffffffffffffffffffffffffffffffff ff c fd b c fd b c fd b f f f ffffffff e b b b d d fd b ffffffffffffffffffffffffffffffffffffffff d b b d fd b ea d a fd b d fd b d b fd b dae fd b f f f e fd b e fd b e fd b f f f de b b eb fd b e ecd fd b eeb fd b efe fd b f fd b f f f f fd b f fd b fbb fd b f f f aa b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff f b d fd b f b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff f b b fd b e d fd b b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff f b fd b c f fd b ffffffffffffffffffffffffffffffffffffffff b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff f b cb fd b b e fd b fd b fd b fd b f f f b e b eb ce b f a b d b b f a b c b bd a b f eb a b b b b f a b b f b f bd a b b f db b f a b d f b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff b c ffffffff c b f dc b f a b b b f a b b cb ae b f f a b b b f a b b fd b af d d e d fd b b a ffffffffffffffffffffffffffffffffffffffff b b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff b b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff cd a ffffffff c b f b f d a b b b b f b a b b f d b f a f a b b a fd b af a d e d fd b b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff b ffffffff c b b af b f b a b b b f b b f bad a b b be bcb b f c a b b c a fd b af c f d e d fd b b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff a ffffffffffffffffffffffffffffffffffffffff b cd fe b d b b dfd d aa b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff ddc fe b d b b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff e fd b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff f c f c a e f a f c e fd b f e e b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff fc fe b ff ffffffff ffffffff a b e b f c a b b a b f b a b b f d b f e a b f d e d fd b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff d fe b e fe b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff fd b d ce c b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff b bde b c b ffffffffffffffffffffffffffffffffffffffff b ffffffff c b fd b afa d e d fd b d c fd b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff a ffffffffffffffffffffffffffffffffffffffff b ec cbf b b d fe b b f b fd b e dac b fd b b f f c f b ff f f c f b a f c f b d b f f e c f b d f b b c eb b a b ff b b b ff a c ff b e eb b f d e d a a c ff ff afa da d e d fd b b b a ffffffffffffffffffffffffffffffffffffffff b fe b a ffffffffffffffffffffffffffffffffffffffff b a ffffffffffffffffffffffffffffffffffffffff b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff cd d ffffffff c b f b f d a b b b fd b afa a d e d fd b d e d f f e cb fd b e fd b fb fd b a fd b a fd b a d fd b a b fd b a fd b a f fd b abd fd b ada fd b af fd b b f fd b b fd b b d fd b b b fd b b fd b b f fd b bbd fd b b b c ffffffffffffffffffffffffffffffffffffffff c fe b ffffffffffffffffffffffffffffffffffffffff c c a b be b fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b b c da b b d c cbc fe b a ffffffffffffffffffffffffffffffffffffffff cf fe b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff c a b d fe b a ffffffffffffffffffffffffffffffffffffffff da e b b b dc ec b dce dbc b dec eea b b c e fe b f f b f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff ef b f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b e f f b e b f b a a a a c b fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff f c f c fe b a ff ff b b f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff ff ff b b fe b fe b bfc b d f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff e d f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b c d f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b b b b fe b b a fe b b fe b dc c c c c c b fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff c d fe b c fe b b b c c c c c b b f b b fe b d b e f b b b f fe b f b fffffffffffffffffffffffffffffffff b b bfc b f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff c b b a f d b dc a a a a c b fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff fe b a ff ff b bfc b f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff e f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b e bfc b f a effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff f bfc b f c effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff fc fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff aa a fe b a d fe b a fe b b f c fe b a d fe b ed fe b b f b f a fe b a fe b fe b fe b a fe b fe b b e fe b ce be fe b b e f b b b b bfc b f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b de f d effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b b f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b c f e effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b b d fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff a a c fe b a fe b a fe b a a d fe b a e fe b a a ff b b a a a a a c b b aa b a b acd a a a a c b fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b b fe b a ff ff b bfc b f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff bd e f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b bfa a a a a c b b ded b b b b d b c f fe b c e fe b c fe b cd cd ccb c a fe b cb fe b a a b b b b d f d cf fe b d fe b a a b db b c b db f c a f f e f f e fd b b b dc ec b dd ec b fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff e b e e f b e b b e e eea b ea e fe b f b eb eea b c ecd fe b ff f fe b b b f eea b b f fe b f f f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b e b b b e b b c f ff b b f ff fe b f f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff f f a fe b f f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b c f c fe b f f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b b f fc fe b f f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b f a fe b f f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b bf f e fe b f f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b f fa fe b f f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b f a fe b f f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b a b b b f b b b eea b b af a fe b f f f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b d f a effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b f d effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b e f c effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b be d f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b e d f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff b e af b f ff a f f ff b a b b d a b dc e b a a b a c e b b b f f a b b b a fe b f f af fe b effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff a a b b b b b db b f fe b f f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff bfb fe b f f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff c c fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff e f b cab fe b f f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff d fe b f f effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff da e f b b b def fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff e f b e e f b b b e fe b e fe b a ff ff b d fa b ec ec f e b b b b c f fe b ff b c f e fe b ff b fa b f f f b b fe fd b d d c fd b fd b fd b fd b a fd b b fd b d fd b fd b f fd b d fd b a f b f b a ff a fe b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff f b a ffffffff ffffffff de b f f ff a b a b a b b b b b b db b d bd b b b a ee f fe c fdde d b c b d d ee db c e b aaa aa cb b bc d e f bc c b fd b fd b a b b e c b f f a b f b fd b f b ffffffff ffffffff f b fd b b b b a e b f d a b f b f fd b f a b b e b f a b f b fd b b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff f b d fd b e d b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff a fe b ff ffffffff ffffffff a b b f ad a b b e cb b f a b b c b f a b f b a fd b a aa b b fe b ff f b d fd b dc bd b b c b f a b f b f ed f c ed b b d f b b a ffffffff b f a f a b b f b b f f f f b b f b b a ffffffffffffffffffffffffffffffffffffffff b a ffffffffffffffffffffffffffffffffffffffff a ff a ffffffff f f c b b a f b f f f c f b b d f b f f f f b b f b b a ff b f a f a a b b a f b fea a a b ef d fff d bff e b afa fcf c aecd a a a f f f e c d c f a ecf b e e d bbfcc e a e dc e fd b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff b f fe c b c c cd a f b ef da cb b e cd d c b fd b fd b f f fd b ac fd b be fd b e fd b f f f fd b fd b fd b f f f da fd b ec fd b e fd b f f f fd b fd b a fd b f f f aa b b fd b ed c fd b fd b b fd b d fd b f f f d fd b e fd b fd b f f f fd b fd b b fd b f f f e b b fb fd b e fd b f fd b fd b fd b f f f c fd b d fd b fa fd b f f f d fd b f fd b fd b f f f d b b f fd b fa b ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff f b fd b f fd b c fd b e fd b b fd b f f f b e b b f d a b d b c ab b f f a b c b c b f a b b b b f bf a b b f dd b f a a b b a e a b f a b a b d f b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff aff fd b b b d b b a afa b f d e d fd b d b fd b bd fd b e d f e f c b cb c e b a afa cf d e d fd b d d a fd b d af b d af b d f af b da af b dc af b a ff a e af b c e e af b b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff e fd b b ec e c b a afa f d e d fd b d f fd b f c fd b b f a f b a afa fdc d e d fd b d ff fd b f f b f a b a afa c d e d fd b d d fd b b f fa b a afa d e d fd b d fd b ae a a f b cb b c a f b b b a ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff ffffffffffffffffffffffffffffffffffffffff c fd b b a b a afa ac d e d fd b d c fd b fd b b e b a afa d e d fd b d a fd b a ff f a f b a f b b a ffffffffffffffffffffffffffffffffffffffff b b b e b a afa c d e d fd b d d fd b fd b b b b a afa d e d fd b d ae fd b f f c b b a f b f f db b b e f b f a f d a b b b f b f a f f a b b d f b a ff f fd f d fd b b e f b f c f c b b f f b b f f f ff a e b a e b a d a b b a b aaf b b f f a ff a e b a e b a d a b b aab aaf b b ad b acd ab b b fea a a aa b b f da e aa f bc dd e c b e fffb gasPrice x Which then produces the WebSocket connection shut down in response json jsonrpc errorcode messageunexpected EOF Currently we have a way to retrieve a payload from the Private Transaction Manager ethgetQuorumPayload but it might be nice to have one that sends a payload to the PTM both Tessera raw txns and regular ones This has a few upsides the security for sending transactions to the PTM for raw txns is purely via the unix socket and does not need to be exposed to another network interface the same security used for protecting Quorum APIs can be used This needs some discussion first as to whether this is actually something we want to add and if so what exactly is required We have a lot of Stack too deep issues in our project because we build project with large structures and looks to move from classical EVM to something else This issues really depends on number of DUP commands limit It have sense for miners economy limitations in public Ethereum but no senses for corporate applications Seems as you copypasted that code from original EVM but do you plan to remove this and same restrictions in Quorum Overview Similar to the existing Vault integration in Tessera adds support for storing and using Quorum account private keys in a Hashicorp Vault instead of in local files New keys can be created using the geth account new CLI Accounts are configured for use in Quorum through the standard toml config file How Vault is used Vaultstored accounts can be in one of three states Locked Private key component is not retained in memory Each time an account is used for signing an API request is made to the Vault to retrieve the corresponding private key The key is then zeroed after use Timed Unlock Private key component is retained in memory for some predetermined duration During this period signing operations can be carried out without needing to make API requests to the Vault Once the duration has passed the key is zeroed and the account becomes locked Unlocked Private key component is retained in memory indefinitely Signing operations can be carried out without needing to make API requests to the Vault Newpersonal APIs personallockVaultAccountaddr Immediately lock an unlocked Vaultstored account personalunlockVaultAccountaddr duration Unlock a Vaultstored account for duration secs default duration indefinitely unlocks the account web js in the geth JS console has been extended to add support for these new APIs this should be considered a temporary solution until support is added to QuorumJS personallockVaultAccountaddr personalunlockVaultAccountaddr duration Docs Doc updates are included in this PR Do mkdocs serve and navigate to to view them Fixes Added configurable threshold for future block check in order to avoid spurious block in the future messages Threshold is specified in seconds usingistanbulallowedfutureblocktime command line argument Note that there is a similar change for ethash in upstream geth albeit a fixed threshold not configurable 