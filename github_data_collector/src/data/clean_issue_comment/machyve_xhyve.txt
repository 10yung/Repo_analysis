Host is MacOS Ive tried TinyCoreLinux and Ubuntu serveramd Guest unable to get DHCP response Tried manually configuring network with IP in x subnet ie but unable to ping host and host also unable to ping guest Tried both virtionet and e Using brew xhyve HEAD f a d Heres ifconfig with Linux guest booted lo flags UPLOOPBACKRUNNINGMULTICAST mtu options RXCSUMTXCSUMTXSTATUSSWTIMESTAMP inet netmask xff inet prefixlen inet fe lo prefixlen scopeid x nd options PERFORMNUDDAD gif flags POINTOPOINTMULTICAST mtu stf flags mtu XHC flags mtu XHC flags mtu en flags UPBROADCASTSMARTRUNNINGSIMPLEXMULTICAST mtu ether c b de inet netmask xffffff broadcast media autoselect status active p p flags UPBROADCASTRUNNINGSIMPLEXMULTICAST mtu ether e b de media autoselect status inactive awdl flags UPBROADCASTRUNNINGPROMISCSIMPLEXMULTICAST mtu ether ce df a inet fe cc fffe df aawdl prefixlen scopeid x nd options PERFORMNUDDAD media autoselect status active en flags UPBROADCASTSMARTRUNNINGPROMISCSIMPLEXMULTICAST mtu options TSO TSO ether a d media autoselect fullduplex status inactive en flags UPBROADCASTSMARTRUNNINGPROMISCSIMPLEXMULTICAST mtu options TSO TSO ether a d media autoselect fullduplex status inactive bridge flags UPBROADCASTSMARTRUNNINGSIMPLEXMULTICAST mtu options RXCSUMTXCSUMTSO TSO ether a d Configuration id priority hellotime fwddelay maxage holdcnt proto stp maxaddr timeout root id priority ifcost port ipfilter disabled flags x member en flags LEARNINGDISCOVER ifmaxaddr port priority path cost member en flags LEARNINGDISCOVER ifmaxaddr port priority path cost media unknown type status inactive utun flags UPPOINTOPOINTRUNNINGMULTICAST mtu inet fe fb fde f b b utun prefixlen scopeid xc nd options PERFORMNUDDAD en flags UPBROADCASTSMARTRUNNINGPROMISCSIMPLEXMULTICAST mtu ether e e media autoselect status active bridge flags UPBROADCASTSMARTRUNNINGSIMPLEXMULTICAST mtu options RXCSUMTXCSUM ether e inet netmask xffffff broadcast Configuration id priority hellotime fwddelay maxage holdcnt proto stp maxaddr timeout root id priority ifcost port ipfilter disabled flags x member en flags LEARNINGDISCOVER ifmaxaddr port priority path cost nd options PERFORMNUDDAD media autoselect status active FreeBSD bhyve commit From that commit message This prevented the device from attaching with a Windows guest most other guests use the device type for matching The corrected ID also matches the PCI ID Repository I havent tested Windows but Linux and OpenBSD guests do load the driver correctly albeit with the PCI device identified incorrectly as the memory ballooning device Im using s virtiornd for these VMs Before Linux lspci Network and computing encryption device Red Hat Inc Virtio memory balloon Before OpenBSD dmesg and pcidump virtio at pci dev function Qumranet Virtio Memory Balloon rev x viornd at virtio pcidump Qumranet Virtio Memory Balloon With the fix everything is correctly identified and virtiornd still works at least my Linux VM gets new random data each time I run dd ifdevhwrng count hexdump C After Linux lspci Network and computing encryption device Red Hat Inc Virtio RNG OpenBSD dmesg virtio at pci dev function Qumranet Virtio RNG rev x viornd at virtio OpenBSD pcidump Qumranet Virtio RNG Fixes errors from WerrorWextrasemistmt in clang OpenBSD since reads this register and attempts to disable the debug interface if enabled Ref Returning will satifsy OpenBSD guests that this feature is disabled and allow running xhyve without w This might also need to be upstreamed to bhyve as I found a similar report for it and workaround with w A reply to that thread indicated the hardenedbsd fork fixed it via returning a locked and disabled value in that MSR but that doesnt seem to have made it into FreeBSD bhyve Also in my testing simply returning disabled is sufficient This only affects certain host CPUs those with the SDBG CPU ID bit which bhyvexhyve pass through but theyre apparently common among recentish Macs An alternative solution would be to mask off that CPU ID bit but this seemed like a simpler solution In inline assembly of xhyvesrcmeventtestc an unused inline assembly asm volatile cpuid is written here cpuid is an instruction which overrides register eax ebx ecx and edx by the information of cpu details can be found in x specification This inline assembly is not only unuseful under some context it may corrupt the normal C data flow and cause errors in C world For example static inline uint t rdtscvoid unsigned a d asm volatile cpuid asm volatile rdtsc a a d d return uint t a uint t d int attributenoinline setvalint v return v int main int a setval int b setval int c setval a a b b b c c c a uint t d rdtsc printfd d d lx n a b c d return The above code on my pc gcc O will output bcbf e assume rdtsc now is bcbf e but the actual output should be bcbf e the reason is that cpuid override some registers unexpectedly How to reproduce Build xhyve from git I built from f a d bbeb c f fcc a Grab OpenBSD miniroot fs and bhyve UEFI from FreeBSD Use this script to boot xhyve Connect to VNC See that VNC is dark and wont display anything See xhyve spit out output to stdout probing pc com com mem K M M M K disk hd hd OpenBSDamd BOOTX boot cannot open hd aetcrandomseed No such file or directory booting hd absd x f entry point at x rdmsr to register xc on vcpu XHYVE vlapic callout at x x f e expected at x e cbdadf xhyve exits Am I doing something wrong This fixes a crash on windows and its based on the same upstream fix Windows uses at least and qemu alsosupports hence why we need to raise this Assertion failed vvmpktsize vmsmaxpacketsize function vmnread file srcpcivirtionetvmnetc line xhyverunwindowssh line Abort trap Fix on bhyve Signedoffby mikept mikeptusersnoreplygithubcom Scenario Im trying to follow the directions to create an xhyve VM running Windows Ive gone through the preparation steps but when I run the build script I get an error about the e device being unknown Error Message pci slot unknown device e My Xhyve Folder xhyve ls lGa total drwxrxrx trevor staff Sep drwxrxrx trevor staff Sep rwxrxrx trevor staff Sep BHYVEUEFIfd rwx trevor staff Dec Win OctEnglishx iso rw trevor staff Sep Windowsdmg rwxrxrx trevor staff Sep buildsh buildsh binsh BOOTVOLUMEWin OctEnglishx iso IMGWindowsdmg FIRMWAREBHYVEUEFIfd PATHbuildReleasebuildPATH xhyve w m G c s hostbridge s ahcicdBOOTVOLUME s ahcihdIMG s e s fbuftcp w h wait s lpc l com stdio l bootromFIRMWARE Xhyve Version xhyve xhyve v xhyve xhyve is a port of FreeBSDs bhyve hypervisor to OS X that works entirely in userspace and has no other dependencies Homepage License BSD MacOS Version xhyve uname mprsv Darwin Darwin Kernel Version Tue Aug PDT rootxnu RELEASEX x i Hi Just found windows has a new Hypervisor API just like macOS does So Im wondering is it possible to make a xbyve version of it xhyve w m G c s hostbridge s ahcicdBOOTVOLUME s ahcihdIMG s virtionet s fbuftcp w h wait s lpc l com stdio l bootromFIRMWARE Using this which is prety much like the sample except Im not using e which fails According to this and xhyve guide that last line should work the file is places in the same dir