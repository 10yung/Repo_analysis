 Required information Distribution Alpine Distribution version Kernel version vanilla LXC version LXD version Storage backend in use ext on md Issue description When I attempt to move a container to the cluster node that the container is already on it crashes the cluster Of course theres no reason to do this but the cluster shouldnt crash if done by accident I would expect no output and a success return code The following shows the situation pretty well I have these lxd nodes behind a load balancer in round robin so it looks like it took a moment for every node to show the failed state bab b ce lxc cluster list NAME URL DATABASE STATE MESSAGE c fae ca YES ONLINE fully operational f b YES ONLINE fully operational a abd afeef YES ONLINE fully operational bab b ce lxc stop test Error The container is already stopped bab b ce lxc info test grep i locat Location f b bab b ce lxc mv test target f b Error Migration operation failure Get Unable to connect to bab b ce lxc cluster list NAME URL DATABASE STATE MESSAGE c fae ca YES ONLINE fully operational f b YES ONLINE fully operational a abd afeef YES ONLINE fully operational bab b ce lxc cluster list Error cannot fetch node config from database driver bad connection bab b ce lxc list Error cannot fetch node config from database driver bad connection bab b ce lxc list Error cannot fetch node config from database driver bad connection Rather than the error Error storage pool pool has volumes attached to it which is given when the pool contains instance volumes from the default project Building on issue to use the new background proceess manager to refactor how dnsmasq and forkdns are processes are started or killed net lxc version net uname a Linux net faststablehostingcom generic Ubuntu SMP Tue Sep UTC x x x GNULinux net lsbrelease a No LSB modules are available Distributor ID Ubuntu Description Ubuntu LTS Release Codename bionic After a container creation container running Stopping the container then attempting a delete produces this net lxc delete net testitk Error Failed to remove device eth Failed to release DHCPv lease for instance net testitk IP MAC e write udp write operation not permitted Container is partially removed so I guess the fix is to somehow force removal of varsnaplxdcommonlxdstoragepoolsdefaultcontainersnet testitk residue Be great if someone can provide the correct way to force container removal so all cleanup is done correctly Thanks Github issues are used for bug reports For support questions please use our forum Please fill the template below as it will greatly help us track down your issue and reproduce it on our side Feel free to remove anything which doesnt apply to you and add more information where it makes sense Required information Distribution Ubuntu Distribution version LTS The output of lxc info or if that fails Kernel version generic LXC version LXD version Storage backend in use dir Issue description I have update lxdlxc from V x to V but now it is not anymore possible to start container I always get the error Initialize LXC Failed to load rawlxc The main issue will be that my container is privileged and Ive had to set set aaprofileunconfined lxc config set webserver rawlxc lxcaaprofileunconfined Then it worked fine under lxd V x as expected Now i wanted to copy container to a remote one which has lxd V and I got also this error while copying Therefore i tried to update my local lxd to Ver but Im having the same troubles No I dont have any clue how to get out this misery because any lxc config set leads to this error for my container I think that this is a migration bug If I try to edit config file this way lxc config edit webserver newconfigyaml overwriting aaprofileunconfined with the new keyword lxcapparmorprofileunconfined then I receive other errors like ie Error The storage pool of the root disk can only be changed through move Is there a chance to get my container running fine again Steps to reproduce Step one Install lxd V x and create a pivileged container and set config rawlxc lxcaaprofileunconfined Step two Update to lxd V Step three Try to start container Information to attach Any relevant kernel output dmesg Container log lxc info NAME showlog x Container configuration lxc config show NAME expanded Main daemon log at varloglxdlxdlog or varsnaplxdcommonlxdlogslxdlog Output of the client with debug Output of the daemon with debug alternatively output of lxc monitor while reproducing the issue architecture x config environmenthttpproxy rawapparmor mount fstypecfis rawidmap both rawlxc lxcaaprofileunconfined securityprivileged true usernetworkmode volatilebaseimage f c cc eca f e fdaf f c d a c e e volatileeth hwaddr ecff a volatileidmapbase volatileidmapnext volatilelaststateidmap volatilelaststatepower STOPPED devices eth name eth nictype bridged parent lxdbr type nic root path type disk sharedir path varwwwhtml source homesfnVirtualBox VMsTBSDevelopmentExchangewww type disk ephemeral false profiles default stateful false description One of major problems with remote LXDLXC containers that prevents their adoption is inability to map service ports running in remote container to local machine with LXC client mapping other way is also needed The common use case for secure port forwarding is sharing local project directory with remote container Doing that requires establishing additional secure channel and routing rule for NFS SSH or p p protocol as in the issue above Using p also requires putting encryption layer and there are no easy solutions like Lets Encrypt for domain names LXD already provides a secure channel so this issue it to reuse that for port forwarding I asked the question on the forum days ago and there are still no replies The proposal had been raised a year ago in where is was marked as isnt something that LXD is meant to do at least for now which was strange because there was already proxy device for forwarding tcp connections I cam accept if LXD was not meant to support port forwarding or not meant to support remote containers but since it is now supports both it is only logical to add the missing link Issues that made LXD is now ready to share its connection for port forwarding on remote containers presence of forkproxy executing host side processes for container interaction which can be used to maintain connection with remote LXD client and do simple channel copy backgroud process manager for managing forkproxy forkdns and dnsmasq I could probably do the patch myself but I need pointer how to a read and write to connection between LXD client and server Problem Im getting sporadic internal server errors on uploading plaintext files to the LXD api Software rootalpha snap list Name Version Rev Tracking Publisher Notes core stable canonical core lxd canonical rootalpha lsbrelease a No LSB modules are available Distributor ID Ubuntu Description Ubuntu LTS Release Codename bionic Logs Info about request StatusCodeError error file does not exist errorcode type error n n removed for brevity name StatusCodeError statusCode message error file does not exist errorcode type error n n error errorfile does not existerrorcode typeerror n n options removed for brevity ecdhCurve secp r json false method POST url qs path etcenvironment headers XLXDtype file ContentType plaintext body n ENVIRONMENTVARIABLEvalue n n I cant find anything in the lxd daemon logs Also i havent reported this for quite some time as id found this which seems like the same problem to me as i did not set the ContentType header manually Now im passing the header since a few days though and im still encountering this bug Also a lot of containers get set up but this problem occurs only sporadically An attempt in implementing passwordless PKI mode Addressing issue Implements basic filtering on the instance and images endpoints Users can pass in a filter query through the API call and it will be applied to the results Supports filtering on basic attributes and some nested objects config devices and basic logic ANDORNOT following OData conventions Additional details in docrestapimd