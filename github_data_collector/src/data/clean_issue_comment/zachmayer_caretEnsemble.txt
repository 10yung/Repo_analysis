 Code getS methodprint caretStack function x n lengthxmodels catpasteA xensmodelmethod ensemble of base models pastesapplyxmodels functionx xmethod collapse cat n nEnsemble results n printxensmodel bytecode x feea bc environment namespacecaretEnsemble Minimal dataset R setseed dat carettwoClassSim X dat y dat Class Minimal runnable code R librarycaretEnsemble models caretList X y methodListcglm rpart nnet trControltrainControl methodcv number classProbsTRUE savePredictionsfinal ens caretStackmodels printens Its broke Lots of testthat tests have warnings need to fix them Once merges I need to make a tag I tried to create an ensemble model using the CaretEnsemble package I wrote the following code models caretList logsales datatraindatafinal trControltrnCtrl tuneListlist rfcaretModelSpecmethodrf tuneGridexpandgridmtryc nncaretModelSpecmethodnnet tuneGridexpandgriddecay c size c preProcessccenter scale linoutTRUE traceFALSE maxit gbmcaretModelSpecmethodgbm tuneGridexpandgridinteractiondepth seq by ntrees seq by shrinkage c nminobsinnode xgbcaretModelSpecmethodxgbTree tuneGridexpandgridnrounds eta c maxdepth c gamma colsamplebytree c subsample c minchildweight stackglm caretStackmodels methodglm trControltrnCtrl Which runs totally fine but when I try to use the stacked model to predict new data I get the following error pred predictstackglm newdata testing Error in evalpredvars data env object nn not found When I run stackglmmodelsnn I get the results for neural network but I am not sure if object nn in the error message refers to same thing The issue is not fixed for xgboost The following R code fails with Error in evalpredvars data env object xgb not found It works if the model is named xgbTree instead of xgb requiredatatable requirecaret requirecaretEnsemble datairis iris datatableiris iris Species factorifelseSpecies setosa SETOSA samplecSETOSA OTHERS replace T setseed trainIndex createDataPartitionirisSpecies p listF train iris trainIndex test iris trainIndex mycontrol trainControl methodcv number indexcreateResampletrainSpecies savePredictionsfinal classProbsTRUE summaryFunctiontwoClassSummary xgbgrid expandgrid nrounds eta c maxdepth c gamma colsamplebytree minchildweight subsample modellist caretList Species datatrain trControlmycontrol metricROC tuneListlist xgbcaretModelSpecmethodxgbTree tuneGridxgbgrid rfcaretModelSpecmethodrf tuneGrid expandgridmtry croundsqrtncoltrain greedyensemble caretEnsemble modellist metricROC trControltrainControl number summaryFunctiontwoClassSummary classProbsTRUE summarygreedyensemble predictgreedyensemble newdatatest typeprob Hi I am having hard time to interpret the weights of glm and rpart what are the models weights for glm and rpart many thanks in advance greedyensemble caretEnsemble modellist metricROC trControltrainControl number summaryFunctiontwoClassSummary classProbsTRUE summarygreedyensemble The following models were ensembled glm rpart They were weighted The resulting ROC is The fit for each individual model on the ROC is method ROC ROCSD glm rpart ensemble caretEnsemblemods metric ROC trControl trainControl method cv number savePredictions final classProbs TRUE summaryFunction twoClassSummary As of this commit on the master branch of the caret package the predicttrain function is no longer exported causing the following error to be thrown from predictcaretList R Error predicttrain is not an exported object from namespacecaret Minimal reproducible example Minimal dataset R setseed dat carettwoClassSim X dat y dat Class Minimal runnable code R librarycaretEnsemble models caretList X y methodListcglm rpart trControltrainControl methodcv number classProbsTRUE savePredictionsfinal predictmodels newdata X Session Info R sessionInfo R version Platform x w mingw x bit Running under Windows x build Matrix products default locale LCCOLLATEEnglishUnited States LCCTYPEEnglishUnited States LCMONETARYEnglishUnited States LCNUMERICC LCTIMEEnglishUnited States attached base packages stats graphics grDevices utils datasets methods base other attached packages caretEnsemble caret ggplot lattice RevoUtils RevoUtilsMath loaded via a namespace and not attached tidyselect pbapply purrr reshape kernlab splines colorspace stats yaml survival prodlim rlang e ModelMetrics pillar withr foreign glue bindrcpp foreach bindr plyr dimRed lava robustbase stringr timeDate munsell gtable recipes codetools psych parallel class DEoptimR broom Rcpp scales ipred CVST gridExtra mnormt digest stringi dplyr RcppRoll ddalpha grid tools magrittr lazyeval tibble randomForest tidyr DRR pkgconfig MASS Matrix datatable lubridate gower assertthat iterators R rpart sfsmisc nnet nlme compiler In the following example I create a simple custom caret model so that I can view the x y and wts values being sent to the model The easiest thing is to add browser inside of the custom model but I am using print statements instead that illustrate what problems it can cause In the example below my weights are ascending going from to in steps of In theory this should have a random effect on the prediction But because the y get sorted prior to being passed to the model but the wts dont the wts no longer align to the x and y rows and even more pernicious in the case below they cause the larger y values to be weighted higher causing a strong distortion of the apparent weighted mean value of the series Minimal reproducible example Minimal dataset R setseed df dataframex rnorm w seq lengthout dfy dfx rnorm headdf taildf Minimal runnable code R librarycaret librarycaretEnsemble Mean Custom Caret Method CaretMean list library cdplyr type Regression parameters dataframeparameter cNone class ccharacter label cNone grid functionx y len NULL search grid dataframe None fit functionx y wts param lev last weights NA classProbs NA RetVal list if isnullwts wts rep lengthy Both x and y are being resorted such that y is in ascending order however wts is not reordered So the weight no longer corresponds to the correct x and y values and can cause pernicious problems such as in this example the weights are also increasing meaning that the weighted mean y value is much higher than the unweighted mean printsprintfUnweighted Mean y f meany printsprintfWeighted Mean y f sumy wts sumwts browser classRetVal CaretMean returnRetVal predict functionmodelFit newdata preProc NULL submodels NULL sapply nrownewdata functionR meannewdata R prob NULL tags cSimple label Mean models caretListy x data df weights dfw trControl trainControlmethod cv savePredictions final allowParallel F methodList cglm gbm svmRadialCost knn ensemble caretStackmodels method CaretMean weights dfw trControl trainControlmethod cv savePredictions final allowParallel F Session Info R sessionInfo R version Platform x w mingw x bit Running under Windows Server x build Matrix products default locale LCCOLLATEEnglishUnited States LCCTYPEEnglishUnited States LCMONETARYEnglishUnited States LCNUMERICC LCTIMEEnglishUnited States attached base packages grid parallel splines stats stats graphics grDevices utils datasets methods base other attached packages caretEnsemble caret randomForest datatable weights mice gdata flexclust modeltools magrittr ROI PortfolioAnalytics PerformanceAnalytics xts zoo xgboost lubridate bindrcpp GenSA optimx doParallel iterators glmnet foreach Matrix tidyr dplyr plyr scales car MASS DBI rsqlserver rClr VGAM Hmisc ggplot Formula survival lattice RODBC loaded via a namespace and not attached backports lazyeval svUnit BB digest htmltools checkmate memoise cluster recipes gower dimRed colorspace lme Rglpk bindr glue DRR registry gtable ipred MatrixModels kernlab ddalpha DEoptimR SparseM setRNG Rcpp htmlTable foreign lava prodlim htmlwidgets httr ROIpluginquadprog RColorBrewer acepack pkgconfig nnet rlang reshape munsell tools ranger devtools ROIpluginglpk stringr ModelMetrics knitr robustbase purrr pbapply nlme quantreg slam RcppRoll compiler pbkrtest curl e tibble stringi superpc nloptr gbm ucminf R latticeExtra gridExtra codetools gtools assertthat CVST Rvmmin optextras withr mgcv Rcgmin quadprog dfoptim rpart timeDate class minqa git r numDeriv base enc 