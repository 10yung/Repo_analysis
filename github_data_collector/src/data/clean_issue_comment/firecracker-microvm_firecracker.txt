 Description of Changes Some code and docs adjustments included License Acceptance By submitting this pull request I confirm that my contribution is made under the terms of the Apache license PR Checklist Author TODO Meet these criteria Where there are two options keep one Reviewer TODO Verify that these criteria are met Request changes if not All commits in this PR are signed git commit s Either this PR is linked to an issue or the reason for this PR is clearly provided The description of changes is clear and encompassing Either no docs need to be updated as part of this PR or the required doc changes are included in this PR Docs in scope are all md files located either in the repository root or in the docs directory Either no code has been touched or codelevel documentation for touched code is included in this PR Either no API changes are included in this PR or the API changes are reflected in firecrackerswaggeryaml Either the changes in this PR have no user impact or the changes in this PR have user impact and have been added to the CHANGELOGmd file Either no new unsafe code has been added or the newly added unsafe code is unavoidable and properly documented Hi I have a C program that runs x slower when I fix the memory size of the microVM to GB in comparison to GB The program itself uses MB of memory I tried to use perf events inside the microVM but it seems like not every event is supported in alpine What would be a good toolway to measure the performance counters in the microVM Thanks Anjali Reason for This PR Refactor net device and drive it with polly Description of Changes In this PR the net device is ported on polly IO event manager The changes contained by this PR are as follows added edge triggered event type to polly aggregated the information from NetEpollHandler RxVirtio TxVirtio Net into one single struct Net implemented handleread for Net device which is now also a polly EventHandler and can handle events related to Net device queue events tap events rate limiter events provided a single execution path which registers the Net device and also handles the PATCH request from microvm runtime separated the Net device into specific and self contained components which resembles the Block refactoring which will help us to draw a more generic view of devices There is still work to be done to complete the refactoring for the Net device update unit tests provide documentation where necessary implement error handling to polly events handling Commits relevant for review net net dev is driven by polly net separated the net dev on components License Acceptance By submitting this pull request I confirm that my contribution is made under the terms of the Apache license x All commits in this PR are signed git commit s x The reason for this PR is clearly provided x The description of changes is clear and encompassing Docs have been provided Codelevel documentation for touched code is included in this PR x No API changes are included in this PR x The changes in this PR have no user impact x No new unsafe code has been added Description of Changes Made the necessary changes to the device manager tests to follow the postdecoupling mmiovirtio interface Other improvements The MMIODeviceManager does not need to hold a reference to GuestMemory Refactored the code a bit to cut that dependency GuestMemory is owned by Vmm the Vm object is also owned by Vmm There is no point in both Vmm and Vm to hold references to GuestMemory Remove it from the Vm object as it doesnt need it in any way License Acceptance By submitting this pull request I confirm that my contribution is made under the terms of the Apache license PR Checklist Author TODO Meet these criteria Where there are two options keep one Reviewer TODO Verify that these criteria are met Request changes if not x All commits in this PR are signed git commit s x Either this PR is linked to an issue or the reason for this PR is clearly provided x The description of changes is clear and encompassing x Either no docs need to be updated as part of this PR or the required doc changes are included in this PR Docs in scope are all md files located either in the repository root or in the docs directory x Either no code has been touched or codelevel documentation for touched code is included in this PR x Either no API changes are included in this PR or the API changes are reflected in firecrackerswaggeryaml x Either the changes in this PR have no user impact or the changes in this PR have user impact and have been added to the CHANGELOGmd file x Either no new unsafe code has been added or the newly added unsafe code is unavoidable and properly documented Reason for This PR Fixed completed and reorganized some things inside the apiserver Please keep in mind while reviewing that this does not aim at making apiserver perfect These are just nice good improvements Description of Changes Check out the commits coverage increases with License Acceptance By submitting this pull request I confirm that my contribution is made under the terms of the Apache license PR Checklist Author TODO Meet these criteria Where there are two options keep one Reviewer TODO Verify that these criteria are met Request changes if not x All commits in this PR are signed git commit s x The reason for this PR is clearly provided x The description of changes is clear and encompassing x No docs need to be updated as part of this PR x No code has been touched x No API changes are included in this PR x The changes in this PR have no user impact x No new unsafe code has been added I have the build using the musl compiler working But the build using the gnu compiler will not work I have verified on tag v In One Shell toolsdevtool build l gnu rm f tmpfirecrackersocket firecracker apisock tmpfirecrackersocket Run the commands in the nd shell MicroVM Fails to Boot with this error T anonymousinstanceERRORsrcvmmsrcsignalhandlerrs Shutting down VM after intercepting a bad syscall In Another Shell Follow everything in the Getting Started Guide musl works following these steps gnu does not Am I missing something simple Do the kernel and rootfs need to be tied together with gnu to run on a gnu build Looking forward to your response Signedoffby Serban Iorga seriorgaamazoncom Reason for This PR partially addresses Description of Changes Rename GuestMemory to GuestMemoryMmap License Acceptance By submitting this pull request I confirm that my contribution is made under the terms of the Apache license PR Checklist Author TODO Meet these criteria Where there are two options keep one Reviewer TODO Verify that these criteria are met Request changes if not x All commits in this PR are signed git commit s x This PR is linked to an issue x The description of changes is clear and encompassing x No docs need to be updated as part of this PR x Nodelevel documentation for touched code is included in this PR x No API changes are included in this PR x The changes in this PR have no user impact x No new unsafe code has been added On snapshot creation make sure to flush disks so that any inflight data in the host OS buffers gets committed to the files backing the disks The rescanblockdevice function which can only be triggered after the guest has booted up does not update disknsectors field This field is used in the processqueue so it is vital to the good functioning of the blocks transport requests The change fixing this bug should also make sure this duplicated warning here and here gets deduplicated and is used both when Blocknew is created and also at rescanblockdevice Reason for This PR The extraargs feature for propagating jailer parameters to firecracker gets appended only when configfile is specified Fixed this by implementing a forward looking approach that enables us to even exercise our new implementation of the arg parser Description of Changes The approach implemented mirrors the codebase Added the extraargs parameter to the jailer just like in the codebase that can be tweaked from inside the integration tests in any means possible for the sake of exercising valid as well as nonvalid scenarios License Acceptance By submitting this pull request I confirm that my contribution is made under the terms of the Apache license PR Checklist Reviewer TODO Verify that these criteria are met Request changes if not x All commits in this PR are signed git commit s x The reason for this PR is clearly provided x The description of changes is clear and encompassing x No docs need to be updated as part of this PR x No code has been touched x No API changes are included in this PR x The changes in this PR have no user impact x No new unsafe code has been added 