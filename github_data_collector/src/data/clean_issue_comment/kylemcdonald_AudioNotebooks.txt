At this point even for just one file the functions runs endlessly 