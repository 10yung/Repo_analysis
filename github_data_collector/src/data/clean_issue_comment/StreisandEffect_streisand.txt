in this pull Im laying the groundwork to support later Ansible version where the ec module will be deprecated in favor of ec instances Currently there are a few modules that only recently got merged in ansible devel that will allow us to move the metric module to support boto This will allow us to enable the new zones like mesouth that are currently not supported with boto and they dont accept pull requests for it The Windows Stunnel Setup instructions in step say to Open the directory where you installed stunnel For most users this will either be in C Program Files stunnel or C Program Files x stunnel I had to append config to that path eg C Program Files x stunnel config to get to the directory where the existing stunnelconf file was the one that needed replaced This changes the instructions to specify that subdirectory Expected behavior Expected the installation to complete successfully Actual Behavior Installation hanged and eventually failed on TASK nginx Install Nginx Steps to Reproduce Start install on fresh Ubuntu as per masterInstallationmd Select option Existing Server Advanced Customize as below Enable DNSbased adblocking Press enter for default no yes Enable OpenConnect Press enter for default yes Enable OpenVPN Press enter for default yes Enable stunnel service only allowed for OpenVPN Press enter for default yes Enable Shadowsocks Press enter for default yes Enable v rayplugin for Shadowsocks Press enter for default no Enable SSH Forward User Note A SOCKS proxy only user will be added no shell Press enter for default yes Enable sshuttle Note A full shell access user will be added Press enter for default no Enable tinyproxy Press enter for default yes Enable Tor Press enter for default no Enable WireGuard Press enter for default yes Enable DNSoverHTTPS cloudflared Press enter for default yes Let run until if fails Additional Details After logging into the destination server while hanged and stracing the running apt instance one trying to install nginx I noticed archiveununtuorg and other sources failing to resolve repeatedly thus hanging apt manually trying to resolve other URLs failed as well trying to resolve on worked but DNS didnt work on dnsmasq was open on and configured with server although port was not opened after further inspection I noticed that cloudflared service was created but not running after running systemctl start cloudflared the DNS resolved successfully thus fixing the issue running streisand one more time finished the installation without any further errors It might be that the service creationstart timing ordering is misconfigured so it accidentally fails DNS for the whole machine in the gap between create and start while trying to do other tasks in the meantime apt install nginx Log output from Ansible or other relevant services link to Gist for longer output fatal xxxxxxxxxxxx FAILED cacheupdatetime cacheupdated false changed false msg usrbinaptget y o DpkgOptionsforceconfdef o DpkgOptionsforceconfold install nginx failed E Failed to fetch Temporary failure resolving archiveubuntucom n nE Failed to fetch Target Cloud Provider Hetzner Operating System of target host Ubuntu Operating System of client Ubuntu Version of Ansible using ansible version ansible Output from git revparse HEAD in your Streisand directory f bc b d bf a dab b f Expected behavior Streisand should install on a clean KVM based VPS Ubuntu Actual Behavior It fails while restarting Nginx with the following error code systemctl restart nginx Job for nginxservice failed because the control process exited with error code See systemctl status nginxservice and journalctl xe for details Result of journalctl xe Dec localhost systemd nginxservice Unit entered failed state Dec localhost systemd nginxservice Failed with result exitcode Dec localhost systemd nginxservice Service holdoff time over scheduling restart Dec localhost systemd Stopped A high performance web server and a reverse proxy server Subject Unit nginxservice has finished shutting down DefinedBy systemd Support Unit nginxservice has finished shutting down Dec localhost systemd Starting A high performance web server and a reverse proxy server Subject Unit nginxservice has begun startup DefinedBy systemd Support Unit nginxservice has begun starting up Dec localhost nginx nginx emerg a duplicate default server for in etcnginxsitesenabledstreisand Dec localhost nginx nginx configuration file etcnginxnginxconf test failed Dec localhost systemd nginxservice Control process exited codeexited status Dec localhost systemd Failed to start A high performance web server and a reverse proxy server Subject Unit nginxservice has failed DefinedBy systemd Support Unit nginxservice has failed The result is failed Dec localhost systemd nginxservice Unit entered failed state Dec localhost systemd nginxservice Failed with result exitcode Steps to Reproduce Reinstalled a new server on a new KVM VPS Ubuntu Let Streisand configure the System with custom settings If you have a streisanddiagnosticsmd file in your Streisand directory please paste its contents below Ansible Information Ansible version Ansible system Linux Host OS Ubuntu Host OS version Python interpreter usrbinpython Python version Streisand Information Streisand Git revision f bc b d bf a dab b f Streisand Git clone has untracked changes yes Genesis role localhost Custom SSH key False Enabled Roles Shadowsocks enabled True Wireguard enabled True OpenVPN enabled True stunnel enabled True Tor enabled False Openconnect enabled True TinyProxy enabled True SSH forward user enabled True Configured number of VPN clients This is the same error which was reported on Support for python will be deprecated in January What dependencies need to be ported to before this happens The ec metadatainstanceyml playbook blocked requests to EC metadata but providerdetectyml playbook has code to detect cloud provider by querying ec metadata ExecStartsbinroute add host reject name Find the external EC IP from Metadata command curl register streisandec externalip changedwhen False So it will be impossible to execute streisandexistingcloudserversh script subsequently after a successful attempt As a workaround ssh onto instance run sudo ip r del The Windows Stunnel Setup instructions in step says to Open the directory where you installed stunnel For most users this will either be in C Program Files stunnel or C Program Files x stunnel Using a fresh install today I had to append config to that path eg C Program Files x stunnel config This is on a vanilla install all defaults accepted on Amazon AWS TASK downloadandverify Download the OpenVPN Community files changed itemusig uopenvpnlateststabletargzasc ufile uopenvpnlateststabletargz failed itemusig uopenvpninstalllateststableexeasc ufile uopenvpninstalllateststableexe ansibleloopvar item changed false dest varwwwstreisandmirroropenvpnopenvpninstalllateststableexe elapsed item file openvpninstalllateststableexe sig openvpninstalllateststableexeasc msg Request failed response HTTP Error Not Found statuscode url TASK openvpn One or more of the VPN clients could not be mirrored Please file a bug report on GitHub so that the version number checksum or download location can be updated Setup will now continue 