Test sndrcvrelptlscfgcmdsh failed in rsyslog with librelp testbench TZ env var not set setting it to UTC Test sndrcvrelptlscfgcmdsh config rstb fa fconf is moduleloadpluginsimdiaglibsimdiag globalinputstimeoutshutdown defaultactionqueuetimeoutshutdown defaultactionqueuetimeoutEnqueue use legacystyle for the following settings so that we can override if needed MainmsgQueueTimeoutEnqueue MainmsgQueueTimeoutShutdown IMDiagListenPortFileName rstb fa fimdiagport IMDiagServerRun IMDiagAbortTimeout syslogtag contains rsyslogd rstb fa fstarted end of testbench instrumentation part test conf follows module loadpluginsimrelplibsimrelp tlstlslibopenssl then SENDER sends to this port not tcpflood input typeimrelp port tlson tlstlscfgcmdProtocolALLSSLv SSLv TLSv TLSv template outfmtmsgF n msg contains msgnum actiontypeomfile filerstb fa foutlog templateoutfmt rsyslogd NOTE RSYSLOGDEBUGTIMEOUTSTOSTDERR activated rsyslogd error invalid debug option nologfuncflow ignored rsyslogd error invalid debug option noprintmutexaction ignored main QReg worker start requested num workers currently main QReg wrkr start initiated with state num workers now rsyslog debug main QReg worker x ff c c a started rsyslog debug main QReg started with state num workers now rstb fa fpid found pid rsyslogd startup msg seen pid waiting for file rstb fa fimdiagport imdiag port config rstb fa f conf is moduleloadpluginsimdiaglibsimdiag globalinputstimeoutshutdown defaultactionqueuetimeoutshutdown defaultactionqueuetimeoutEnqueue use legacystyle for the following settings so that we can override if needed MainmsgQueueTimeoutEnqueue MainmsgQueueTimeoutShutdown IMDiagListenPortFileName rstb fa fimdiag port IMDiagServerRun IMDiagAbortTimeout syslogtag contains rsyslogd rstb fa f started end of testbench instrumentation part test conf follows module loadpluginsomrelplibsomrelp tlstlslibopenssl action typeomrelp target port tlson tlstlscfgcmdProtocolALLTLSv rsyslogd NOTE RSYSLOGDEBUGTIMEOUTSTOSTDERR activated rsyslogd error invalid debug option nologfuncflow ignored rsyslogd error invalid debug option noprintmutexaction ignored main QReg worker start requested num workers currently main QReg wrkr start initiated with state num workers now rsyslog debug main QReg worker x f ba a started rsyslog debug main QReg started with state num workers now rstb fa f pid found pid rsyslogd startup msg seen pid waiting for file rstb fa fimdiag port imdiag port injecting messages imdiag messages injected Shutting down instance imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag mainqueue empty DoDie called rsyslogd debug info trying to cooperatively stop input pluginsimdiaglibsimdiag timeout ms rsyslog debug main QRegw enter WrkrExecCleanup rsyslog debug x f ba a worker exiting rsyslog debug main QRegw thread joined wait on shutdown of Shutting down instance imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag mainqueue empty DoDie called rsyslogd debug info trying to cooperatively stop input pluginsimdiaglibsimdiag timeout ms rsyslogd debug info trying to cooperatively stop input imrelp timeout ms rsyslog debug main QRegw enter WrkrExecCleanup rsyslog debug x ff c ca e worker exiting rsyslog debug main QRegw thread joined wait on shutdown of contentcheck did not yet succeed contentcheck did not yet succeed In rsyslog imrelptlscfgcmdsh is failing FAIL imrelptlscfgcmd testbench TZ env var not set setting it to UTC Test imrelptlscfgcmdsh config rstb a ec conf is moduleloadpluginsimdiaglibsimdiag globalinputstimeoutshutdown defaultactionqueuetimeoutshutdown defaultactionqueuetimeoutEnqueue use legacystyle for the following settings so that we can override if needed MainmsgQueueTimeoutEnqueue MainmsgQueueTimeoutShutdown IMDiagListenPortFileName rstb a ec imdiagport IMDiagServerRun IMDiagAbortTimeout syslogtag contains rsyslogd rstb a ec started end of testbench instrumentation part test conf follows module loadpluginsimrelplibsimrelp tlstlslibopenssl inputtypeimrelp port tlson tlscacerttlscertscapem tlsmycerttlscertscertpem tlsmyprivkeytlscertskeypem tlsauthmodecertvalid tlspermittedpeerrsyslog tlstlscfgcmdProtocolALLSSLv SSLv TLSv TLSv templatenameoutfmt typestring stringmsgF n msg contains msgnum actiontypeomfile templateoutfmt fileecho RSYSLOGOUTLOG rsyslogd NOTE RSYSLOGDEBUGTIMEOUTSTOSTDERR activated rsyslogd error invalid debug option nologfuncflow ignored rsyslogd error invalid debug option noprintmutexaction ignored main QReg worker start requested num workers currently main QReg wrkr start initiated with state num workers now rsyslog debug main QReg worker x f b e a started rsyslog debug main QReg started with state num workers now rstb a ec pid found pid rsyslogd startup msg seen pid waiting for file rstb a ec imdiagport imdiag port starting run Sending messages messages sent runtime End of tcpflood Run Shutting down instance imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag wait qempty qsize nempty imdiag mainqueue empty DoDie called rsyslogd debug info trying to cooperatively stop input pluginsimdiaglibsimdiag timeout ms rsyslogd debug info trying to cooperatively stop input imrelp timeout ms rsyslog debug main QRegw enter WrkrExecCleanup rsyslog debug x f b ee c worker exiting rsyslog debug main QRegw thread joined wait on shutdown of contentcheck did not yet succeed contentcheck did not yet succeed FILE rstb a ec tcpflood content FAIL contentcheck failed to find relp connect failed with return not reporting failure as RSYSLOGSTATSURL is not set FAIL Test imrelptlscfgcmdsh took seconds FAIL imrelptlscfgcmdsh exit status FAIL sndrcvrelptlscfgcmd Tested against librelp My database only allows inserts over of range of plus or minus about days from current time On occasion an incorrectly configured machine will send syslog data with timestamps outside of this range The database then returns an error for these inserts I was wondering what is the official policy on failed database inserts Retry or throw away and continue Expected behavior omelasticsearch can parse an elasticsearch response from a bulkmode insert Actual behavior After rsyslog was upgraded to omelasticsearch fails to parse valid reply that includes items T ourhostname rsyslogd omelasticsearch error in elasticsearch reply bulkmode insert does not return array reply is elkproduction green took errorsfalseitems indexindexrsyslog typersyslogidTpX qm BhsTOmI LK EEversion resultcreatedshardstotal successful failed seqno primaryterm status v try Steps to reproduce the behavior I am not too sure I think it has to do with logic in this PR But basically increasing the buffer and then trying to send messages smaller than that increase The problem persists after restart of rsyslogd but maybe thats just due to the volume of messages in our buffer Environment rsyslog version aka platform Ubuntu Note we are running Ubuntu hosts that still have rsyslogd aka which arent experiencing issues to the same elasticsearch cluster On hosts experiencing this error I do not see any logged allocation errors realloc failed in curlResult in the log history templatesconftxt Expected behavior rsyslog should log to syslog using the imuxsock module Actual behavior rsyslog generates error messages like file write error Inputoutput error v try and does not write to the syslog Steps to reproduce the behavior Reboot machine and the service fails If after rebooting the service is restarted the service starts working It seems to fail to work only after a reboot After reboot the journalctl logs has this Jan radius examplecom systemd Starting System Logging Service Jan radius examplecom rsyslogd imuxsock Acquired UNIX socket runsystemdjournalsyslog fd from systemd v Jan radius examplecom systemd Started System Logging Service Jan radius examplecom rsyslogd origin softwarersyslogd swVersion xpid xinfo start Jan radius examplecom rsyslogd file write error Inputoutput error v try Jan radius examplecom rsyslogd file write error Inputoutput error v try Jan radius examplecom rsyslogd file write error Inputoutput error v try forever Environment rsyslog version platform Debian buster Looking at the unix sockets on a server where rsyslog is working properly I see these file descriptors owned by the rsyslogd process lrx root root Jan devnull lwx root root Jan devnull lwx root root Jan devnull lrwx root root Jan socket runsystemdjournalsyslog lrx root root Jan devurandom lrwx root root Jan socket varspoolpostfixdevlog lrx root root Jan prockmsg lwx root root Jan devconsole lwx root root Jan varlogmessages lrwx root root Jan socket On a server where rsyslog is not working I see the same set except the file descriptor corresponding to the number in the error message in the example above this is is missing and the last socket the one not pointing at a file keeps getting regenerated Rsyslog is managed by systemd with the stock systemd unit file that comes with Debian buster etcrsyslogconf ModLoad imuxsock ModLoad imklog ActionFileDefaultTemplate RSYSLOGTraditionalFileFormat FileOwner root FileGroup root WorkDirectory varspoolrsyslog FileCreateMode DirCreateMode SystemLogRateLimitInterval IncludeConfig etcrsyslogdconf etcrsyslogdpostfixconf AddUnixListenSocket varspoolpostfixdevlog etcrsyslogd defaultconf emerg actiontype omusrmsg name emerg users root debug actiontype omfile name defaultLocal file varlogmessages template FileFormat err actiontype omfile name err file devconsole etcrsyslogd authproxyconf if syslogfacilitytext local then actiontype omfile name authproxyLocal file varlogduoauthproxy template FileFormat stop etcrsyslogd templatesconf Attached as templatesconftxt Here is the systemd unit file used to control the rsyslogd service on buster Unit DescriptionSystem Logging Service Requiressyslogsocket Documentationmanrsyslogd Documentation Service Typenotify ExecStartusrsbinrsyslogd n iNONE StandardOutputnull Restartonfailure Increase the default a bit in order to allow many simultaneous files to be monitored we might need a lot of fds LimitNOFILE Install WantedBymultiusertarget Aliassyslogservice Hi Ive found a strange log in my syslog file so i think there is a typo have a look at this merge request on my forked rsyslog This was accidentally set to no Test for imfile should by default run when imfile is enabled see also LEGAL GDPR NOTICE According to the European data protection laws GDPR we would like to make you aware that contributing to rsyslog via git will permanently store the name and email address you provide as well as the actual commit and the time and date you made it inside gits version history This is inevitable because it is a main feature git If you are concerned about your privacy we strongly recommend to use author anonymous gdprexamplecom together with your commit Also please do NOT sign your commit in this case as that potentially could lead back to you Please note that if you use your real identity the GDPR grants you the right to have this information removed later However we have valid reasons why we cannot remove that information later on The reasons are this would break git history and make future merges unworkable the rsyslog projects has legitimate interest to keep a permanent record of the contributor identity once given for copyright verification being able to provide proof should a malicious commit be made Please also note that your commit is public and as such will potentially be processed by many thirdparties Gits distributed nature makes it impossible to track where exactly your commit and thus your personal data will be stored and be processed If you would not like to accept this risk please do either commit anonymously or refrain from contributing to the rsyslog project Expected behavior Actual behavior Steps to reproduce the behavior Environment rsyslog version eg use rsyslogd v to obtain the version number platform eg Ubuntu for configuration questionsissues include rsyslogconf and included config files Note rsyslog documentation is available here current stable release prerelease Version Debian sid Trying to build the latest version of rsyslog for Debian I get PASS immarksh SNIPPED by admin for easier readability SKIP imfilelogrotatenocopytruncatesh FAIL imfilegrowingfileidsh PASS glbloversizeMsgtruncateimfilesh PASS configenabledonsh PASS configenabledoffsh PASS imfileendmsgregexwithexamplesh make Entering directory hometestrsyslog tests make Nothing to be done for imfileescapelfreplacementlog make Nothing to be done for imfileescapelfreplacementemptylog make Leaving directory hometestrsyslog tests fatal making testsuitelog failed to create imfileescapelfreplacementtrs fatal making testsuitelog failed to create imfileescapelfreplacementlog fatal making testsuitelog failed to create imfileescapelfreplacementemptytrs fatal making testsuitelog failed to create imfileescapelfreplacementemptylog make Makefile testsuitelog Error LEGAL GDPR NOTICE According to the European data protection laws GDPR we would like to make you aware that contributing to rsyslog via git will permanently store the name and email address you provide as well as the actual commit and the time and date you made it inside gits version history This is inevitable because it is a main feature git If you are concerned about your privacy we strongly recommend to use author anonymous gdprexamplecom together with your commit Also please do NOT sign your commit in this case as that potentially could lead back to you Please note that if you use your real identity the GDPR grants you the right to have this information removed later However we have valid reasons why we cannot remove that information later on The reasons are this would break git history and make future merges unworkable the rsyslog projects has legitimate interest to keep a permanent record of the contributor identity once given for copyright verification being able to provide proof should a malicious commit be made Please also note that your commit is public and as such will potentially be processed by many thirdparties Gits distributed nature makes it impossible to track where exactly your commit and thus your personal data will be stored and be processed If you would not like to accept this risk please do either commit anonymously or refrain from contributing to the rsyslog project 