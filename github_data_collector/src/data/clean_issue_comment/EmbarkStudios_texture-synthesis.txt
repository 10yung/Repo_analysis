This adds support for building the lib for both wasm unknownunknown and wasm wasi with singlethreaded execution and for running the CLI with wasm wasi Example sh rustup target add wasm wasi cargo build release target wasm wasi wasmer run targetwasm wasireleasetexturesynthesiswasm mapdiroutout mapdirimgsimgs out out jpg generate imgs jpg It is not too practical yet without multithreading support which WASM doesnt support yet but is very portable and is a good benchmark to test WASM performance with I was pretty happy with the mdbook refactor I did I think we could improve the docs for this repo as well Thoughts anopara Hi I watched the talk linked in the Readme At the end Anastasia mentions that you are currently working on bringing the d concept to d I am currently working on a hobby Voxel enigne in rustvulkan and thought it might be easy to transfer the algorithm to d given a good Voxel loadingediting crate similar to the image crate Are there already working prototypes internally which take some d information and apply the algorithm to generate a new d model Do you have some more crates in this direction planed or would it make sense for me to either extent this project to also worke in d or create a new one from scratch Greetings Tendsin Mende Though is a bug in structopt we should still have at least one example of using sample masks so that if users copy it and replace eg the input image paths they wont get this confusing error message When running bash texturesynthesis inpaint maskpng o outputpng samplemasks IGNORE maskpng generate whitesquarepng texturepng I get error The subcommand generate wasnt recognized Did you mean generate If you believe you received this message in error try rerunning with texturesynthesis generate USAGE texturesynthesis inpaint inpaint outsize outsize out outputpath samplemasks samplemasks Is this the expected behavior How should I use samplemasks option there is no example in the README The help says samplemasks samplemasks Paths to sample masks used to determine which pixels in an example can be used as inputs during generation any example that doesnt have a mask or uses ALL will consider all pixels in the example If IGNORE is specified then the example image wont be used at all which is useful with inpaint Im precisely trying to use samplemasks in combination with inpaint but can not manage to do it Checklist x I have read the Contributor Guide CONTRIBUTINGmd x I have read and agree to the Code of Conduct CODEOFCONDUCTmd x I have added a description of my changes and why Id like them included in the section below Description of Changes Remove calls to CandidateStructclear and the function itself These are not necessary as Only findcandidates directly uses the Vec whose elements are being cleared everything else uses the truncated slice returned by findcandidates All CandidateStructs in that slice have been updated in the if checkcoordvalidity block within findcandidates and this resizes the CandidateStructs kneighs to have length matching the input kneighs and then overwrites all of its values Clearing these vectors meant that findcandidates was wasting time writing values into the underlying allocations only to immediately potentially truncate the vecs and then overwrite the values without using them The cargo bench logs below show an improvement on every benchmark ranging from to This might make the code slightly more brittle in the face of future changes but the regression tests should catch this and I dont think this is any more subtle than the existing implicit invariants between functions This has trivial merge conflicts with but Ill fix those after youve decided which PRs you want to merge philphilMS B texturesynthesis master U cargo bench Finished bench optimized debuginfo targets in s Running targetreleasedepsallthethingsae f b bcc ba singleexample time ms ms ms Benchmarking singleexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to singleexample time ms ms ms Benchmarking singleexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to singleexample time ms ms ms Benchmarking singleexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to singleexample time ms ms ms Benchmarking singleexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to singleexample time s s s Found outliers among measurements high mild multiexample time ms ms ms Found outliers among measurements high mild multiexample time ms ms ms Found outliers among measurements high mild Benchmarking multiexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to multiexample time ms ms ms Benchmarking multiexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to multiexample time ms ms ms Benchmarking multiexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to multiexample time s s s Found outliers among measurements low mild Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time s s s Found outliers among measurements high severe Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms Found outliers among measurements high mild Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms Found outliers among measurements high mild Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time s s s Found outliers among measurements high mild inpaint time ms ms ms Found outliers among measurements low mild inpaint time ms ms ms Benchmarking inpaint Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaint time ms ms ms Benchmarking inpaint Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaint time ms ms ms Benchmarking inpaint Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaint time ms ms ms Found outliers among measurements low mild high severe inpaintchannel time ms ms ms inpaintchannel time ms ms ms Found outliers among measurements high severe Benchmarking inpaintchannel Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaintchannel time ms ms ms Benchmarking inpaintchannel Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaintchannel time ms ms ms Found outliers among measurements low mild high mild high severe Benchmarking inpaintchannel Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaintchannel time ms ms ms tiling time ms ms ms Found outliers among measurements low mild tiling time ms ms ms Benchmarking tiling Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to tiling time ms ms ms Benchmarking tiling Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to tiling time ms ms ms Found outliers among measurements low mild Benchmarking tiling Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to tiling time ms ms ms philphilMS B texturesynthesis master U git checkout clear M Cargotoml Switched to branch clear philphilMS B texturesynthesis clear U cargo bench Compiling texturesynthesis v homephiltexturesynthesislib Finished bench optimized debuginfo targets in s Running targetreleasedepsallthethingsae f b bcc ba singleexample time ms ms ms change p Performance has improved singleexample time ms ms ms change p Performance has improved Benchmarking singleexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to singleexample time ms ms ms change p Performance has improved Found outliers among measurements high mild Benchmarking singleexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to singleexample time ms ms ms change p Performance has improved Benchmarking singleexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to singleexample time s s s change p Performance has improved multiexample time ms ms ms change p Performance has improved multiexample time ms ms ms change p Performance has improved Benchmarking multiexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to multiexample time ms ms ms change p Performance has improved Benchmarking multiexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to multiexample time ms ms ms change p Performance has improved Benchmarking multiexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to multiexample time s s s change p Performance has improved Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms change p Performance has improved Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms change p Performance has improved Found outliers among measurements high severe Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms change p Performance has improved Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms change p Performance has improved Found outliers among measurements low mild Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time s s s change p Performance has improved Found outliers among measurements low severe high severe Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms change p Performance has improved Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms change p Performance has improved Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms change p Performance has improved Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms change p Change within noise threshold Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time s s s change p Performance has improved Found outliers among measurements high mild high severe inpaint time ms ms ms change p Performance has improved inpaint time ms ms ms change p Performance has improved Found outliers among measurements low mild high mild Benchmarking inpaint Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaint time ms ms ms change p Performance has improved Found outliers among measurements high severe Benchmarking inpaint Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaint time ms ms ms change p Performance has improved Benchmarking inpaint Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaint time ms ms ms change p Performance has improved Found outliers among measurements high mild inpaintchannel time ms ms ms change p Performance has improved inpaintchannel time ms ms ms change p Performance has improved Found outliers among measurements high mild Benchmarking inpaintchannel Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaintchannel time ms ms ms change p Performance has improved Benchmarking inpaintchannel Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaintchannel time ms ms ms change p Performance has improved Found outliers among measurements high severe Benchmarking inpaintchannel Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaintchannel time ms ms ms change p Performance has improved tiling time ms ms ms change p Performance has improved tiling time ms ms ms change p Performance has improved Benchmarking tiling Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to tiling time ms ms ms change p Performance has improved Benchmarking tiling Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to tiling time ms ms ms change p Performance has improved Benchmarking tiling Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to tiling time ms ms ms change p Performance has improved Found outliers among measurements high mild Checklist x I have read the Contributor Guide CONTRIBUTINGmd x I have read and agree to the Code of Conduct CODEOFCONDUCTmd x I have added a description of my changes and why Id like them included in the section below Description of Changes All very minor stuff Split into a series of commits to make it easier to cherrypick changes you agree with I tend to tinker with code as Im reading through it and thought I might as well upstream these no offence taken if you decide this is just unnecessary churn Checklist x I have read the Contributor Guide CONTRIBUTINGmd x I have read and agree to the Code of Conduct CODEOFCONDUCTmd x I have added a description of my changes and why Id like them included in the section below Description of Changes A microoptimisation to reduce the number of calls to f exp and avoid an allocation in a fairly hot function This gives a small speedup see cargo bench output below at the possible cost of making the code structure marginally worse as the decision about how to decay scores with distances is no longer solely made within findbestmatch I have a few more tidying changes on a fork and hope to also come up with a few more microoptimisations Shout if youd rather not have such changes eg because the minor improvements arent worth the code churn potential merge conflicts or effort to review The first run below is on this branch the second on master Of the results show an improvement after this change have regressed and are within noise threshold philphilMS B texturesynthesis exp U cargo bench Downloaded itertools v Compiling texturesynthesis v homephiltexturesynthesislib Finished bench optimized debuginfo targets in s Running targetreleasedepsallthethingsae f b bcc ba singleexample time ms ms ms singleexample time ms ms ms Benchmarking singleexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to singleexample time ms ms ms Found outliers among measurements high mild Benchmarking singleexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to singleexample time ms ms ms Benchmarking singleexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to singleexample time s s s multiexample time ms ms ms Found outliers among measurements high mild multiexample time ms ms ms Benchmarking multiexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to multiexample time ms ms ms Benchmarking multiexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to multiexample time ms ms ms Benchmarking multiexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to multiexample time s s s Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time s s s Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms Found outliers among measurements high mild Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time s s s inpaint time ms ms ms Found outliers among measurements low mild inpaint time ms ms ms Benchmarking inpaint Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaint time ms ms ms Found outliers among measurements high severe Benchmarking inpaint Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaint time ms ms ms Benchmarking inpaint Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaint time ms ms ms inpaintchannel time ms ms ms inpaintchannel time ms ms ms Found outliers among measurements low mild high mild Benchmarking inpaintchannel Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaintchannel time ms ms ms Benchmarking inpaintchannel Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaintchannel time ms ms ms Benchmarking inpaintchannel Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaintchannel time ms ms ms tiling time ms ms ms tiling time ms ms ms Benchmarking tiling Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to tiling time ms ms ms Benchmarking tiling Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to tiling time ms ms ms Benchmarking tiling Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to tiling time ms ms ms philphilMS B texturesynthesis exp U git checkout master M Cargotoml Switched to branch master Your branch is up to date with originmaster philphilMS B texturesynthesis master U cargo bench Compiling texturesynthesis v homephiltexturesynthesislib Finished bench optimized debuginfo targets in s Running targetreleasedepsallthethingsae f b bcc ba singleexample time ms ms ms change p Performance has regressed Found outliers among measurements low severe high mild Benchmarking singleexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to singleexample time ms ms ms change p Performance has regressed Benchmarking singleexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to singleexample time ms ms ms change p Performance has regressed Benchmarking singleexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to singleexample time ms ms ms change p Performance has regressed Benchmarking singleexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to singleexample time s s s change p Performance has regressed multiexample time ms ms ms change p Performance has regressed multiexample time ms ms ms change p Change within noise threshold Benchmarking multiexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to multiexample time ms ms ms change p Performance has regressed Found outliers among measurements high mild Benchmarking multiexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to multiexample time ms ms ms change p Performance has regressed Found outliers among measurements low mild Benchmarking multiexample Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to multiexample time s s s change p No change in performance detected Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms change p Performance has regressed Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms change p Performance has regressed Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms change p No change in performance detected Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time ms ms ms change p Performance has improved Benchmarking guided Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to guided time s s s change p Performance has improved Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms change p Performance has regressed Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms change p Performance has regressed Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms change p Performance has regressed Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time ms ms ms change p No change in performance detected Benchmarking styletransfer Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to styletransfer time s s s change p No change in performance detected inpaint time ms ms ms change p No change in performance detected Found outliers among measurements high mild inpaint time ms ms ms change p Change within noise threshold Found outliers among measurements high mild Benchmarking inpaint Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaint time ms ms ms change p Change within noise threshold Benchmarking inpaint Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaint time ms ms ms change p No change in performance detected Found outliers among measurements low severe high mild high severe Benchmarking inpaint Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaint time ms ms ms change p Performance has regressed inpaintchannel time ms ms ms change p Performance has regressed inpaintchannel time ms ms ms change p Performance has regressed Benchmarking inpaintchannel Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaintchannel time ms ms ms change p Performance has regressed Found outliers among measurements high mild Benchmarking inpaintchannel Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaintchannel time ms ms ms change p No change in performance detected Benchmarking inpaintchannel Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to inpaintchannel time ms ms ms change p No change in performance detected tiling time ms ms ms change p Performance has regressed Found outliers among measurements high mild tiling time ms ms ms change p Change within noise threshold Benchmarking tiling Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to tiling time ms ms ms change p No change in performance detected Benchmarking tiling Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to tiling time ms ms ms change p No change in performance detected Found outliers among measurements low mild Benchmarking tiling Warming up for s Warning Unable to complete samples in s You may wish to increase target time to s or reduce sample count to tiling time ms ms ms change p No change in performance detected Found outliers among measurements high mild As this project distributes binary executables in the GitHub releases and as now have our cargoabout tool we should use it to include license attribution for all dependencies used in the texture synthesis cli application for every release Would be great to have a subcommand that prints out the licenses something like texturesynthesiscli aboutlicenses that shows a simple list of crates license and then maybe a texturesynthesiscli aboutlicensesfull that shows the full license text for every unique license as well Should have a standard naming output and CI set up for this that we and others can use in all of our binary tools