Ive recently started to see the broker complaining about connection timeouts Some messages that seem to have been pubished OK also are not received It turns out that the fix is to delay for ms before turning off the WiFi after a call to disconnect Presumably this is to allow time for the preceding messages and the disconnect to be transmitted or for an ACK to be received or something Is this normalexpected If so is it possible to tell when it is safe to put the processor ESP to sleep after a disconnect call ie to find out when all the messages have actually been sent to the server I realise this may be determined from the WiFiClient perhaps is it possible to get QoS level in in subscribe function and please guide me if it is possible then is it possible to publish a message two times and get it delivered two times or it will just be delivered only once in a life time if the topic is the same Get this panic after subscribing to other clients published topics in total If I dont subscribe then all is fine The panic occurs every hrs clients publish data every seconds Im using PubSub Client with Arduino IDE and ESP MQTT Server running on RPi Guru Meditation Error Core paniced InstrFetchProhibited Exception was unhandled Core register dump PC x PS x A x d A x ffcb A x ffc a A x A x A x efa A x A x ffc edd A x d efd A x A x ffc b A x ffcb a A x ffcb a A x ffcb ac A x A x SAR x a EXCCAUSE x EXCVADDR x LBEG x c e LEND x c f LCOUNT xffffffff Backtrace x x ffcb x d x ffcb d x d d x ffcb f x d d x ffcb Rebooting ets Jun rst xc SWCPURESETboot x SPIFASTFLASHBOOT configsip SPIWP xee clkdrv x qdrv x ddrv x cs drv x hddrv x wpdrv x modeDIO clock div load x fff len load x fff clen ho tail room load x len ho tail room load x len entry x b Code include WiFih include PubSubClienth include Timerh include TimeLibh include WiFiUdph include ArduinoOTAh define DEBUG define ANALOGPIN bool doorbellpushed false bool timeisvalid false bool blink false bool connected false bool dataReady false String DeviceID esp xx String Location Front Door String firmware String movementTime String bootTime String ip String alexa enabled String doorbellpushedTime String currentTime String uTime String topicData String topic Timer mqttPublish Timer IswiFiConnected Timer mqttSubscribe Timer cpuLED timet LocalTime struct tm timeinfo WiFi network name and password const char networkName XXXXXXXX const char networkPswd xxxxxxxxxxx const char mqttpwd xxxxxxxxxxxxxxxxxxxx make unique for each device unsigned long uptime long lastReconnectAttempt long iteration int CpuledPin change to int deviceReset int presence offline active int port int onetime char buffer char timeServer ukpoolntporg char MQTTServer xxxxxxxxxxxx WiFiClient wifiClient PubSubClient clientwifiClient void callbackchar pubtopic byte payload unsigned int len iteration dataReady false SerialprintCallback Serialprintlniteration bool reconnect loops int loopcounter Loop until were reconnected while clientconnected SerialprintAttempting MQTT connection Attempt to connect if clientconnectxxxxxxx xxxxxxx mqttpwd Serialprintlnconnected else Serialprintfailed rc Serialprintclientstate Serialprintln try again in seconds Wait seconds before retrying delay loopcounter ifloopcounter ESPrestart return clientconnected void setup Initilize hardware serial Serialbegin btStop setenvTZGMT BSTM M OTA SETUP WiFimodeWIFISTA DeviceIDtoCharArraybufferDeviceIDlength ArduinoOTAsetHostnamebuffer Port defaults to ArduinoOTAsetPort Hostname defaults to esp MAC ArduinoOTAsetHostnamemyesp No authentication by default ArduinoOTAsetPasswordadmin Password can be set with its md value as well MD admin f a a a a e a fc ArduinoOTAsetPasswordHash f a a a a e a fc ArduinoOTAonStart String type if ArduinoOTAgetCommand UFLASH type sketch else USPIFFS type filesystem NOTE if updating SPIFFS this would be the place to unmount SPIFFS using SPIFFSend SerialprintlnStart updating type ArduinoOTAonEnd Serialprintln nEnd ArduinoOTAonProgress unsigned int progress unsigned int total SerialprintfProgress u r progress total ArduinoOTAonError otaerrort error SerialprintfError u error if error OTAAUTHERROR SerialprintlnAuth Failed else if error OTABEGINERROR SerialprintlnBegin Failed else if error OTACONNECTERROR SerialprintlnConnect Failed else if error OTARECEIVEERROR SerialprintlnReceive Failed else if error OTAENDERROR SerialprintlnEnd Failed ArduinoOTAbegin Connect to the WiFi network connectToWiFinetworkName networkPswd pinModeCpuledPin OUTPUT digitalWriteCpuledPin HIGH Indicate Startup clientsetServerMQTTServerport clientsetCallbackcallback configTime timeServer Serialprintln SerialprintWaiting for NTP TIME Server bool rc localTime int loopCounter while rc loopCounter configTime timeServer rc localTime Serialprint delay loopCounter ifloopCounter ESPrestart Serialprintln SerialprintSuccessfully obtained TIME from NTP Server SerialprintlntimeServer setenvTZGMT BSTM M cpuLEDevery ledBlink ms blink led mqttPublishevery mqttUpdate s mqttSubscribeevery subscribeMQTT s IswiFiConnectedevery wiFiConnected s digitalWriteCpuledPin LOW bootTime timeToString void loop ArduinoOTAhandle localTime cpuLEDupdate mqttPublishupdate mqttSubscribeupdate IswiFiConnectedupdate if clientconnected long now millis if now lastReconnectAttempt lastReconnectAttempt now Attempt to reconnect if reconnect lastReconnectAttempt else Client connected clientloop void ledBlink ifblink digitalWriteCpuledPin HIGH blink true return ifblink digitalWriteCpuledPin LOW blink false bool localTime setenvTZGMT BSTM M ifgetLocalTime timeinfo SerialprintFailed to obtain time retrying Serialprintln timeisvalid false return false currentTime timeToString timeisvalid true return true void mqttUpdate int len memsetbuffer firmwaretoCharArraybuffer clientpublishhomedev statusfirmwarebuffer len DeviceIDlength DeviceIDtoCharArraybuffer len clientpublishhomedev statusdeviceID buffer len Locationlength LocationtoCharArraybuffer len clientpublishhomedev statuslocation buffer uptime uptime dtostrfuptime buffer clientpublishhomedev statusuptime buffer len bootTimelength bootTimetoCharArraybuffer len clientpublishhomedev statusboot buffer len iplength iptoCharArraybuffer len clientpublishhomedev statusip buffer currentTime timeToString len currentTimelength currentTimetoCharArraybuffer len just show time clientpublishhomedev statustime buffer dtostrfiteration buffer clientpublishhomedev statusCallBackCount buffer ifonetime subscribeMQTT delay subscribeMQTT onetime void wiFiConnected int wifiStatus wifiStatus WiFistatus ifwifiStatus WLCONNECTED SerialprintlnNo wifi connectivity detected restarting esp ESPrestart void lastError String p Startup return void subscribeMQTT clientsubscribehomedev cmdreset clientsubscribehomedev statusuptime clientsubscribehomedev statusuptime clientsubscribehomedev statusuptime void connectToWiFiconst char ssid const char pwd SerialprintlnConnecting to WiFi network Stringssid delete old config WiFidisconnecttrue register event handler WiFionEventWiFiEvent Initiate connection WiFibeginssid pwd SerialprintlnWaiting for WIFI connection void WiFiEventWiFiEventt event switchevent case SYSTEMEVENTSTAGOTIP When connected set Serialprintln SerialprintWiFi connected IP address SerialprintlnWiFilocalIP ip WiFilocalIPtoString initializes the UDP state This initializes the transfer buffer udpbeginWiFilocalIPudpPort connected true break case SYSTEMEVENTSTADISCONNECTED SerialprintlnWiFi lost connection restarting ESP connected false ESPrestart break String timeToString String s String f iftimeinfotmhour s s f s s timeinfotmhour s s iftimeinfotmmin s s f s s timeinfotmmin s s iftimeinfotmsec s s f s s timeinfotmsec s s timeinfotmmday s s timeinfotmmon s s timeinfotmyear return s Hi there Im working on a project where I want to connect a Controllino with an ESP WiFi module I can successfully connect to a WiFi and connect to a local Cbased broker on that WiFi Both the PubSubClient and the broker confirms this However I have run into an issue when I want to check for new messages and renew the connection via mqttClientloop in the void loop method Likewise if I want to check the current connectivity state mqttClientconnected my WiFi connectivity stops working entirely and I am no longer able to connect to the WiFi Libraries needed include PubSubClienth include WiFiEsph include Controllinoh Baseline Controllino library Mandatory in order to use CONTROLLINOxx aliases for pins in sketch WiFi credentials and Broker information char ssid XXXXX Network SSID name char pass xxxxxx Network password int status WLIDLESTATUS the WiFi radios status char serverIP int portNumber char macArrayToSend For later use Setting up arrays for easier management of leds and buttons int buttonLEDs CONTROLLINOD CONTROLLINOD CONTROLLINOD CONTROLLINOD CONTROLLINOD CONTROLLINOD CONTROLLINOD CONTROLLINOD CONTROLLINOD int buttonAnalog CONTROLLINOA CONTROLLINOA CONTROLLINOA CONTROLLINOA CONTROLLINOA CONTROLLINOA CONTROLLINOA CONTROLLINOA CONTROLLINOA WiFi Client Used to establish connection to local WiFi WiFiEspClient espClient MQTT Client PubSubClient mqttClientserverIP portNumber espClient void callbackchar topic byte payload unsigned int length SerialprintMessage arrived Serialprinttopic Serialprint for int i ilengthi Serialprintcharpayload i Serialprintln Functions void setupMQTTClient Serialprintln MQTT Attempting to connect to broker mqttClientsetCallbackcallback bool connectionResult mqttClientconnectCONTROLLINO superSecretUN superSecretPW Serialprint MQTT Connection result SerialprintlnconnectionResult while connectionResult Serialprintln MQTT Connection failed delay connectionResult mqttClientconnectCONTROLLINO superSecretUN superSecretPW if connectionResult Serialprintln MQTT Connection established Serialprintln MQTT Subscribing to topic mqttClientsubscribeCONTROLLINO Breaks the program void setupWiFi WiFiinit Serial Initialize connection via Serial if WiFistatusWLNOSHIELD SerialprintlnWiFiEsp WiFi shield not present whiletrue while status WLCONNECTED Serialprint WiFiEsp Attempting to connect to WPA SSID Serialprintlnssid Connect to WPAWPA network status WiFibeginssid pass Serialprintln WiFiEsp WiFi connection established SerialprintWIFI Status Serialprintlnstatus Turns on a button LED and waits for button press before continuing bool turnOnButtonint input if input Edge cases where designated LED does not exist in PLC return false if input Edge case where a reset of all LEDs is requested for int i i sizeofbuttonLEDs i digitalWritebuttonLEDs i LOW return true else Turn on LED digitalWritebuttonLEDs input HIGH whiledigitalReadbuttonAnalog input LOW Keep waiting for the user to push the button The button has been pushed down by the user SerialprintlnButton pushed digitalWritebuttonLEDs input LOW return true void printWifiStatus Print the SSID of the network currently connected to SerialprintSSID SerialprintlnWiFiSSID Print WiFi modules IP address IPAddress ip WiFilocalIP SerialprintIP Address Serialprintlnip Print WiFi modules MAC address byte mac WiFimacAddressmac SerialprintMAC Address Serialprintmac HEX Serialprint Serialprintmac HEX Serialprint Serialprintmac HEX Serialprint Serialprintmac HEX Serialprint Serialprintmac HEX Serialprint Serialprintlnmac HEX Print the received signal strength long rssi WiFiRSSI SerialprintSignal strength RSSI Serialprintrssi Serialprintln dBm Set up pins and LEDS using arrays void setupPins Serialprintln CONTROLLINO Setting up pins for int i i sizeofbuttonLEDs i Set up LED pins pinModebuttonLEDs i OUTPUT digitalWritebuttonLEDs i LOW Set up analog pins pinModebuttonAnalog i INPUT Serialprintln CONTROLLINO Pin setup succeeded void testButtonint input bool test false SerialprintTesting button Serialprintlninput test turnOnButtoninput if test true SerialprintlnButton succeeded else SerialprintlnButton failed End of Functions void setup Serialbegin Regular serial printout to COM Serial begin Serial connection to ESP WiFi module setupPins setupWiFi printWifiStatus setupMQTTClient void loop mqttClientloop Breaks the program Any help would be greatly appreciated as I am at my wits end trying to get it to work must have statement for current Arduino Framework see also I loaded the code on arduino uno and after hours it crashes on time can you help me I also tried with arduino due but it crashes after about days include Etherneth include PubSubClienth include SPIh define CLIENTID Giardino define TOPIC temp define PUBLISHDELAY define subscribeDELAY include avrdtostrfh define relayPin define relayPin define relayPin define relayPin String ip bool relaystate LOW bool relaystate LOW bool relaystate LOW bool relaystate LOW int luminosita Il valore letto dalla fotoresistenza int umidita int sensorepioggia int x int a int b int c int CICLO unsigned long y EthernetClient Giardino PubSubClient mqttClientGiardino unsigned long previousMillis unsigned long previousMillis unsigned long lastMillis uint t mac x x x x x x void setup pinModerelayPin OUTPUT pinModerelayPin OUTPUT pinModerelayPin OUTPUT pinModerelayPin OUTPUT pinModeA INPUT pinMode INPUTPULLUP pinMode INPUT setup serial communication Serialbegin while Serial SerialprintlnFMQTT Arduino Demo if Ethernetbeginmac SerialprintlnFUnable to configure Ethernet using DHCP for SerialprintlnFEthernet configured via DHCP SerialprintFIP address SerialprintlnEthernetlocalIP Serialprintln SerialprintlnEthernetlocalIP SerialprintlnEthernetlocalIP SerialprintlnEthernetlocalIP SerialprintlnEthernetlocalIP if EthernetlinkStatus LinkOFF SerialprintlnFEthernet cable is not connected ip String EthernetlocalIP ip ip ip ip String EthernetlocalIP ip ip ip ip String EthernetlocalIP ip ip ip ip String EthernetlocalIP Serialprintlnip setup mqtt client mqttClientsetClientGiardino mqttClientsetServermqttServer mqttClientsetServertestmosquittoorg mqttClientsetServer raspberrypilocal mqttClientsetServerioadafruitcom mqttClientsetServer server SerialprintlnFMQTT client configured mqttClientsetCallbackcallback previousMillis millis Serialprintln void loop while mqttClientconnected Attempt to connect mqttClientconnectGiardino char msgBuffer if millis previousMillis subscribeDELAY luminosita digitalRead Lettura della luminosit sensorepioggiadigitalRead umidita analogReadA previousMillis millis mqttClientpublishcasaGiardinoumidit dtostrfanalogReadA msgBuffer mqttClientpublishcasaGiardinoluminositadtostrf digitalRead msgBuffer mqttClientpublishcasaGiardinosensorepioggiadtostrfdigitalRead msgBuffer if millis previousMillis PUBLISHDELAY sendData previousMillis millis relaystate digitalReadrelayPin Reads the state of a relay relaystate digitalReadrelayPin Reads the state of a relay relaystate digitalReadrelayPin Reads the state of a relay relaystate digitalReadrelayPin Reads the state of a relay SerialprintlndigitalRead mqttClientloop if x if millis lastMillis y a SerialprintlnFiniziato Ciclo If delay digitalWriterelayPin LOW b lastMillis millis digitalWriterelayPin HIGH a mqttClientpublishcasaGiardinoconferma mqttClientpublishcasaGiardinoconferma if b if millis lastMillis y b SerialprintlnFsecondo step delay digitalWriterelayPin LOW b lastMillis millis c digitalWriterelayPin HIGH mqttClientpublishcasaGiardinoconferma mqttClientpublishcasaGiardinoconferma if c if millis lastMillis y c Serialprintlnterzo step delay digitalWriterelayPin LOW c lastMillis millis mqttClientpublishcasaGiardinoconferma SerialprintlnFfine ciclo irrigazione void sendData char msgBuffer if mqttClientconnectCLIENTID mqttClientsubscribecasaGiardinosb mqttClientsubscribecasaGiardinosb mqttClientsubscribecasaGiardinosb mqttClientsubscribecasaGiardinosb mqttClientsubscribecasaGiardinociclo mqttClientsubscribecasaGiardinoiniziociclo mqttClientsubscribecasaGiardinopresenza void callbackchar topic byte payload unsigned int length char msgBuffer I am only using one ascii character as command so do not need to take an entire word as payload However if you want to send full word commands uncomment the next line and use for string comparison payload length terminate string with String strPayload Stringcharpayload convert to string SerialprintlnstrPayload can use this if using longer southbound topics SerialprintFMessage arrived Serialprinttopic String topicStr topic String messageTemp Serialprint MQTTBROKER Serialprintln SerialprintFTopic SerialprintlntopicStr for int i i length i Serialprintcharpayload i messageTemp charpayload i Serialprintln Serialprintlnpayload if topicStr casaGiardinosb if messageTemp Message in ASCII turn output ON digitalWriterelayPin HIGH mqttClientpublishcasaGiardinoconferma else if messageTemp Message in ASCII turn output OFF digitalWriterelayPin LOW mqttClientpublishcasaGiardinoconferma if topicStr casaGiardinosb if messageTemp Message in ASCII turn output ON mqttClientpublishcasaGiardinoconferma digitalWriterelayPin HIGH else if messageTemp Message in ASCII turn output OFF digitalWriterelayPin LOW mqttClientpublishcasaGiardinoconferma if topicStr casaGiardinosb if messageTemp Message in ASCII turn output ON mqttClientpublishcasaGiardinoconferma digitalWriterelayPin HIGH else if messageTemp Message in ASCII turn output OFF digitalWriterelayPin LOW mqttClientpublishcasaGiardinoconferma if topicStr casaGiardinosb if messageTemp Message in ASCII turn output ON mqttClientpublishcasaGiardinoconferma digitalWriterelayPin HIGH else if messageTemp Message in ASCII turn output OFF digitalWriterelayPin LOW mqttClientpublishcasaGiardinoconferma if topicStr casaGiardinociclo CICLO messageTemptoInt mqttClientpublishcasaGiardinoconfermareciclo messageTempcstr y CICLO if topicStr casaGiardinoiniziociclo if messageTemp Message in ASCII turn output ON x a digitalWriterelayPin HIGH mqttClientpublishcasaGiardinoconferma mqttClientpublishcasaGiardinoconfermainiziociclo else if messageTemp Message in ASCII turn output OFF x a mqttClientpublishcasaGiardinoconfermainiziociclo digitalWriterelayPin LOW digitalWriterelayPin LOW digitalWriterelayPin LOW mqttClientpublishcasaGiardinoconferma mqttClientpublishcasaGiardinoconferma mqttClientpublishcasaGiardinoconferma if topicStr casaGiardinopresenza if messageTemp ip mqttClientpublishcasaGiardinoip ipcstr mqttClientpublishcasaGiardinonbrelay relaystate LOW OPEN CLOSED Hi all I have an issue with pubsubclient library I use HardwareSerial in ESP with TinyGSM in order to send MQTT messages via GSM When SIM C is connected to GPRS PubSubClient tries to connect to MQTT and no connection although Internet access is present and MQTT broker is up Here are my codes Interface declaration HardwareSerial MySerial TinyGsm modemMySerial define DUMPATCOMMANDS ifdef DUMPATCOMMANDS include StreamDebuggerh StreamDebugger debuggerMySerial Serial TinyGsm modemdebugger else TinyGsm modemMySerial endif TinyGsmClient clientmodem TinyGsmClientSecure secureClientmodem PubSubClient mqttclient Modem interface initialization MySerial begin SERIAL N mqttConnect boolean mqttConnect SerialprintConnecting to Serialprintmqtthost Or if you want to authenticate MQTT mqttsetStreamdebugger mqttsetStreamdebugger mqttsetClientclient boolean status mqttconnecttrname mqtttoken NULL boolean status mqttconnectTempLogger uerdekta FxTNPTyHTJhM if status false Serialprintln fail Serialprintlnmqttstate return false Serialprintln OK mqttpublishtopicInit GsmClientTest started mqttsubscribev devicesmeattributesresponse mqttsubscribev devicesmerpcrequest mqttsubscribev devicesmerpcresponse mqttsubscribev devicesmeattributes return mqttconnected sendReceiveTelemetry void sendReceiveTelemetryString temp StaticJsonBufferMQTTSENDSIZE jsonBuffer JsonObject mqttSend jsonBuffercreateObject uint t atts inet true mqttsetServermqtthost mqttport mqttsetCallbackmqttCallback while mqttConnect atts atts int csq modemgetSignalQuality int bat checkBatLite String send char sendArray MQTTSENDSIZE char pubsub String pub checkBatterytemptoFloat writeAlarmtemptoFloat struct coords currentLocation getLocation int locerr currentLocationlocerr SerialprintlnMQTT is running MQTT mqttSend ts timestamp mqttSend temp temptoFloat mqttSend ltemp lowertemp mqttSend htemp uppertemp mqttSend locerr currentLocationlocerr mqttSend csq csq mqttSend bat bat mqttSend name trackerName mqttSend ttint uint tTIMETOSLEEP mqttSend locstr currentLocationlocstring ifdef COORDSFILTER if locerr currentLocationlongitude currentLocationlatitude mqttSend lon currentLocationlongitude mqttSend lat currentLocationlatitude else mqttSend lon currentLocationlongitude mqttSend lat currentLocationlatitude endif mqttSend imei imei mqttSend mv getVoltage mqttSendprintTosend sendtoCharArraysendArray MQTTSENDSIZE SerialprintlnsendArray pub v devicesmetelemetry pubtoCharArraypubsub mqttpublishpubsub sendArray send csq Stringcsq bat Stringbat sharedKeys ltemphtempttint sendtoCharArraysendArray MQTTSENDSIZE pub v devicesmeattributesrequest pubtoCharArraypubsub mqttpublishpubsub sendArray unsigned long int newmillis millis whilemillis newmillis mqttloop mqttdisconnect modemgprsDisconnect inet false Serialprint Serialprintmillis Serialprintln ms Modem isnt in sleep mode and is able to respond commands Here is debug log Connecting to demothingsboardioATCIPCLOSE ERROR ATCIPSSL OK ATCIPSTART TCPdemothingsboardio OK CONNECT OK ATCIPSEND MQTT SMR i T XXXXXbanzZcSreKN DATA ACCEPT CIPRXGET ATCIPRXGET CIPRXGET OK ATCIPCLOSE CLOSE OK fail Ive been investigating timeout disconnect issues between pubsubclient and mosquitto and I noticed that MQTTKEEPALIVE appears to be used for two things The first is this is the value that is sent on connection to the broker as the connection timeout The second is to determine when to send keepalive pings What Im wondering is that if for example the MQTTKEEPALIVE value is the default seconds and on connection to the broker you provide that value and then on the pubsubclient device you wait exactly MQTTKEEPALIVE seconds before you send the ping isnt that cutting things a bit close if there is any glitch at all the broker by all rights would disconnect you Shouldnt the value in the ping loop be a bit smaller than the value sent on connection to allow for a little wiggle room Id maybe consider sending seconds to the broker on connection if the ping loop on the client is set to send every seconds Im receiving JPG picture from a device connected to ESP with serial connection baud rate Receiving part is done using the following code if Stringtopic esp faceenroll here is some code related to getting message from the device and parsing it I omit it because this part works as expected byte incomingByte byte nextByte bool jpeg byte jpegimage int i Serialprintlninit if mf jpegavailable Serialprintlndata incomingByte mf jpegread if incomingByte xFF nextByte mf jpegread if nextByte xD jpeg i jpegimage incomingByte jpegimage nextByte Serialprintlnjpg begin while jpeg incomingByte mf jpegread jpegimage i incomingByte i if incomingByte xFF nextByte mf jpegread if nextByte xD jpeg jpegimage i nextByte Serialprintlnjpg end clientpublishesp jpg jpegimage false Serialprintlnfinished break if detected clientpublishesp result nofacedetected Serialprintlnnofacedetected detected delay If the line about publishing is commented out I can receive messages from the device including jpg which appears to be not corrupted begins with ff d and ends with ff d If I try sending the jpg with clientpublish then esp immediately after receiving message on faceenroll topic reboots with the following backtrace Connecting to orangepi WiFi connected IP address Attempting MQTT connectionconnected ets Jun rst x TG WDTSYSRESETboot x b SPIFASTFLASHBOOT configsip SPIWP xee clkdrv x qdrv x ddrv x cs drv x hddrv x wpdrv x modeDIO clock div load x fff len load x fff clen load x len load x len entry x ac Guru Meditation Error Core paniced Interrupt wdt timeout on CPU Core register dump PC x PS x A x A x ffbe a A x ffbec A x A x A x b e A x A x ffb A x ff A x A x A x A x A x ffb db A x ffb A xbaad SAR x EXCCAUSE x EXCVADDR x LBEG x LEND x LCOUNT x Core was running in ISR context EPC x bff EPC x EPC x EPC x Backtrace x x ffbe a x x ffbe d x bfed x ffb e x ce x ffb e x d x ffb e x d d x ffb e x d d x ffb ea x d c x ffb ec x d c e x ffb ee x d x ffb f x d x ffb f x d e f x ffb fb x b d x ffb fd Core register dump PC x e a PS x A x d d A x ffbbff A x A x A x A x A x A x A x d d a A x ffbbfc A x A x f A x A x ffbb A x ff e A x SAR x EXCCAUSE x EXCVADDR x LBEG x LEND x LCOUNT x Backtrace x e a x ffbbff x d d f x ffbc x a x ffbc x b d x ffbc Rebooting ets Jun rst xc SWCPURESETboot x b SPIFASTFLASHBOOT configsip SPIWP xee clkdrv x qdrv x ddrv x cs drv x hddrv x wpdrv x modeDIO clock div load x fff len load x fff clen load x len load x len entry x ac Guru Meditation Error Core paniced Interrupt wdt timeout on CPU Core register dump PC x PS x A x A x ffbe a A x ffbec A x A x A x b e A x A x ffb A x A x ff A x A x A x A x ffb db A x ffb A xbaad SAR x EXCCAUSE x EXCVADDR x LBEG x LEND x LCOUNT x Core was running in ISR context EPC x bff EPC x EPC x EPC x Backtrace x x ffbe a x x ffbe d x bfed x ffb e x ce x ffb e x d x ffb e x d d x ffb e x d d x ffb ea x d c x ffb ec x d c e x ffb ee x d x ffb f x d x ffb f x d e f x ffb fb x b d x ffb fd Core register dump PC x e a PS x A x d d A x ffbbff A x A x A x A x A x A x A x d d a A x ffbbfc A x A x f A x A x ffbb c A x A x ffbbce SAR x EXCCAUSE x EXCVADDR x LBEG x LEND x LCOUNT x Backtrace x e a x ffbbff x d d f x ffbc x a x ffbc x b d x ffbc Rebooting ets Jun rst xc SWCPURESETboot x b SPIFASTFLASHBOOT configsip SPIWP xee clkdrv x qdrv x ddrv x cs drv x hddrv x wpdrv x modeDIO clock div load x fff len load x fff clen load x len load x len entry x ac Connecting to orangepi The MQTTMAXPACKETSIZE is set to changing it to doesnt make a difference I have also tried publishing with clientbeginPublish and writepayload length or writepayload to send single bytes all with the same result What I found working sort of is publishing bytes of jpg image right after receiving them from the device or buffering them to buf array and then publishing them Unfortunately the jpg image is corrupted when publishing this way a lot of ff bytes in the body of jpg doesnt end with ff d impossible to open Is there any work around this issue It doesnt seem to be memory related Hello together I am working on a small programm for an ESP that allows me to forwards MQTT messages from my local broker to Thingspeak channels I am using the Thingspeak library Thingspeakh As soon as the following code to update the Thingspeak channel is executed the connection to the MQTT broker is lost reconnection appears ifActualPwrState ActualPwrState false Write to ThingSpeak There are up to fields in a channel allowing you to store up to different pieces of information in a channel Here we write to field int x ThingSpeakwriteFieldmyChannelNumber ActualPwrValue myWriteAPIKey ifx SerialprintlnChannel update successful else SerialprintlnProblem updating channel HTTP error code Stringx Any ideas what the issue is