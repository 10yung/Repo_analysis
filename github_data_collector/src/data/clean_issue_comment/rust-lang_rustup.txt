Problem On Windows using WSL rustup doc std or any other rustup doc command opens firefox correctly because I have BROWSERfirefoxexe but the browser does not load a file the browser is emptyblank I found the rustup docs here rustuptoolchainsnightlyx unknownlinuxgnusharedocrusthtmlindexhtml I could open this manually like this firefoxexe filewslUbuntuhomekobenaufrustuptoolchainsnightlyx unknownlinuxgnusharedocrusthtmlindexhtml Or like this firefoxexe wslpath w rustuptoolchainsnightlyx unknownlinuxgnusharedocrusthtmlindexhtml Possible Solutions Consider making rustup doc aware of how to open files on WSL so they open the docs as expected Notes Output of rustup version rustup b ebe Output of rustup show Default host x unknownlinuxgnu rustup home homekobenaufrustup installed toolchains stablex unknownlinuxgnu nightlyx unknownlinuxgnu default installed targets for active toolchain wasm unknownunknown x pcwindowsgnu x unknownlinuxgnu active toolchain nightlyx unknownlinuxgnu default rustc nightly fca c The curl proto option is not necessary since target URL is https hence it should be dropped Problem Rockets Windows CI Azure Pipelines started failing between and days ago We run this command curl sSf o rustupinitexe rustupinitexe y defaulttoolchain rustversion And the output looks like this Starting Command Output C windows system cmdexe D EON VOFF S C CALL d a temp c a dafad cd a d dcmd info profile set to default info default host triple is i pcwindowsmsvc error toolchain stable is not installed error caused by not a directory C Users VssAdministrator rustup toolchains stablei pcwindowsmsvc error Cmdexe exited with code Finishing Install Rust nightly In a previous successful run this was the output Starting Command Output C windows system cmdexe D EON VOFF S C CALL D a temp e b bf cfb dd bcccmd info profile set to default info default host triple is x pcwindowsmsvc info updating existing rustup installation Steps I have not attempted to reproduce this yet Ill try locally first but I would not be surprised if theres some kind of caching going on from a previous installation that will make reproduction difficult Analysis Two things about this seem really odd to me i maybe related to and stable when the requested version was nightly I dont know if its trying to find the stable toolchain before or during a selfupdate assuming it is trying to do one Any hints before I go and try this on bare metal After a successful rustup update or maybe even after each successful rustup command the RUSTUPHOME directory should be in a clean state Example of a nonclean state ls rustupdownloads b a c bcf f c f b cb d e abd b c a decc dcef de c ddf a e e a a d f c e be f e bd a d e d dde cd ef d edf ea e ff b a c efb d a cef ef e c ab ab dfb bfaa b a a cd f edbcaaa c e c b b c a a fbad ece a c af af c ee fc ac bea ded f f f c b bc f f c bb e a f adf e c c b a dcb fff e a a ad c d ef ff e b da fabe b d efe b d e bc dfd c f ebf c b bc cd dd f ab f a da b cee b be c c bb a bfe c d c f a d b f e a f cde c bb e cb a aa bff e a ef b e a b a f ddc f bacd fdea e e fa adb d d caab d af a aefad a a c a ff fcfcd b b dd c f fc c ae fa d a c f fee bb e edc e fff e d f a f f cbfdc f f f f c d a d a c c ee ad ec f febc e e eefa f bd ea af b c fc partial e e b fb cf c b b c b a d cfced d e b df epartial d fdab e a d f c f d f f d d e cb f b e bfba ef b bacc b ff aba fba ead ee e c e af fce fd ca ed ab d ec ca b e e a fe b eb b e b c a fd c cbddfb c ed eec e apartial e c b da d d fd fdbe aa e a db c c adbad b d e cd cfa dffdc bbccbd ec e cc b c b dc f ff d b d fc ef d d ad b aca b d c dcb dfc c cf e d e d bd e ce ede f d fdec a fce f c bfc dfbdc dc b fa ea af c bc d fdd d ef cd fe b f c ca f e d b ef e bb abf b f a a e ee a a bd b af f a fd c b cf dbb ee e f e fee a f b e fec b fd b a c d bf b e f e fe d d du h rustupdownloads G Usersgnzlbgrustupdownloads Thats Gb of useless files Ideally we would have a definition of what clean means for the RUSTUPHOME directory APIs to eg iterate over all files that would need to be removed for the RUSTUPHOME directory to become clean Decide which rustup commands on success should enforce that the RUSTUPHOME directory is clean eg rustup update rustup self update etc I think we should try hard to avoid a rustup clean command since users should not be required to know that such a command exists to avoid wasting multiple Gbs of files Tests that make sure that whatever gets implemented works If the user specifies any of defaulttoolchain not none or target or component when invoking rustupinit then we will update the existing installation toolchains rather than the previous behaviour which was to skip toolchain installation This is nominally a breaking change but likely ends up adhering closer to the principle of least surprise At this point the profile will not be applied so a change of profile from minimal to default will not cause additional components to end up being installed In theory this fixes but will need checking with flaviojs Problem If a crate contains a rusttoolchain file the default toolchain is used if cargo install path is run from outside of the crates directory I expected it to use the toolchain specified in rusttoolchain Steps rustup default stable cargo new foo echo nightly foorusttoolchain sed i i featureexactsizeisempty foosrcmainrs cargo install path foo cd foo cargo install path does work Notes Output of rustup version rustup b ebe Output of rustup show Default host x pcwindowsmsvc rustup home C Users mkraai rustup installed toolchains stablex pcwindowsmsvc nightlyx pcwindowsmsvc active toolchain stablex pcwindowsmsvc default rustc e About the wmemchr change I dont have Windows machine to bench but from it may be a improvement Closes I havent been able to test this at all but I still wanted to create this PR so someone could test for me before I find time to do it myself Describe the problem you are trying to solve This is a followup to Since rustupinit shouldnt be used to set up crosscompiling with mingw at the very least it should warn when an argument is ignoredchanged Without a warning I would think that everything is setup as expected This leads to wasting a lot of time trying to figure out what is wrong when a problem arises Describe the solution youd like Im not sure what the stated reasons should be but I would like a warning with enough information Examples for defaulttoolchain x pcwindowsgnu default toolchain changed to x unknownlinuxgnu reason for defaulttoolchain targetx pcwindowsgnu target x pcwindowsgnu was ignored reason Maybe something else would be appropriate but this is all I can think of without knowledge of the internals