A minimally reprodicuble Rmd file title test output htmlnotebook r libraryggplot libraryplotly df dataframex y t p ggplotdf aesxx yy fillt geompoint ggplotlyp Then run r rmarkdownrendertestRmd outputformathtmlnotebook Results in the following error processing file testRmd ordinary text without R code label unnamedchunk ordinary text without R code label unnamedchunk ordinary text without R code output file testknitmd Error in extractinputstr Invalid nesting of htmlpreserve directives Calls Anonymous Anonymous base base extractpreservechunks extract Execution halted Interestingly in RStudio for preview everything is fine And Ive found out that the length matters So will cause the error but NOT Here is my system info R version Platform x appledarwin bit Running under macOS High Sierra rmarkdown pandoc I encounter the same error in my Ubuntu machine I really have no idea whats going on here and it took me quite some time to finally pin down the root cause being UTF Chinese characters Still no clue why this happens By filing an issue to this repo I promise that x I have fully read the issue guide at x I have provided the necessary information about my issue If Im asking a question I have already asked it on Stack Overflow or RStudio Community waited for at least hours and included a link to my question there If Im filing a bug report I have included a minimal selfcontained and reproducible example and have also included xfunsessioninformarkdown I have upgraded all my packages to their latest versions eg R RStudio and R packages and also tried the development version remotesinstallgithubrstudiormarkdown If I have posted the same issue elsewhere I have also mentioned it in this issue x I have learned the Github Markdown syntax and formatted my issue correctly I understand that my issue may be closed if I dont fulfill my promises Say I have files indexRmd slide Rmd and siteyml indexRmd title Home This is the home slide Rmd title Xaringan slide output xaringanmoonreader Hello siteyml name RMD test navbar title RMD test right text Home href indexhtml text Slide href slide html output rmarkdownhtmldocument If I run rmarkdownrenderslide Rmd in the presence of siteyml the output is the document defined in siteyml The YAML definition in the Rmd file is ignored If I run rmarkdownrendersite the output of slide Rmd is a xaringan presentation ie document defined inside slide Rmd As expected But in addition I get this warning Output created siteindexhtml Warning message In filerenameoutput outputdest cannot rename file homeuserDesktoptestrmdslide html to siteslide html reason No such file or directory Is there some way to make render use only the YAML definition inside the file and not that from siteyml Is the warning something to worry about Issue on StackOverflow By filing an issue to this repo I promise that x I have fully read the issue guide at x I have provided the necessary information about my issue If Im asking a question I have already asked it on Stack Overflow or RStudio Community waited for at least hours and included a link to my question there If Im filing a bug report I have included a minimal selfcontained and reproducible example and have also included xfunsessioninformarkdown I have upgraded all my packages to their latest versions eg R RStudio and R packages and also tried the development version remotesinstallgithubrstudiormarkdown If I have posted the same issue elsewhere I have also mentioned it in this issue x I have learned the Github Markdown syntax and formatted my issue correctly I understand that my issue may be closed if I dont fulfill my promises This is a try to making some evolution to pandoc pagebreak lua filter in the aim of supporting inline command Supporting this would fix Initially the pagebreak lua filter was added from pandoc lua filters repo and support newpage or pagebreak command as its own paragraph It would detect this paragraph and replace it with a RawBlock with the correct pagebreak syntax This PR is to see if we can detect one of the command in the paragraph itself and replace it by RawInline It seems to works well for docx output This need to be thoroughly tested for other format This is a draft PR to share this and test it Currently newpage must be a paragraph composed only by itself like md Paragraph newpage Paragraph This may add a blank page in worddocument when the paragraph before breaking page reaches at the bottom of a page It would be nice if pagebreak can be done as a part of paragraph For example by This paragraph ends with pagebreak newpage reprex output worddocument mdextensions hardlinebreaks r echoFALSE resultsasis catrep st page sep n newpage Blank page exists before this line xfunsessioninformarkdown R version Platform x w mingw x bit Running under Windows x build RStudio Locale LCCOLLATEJapaneseJapan LCCTYPEJapaneseJapan LCMONETARYJapaneseJapan LCNUMERICC LCTIMEJapaneseJapan Package version base enc digest evaluate glue graphics grDevices highr htmltools jsonlite knitr magrittr markdown methods mime Rcpp rlang rmarkdown stats stringi stringr tinytex tools utils xfun yaml Pandoc version By filing an issue to this repo I promise that x I have fully read the issue guide at x I have provided the necessary information about my issue If Im asking a question I have already asked it on Stack Overflow or RStudio Community waited for at least hours and included a link to my question there If Im filing a bug report I have included a minimal selfcontained and reproducible example and have also included xfunsessioninformarkdown I have upgraded all my packages to their latest versions eg R RStudio and R packages and also tried the development version remotesinstallgithubrstudiormarkdown If I have posted the same issue elsewhere I have also mentioned it in this issue x I have learned the Github Markdown syntax and formatted my issue correctly I understand that my issue may be closed if I dont fulfill my promises Im noticing that when I print a tibble and generate a PDF output the intermediate markdown file has div classkabletable surrounding the table This seems to be the result of knitprintR line Normally this doesnt affect my output however Im trying to hack in table captions and also use pandoccrossref down the line Im rendering with the following call rendertestRmd outputformat pdfdocumentdfprint kable keepmd T testRmd title test output pdfdocument r libraryknitr optschunksetecho F message F warning F testtibble tibblea letters b Using print r testtibble Table Table caption tblfirst Using kable to print r kabletesttibble format markdown Table Table caption tblsecond This fixes I began with the easy way just prepending if pandoc This seem to work well yihui what do you prefer This sort of simple way to deal with this or the use of metadatafile In fact I tried the later but at these lines in renderR where R file is spinned it does not seems that we can access yet the output format to add some pandoc args directly We can add it later like postknithandler or just add it anywhere if a temporary yaml file has been created I guess Even if it seems the way to go it seems maybe to complicated to implement more lines and logic to add What do you think Ill modify or complete this PR based on your input Rendering this simple testR script r title Test title author Name Surname printHello World produces HTMLPDF documents with the wrong title and author when used with pandoc while it works fine with pandoc How to reproduce miniconda binconda create y n rmarkdown rrmarkdown miniconda binactivate rmarkdown rmarkdown Rscript e xfunsessioninformarkdown R version Platform x condacos linuxgnu bit Running under Ubuntu LTS Locale LCCTYPEenGBUTF LCNUMERICC LCTIMEenGBUTF LCCOLLATEenGBUTF LCMONETARYenGBUTF LCMESSAGESenGBUTF LCPAPERenGBUTF LCNAMEC LCADDRESSC LCTELEPHONEC LCMEASUREMENTenGBUTF LCIDENTIFICATIONC Package version base enc digest evaluate glue graphics grDevices highr htmltools jsonlite knitr magrittr markdown methods mime Rcpp rlang rmarkdown stats stringi stringr tinytex tools utils xfun yaml Pandoc version rmarkdown Rscript e libraryrmarkdown rendertestR processing file testspinRmd ordinary text without R code label unnamedchunk ordinary text without R code output file testknitmd usrusersga soranzonminiconda envsrmarkdownbinpandoc RTS K m RTS testutf md to html from markdownautolinkbareuristexmathsinglebackslashsmart output testhtml emailobfuscation none selfcontained standalone sectiondivs template usrusersga soranzonminiconda envsrmarkdownlibRlibraryrmarkdownrmdhdefaulthtml nohighlight variable highlightjs variable themebootstrap includeinheader tmpRtmp eInxFrmarkdownstrdb a adc html mathjax variable mathjaxurl luafilter usrusersga soranzonminiconda envsrmarkdownlibRlibraryrmarkdownrmdluapagebreaklua luafilter usrusersga soranzonminiconda envsrmarkdownlibRlibraryrmarkdownrmdlualatexdivlua Output created testhtml rmarkdown grep E authortitleh testhtml meta nameauthor contentsoranzon titletestRtitle h classtitle tocignoretestRh h classauthorsoranzonh After downgrading pandoc to rmarkdown conda install y pandoc rmarkdown Rscript e xfunsessioninformarkdown R version Platform x condacos linuxgnu bit Running under Ubuntu LTS Locale LCCTYPEenGBUTF LCNUMERICC LCTIMEenGBUTF LCCOLLATEenGBUTF LCMONETARYenGBUTF LCMESSAGESenGBUTF LCPAPERenGBUTF LCNAMEC LCADDRESSC LCTELEPHONEC LCMEASUREMENTenGBUTF LCIDENTIFICATIONC Package version base enc digest evaluate glue graphics grDevices highr htmltools jsonlite knitr magrittr markdown methods mime Rcpp rlang rmarkdown stats stringi stringr tinytex tools utils xfun yaml Pandoc version rmarkdown Rscript e libraryrmarkdown rendertestR processing file testspinRmd ordinary text without R code label unnamedchunk ordinary text without R code output file testknitmd usrusersga soranzonminiconda envsrmarkdownbinpandoc RTS K m RTS testutf md to html from markdownautolinkbareuristexmathsinglebackslashsmart output testhtml emailobfuscation none selfcontained standalone sectiondivs template usrusersga soranzonminiconda envsrmarkdownlibRlibraryrmarkdownrmdhdefaulthtml nohighlight variable highlightjs variable themebootstrap includeinheader tmpRtmpGhwdehrmarkdownstr d a a fhtml mathjax variable mathjaxurl luafilter usrusersga soranzonminiconda envsrmarkdownlibRlibraryrmarkdownrmdluapagebreaklua luafilter usrusersga soranzonminiconda envsrmarkdownlibRlibraryrmarkdownrmdlualatexdivlua Output created testhtml rmarkdown grep E authortitleh testhtml meta nameauthor contentName Surname titleTest titletitle h classtitle tocignoreTest titleh h classauthorName Surnameh Please keep the below portion in your issue Your issue will be closed if any of the boxes is not checked ie replace by x In certain rare cases you may be exempted if you give a brief explanation eg you are only making a suggestion for improvement Thanks By filing an issue to this repo I promise that x I have fully read the issue guide at x I have provided the necessary information about my issue If Im asking a question I have already asked it on Stack Overflow or RStudio Community waited for at least hours and included a link to my question there If Im filing a bug report I have included a minimal selfcontained and reproducible example and have also included xfunsessioninformarkdown I have upgraded all my packages to their latest versions eg R RStudio and R packages and also tried the development version remotesinstallgithubrstudiormarkdown If I have posted the same issue elsewhere I have also mentioned it in this issue x I have learned the Github Markdown syntax and formatted my issue correctly I understand that my issue may be closed if I dont fulfill my promises Add pandoccopydata to copy data files provided by Pandoc eg pandoccopydatareferencedocx cf Add pandoccopytemplate to copy templates provided by R Markdown or Pandoc eg pandoccopytemplatehtmldocument cf After updating packages today Rmd files that previously knitted properly to PDF files were no longer working because knitting ends up leading to an undefined control sequence in the tex file l filegetnnN unicodemathtabletex lummathtabletl My computer has MiKTeX installed and fully updated This behavior appears to be caused by changes made between rmarkdown version and version I have also tried using the latest development version but that gives the same result as version libraryrmarkdown xfunsessioninfo Under setup that fails R version Platform x w mingw x bit Running under Windows x build RStudio Locale LCCOLLATEEnglishUnited States LCCTYPEEnglishUnited States LCMONETARYEnglishUnited States LCNUMERICC LCTIMEEnglishUnited States Package version base enc compiler digest evaluate glue graphics grDevices highr htmltools jsonlite knitr magrittr markdown methods mime Rcpp rlang rmarkdown stats stringi stringr tinytex tools utils xfun yaml Uninstalling rmarkdown and reverting to the older version as shown below fixes the problem knitting creates PDFs as expected removepackagesrmarkdown devtoolsinstallversionrmarkdown version repos The following minimal Rmd code reproduces this problem on my computer output pdfdocument latexengine xelatex Knitting this file produces a PDF file properly when rmarkdown or is installed but fails when version or are installed instead Then knitting generates an undefined control sequence Please keep the below portion in your issue Your issue will be closed if any of the boxes is not checked ie replace by x In certain rare cases you may be exempted if you give a brief explanation eg you are only making a suggestion for improvement Thanks By filing an issue to this repo I promise that x I have fully read the issue guide at x I have provided the necessary information about my issue If Im asking a question I have already asked it on Stack Overflow or RStudio Community waited for at least hours and included a link to my question there If Im filing a bug report I have included a minimal selfcontained and reproducible example and have also included xfunsessioninformarkdown I have upgraded all my packages to their latest versions eg R RStudio and R packages and also tried the development version remotesinstallgithubrstudiormarkdown If I have posted the same issue elsewhere I have also mentioned it in this issue x I have learned the Github Markdown syntax and formatted my issue correctly I understand that my issue may be closed if I dont fulfill my promises This PR enables output formats to keep native haskell files Currently this is a draft which modifies least functions htmldocument pdfdocument outputformat and render If yihui likes the idea I would like to add the keepmd argument to other formats and then update Rd files and NEWS