Im trying to build a dynamic module for use with the standard RHEL nginx deploy When I run configure with the values scraped directly from the nginx V command the compile gets casting errors The code compiles when using the withcompat configuration flag but is then binary incompatible with the standard RHEL nginx since that was not compiled with the withcompat flag There are four cast errors in ngxstreamscriptc lines and Errors are all cast between incompatible function types from sizet ngxstreamscriptenginet aka long unsigned int struct anonymous to void ngxstreamscriptenginet aka void struct anonymous Werrorcastfunctiontype Currently the documentation specifies Existing response headers with the same name are always overridden If you want to add headers incrementally use the standard addheader directive instead But the addheader has the drawback that it removes ALL previously defined addheaders in upper sections It could be very useful to add parameters to an already defined header For example we can have a global Vary but need to add more itens just inside a location Or we may want to expand headers received from a proxy headerfilterbyluablock can not unset header if set by moresetheaders Example moresetheaders test test headerfilterbyluablock some custom logic to unset previously set header from upstream or by moresetheaders if then ngxheader test nil end I found a problem if I use the following construction then the header is missing in the answer location include etcnginxdefaultdcorsconf etcnginxdefaultdcorsconf moresetheaders AccessControlAllowOrigin moresetheaders AccessControlAllowMethods GET POST OPTIONS PUT DELETE moresetheaders AccessControlAllowHeaders DNTUserAgentXRequestedWithIfModifiedSinceCacheControlContentTypeRange moresetheaders AccessControlExposeHeaders ContentLengthContentRange if requestmethod OPTIONS moresetheaders AccessControlMaxAge moresetheaders ContentType textplain charsetutf moresetheaders ContentLength return The answer is present only the first part to the block if When using schemes include moresetheaders and if moresetheaders all heders will be added correctly nginx version headersmorenginxmodule nginx V nginx version nginx built by gcc Red Hat GCC built with LibreSSL TLS SNI support enabled configure arguments prefixvarwwwhtml sbinpathusrsbinnginx modulespathusrlib nginxmodules confpathetcnginxnginxconf errorlogpathvarlognginxerrorlog httplogpathvarlognginxaccesslog httpclientbodytemppathvarlibnginxtmpclientbody httpproxytemppathvarlibnginxtmpproxy httpfastcgitemppathvarlibnginxtmpfastcgi httpuwsgitemppathvarlibnginxtmpuwsgi httpscgitemppathvarlibnginxtmpscgi pidpathvarrunnginxpid lockpathvarlocksubsysnginx usernginx groupnginx withthreads withfileaio withhttpsslmodule withhttpv module withhttprealipmodule withhttpadditionmodule withhttpxsltmodule withhttpimagefiltermodule withhttpgeoipmodule withhttpsubmodule withhttpdavmodule withhttpflvmodule withhttpmp module withhttpgunzipmodule withhttpgzipstaticmodule withhttpauthrequestmodule withhttprandomindexmodule withhttpsecurelinkmodule withhttpdegradationmodule withhttpstubstatusmodule withhttpperlmodule withmail withmailsslmodule withstream withstreamsslmodule withpcre withopenssllibressl addmodulengxdevelkit rc addmoduleluanginxmodule addmodulenjs nginx addmodulenginxmodulevts addmodulengxbrotli addmodulengxcachepurge addmodulengxhttpgeoip module addmoduleechonginxmodule addmodulenginxupstreamcheckmodule addmodulenginxauthldapgit addmoduleheadersmorenginxmodule addmodulenginxvodmodule withccoptO g pipe Wall WpDFORTIFYSOURCE fexceptions fstackprotectorstrong paramsspbuffersize grecordgccswitches m mtunegeneric DNGXHAVEMD DNGXLUAUSEASSERT DNGXLUAABORTATPANIC Iusrincludeluajit Iusrincludehttpd withldoptWlE lrt server location moresetinputheaders myheader test htmlcode img src it doesnt send request header to xxxx I was using nginx with headersmoremodule to remove the Server nginx header from all requests Now I have recompiled nginx with ngxpagespeed module using the following command bash curl f L sS nginxversion latest The header starts to show up again after thisnot shown earlier When pagespeed is disabled the header is not shown anymore Is there anything that can be done to stop showing the headers when pagespeed is enabled moresetinputheaders pushes to the requestheadersinheaders list While it behaves as expected most of the time according to this post youre not allowed to modify headersin like that Hello This PR is about the issue for SamMousa It would add header if not present the specified header new option i usage as the following bash add input header XFoo only if it XFoo doesnt exist moresetinputheaders i XFoo howdy add output header XFoo only if it XFoo doesnt exist moresetheaders i XFoo howdy agentzh please review this PR grin This is the Copyright License portion of the READMEmarkdown file It is a convention to place this info in a LICENSE or COPYING file so make it easy to find 