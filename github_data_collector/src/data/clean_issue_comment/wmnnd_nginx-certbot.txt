diff diff git ainitletsencryptsh binitletsencryptsh index f b c e ainitletsencryptsh binitletsencryptsh binbash set e set ex domainsexamplecom wwwexamplecom Specify domains here or use the d argument datapathdatacertbot Specify data path here or use the datapath argument fi if e datapathconfoptionssslnginxconf e datapathconfssldhparamspem then echo Downloading recommended TLS parameters mkdir p datapathconf curl s datapathconfoptionssslnginxconf curl s datapathconfssldhparamspem curl s datapathconfoptionssslnginxconf curl s datapathconfssldhparamspem echo fi This causes an endless loop redirect Hello Thank you for the detailed tutorial but Im having a weird issue After a lot of tries I managed to get this verbose log Existing data found for xxxloremcom Continue and replace existing certificate yN y Creating dummy certificate for xxxloremcom Generating a RSA private key writing new private key to etcletsencryptlivexxxloremcomprivkeypem Starting nginx Recreating xxxnginx Recreating xxxnginx done Deleting dummy certificate for xxxloremcom Requesting Lets Encrypt certificate for xxxloremcom Root logging level set at Saving debug log to varlogletsencryptletsencryptlog Requested authenticator webroot and installer None Single candidate plugin webroot Description Place files in webroot directory Interfaces IAuthenticator IPlugin Entry point webroot certbotpluginswebrootAuthenticator Initialized certbotpluginswebrootAuthenticator object at x f e e Prep True Selected authenticator certbotpluginswebrootAuthenticator object at x f e e and installer None Plugins selected Authenticator webroot Installer None Picked account AccountRegistrationResourcebodyRegistrationkeyNone contact agreementNone statusNone termsofserviceagreedNone onlyreturnexistingNone externalaccountbindingNone uri newauthzruriNone termsofserviceNone e d d cfa d bb bd Metacreationdtdatetimedatetime tzinfoUTC creationhost b b e c Sending GET request to Starting new HTTPS connection acmestagingv apiletsencryptorg GET directory HTTP Received response HTTP Server nginx Date Fri Nov GMT ContentType applicationjson ContentLength Connection keepalive CacheControl public maxage nocache XFrameOptions DENY StrictTransportSecurity maxage IRDSaUJLI keyChange meta caaIdentities letsencryptorg termsOfService website newAccount newNonce newOrder revokeCert Obtaining a new certificate Generating key bits etcletsencryptkeys keycertbotpem Creating CSR etcletsencryptcsr csrcertbotpem Requesting fresh nonce Sending HEAD request to HEAD acmenewnonce HTTP Received response HTTP Server nginx Date Fri Nov GMT Connection keepalive CacheControl public maxage nocache Link ReplayNonce tUBK GOg sYqNGtZVk sAu CvI kCg CZ ubFK OzKU XFrameOptions DENY StrictTransportSecurity maxage Storing nonce tUBK GOg sYqNGtZVk sAu CvI kCg CZ ubFK OzKU JWS payload b n identifiers n n type dns n value xxxloremcom n n n Sending POST request to protected eyJhbGciOiAiUlMyNTYiLCAia lkIjogImh dHBzOi vYWNtZS zdGFnaW nLXYwMi hcGkubGV c VuY J cHQub JnL FjbWUvYWNjdC xMTUxOTk MCIsICJub jZSI ICIwMDAydFVCSzVHT c c lxTkd WlZrOHNBdTVDdkkya NnNkNaMnViRks T pLVSIsICJ cmwiOiAiaHR cHM Ly hY lLXN YWdpbmctdjAyLmFwaS sZXRzZW jcnlwdC vcmcvYWNtZS uZXctb JkZXIifQ signature eUu ijFJznEuhHIbsGZXEIFMVnVGQ q BafLKLkdEeHreuggZq GgBycDZrsbMHxojVkwwRdFV tSL uJPLYnsat nsRgU EDnFpCgUlXwvPiek yXVczB VHtgYdx bL jxnAWUCwlJVmfMyY Jptjn Jvolsemr jQrn P Be ibVqi iqA rYY ZeWw YJdpaF lRi VBQsaLcnE fGIn CTDMdOKqZGlTY ac dDpHtzZ yQV yU nBaXakenBoubInvctfc T jQHVchKW R Qoysy Hkij t cJaet BZwyNVmF lN BGWfbz qQzfPdoFFzDaPNmPBsnu y sBmtTBgHCJ YjQQTbYmACwIvcTRzGTUbqLFS avjCXvZOsK j yaDP uSvpPCB qaV v Lqlcir i EiVHEKvXiFVe EudGg Q sjw FqpMo TAKpOuLYRZQIZJxfnpeCCTt jCREcNUUFp Q pCf pv F EKg HLdrDUQNva IvtNMEzm HQUE HfNRyFHogYODUlAGMB ygAdFUhje SA YgWXwCvDKSrctEN bODp hfLjfhHbx Gp IkKPNNyKAnxvggI iJYSnazOwsog gquCrljmjNzDwctZNsPI payload ewogICJpZGVudGlmaWVycyI IFsKICAgIHsKICAgICAgInR cGUiOiAiZG zIiwKICAgICAgInZhbHVlIjogInByb pvLm jdXMuY tIgogICAgfQogIF KfQ POST acmeneworder HTTP Received response HTTP Server nginx Date Fri Nov GMT ContentType applicationjson ContentLength Connection keepalive BoulderRequester CacheControl public maxage nocache Link Location ReplayNonce dthn OPYUbaGIfCqJFbisnxyD Hy kLbjXooClNg XFrameOptions DENY StrictTransportSecurity maxage status pending expires T Z identifiers type dns value xxxloremcom authorizations finalize Storing nonce dthn OPYUbaGIfCqJFbisnxyD Hy kLbjXooClNg JWS payload b Sending POST request to protected eyJhbGciOiAiUlMyNTYiLCAia lkIjogImh dHBzOi vYWNtZS zdGFnaW nLXYwMi hcGkubGV c VuY J cHQub JnL FjbWUvYWNjdC xMTUxOTk MCIsICJub jZSI ICIwMDAyZF aG ME QWVViYUdJZkNxSkZiaXNueHlEMUh MTlrTGJqWG vQ xOZyIsICJ cmwiOiAiaHR cHM Ly hY lLXN YWdpbmctdjAyLmFwaS sZXRzZW jcnlwdC vcmcvYWNtZS hdXRoei My xOTgxNTg MCJ signature KZ llKj mZIYamX xhVkHSUnavih MWEY KlmzcYdNHtOdhGSNG FFU ZsVFuu XIzmfUyIW esdSIHllOM DdCHVe d sIxuN V cs ltAPMCZoeiG XBwxJDsBtDV WdJ DVv UPqCfcX Ntw T LkooCQaRGJCstAPlx MiVb uf gJIPqY O thKUADbzMDeew PDMtlHYHaqQZOvaajgY vTFtF Q DsfEyLASpkony fHlw S IuDDrZhLUyAbvKgwJDeTkYOOyiizxzf JnEvEG JyKNZsfLhMCxst W dDYlbESYXAKQSYbBhbFaDCzVAOQT Cc iq MSVITyB h vGq dJHVJloobTBDg azuNN ERnsZLuIKO wFQ HoGyFP AQ VPKgCDP MXf Whv O InciBuAO QKkNrpxBmLlrXD ndcDQ pD gtlStvBIADHuee L zxoqIu sOxmbmAWCHIPCQDYDIOTbad WPYS N aiIdjoNwTbtNbXys CzYfeSw nRugyWz geTg MhpYqoHIWqFQfVMW ER g kwcIYTbjZt MdE IWydJEq Q MvcEvGOLuYfpZjE deaHl NSiw JUW mYtSylWxXgxRVdChhRZtjh UlspHWU payload POST acmeauthzv HTTP Received response HTTP Server nginx Date Fri Nov GMT ContentType applicationjson ContentLength Connection keepalive BoulderRequester CacheControl public maxage nocache Link ReplayNonce pQ YQCYousjJoEJZ sTVmzmaAAtuPCBHN FLfOiQU XFrameOptions DENY StrictTransportSecurity maxage identifier type dns value xxxloremcom status pending expires T Z challenges type http status pending url token dkzqQxktAdggktPN t gT ckwh o hmSc gyhE U type dns status pending url token dkzqQxktAdggktPN t gT ckwh o hmSc gyhE U type tlsalpn status pending url token dkzqQxktAdggktPN t gT ckwh o hmSc gyhE U Storing nonce pQ YQCYousjJoEJZ sTVmzmaAAtuPCBHN FLfOiQU Performing the following challenges http challenge for xxxloremcom Using the webroot path varwwwcertbot for all unmatched domains Creating root challenges validation dir at varwwwcertbotwellknownacmechallenge Attempting to save validation to varwwwcertbotwellknownacmechallengedkzqQxktAdggktPN t gT ckwh o hmSc gyhE U Waiting for verification Challenges loaded Press continue to submit to CA Pass v for more info about challenges Press Enter to Continue JWS payload b n resource challenge n type http n Sending POST request to protected eyJhbGciOiAiUlMyNTYiLCAia lkIjogImh dHBzOi vYWNtZS zdGFnaW nLXYwMi hcGkubGV c VuY J cHQub JnL FjbWUvYWNjdC xMTUxOTk MCIsICJub jZSI ICIwMDAycFE OFlRQ lvdXNqSm FSloxc RWbXptYUFBdHVQQ JITjdGTGZPaVFVNCIsICJ cmwiOiAiaHR cHM Ly hY lLXN YWdpbmctdjAyLmFwaS sZXRzZW jcnlwdC vcmcvYWNtZS jaGFsbC My xOTgxNTg MC QbUtObVEifQ signature FDYkuxb R dc ZBRJfezgMw DOSt y nAqoplXs F D N Esvnl hiVFhd MlbbYLdsVzEQ vbnc NPUzVVK MtFIw aMNuIJnGIAgn coIffZZKfha mQD gRffhuIFUP xVDMNR rcpsN WNiHnDeuzpUJqOGGDiqGy SITfiCff cTKqYOykbgsPsfBO taY KHq nGP H pQvlboEu ALKzH UUP UaHxejq FLLrHYLqHMsVqLSegJU OjxrxCMl g ygrNunrO ctgiIgN WNgld I mOOEGkfz UVjvmfGmKwlWl fcqsGyy jBgGbgvPbBFX YRsahdBvlb nJaLNs lBqFWUCgnGLO PuMbDgVTqFUwrcGM UerwV GK AItNxvV DAcXRGorVnYEindt p OsbXA iO XHegp ficXfLuBKnbc IxW Ro ew eU nQ DpEE wh exlQJgm XYItbDL XdpxkVcGkvE jhQpuvwSWv MGgxkuVU uV eSPw wB iQxHHzk vl kD GbtC Lqx TaadkLHWQm rl PjHjJS O cYvIWqlUaDFVOfyABubJ DdFHIWHjKNZz hFIW AyNOsxP VotU xN ypc m OkLfJWFuXSuOCBqwRdp payload ewogICJyZXNvdXJjZSI ICJjaGFsbGVuZ UiLAogICJ eXBlIjogImh dHAtMDEiCn POST acmechallv PmKNmQ HTTP Received response HTTP Server nginx Date Fri Nov GMT ContentType applicationjson ContentLength Connection keepalive BoulderRequester CacheControl public maxage nocache Link Location ReplayNonce uVhZwVzdVbFWDpcL cgOmusK spQSTfRTrB N I o XFrameOptions DENY StrictTransportSecurity maxage type http status pending url token dkzqQxktAdggktPN t gT ckwh o hmSc gyhE U Storing nonce uVhZwVzdVbFWDpcL cgOmusK spQSTfRTrB N I o JWS payload b Sending POST request to protected eyJhbGciOiAiUlMyNTYiLCAia lkIjogImh dHBzOi vYWNtZS zdGFnaW nLXYwMi hcGkubGV c VuY J cHQub JnL FjbWUvYWNjdC xMTUxOTk MCIsICJub jZSI ICIwMDAydVZoWndWemRWYkZXRHBjTDUyY nT c s c BRU RmUlRyQjFONEk byIsICJ cmwiOiAiaHR cHM Ly hY lLXN YWdpbmctdjAyLmFwaS sZXRzZW jcnlwdC vcmcvYWNtZS hdXRoei My xOTgxNTg MCJ signature EIKVDrBIyCXBwsMkw EjsVgAbcp ry oKvSFKnP T ze aqrkSAMZAWyrOObarYAB jMZGNCJzk ODIIVQBACY LXxvwfWj IItIf NyFc dIUgw r fPLMpWCR meTyzTVDzVjzqJsn bQw pGTlXvAPl BtH MB d qKokOYWd qVSRRFpygm ITLCTaqryltlb XFRFVrYtkChRetdyhr WXHgEbO D wuoYYLNW R MOlbbqBKYmTs ekxH ofDnx HHilqskbFT sjG Mtqe yM ui KWGipG Gacwme YWLf cJDgHStSyVJacegDQa fePwYEiZfHCEw fkChNyxT iGKDOdTUIf tYLpMFIBi zjdN qEAShqx hFoqSlYHv K OWvKgv S DvJXPwH zMKIVJDIGFI J HHHjruXhLp mN LLaeRsVyfiiRgT PKwo uLmmRiysam BwciCalZKEhQlMoswiUOkCnSJaeXTEGdJtdEVWk uPblNQUTgLyM xtAuftiwNbZCi jHXjeVkEExNKfptihbhkjAjC D IX G d alwnl BtwsJgPAhHx s nQ B oX cEIkeSZPixKY KIYCc wtYE kUCq BDroZqlE payload POST acmeauthzv HTTP Received response HTTP Server nginx Date Fri Nov GMT ContentType applicationjson ContentLength Connection keepalive BoulderRequester CacheControl public maxage nocache Link ReplayNonce m OY qaElRdf p LyJeqReobHWSx G FMn I ganA XFrameOptions DENY StrictTransportSecurity maxage identifier type dns value xxxloremcom status invalid expires T Z challenges type http status invalid error type urnietfparamsacmeerrorconnection detail Fetching Connection refused status url token dkzqQxktAdggktPN t gT ckwh o hmSc gyhE U validationRecord url hostname xxxloremcom port addressesResolved addressUsed type dns status invalid url token dkzqQxktAdggktPN t gT ckwh o hmSc gyhE U type tlsalpn status invalid url token dkzqQxktAdggktPN t gT ckwh o hmSc gyhE U Storing nonce m OY qaElRdf p LyJeqReobHWSx G FMn I ganA Challenge failed for domain xxxloremcom http challenge for xxxloremcom Reporting to user The following errors were reported by the server Domain xxxloremcom Type connection Detail Fetching Connection refused To fix these errors please make sure that your domain name was entered correctly and the DNS AAAAA records for that domain contains the right IP address Additionally please check that your computer has a publicly routable IP address and that no firewalls are preventing the server from communicating with the client If youre using the webroot plugin you should also verify that you are serving files from the webroot path you provided Encountered exception Traceback most recent call last File optcertbotsrccertbotauthhandlerpy line in handleauthorizations selfpollauthorizationsauthzrs maxretries besteffort File optcertbotsrccertbotauthhandlerpy line in pollauthorizations raise errorsAuthorizationErrorSome challenges have failed certboterrorsAuthorizationError Some challenges have failed Calling registered functions Cleaning up challenges Removing varwwwcertbotwellknownacmechallengedkzqQxktAdggktPN t gT ckwh o hmSc gyhE U All challenges cleaned up Exiting abnormally Traceback most recent call last File usrlocalbincertbot line in module loadentrypointcertbot consolescripts certbot File optcertbotsrccertbotmainpy line in main return configfuncconfig plugins File optcertbotsrccertbotmainpy line in certonly lineage getandsavecertleclient config domains certname lineage File optcertbotsrccertbotmainpy line in getandsavecert lineage leclientobtainandenrollcertificatedomains certname File optcertbotsrccertbotclientpy line in obtainandenrollcertificate cert chain key selfobtaincertificatedomains File optcertbotsrccertbotclientpy line in obtaincertificate orderr selfgetorderandauthorizationscsrdata selfconfigallowsubsetofnames File optcertbotsrccertbotclientpy line in getorderandauthorizations authzr selfauthhandlerhandleauthorizationsorderr besteffort File optcertbotsrccertbotauthhandlerpy line in handleauthorizations selfpollauthorizationsauthzrs maxretries besteffort File optcertbotsrccertbotauthhandlerpy line in pollauthorizations raise errorsAuthorizationErrorSome challenges have failed certboterrorsAuthorizationError Some challenges have failed Some challenges have failed IMPORTANT NOTES The following errors were reported by the server Domain xxxloremcom Type connection Detail Fetching Connection refused To fix these errors please make sure that your domain name was entered correctly and the DNS AAAAA records for that domain contains the right IP address Additionally please check that your computer has a publicly routable IP address and that no firewalls are preventing the server from communicating with the client If youre using the webroot plugin you should also verify that you are serving files from the webroot path you provided Reloading nginx notice signal process started xxx stands for my subdomain lorem for my domain I double checked my subdomain with nslookup and it seems to be fine Also I tried on a different subdomain same issue In order to give you all the inputs please find my different files defaultconf server listen servername xxxloremcom servertokens off location wellknownacmechallenge root varwwwcertbot location return server listen ssl servername xxxloremcom servertokens off sslcertificate etcletsencryptlivexxxloremcomfullchainpem sslcertificatekey etcletsencryptlivexxxloremcomprivkeypem include etcletsencryptoptionssslnginxconf ssldhparam etcletsencryptssldhparamspem location proxypass proxysetheader Host httphost proxysetheader XRealIP remoteaddr proxysetheader XForwardedFor proxyaddxforwardedfor initletsencryptsh binbash if x command v dockercompose then echo Error dockercompose is not installed exit fi domainsxxxloremcom rsakeysize datapathdatacertbot emailvivianloremcom Adding a valid address is strongly recommended staging Set to if youre testing your setup to avoid hitting request limits if d datapath then read p Existing data found for domains Continue and replace existing certificate yN decision if decision Y decision y then exit fi fi if e datapathconfoptionssslnginxconf e datapathconfssldhparamspem then echo Downloading recommended TLS parameters mkdir p datapathconf curl s datapathconfoptionssslnginxconf curl s datapathconfssldhparamspem echo fi echo Creating dummy certificate for domains pathetcletsencryptlivedomains mkdir p datapathconflivedomains dockercompose run rm entrypoint openssl req x nodes newkey rsa days keyout pathprivkeypem out pathfullchainpem subj CNlocalhost certbot echo echo Starting nginx dockercompose up forcerecreate d nginx echo echo Deleting dummy certificate for domains dockercompose run rm entrypoint rm Rf etcletsencryptlivedomains rm Rf etcletsencryptarchivedomains rm Rf etcletsencryptrenewaldomainsconf certbot echo echo Requesting Lets Encrypt certificate for domains Join domains to d args domainargs for domain in domains do domainargsdomainargs d domain done Select appropriate email arg case email in emailargregisterunsafelywithoutemail emailargemail email esac Enable staging mode if needed if staging then stagingargstaging fi dockercompose run rm entrypoint certbot certonly webroot v debugchallenges w varwwwcertbot stagingarg emailarg domainargs rsakeysize rsakeysize agreetos forcerenewal certbot echo echo Reloading nginx dockercompose exec nginx nginx s reload dockercomposeyml version services nginx image nginx alpine containername xxxnginx restart unlessstopped volumes datanginxetcnginxconfd datacertbotconfetcletsencrypt datacertbotwwwvarwwwcertbot ports command binsh c while do sleep h wait nginx s reload done nginx g daemon off certbot image certbotcertbot containername xxxcertbot restart unlessstopped volumes datacertbotconfetcletsencrypt datacertbotwwwvarwwwcertbot entrypoint binsh c trap exit TERM while do certbot renew sleep h wait done nuxt build app containername xxxapp restart always ports command npm run start Im really desesperate Any advice tip or idea is more than welcome I had trouble deploying this setup on a GCP VM running their ContainerOptimized OS See reasons here Refactoring this script allowed me to get up running I think if you accepted these changes You would make the software more accessible nginx emerg open etcletsencryptoptionssslnginxconf failed No such file or directory in etcnginxconfdappconf nginx nginx emerg open etcletsencryptoptionssslnginxconf failed No such file or directory in etcnginxconfdappconf certbot Saving debug log to varlogletsencryptletsencryptlog certbot certbot certbot certbot No renewals were attempted certbot Allow noninteractive handling of subscriptions to EFF mailings in case an email address was provided