 Problem Description I am trying to set up my Nitrokey Storage to connect to remote hosts with ECC I am using NIST P curve I have no problems at listing all the keys pkcs tool listkeys Using reader with a card Nitrokey Nitrokey Storage Private EC Key Signature key Object Flags x private modifiable Usage x C sign signRecover nonRepudiation Access Flags x D sensitive alwaysSensitive neverExtract local FieldLength Key ref x Native yes Auth ID ID MDguid a f c ad e d af Private EC Key Encryption key Object Flags x private modifiable Usage x decrypt unwrap Access Flags x D sensitive alwaysSensitive neverExtract local FieldLength Key ref x Native yes Auth ID ID MDguid b fb e ea fc d e Private EC Key Authentication key Object Flags x private modifiable Usage x decrypt unwrap nonRepudiation Access Flags x D sensitive alwaysSensitive neverExtract local FieldLength Key ref x Native yes Auth ID ID MDguid a a a eb c c af b e But then there is a problem on exporting the third auth key in SSH form pkcs tool readsshkey Using reader with a card Nitrokey Nitrokey Storage Unsupported curve NIST P should be supported by both this token and OpenSSH Of course this problem persists for two other keyslots sshkeygen returns similar problems sshkeygen D usrlibopenscpkcs so CGetAttributeValue failed failed to fetch key CGetAttributeValue failed failed to fetch key Enter PIN for OpenPGP card User PIN CGetAttributeValue failed failed to fetch key CGetAttributeValue failed failed to fetch key CGetAttributeValue failed failed to fetch key Enter PIN for OpenPGP card User PIN sig CGetAttributeValue failed failed to fetch key cannot read public key from pkcs Of course I have no problems just reading any of those keys pkcs tool readpublickey Using reader with a card Nitrokey Nitrokey Storage BEGIN PUBLIC KEY MHEwCwYHKoZIzj CAQUAA IABEdm v tYPaS jfosey Kc MiUmYu vdRU c CurIla hIkaCvvnUhU SChsggtgyrZP V A kCrdwBOh g B FhWvOuDF pEJJkUQYsmqY k ry FhWsBlg END PUBLIC KEY I also have another Nitrokey with RSA keys from my work it looks like it works perfectly with ssh and openscpkcs module Please read about reporting bugs before opening an issue Steps to reproduce Install OpenSC and OpenSSH Set up an OpenPGP card with NISTP keys Try to generate SSH key Debug output is essential to identify the problem You can enable debugging by editing the file openscconf A debug level of catches most problems Some sensitive data may be logged too eg PIN codes debug Where to write the debug output default stdout debugfile openscdebuglog Please use Gist or a similar code paster for longer logs Before pasting here remove your sensitive data from your log eg PIN code or certificates Paste Log output with less than lines here between the backticks Problem Description I think we need to have a closer look at scdecompresszliballoc It looks like theres are multiple problems with calling realloc with size possible double free missing length checks when calculating the buffer sizes possible misconception of realloc afaik shrinking down a buffer is not possible Problem Description While playing with the openscnotify I noticed it ends up in infinite loop in case I plug out my yubikey and start the daemon first log Similarly there is an issue when the daemon is started while yubikey connected The disconnect of yubikey causes the openscnotify deamon to exit the SCardGetStatusChange returns SCARDEUNKNOWNREADER The reader is not removed from the reader list when the removal is detected and in the next round it is failing as it does not know this reader Proposed Resolution The inifinite loop should be probably solved with the following patch diff git asrclibopenscreaderpcscc bsrclibopenscreaderpcscc index c dac c asrclibopenscreaderpcscc bsrclibopenscreaderpcscc static int pcscwaitforeventsccontextt ctx unsigned int eventmask scre ifndef APPLE OS X do not support PnP notification if eventmask SCEVENTREADERATTACHED if eventmask SCEVENTREADERATTACHED SCEVENTCARDINSERTED rgReaderStates i szReader PnP Notification rgReaderStates i dwCurrentState SCARDSTATEUNAWARE rgReaderStates i dwEventState SCARDSTATEUNAWARE but I am not sure about the other issue I tried to put something together but it did not work so far Steps to reproduce Remove any readers from the system and run openscnotify daemon It will end in infinite loop Connect a reader to the system start openscnotify and then disconnect the reader It will exit with errors Logs P T x openscnotify ctxc processconfigfile Used configuration file etcopenscconf P T x openscnotify ctxc sccontextcreate P T x openscnotify ctxc sccontextcreate opensc version P T x openscnotify readerpcscc pcscinit PCSC options connectexclusive disconnectaction transactionendaction reconnectaction enablepinpad enablepace P T x openscnotify readerpcscc pcscdetectreaders called P T x openscnotify readerpcscc pcscdetectreaders Probing PCSC readers P T x openscnotify readerpcscc pcscdetectreaders Establish PCSC context P T x openscnotify readerpcscc pcscdetectreaders SCardListReaders failed x e P T x openscnotify readerpcscc pcscdetectreaders returning with No readers found P T x openscnotify ctxc scwaitforevent called P T x openscnotify readerpcscc pcscwaitforevent called P T x openscnotify readerpcscc pcscwaitforevent Trying to watch readers P T x openscnotify readerpcscc pcscwaitforevent Looping P T x openscnotify readerpcscc pcscwaitforevent Looping P T x openscnotify readerpcscc pcscwaitforevent Looping P T x openscnotify readerpcscc pcscwaitforevent Looping P T x openscnotify readerpcscc pcscwaitforevent Looping Removal P T x openscnotify readerpcscc pcscwaitforevent Yubico YubiKey OTPFIDOCCID before x now x E P T x openscnotify readerpcscc pcscwaitforevent card removed event P T x openscnotify readerpcscc pcscwaitforevent reader detached event P T x openscnotify readerpcscc pcscwaitforevent Matching event x A in reader Yubico YubiKey OTPFIDOCCID P T x openscnotify readerpcscc pcscwaitforevent returning with Success P T x openscnotify cardc matchatrtable ATR bf fe b d P T x openscnotify cardc matchatrtable ATR try bf f P T x openscnotify cardc matchatrtable ignored wrong length P T x openscnotify cardc matchatrtable ATR bf fe b d P T x openscnotify cardc matchatrtable ATR try bf f P T x openscnotify cardc matchatrtable ignored wrong length P T x openscnotify ctxc scwaitforevent called P T x openscnotify readerpcscc pcscwaitforevent called P T x openscnotify readerpcscc pcscwaitforevent reuse reader Yubico YubiKey OTPFIDOCCID P T x openscnotify readerpcscc pcscwaitforevent reuse reader PnP Notification P T x openscnotify readerpcscc pcscwaitforevent SCardGetStatusChange failed x P T x openscnotify readerpcscc pcscwaitforevent returning with Unknown error P T x openscnotify ctxc scwaitforevent called opensctool segfaults when trying to read a card that doesn t populate the name field This commit adds a null check before calling strcmp The card in question is unknown and subject to research This is probably quite easy to reproduce though Fixes Checklist No applicable items Problem Description When using the openscuninstall script I noted the following shell sudo usrlocalbinopenscuninstall No receipt for orgopenscprojecttokend found at OpenSC has been removed from your system See you again pkgutil pkgs grep opensc orgopenscprojectmacopensctoken orgopenscprojectstartup launchctl list grep Ee openscnotifypkcs register openscnotify pkcs register Proposed Resolution Unload the launchagents on uninstall Update the pkgutil cleaning steps Steps to reproduce Install OpenSC on macOS Catalina Use the usrlocalbinopenscuninstall script to uninstall Found via Make openscexplorer a bit more user friendly by treating the question mark given as argument to option carddriver special list all available drivers instead of stupidly bailing out Checklist x Documentation is added or updated This is not a bug and I am unsure if this is the correct to ask questions or not I followed the directions to compile on cygwin here The good news is that it works perfectly My question is how do I transfer this solution to another system I am guessing that I do not have to follow the same process of compiling on every system Or do I I am unsure if I have to create some sort of package or copy some specific files I appreciate any assistance on how to proceed Problem Description I have a digital signature token ACS ECR U SC reader with a Oberthur IDone Cosmo V smartcard Whenever I try to log into the device using OpenSC it resets No matter if I enter correct or a wrong PIN Steps to reproduce pkcs tool test login On such device Logs Verbose log Login at line pcscscan Is my hardware supported Am I doing something wrong In regards of I would like to bump version of PKCS library to and implement the new required interfaces in coming months The public review drafts are already available on OASIS website and I assume there will be no significant changes before the final version So far these are my thoughts about advantages of Support for new key types ed see It is backward compatible new functions are available through CGetInterfaceList and CGetInterface Profile objects can resolve the issues with NSS and its handling of OpenSC as nonfriendly by announcing the CKPPUBLICCERTIFICATESTOKEN profile from SHA support I will probably go through the draft and try to create issues for particular tasks if it will be easy to separate them so anyone can help I would probably like to create it as a project but it looks like I do not have appropriate permissions to do that Any thoughts