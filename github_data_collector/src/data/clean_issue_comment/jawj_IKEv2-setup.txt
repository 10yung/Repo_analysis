 Hi Everything on the script works great but I want to try to give more access to VPN clients to LAN resources I works with a dedicate server to deploy IKEV with two network interfaces eth Public IP eth Connect server to my LAN network IP LAN network IKE VPN clients IP My goal is provide access from VPN Client eg to some resources into my LAN eg from the server I can make ping to IP LANs VPN clients and surfing internet everything work fine I was try to create some Iptables roules to make a NAT from VPN Clients to LAN network but I have not had good results Im stuck in this point because I dont know if I have to make some changes in ipsecconf file or I make a mistake with Iptables routes that I created I will appreciate any help that you could provide me to achieve my goal Many thanks for any help Darwin Hi i got this issue while im trying to use your file No such network interface dev my ubuntu version rootDESKTOPU S V lsbrelease a No LSB modules are available Distributor ID Ubuntu Description Ubuntu LTS Release Codename bionic Error invokercd could not determine current runlevel Setting up mutt ubuntu Setting up strongswanlibcharon ubuntu Setting up python rfc Setting up iptablespersistent nmu ubuntu iptables v cant initialize iptables table filter Table does not exist do you need to insmod Perhaps iptables or your kernel needs to be upgraded IPv Unable to save table filter isnt available or module not loadable ip tables v cant initialize ip tables table filter Table does not exist do you need to insmod Perhaps ip tables or your kernel needs to be upgraded IPv Unable to save table filter isnt available or module not loadable Setting up strongswanstarter ubuntu invokercd could not determine current runlevel Created symlink etcsystemdsystemmultiusertargetwantsstrongswanservice libsystemdsystemstrongswanservice Setting up dconfservice ubuntu Setting up python zopecomponent Setting up moreutils Setting up python ubuntu Setting up libpythonstdlibamd rc Setting up python future ubuntu updatealternatives using usrbinpython futurize to provide usrbinfuturize futurize in auto mode updatealternatives using usrbinpython pasteurize to provide usrbinpasteurize pasteurize in auto mode Setting up strongswancharon ubuntu Setting up dconfgsettingsbackendamd ubuntu Setting up python rc Setting up pythonpyicu ubuntu Setting up python acme ubuntu Setting up python parsedatetime Setting up python certbot Setting up gsettingsdesktopschemas ubuntu Setting up strongswan ubuntu Setting up glibnetworkingamd Setting up certbot Created symlink etcsystemdsystemtimerstargetwantscertbottimer libsystemdsystemcertbottimer Setting up libsoup amd ubuntu Setting up languagepacken Setting up languagepackenbase Generating locales this might take a while enAGUTF done enAUUTF done enBWUTF done enCAUTF done enDKUTF done enGBUTF done enHKUTF done enIEUTF done enILUTF done enINUTF done enNGUTF done enNZUTF done enPHUTF done enSGUTF done enZAUTF done enZMUTF done enZWUTF done Generation complete Setting up strongswantncbase ubuntu Setting up libcharonextraplugins ubuntu Setting up libstrongswanextraplugins ubuntu Processing triggers for ureadahead Processing triggers for libcbin ubuntu Processing triggers for systemd ubuntu Processing triggers for rsyslog ubuntu invokercd could not determine current runlevel Processing triggers for ufw ubuntu Configuration VPN settings No such network interface dev My favorite VPS hoster gives a numeric hostname digits of the order with the public DNS name as ipnsnet is here as a changed example And your setup script fails as it is shown below root setupsh Updating and installing software Get bionicsecurity InRelease kB Hit bionic InRelease Hit bionicupdates InRelease Hit bionicbackports InRelease Fetched kB in s kBs Reading package lists Done Reading package lists Done Building dependency tree Reading state information Done softwarepropertiescommon is already the newest version upgraded newly installed to remove and not upgraded not fully installed or removed After this operation B of additional disk space will be used Setting up postfix ubuntu postconf warning validhostname numeric hostname postconf fatal unable to use my own hostname Use of uninitialized value destinations in scalar chomp at varlibdpkginfopostfixconfig line Use of uninitialized value in join or string at usrshareperl DebconfClientConfModulepm line postconf warning validhostname numeric hostname postconf fatal unable to use my own hostname Use of uninitialized value mynetworks in scalar chomp at varlibdpkginfopostfixconfig line Use of uninitialized value in join or string at usrshareperl DebconfClientConfModulepm line postconf warning validhostname numeric hostname postconf fatal unable to use my own hostname Use of uninitialized value protos in scalar chomp at varlibdpkginfopostfixconfig line Use of uninitialized value in join or string at usrshareperl DebconfClientConfModulepm line postconf warning validhostname numeric hostname postconf fatal unable to use my own hostname postconf warning validhostname numeric hostname postconf fatal unable to use my own hostname dpkg error processing package postfix configure installed postfix package postinstallation script subprocess returned error exit status Processing triggers for libcbin ubuntu Errors were encountered while processing postfix E Subprocess usrbindpkg returned an error code root Is it possible to remark the postfix actions at all if I know what your script will try to send me An idea is just to add such example outputs nearby to your repo as documentation please no unwanted emails for ones privacy Dear Team Might be a newbie question I am having this error when running the script No such network interface I am running this on a Ubuntu hosted on a virtual cloud VPS server Configuration VPN settings No such network interface Part of LOG Feb f hd s qm systemd Created slice systempostfixslice Feb f hd s qm systemd Starting Postfix Mail Transport Agent instance Feb f hd s qm configureinstancesh postconf fatal open etcpostfixmaincf No such file or directory Feb f hd s qm configureinstancesh postconf fatal open etcpostfixmaincf No such file or directory Feb f hd s qm systemd postfixservice Control process exited codeexited status Feb f hd s qm systemd postfixservice Failed with result exitcode Feb f hd s qm systemd Failed to start Postfix Mail Transport Agent instance Feb f hd s qm systemd Reloading Feb f hd s qm systemd libsystemdsystemvzfifoservice Support for option SysVStartPriority has been removed and it is ignored Feb f hd s qm systemd Starting Postfix Mail Transport Agent instance Feb f hd s qm postfixpostfixscript starting the Postfix mail system Feb f hd s qm postfixmaster daemon started version configuration etcpostfix Feb f hd s qm systemd Started Postfix Mail Transport Agent instance Feb f hd s qm systemd Starting Postfix Mail Transport Agent Feb f hd s qm systemd libsystemdsystemvzfifoservice Support for option SysVStartPriority has been removed and it is ignored Feb f hd s qm systemd Reloading Feb f hd s qm systemd libsystemdsystemvzfifoservice Support for option SysVStartPriority has been removed and it is ignored Feb f hd s qm systemd Reloading Feb f hd s qm systemd libsystemdsystemvzfifoservice Support for option SysVStartPriority has been removed and it is ignored Feb f hd s qm systemd Started strongSwan IPsec IKEv IKEv daemon using ipsecconf Feb f hd s qm ipsec Starting strongSwan IPsec starter Feb f hd s qm ipsec no netkey IPsec stack detected Feb f hd s qm ipsec no KLIPS IPsec stack detected Feb f hd s qm ipsec no known IPsec stack detected ignoring Feb f hd s qm charon DMN Starting IKE charon daemon strongSwan Linux x Feb f hd s qm charon CFG loading ca certificates from etcipsecdcacerts Feb f hd s qm charon CFG loading aa certificates from etcipsecdaacerts Feb f hd s qm charon CFG loading ocsp signer certificates from etcipsecdocspcerts Feb f hd s qm charon CFG loading attribute certificates from etcipsecdacerts Feb f hd s qm charon CFG loading crls from etcipsecdcrls Feb f hd s qm charon CFG loading secrets from etcipsecsecrets Feb f hd s qm charon LIB loaded plugins charon aesni aes rc sha sha md md mgf random nonce x revocation constraints pubkey pkcs pkcs pkcs pkcs pgp dnskey sshkey pem openssl fipsprf gmp agent xcbc hmac gcm attr kernelnetlink resolve socketdefault connmark stroke updown eapmschapv xauthgeneric counters Feb f hd s qm charon LIB dropped capabilities running as uid gid Feb f hd s qm charon JOB spawning worker threads Feb f hd s qm ipsec charon started after ms Feb f hd s qm systemd Reloading Feb f hd s qm systemd libsystemdsystemvzfifoservice Support for option SysVStartPriority has been removed and it is ignored Feb f hd s qm systemd Reloading Feb f hd s qm systemd libsystemdsystemvzfifoservice Support for option SysVStartPriority has been removed and it is ignored Feb f hd s qm systemd Reloading Feb f hd s qm systemd libsystemdsystemvzfifoservice Support for option SysVStartPriority has been removed and it is ignored Feb f hd s qm systemd Started Run certbot twice daily Feb f hd s qm systemd Reloading Feb f hd s qm systemd libsystemdsystemvzfifoservice Support for option SysVStartPriority has been removed and it is ignored Please assist Thanks Hi thank you for your script I am having troubles to setup second VPN user with fixed IP inside VPN network Your script configures one VPN user that receives free IP from pool I want to change IPs for that user to be in range I figured out that to do this I need to modify rightsourceip of conn roadwarrior section in etcipsecconf I know how to add new users in etc ipsecsecrets but they receive IPs from the same pool As I understand I need to setup additional conn sections for each VPN user that requires fixed IP in etcipsecconf The problem is if I modify leftid or eapidentity fields of conn roadwarrior section to something other than any then I cant connect to VPN server using Windows and Ubuntu anymore only Android StrongSwan application is able to connect What is the correct way to configure etcipsecconf to make some VPN users receive IP from pool and make other VPN users to have fixed IP Hi Everything looks good in my environment The clients can get an IP address from the DHCP Server and can go to LAN and WAN without any problem butall the clients get the same IP address from the DHCP Server I have tested with another DHCP Server st was a Firewall DHCP and nd was a Windows Server DHCP and its the same My Config files are etcipsecconf config setup strictcrlpolicyno uniqueidsnever charondebugike knl cfg net esp dmn mgr conn roadwarrior autoadd compressno typetunnel keyexchangeikev fragmentationyes forceencapsyes ikeaes gcm sha ecp aes sha ecp espaes gcm sha dpdactionclear dpddelay s rekeyno leftany leftidvpnrvaorg leftcertcertpem leftsendcertalways leftsubnet rightany rightidany rightautheapmschapv eapidentityany rightdnsdns ip address dns IP address rightsourceipdhcp rightsendcertnever etcsysctld strongswanconf netipv ipforward etcstrongswandcharondhcpconf dhcp forceserveraddress yes identitylease yes interface eth load yes server DHCP IP address charon loadmodular yes dns dns ip address dns dns ip address plugins include strongswandcharonconf attr splitinclude Send only traffic destined to leftsubnet to the tunnel interface splitexclude Mac OS X client responsible for routing all nontunnel traffic elsewhere rvaorg dns dns ip address dns ip address include strongswandconf IPTABLES PS That is not my config but I tested with that to make sure that there is nothing wrong with it Clean IP Tables iptables F iptables X iptables t nat F iptables t nat X iptables t mangle F iptables t mangle X iptables P INPUT ACCEPT iptables P FORWARD ACCEPT iptables P OUTPUT ACCEPT Questions How to fix that the DHCP gives a different IP address to each VPN Client LikeI made a test using rightsourceip and the client works with no problem but for the firewall looks like the connection comes from the server The server have free access to the internet but the Clients should auth first How to change the way that the VPN Client go to the LAN to because a normal client Or how to fix the DHCP Issue that gives the same IP address to all the VPN Client Is there a way to add IPv support I am on US TMobile and even though I can connect to my VPN server the traffic completely stops after connecting That seems to be because TMobile only supports IPv Hello This seems like a wonderful project I installed it on a Google Compute instance Ubuntu During the installation I get the following error Processing triggers for ufw Network interface ens External IP Warning vpnmyDomaincom resolves to not Either you are behind NAT or something is wrong eg hostname points to wrong IP CloudFlare proxying shenanigans Press Return to continue or CtrlC to abort Well my external IP of the instance is and the internal IP is Why should my domain point to the internal IP address That makes no sense May you please advise on this Many Thanks Houman Ran the setupsh script on a fresh install of Ubuntu Server with no modifications to anything Im able to successfully connect to the VPN server but theres no traffic passing through the tunnel The VPN server is a virtual machine running on Vmware Workstation Pro The virtual network adapter is set to bridge mode and its pulling its own IP address from the router iptables L output Chain INPUT policy ACCEPT target prot opt source destination DROP all anywhere anywhere state NEW recent UPDATE seconds hitcount name DEFAULT side source mask all anywhere anywhere state NEW recent SET name DEFAULT side source mask ACCEPT all anywhere anywhere state RELATEDESTABLISHED ACCEPT all anywhere anywhere DROP all anywhere anywhere state INVALID ACCEPT tcp anywhere anywhere tcp dptssh ACCEPT udp anywhere anywhere udp dptisakmp ACCEPT udp anywhere anywhere udp dptipsecnatt DROP all anywhere anywhere Chain FORWARD policy ACCEPT target prot opt source destination ACCEPT all anywhere policy match dir in pol ipsec proto esp ACCEPT all anywhere policy match dir out pol ipsec proto esp DROP all anywhere anywhere Chain OUTPUT policy ACCEPT target prot opt source destination etcipsecconf config setup strictcrlpolicyyes uniqueidsnever conn roadwarrior autoadd compressno typetunnel keyexchangeikev fragmentationyes forceencapsyes ikeaes gcm sha ecp aes sha ecp espaes gcm sha dpdactionclear dpddelay s rekeyno leftany leftid server hostname leftcertcertpem leftsendcertalways leftsubnet rightany rightidany rightautheapmschapv eapidentityany rightdns rightsourceip rightsendcertnever truncated and sanitised varlogsyslog Aug VPN charon NET received packet from client to server bytes Aug VPN charon ENC parsed IKESAINIT request SA KE No NREDIRSUP NNATDSIP NNATDDIP NFRAGSUP Aug VPN charon IKE client is initiating an IKESA Aug VPN charon IKE local host is behind NAT sending keep alives Aug VPN charon IKE remote host is behind NAT Aug VPN charon ENC generating IKESAINIT response SA KE No NNATDSIP NNATDDIP NFRAGSUP NMULTAUTH Aug VPN charon NET sending packet from server to client bytes Aug VPN charon NET received packet from client to server bytes Aug VPN charon ENC unknown attribute type Aug VPN charon ENC parsed IKEAUTH request IDi NINITCONTACT NMOBIKESUP IDr CPRQADDR DHCP DNS MASK ADDR DHCP DNS NESPTFCPADN NNONFIRSTFRAG SA TSi TSr NEAPONLY Aug VPN charon CFG looking for peer configs matching server server host name client server hostname Aug VPN charon CFG selected peer config roadwarrior Aug VPN charon IKE initiating EAPIDENTITY method id x Aug VPN charon IKE received ESPTFCPADDINGNOTSUPPORTED not using ESPv TFC padding Aug VPN charon IKE peer supports MOBIKE Aug VPN charon IKE authentication of server hostname myself with RSA signature successful Aug VPN charon IKE sending end entity cert CNserver hostname Aug VPN charon IKE sending issuer cert CUS OLets Encrypt CNLets Encrypt Authority X Aug VPN charon ENC generating IKEAUTH response IDr CERT CERT AUTH EAPREQID Aug VPN charon ENC splitting IKE message with length of bytes into fragments Aug VPN charon ENC generating IKEAUTH response EF Aug VPN charon ENC generating IKEAUTH response EF Aug VPN charon ENC generating IKEAUTH response EF Aug VPN charon NET sending packet from server to client bytes Aug VPN charon NET sending packet from server to client bytes Aug VPN charon NET sending packet from server to client bytes Aug VPN charon NET received packet from client to server bytes Aug VPN charon ENC parsed IKEAUTH request EAPRESID Aug VPN charon IKE received EAP identity VPNuser Aug VPN charon IKE initiating EAPMSCHAPV method id x C Aug VPN charon ENC generating IKEAUTH response EAPREQMSCHAPV Aug VPN charon NET sending packet from server to client bytes Aug VPN charon NET received packet from client to server bytes Aug VPN charon ENC parsed IKEAUTH request EAPRESMSCHAPV Aug VPN charon ENC generating IKEAUTH response EAPREQMSCHAPV Aug VPN charon NET sending packet from server to client bytes Aug VPN charon NET received packet from client to server bytes Aug VPN charon ENC parsed IKEAUTH request EAPRESMSCHAPV Aug VPN charon IKE EAP method EAPMSCHAPV succeeded MSK established Aug VPN charon ENC generating IKEAUTH response EAPSUCC Aug VPN charon NET sending packet from server to client bytes Aug VPN charon NET received packet from client to server bytes Aug VPN charon ENC parsed IKEAUTH request AUTH Aug VPN charon IKE authentication of server hostname with EAP successful Aug VPN charon IKE authentication of server hostname myself with EAP Aug VPN charon IKE IKESA roadwarrior established between server server hostname client server hostname Aug VPN charon IKE peer requested virtual IP any Aug VPN charon CFG reassigning offline lease to VPNuser Aug VPN charon IKE assigning virtual IP to peer VPNuser Aug VPN charon IKE peer requested virtual IP any Aug VPN charon IKE no virtual IP found for any requested by VPNuser Aug VPN charon IKE CHILDSA roadwarrior established with SPIs cd e cbi e dbo and TS Aug VPN charon ENC generating IKEAUTH response AUTH CPRPADDR DNS DNS SA TSi TSr NMOBIKESUP NNOADDADDR Aug VPN charon NET sending packet from server to client bytes