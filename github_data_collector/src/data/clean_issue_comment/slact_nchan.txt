nginx version nginx nchan version I use XAccelRedirect header to redirect to subscribe endpoint here is my config nchanmaxchannelidlength server location subupstream proxypass proxysetheader XForwardedFor remoteaddr location subinternal internal this location only accessible for internal nginx redirects nchansubscriber nchanchannelid nchanchannelidsplitdelimiter And my upstream response is GET subscriberxaccelredirect HTTP Host localhost UserAgent curl Accept Mark bundle as not supporting multiuse HTTP OK XAccelBuffering no XAccelRedirect subinternal ID length is When I connect to subupstream nginx worker will crash alert worker process exited on signal Doubtless this is my fault in some way but I could use some help Heres my config server listen ssl servername removed SSL settings removed location subscribe nchansubscriber nchanchannelid argid location publish nchanpublisher nchanchannelid argid location nchanstubstatus nchanstubstatus Im using the nchan NPM client About every second I can see that a request is being made to my channel which returns with Switching protocols Why would this be happening so frequently If I connect using a browser then I rapidly get ERREMPTYRESPONSE errors Adding an on handler for errors I see lots of errors saying Error during WebSocket handshake netERRCONNECTIONRESET or Error during WebSocket handshake Unexpected response code But these are not once per second Much less frequently I see it return storage errors Im not worried about this as I have a periodic restart but I mention it in case its relevant Im trying to use nchan to create a pubsub setup where subscribers receive the current state on new connections but start at the newest message Starting from the first and fastforwarding would be a prohibitive amount of data for new connections in this case Is there any way to add HTTP response code capabilities to nchansubscriberequest similar to how nchanpublisherupstreamrequest handlers can optionally return a response Or is there another approach to achieving the same thing I suppose the response could also be done on nchanauthorizerequest instead of nchansubscriberequest but neither seems to listen for a callback response Are there any plans to add SSL support for Redis connection Hiredis had recently added it to their master branch After issuing HTTP DELETE request to publisher endpoint the subsequent GET and DELETE requests for the same channel return as described However the subscribers both Websockets and EventSource stay connected and continue to receive POSTed messages I use Redis as storage backend with the options nchanredisstoragemode nostore nchanredisnostorefastpublish on Hi We would like to use the Fedora dynamic lib build to host nchan on RedHat OS with nginx the curretn version Does the link in support the OS and nginx version If not is this something you can help us or let me know how to produce the dynamic lib Thank you Hi We are trying to use the nchanwebsocketclientheartbeat directive Here is the location config location sub nchansubscriber websocket nchanwebsocketclientheartbeat ping pong nchanchannelid argid Here is the excerpt from the log that we observe after ping is sent debug BUFCHAINPOOL E CC A bcs rec files rec debug BUFCHAINPOOL E CC A bcs rec files rec debug BUFCHAINPOOL E CC A bcs rec files rec debug SUBWEBSOCKET E CCBF dequeue debug SPOOLsub E CCBF dequeue callback debug MEMSTORE Chanhead gc add E CD dd bb d ca d c sub count after spooler dequeue debug MEMSTORE Chanhead churn withdraw E CD dd bb d ca d c debug REAPER withdraw chanhead churner E CD debug MEMSTORE chanheadgc max count debug MEMSTORE message GC results started with walked deleted msgs debug MEMSTORE not ready to reap dd bb d ca d c sec left debug REAPER reap chanhead E CD later waiting to be reaped debug REAPER reap chanhead again later remaining debug SUBWEBSOCKET E CCBF destroy for req E CCF D Version Is the nchanwebsocketclientheartbeat directive allowed in pure nchansubscriber location What we observe is that after the client sends ping websocket is closed from the server side and client reconnects No pong is received Seems like we are doing something wrong But what After nchan running for a few days at our dev env we are facing to publish latency about sec and its growing Also even not able to subscribe to channel When open at browser i can see at network tab that request at pending state Nchan is behind nginxingress Checked logs of nchan and nginxingress there is no line that i tried to access data by subscribe url Only restart helps Here is stats total published messages stored messages shared memory used K shared memory limit K channels subscribers redis pending commands redis connected servers total interprocess alerts received interprocess alerts in transit interprocess queued alerts total interprocess send delay total interprocess receive delay nchan version Active connections server accepts handled requests Reading Writing Waiting Hi Is planed used for storage messages Redis Stream Redis Stream used as universal storage messages for my microservices Thanks Ive updated nchan from nchan built from source commit sha d a c to latest While we had some issues with nginx worker crashing in the past its been quite stable in last months no crashes at all Now in just about minutes after version change the worker crashed Here are the details though as I used compiled deb packages there are less details than usual lsbrelease a No LSB modules are available Distributor ID Ubuntu Description Ubuntu LTS Release Codename trusty uname a Linux appexamplecom generic Ubuntu SMP Wed Jul UTC x x x GNULinux cat procversion Linux version generic builddlgw gcc version Ubuntu ubuntu Ubuntu SMP Wed Jul UTC nginx V nginx version nginx built with OpenSSL f Jan TLS SNI support enabled configure arguments withccoptg O fstackprotector paramsspbuffersize Wformat Werrorformatsecurity DFORTIFYSOURCE withldoptWlBsymbolicfunctions Wlzrelro Wlznow prefixusrsharenginx confpathetcnginxnginxconf httplogpathvarlognginxaccesslog errorlogpathvarlognginxerrorlog lockpathvarlocknginxlock pidpathrunnginxpid modulespathusrlibnginxmodules httpclientbodytemppathvarlibnginxbody httpfastcgitemppathvarlibnginxfastcgi httpproxytemppathvarlibnginxproxy httpscgitemppathvarlibnginxscgi httpuwsgitemppathvarlibnginxuwsgi withdebug withpcrejit withipv withhttpsslmodule withhttpstubstatusmodule withhttprealipmodule withhttpauthrequestmodule withhttpv module withhttpdavmodule withthreads withhttpadditionmodule withhttpflvmodule withhttpgeoipmodule withhttpgunzipmodule withhttpgzipstaticmodule withhttpimagefiltermodule withhttpmp module withhttprandomindexmodule withhttpsecurelinkmodule withhttpsubmodule withhttpxsltmodule withmail withmailsslmodule withstream withstreamsslmodule addmodulebuildnginxdebianmodulesheadersmorenginxmodule addmodulebuildnginxdebianmodulesnginxauthpam addmodulebuildnginxdebianmodulesnginxcachepurge addmodulebuildnginxdebianmodulesnginxdavextmodule addmodulebuildnginxdebianmodulesnginxdevelopmentkit addmodulebuildnginxdebianmodulesnginxecho addmodulebuildnginxdebianmodulesngxfancyindex addmodulebuildnginxdebianmodulesnchan addmodulebuildnginxdebianmodulesnginxlua addmodulebuildnginxdebianmodulesnginxuploadprogress addmodulebuildnginxdebianmodulesnginxupstreamfair addmodulebuildnginxdebianmodulesngxhttpsubstitutionsfiltermodule curl X GET H Accept textjson total published messages stored messages shared memory used K shared memory limit K channels subscribers redis pending commands redis connected servers total interprocess alerts received interprocess alerts in transit interprocess queued alerts total interprocess send delay total interprocess receive delay nchan version nginx error log ker process buildnginxdebianmodulesnchansrcstorespoolc spoolfetchmsg Assertion spoolmsgstatus MSGINVALID failed notice signal SIGCHLD received alert worker process exited on signal core dumped notice start worker process ker process buildnginxdebianmodulesnchansrcstorespoolc spoolfetchmsg Assertion spoolmsgstatus MSGINVALID failed notice signal SIGCHLD received alert worker process exited on signal core dumped notice start worker process gdb usrsbinnginx CoreDump GNU gdb Ubuntu ubuntu Copyright C Free Software Foundation Inc License GPLv GNU GPL version or later This is free software you are free to change and redistribute it There is NO WARRANTY to the extent permitted by law Type show copying and show warranty for details This GDB was configured as x linuxgnu Type show configuration for configuration details For bug reporting instructions please see Find the GDB manual and other documentation resources online at For help type help Type apropos word to search for commands related to word Reading symbols from usrsbinnginxno debugging symbols founddone New LWP Thread debugging using libthreaddb enabled Using host libthreaddb library libx linuxgnulibthreaddbso Core was generated by nginx worker process Program terminated with signal SIGABRT Aborted x f e e c in GIraise sigsigentry at nptlsysdepsunixsysvlinuxraisec nptlsysdepsunixsysvlinuxraisec No such file or directory gdb where x f e e c in GIraise sigsigentry at nptlsysdepsunixsysvlinuxraisec x f e e in GIabort at abortc x f e debf in assertfailbase fmt x f e sssu ssAssertion s failed nn assertionassertionentry x spoolmsgstatus MSGINVALID filefileentry x e buildnginxdebianmodulesnchansrcstorespoolc linelineentry functionfunctionentry x d spoolfetchmsg at assertc x f e deca in GIassertfail assertion x spoolmsgstatus MSGINVALID file x e buildnginxdebianmodulesnchansrcstorespoolc line function x d spoolfetchmsg at assertc x e d in x debf in x a in x ac in nchanmemstorehandlegetmessagereply x ae in x b f in x ad in x e in x ec in x d in x c in nchansubscribersubscribe x bf in nchansubscriberauthorizesubscriberequest x ef in nchanpubsubhandler x a f in ngxhttpcorecontentphase x bf in ngxhttpcorerunphases x e in ngxhttpprocessrequest x in x in x in ngxprocesseventsandtimers x de in x c in ngxspawnprocess x e c in x edff in ngxmasterprocesscycle x c f in main FYI this is the second dump of the two I still have this in corepattern usrshareapportapport p s c d P Im about to revert my version change for now let me know if you need anything else