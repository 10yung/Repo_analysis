Fix implicit conversion changes signedness and higher order bits are zeroes after implicit conversion issues Most probably due to upgrade to Catalina Not sure if this is based on my opam environment or not but these dependencies were not found and were breaking local compilation Fixes using example provided in comments from xhyve project Builds and local make test passes I am not an expert in this code so needs some review Issue was not fixed by the e d commit referenced in marking it closed I am seeing this error on the latest master c dd gen srclibdtraced cc srclibvmmintelvmcsc cc srclibvmmintelvmxc srclibvmmintelvmxc error implicit conversion changes signedness enum vmregname to int WerrorWsignconversion error vmxgetregvmx vcpuid reg val srclibvmmintelvmxc error implicit conversion changes signedness enum vmregname to int WerrorWsignconversion error vmxgetdescvmx vcpuid vissegname vissegdesc errors generated make buildlibvmmintelvmxo Error swvers ProductName Mac OS X ProductVersion BuildVersion G xcodebuild version Xcode Build version A a cc version Apple clang version clang Target x appledarwin Thread model posix InstalledDir ApplicationsXcodeappContentsDeveloperToolchainsXcodeDefaultxctoolchainusrbin On macOS Catalina and later applications need to be Notarized where notarization is an Apple malware and securitycheck of the released binaries As part of the notarization process Apple require that hardened runtime is enabled This prevents code injection into running processes attaching debuggers allocating writable executable memory Currently hyperkit uses valloc to allocate memory for the VM and then grants the VM READ WRITE and EXECUTE which will fail if the hardened runtime is enabled One workaround is to grant the hyperkit binary the Allow Unsigned Executable Memory Entitlement which disables the writableexecutable check for all allocations done by the process This patch proposes another workaround which is to switch from using valloc to mmap with the special flag MAPJIT This allows us to use the weaker Allow Execution of JITcompiled Code entitlement so that only the VM memory allocation is writableexecutable other allocations are not Note that according to the mono project the MAPJIT flag causes problems with older version of macOS so they recommend only enabling it for Mojave and later Note that enabling the hardened runtime and adding entitlements is done at the codesign stage which means we cant easily test this from the current CI as the binaries are unsigned When running the opam install uri qcow conduit lwt qcowtool mirageblockunix conflibev logs fmt mirageunix prometheusapp I received the following error that my OCaml was to new So I had to do opam switch create ocamlbasecompiler and reran the code how to uninstall hyperkit capture higt cup percentage thanks This is the crash stack from the docker logs localhost comdockerhyperkit Speculative Store Bypass Vulnerable localhost comdockerhyperkit Freeing SMP alternatives memory K localhost comdockerhyperkit ftrace allocating entries in pages localhost comdockerhyperkit smpboot Max logical packages localhost comdockerhyperkit TIMER vector x apic pin apic pin localhost comdockerhyperkit MPBIOS bug timer not connected to IOAPIC localhost comdockerhyperkit trying to set up timer IRQ through the A localhost comdockerhyperkit found apic pin localhost comdockerhyperkit failed localhost comdockerhyperkit trying to set up timer as Virtual Wire IRQ localhost comdockerhyperkit failed localhost comdockerhyperkit trying to set up timer as ExtINT IRQ localhost comdockerhyperkit failed localhost comdockerhyperkit Kernel panic not syncing IOAPIC timer doesnt work Boot with apicdebug and send a report Then try booting with the noapic option localhost comdockerhyperkit localhost comdockerhyperkit CPU PID Comm swapper Not tainted linuxkit localhost comdockerhyperkit Hardware name BHYVE BIOS localhost comdockerhyperkit ffffffffaf ffffbab e localhost comdockerhyperkit ffffffffaf fbf ffffbab e ffffbab dd localhost comdockerhyperkit ca f cd c b ffffbab e localhost comdockerhyperkit Call Trace localhost comdockerhyperkit ffffffffaf dumpstack x a x f localhost comdockerhyperkit ffffffffaf fbf panic xe x localhost comdockerhyperkit ffffffffafd fb setupIOAPIC x x d localhost comdockerhyperkit ffffffffaf ad clearIOAPICpin x x localhost comdockerhyperkit ffffffffafd e c apicbspsetup x a x localhost comdockerhyperkit ffffffffafd c d nativesmppreparecpus x a x ef localhost comdockerhyperkit ffffffffafd fd kernelinitfreeable xa x ea localhost comdockerhyperkit ffffffffafd fd kernelinitfreeable xa x ea localhost comdockerhyperkit ffffffffaf dd b restinit x e x e localhost comdockerhyperkit ffffffffaf dd c kernelinit xa xe localhost comdockerhyperkit ffffffffaf e retfromfork x x localhost comdockerhyperkit Rebooting in seconds I am following instructions here and get this error bash opam install uri qcow conduit lwt qcowtool mirageblockunix conflibev logs fmt mirageunix prometheusapp The following dependencies couldnt be met qcowtool qcow qcowtool sha ocaml base of this switch use unlockbase to force Your request cant be satisfied No available version of qcow satisfies the constraints No solution found exiting If hyperkit is launched with the A flag and no PCI devices it crashes In the code below taken from srclibpciemulc bi gets dereferenced even though its NULL static void pcibuswritedsdtint bus struct businfo bi If there are no devices on this bus then just return if bi pcibusinfo bus NULL Bus is special because it decodes the IO ports used for PCI config space access even if there are no devices on it if bus return dsdtfixupbus biiobase biiolimit bimembase bimemlimit bimembase bimemlimit void pcipirqprtentry void pciapicprtentry 