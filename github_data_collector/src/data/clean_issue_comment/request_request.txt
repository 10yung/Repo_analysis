 PR Checklist x I have run npm test locally and all tests are passing x I have addedupdated tests for any new behavior PR Description Node s End of Life is December So it should be safe to drop Node support Changes Module Use the WHATWG URL API instead of the Legacy API The Legacy URL API is deprecated since Node Rewrite the codebase using ES syntax Dependencies Update uuid to v Update toughcookie to v Update safebuffer to v Update qs to v Update combinedstream to v Update formdata to v Update httpsignature to v Update mimetypes to v devDependencies Update bluebird to v Update tape to v Update rimraf to v Update standard to v Remove phantomjsprebuilt Remove karmaphantomjslauncher Add karmachromelauncher Update karma to v Update browserify to v Update browserifyistanbul to v Update codecov to v Update coveralls to v Remove functionbind Update karmabrowserify to v Update karmacli to v Update karmacoverage to v Update karmatap to v Update nyc to v Add puppeteer Test Tests were rewritten using ES syntax Use strictEqual instead of equal Use ChromeHeadless instead of PhantomJS is unmaintained Other Changes Run npm lint Do not use Objectprototypes builtins directly Update TravisCI config PR Checklist x I have run npm test locally and all tests are passing x I have addedupdated tests for any new behavior Request is a complex project there are VERY FEW exceptions where a new test is not required for new behavior If this is a significant change an issue has already been created where the problem solution was discussed NA or add link to issue here If youd like to suggest a significant change to request please create an issue to discuss those changes and gather feedback BEFORE submitting your PR PR Description Describe Your PR Here Summary I have a special timeout issue can someone help me check it Simplest Example to Reproduce js request method GET url headers ContentType applicationjson json true timeout functionerr response body if err return rejectnew Errorurl url method method error errmessage Expected Behavior Here I set a wrong request address The expected result is that a timeout exception is thrown after seconds The protocol header should be http instead of https Current Behavior code Internal message caused by Error url methodGET error ESOCKETTIMEDOUT This request took at least seconds which means that it takes at least seconds for me to get exception information Possible Solution I dont know how to solve this issue Can somebody help me to check Your Environment Include as many relevant details about the environment you experienced the bug in software version request node v npm Operating System Ubuntu Summary When combining strictSSL and forever configs the forever flag is not always honored This is due to the fact that the forever flag is not used lookup the appropriate httpsAgent to use for each request Simplest Example to Reproduce js use strict const http requirehttp const request requirerequest const server httpcreateServerreq res resend serverlisten request strictSSL false err response consolelog Connection is expected to close responseheadersconnection request strictSSL false forever true err response consolelog Connection is expected to keep alive responseheadersconnection request strictSSL false err response consolelog Connection is expected to close responseheadersconnection serverclose Expected Behavior Connection is expected to close close Connection is expected to keep alive keepalive Connection is expected to close close Current Behavior Connection is expected to close close Connection is expected to keep alive close Connection is expected to close close Possible Solution The poolKey should also contain the keepAlive flag value Context This issue was found in Request is used in multiple places in jsdom If the first request config doesnt the forever flag to true for all the subsequent requests the connection will be closed even if the forever flag is set The current workaround is to pass a pass new agent pool to force request to create new httpsAgent when we want to ensure that the forever flag is honored Your Environment software version request node npm Operating System OSX Summary The actual version of the request object converts the response body by the request content type Simplest Example to Reproduce if the request header contenttype applicationxwwwformurlencoded or form body is used the response will not converted into json even the response contenttype applicationjson Expected Behavior The response body should be automatically converted into json format Possible Solution Please change the requestjs RequestprototypereadResponseBody The condition if selfjson to something like if application jsontestresponseheaders contenttype thank you when using with pbjs original value of selfencoding is undefinedwe wish to keep responsebody Buffer style PR Checklist I have run npm test locally and all tests are passing I have addedupdated tests for any new behavior Request is a complex project there are VERY FEW exceptions where a new test is not required for new behavior If this is a significant change an issue has already been created where the problem solution was discussed NA or add link to issue here If youd like to suggest a significant change to request please create an issue to discuss those changes and gather feedback BEFORE submitting your PR PR Description when using with pbjs original value of selfencoding is undefinedwe wish to keep responsebody Buffer style Summary Im trying to set cookies which i get from another request with getCookies but every time i try to set cookies with setCookies im getting TypeError strtrim is not a function RequestPromiseToughCookie Simplest Example to Reproduce So this is a request where i have to set cookies which i get from recent request and variable looks like this domaindomaincompathsecuretrueexpires T Zkeykey valueval httpOnlyfalsehostOnlytruedomaindomaincompathsecuretrueexpires T Zkeykey valueval httpOnlyfalsehostOnlytrue And this is the reuqest where im getting error var request requirerequest var jar requestjar jarsetCookiecookies domaincom request uri method GET headers Accept applicationjson textjavascript q AcceptEncoding gzip deflate br AcceptLanguage bgenUSq enq trq ContentType applicationjson Referer SecFetchMode cors SecFetchSite sameorigin UserAgent Mozilla Windows NT Win x AppleWebKit KHTML like Gecko Chrome Safari XRequestedWith XMLHttpRequest timeout followRedirect true maxRedirects jarjar gzip true functionerror response body consolelogError error consolelogResponse response consolelogBody body Expected Behavior I would be thankful if someone can help with this Tried with toString but getting cookie like creation T Z hostOnly true lastAccessed T Z path pathIsDefault true value object Object object Object object Object object Object object Object object Object object Object object Object object Object object Object object Object object Object object Object Summary error in sending requests Simplest Example to Reproduce js request get UserAgentMozilla Macintosh Intel Mac OS X rv Gecko Firefox AcceptLanguagezhCNzhq zhTWq zhHKq enUSq enq onresponse functionresponse consolelogresponsestatusCode consolelogresponseheaders contenttype imagepng Expected Behavior no Current Behavior no Possible Solution no idea Context when i visited the site I would get statusCode in return But i changed the coding language into python i found its ok import requests r requestsget printrtext usrlocalbinpython Usersxxxxxlibmodulestestpy identifierciscosa asaftdluarcetitleCisco Adaptive Security Appliance Software and Firepower Threat Defense Software Remote Code Execution Vulnerabilityversion firstPublished T lastPublished Your Environment node v mac OS this library is really nice but when I use post to submit some data it response nothing I m tried many way to request Im trying to use Node to make a simulated login The next request requires the cookie returned by the previous request I dont understand the usage of cookieJar I wonder if I can automatically save and pass cookies like the Python Request Library Looking forward to your reply The method requestget with agentOptions SSLv method returns the error described bellow Configuration NPM NODE v dependencies fs security https openssl request Error codeEPROTO errno messagewrite EPROTO error SSL routinesssl readbytessslv alert handshake failurec ws deps openssl openssl ssl record reclayers c SSL alert number n stackError write EPROTO error SSL routinesssl readbytessslv alert handshake failurec ws deps openssl openssl ssl record reclayers c SSL alert number n n at WriteWraponWriteComplete as oncomplete internalstreambasecommonsjs syscallwrite The source code const https requirehttps const request requirerequest const fs requirefs const port const options key fsreadFileSynckeypem cert fsreadFileSynccertpem httpscreateServeroptions function req res var options url agentOptions securityOptions SSLv method requestgetoptions functionerror response body consolelogerror error consolelogstatusCode response responsestatusCode consolelogbody body resendtest test listenport 