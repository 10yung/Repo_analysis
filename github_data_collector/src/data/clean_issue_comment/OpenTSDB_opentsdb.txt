Remove excess param in javadoc for RpcHandlerRpcHandlerfinal TSDB tsdb Effective from January the central maven repository doesnt support insecure communication over plain HTTP set dummy thirdpartykryoasm jar shift buildauxfetchdepsh Resolving centralmavenorg Connecting to centralmavenorg connected HTTP request sent awaiting response HTTPS Required ERROR HTTPS Required make Makefile thirdpartykryoasm jar Error I have inserted some data before where metric mhlsensorrealvalue tags are similar to tags sensorID sensorID identifies different devices but an exception occurred when querying the data of sensorDI the exception information is as follows javalangRuntimeException Unexpected exception javalangRuntimeException Unexpected exception javalangRuntimeException Unexpected exception at netopentsdbcoreTSQuerybuildQueriesTSQueryjava tsdb jar at netopentsdbtsdGraphHandlerdoGraphGraphHandlerjava tsdb jar at netopentsdbtsdGraphHandlerexecuteGraphHandlerjava tsdb jar at netopentsdbtsdRpcHandlerhandleHttpQueryRpcHandlerjava tsdb jar at netopentsdbtsdRpcHandlermessageReceivedRpcHandlerjava tsdb jar at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettyhandlertimeoutIdleStateAwareChannelUpstreamHandlerhandleUpstreamIdleStateAwareChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettyhandlertimeoutIdleStateHandlermessageReceivedIdleStateHandlerjava netty Finaljarna at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettyhandlercodechttpHttpContentEncodermessageReceivedHttpContentEncoderjava netty Finaljarna at orgjbossnettychannelSimpleChannelHandlerhandleUpstreamSimpleChannelHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettyhandlercodechttpHttpContentDecodermessageReceivedHttpContentDecoderjava netty Finaljarna at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettyhandlercodechttpHttpChunkAggregatormessageReceivedHttpChunkAggregatorjava netty Finaljarna at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelChannelsfireMessageReceivedChannelsjava netty Finaljarna at orgjbossnettyhandlercodecframeFrameDecoderunfoldAndFireMessageReceivedFrameDecoderjava netty Finaljarna at orgjbossnettyhandlercodecreplayReplayingDecodercallDecodeReplayingDecoderjava netty Finaljarna at orgjbossnettyhandlercodecreplayReplayingDecodermessageReceivedReplayingDecoderjava netty Finaljarna at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelSimpleChannelHandlermessageReceivedSimpleChannelHandlerjava netty Finaljarna at orgjbossnettychannelSimpleChannelHandlerhandleUpstreamSimpleChannelHandlerjava netty Finaljarna at netopentsdbtsdConnectionManagerhandleUpstreamConnectionManagerjava tsdb jar at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelChannelsfireMessageReceivedChannelsjava netty Finaljarna at orgjbossnettychannelChannelsfireMessageReceivedChannelsjava netty Finaljarna at orgjbossnettychannelsocketnioNioWorkerreadNioWorkerjava netty Finaljarna at orgjbossnettychannelsocketnioAbstractNioWorkerprocessAbstractNioWorkerjava netty Finaljarna at orgjbossnettychannelsocketnioAbstractNioSelectorrunAbstractNioSelectorjava netty Finaljarna at orgjbossnettychannelsocketnioAbstractNioWorkerrunAbstractNioWorkerjava netty Finaljarna at orgjbossnettychannelsocketnioNioWorkerrunNioWorkerjava netty Finaljarna at orgjbossnettyutilThreadRenamingRunnablerunThreadRenamingRunnablejava netty Finaljarna at orgjbossnettyutilinternalDeadLockProofWorker runDeadLockProofWorkerjava netty Finaljarna at javautilconcurrentThreadPoolExecutorrunWorkerThreadPoolExecutorjava na at javautilconcurrentThreadPoolExecutorWorkerrunThreadPoolExecutorjava na at javalangThreadrunThreadjava na Caused by comstumbleuponasyncDeferredGroupException At least one of the Deferreds failed first exception at comstumbleuponasyncDeferredGroupdoneDeferredGroupjava async jarna at comstumbleuponasyncDeferredGrouprecordCompletionDeferredGroupjava async jarna at comstumbleuponasyncDeferredGroupaccess DeferredGroupjava async jarna at comstumbleuponasyncDeferredGroup NotifycallDeferredGroupjava async jarna at comstumbleuponasyncDeferreddoCallDeferredjava async jarna at comstumbleuponasyncDeferredrunCallbacksDeferredjava async jarna at comstumbleuponasyncDeferredaccess Deferredjava async jarna at comstumbleuponasyncDeferredContinuecallDeferredjava async jarna at comstumbleuponasyncDeferreddoCallDeferredjava async jarna at comstumbleuponasyncDeferredrunCallbacksDeferredjava async jarna at comstumbleuponasyncDeferredcallbackDeferredjava async jarna at comstumbleuponasyncDeferredGroupdoneDeferredGroupjava async jarna at comstumbleuponasyncDeferredGrouprecordCompletionDeferredGroupjava async jarna at comstumbleuponasyncDeferredGroupaccess DeferredGroupjava async jarna at comstumbleuponasyncDeferredGroup NotifycallDeferredGroupjava async jarna at comstumbleuponasyncDeferreddoCallDeferredjava async jarna at comstumbleuponasyncDeferredrunCallbacksDeferredjava async jarna at comstumbleuponasyncDeferredcallbackDeferredjava async jarna at comstumbleuponasyncDeferredGroupdoneDeferredGroupjava async jarna at comstumbleuponasyncDeferredGrouprecordCompletionDeferredGroupjava async jarna at comstumbleuponasyncDeferredGroupaccess DeferredGroupjava async jarna at comstumbleuponasyncDeferredGroup NotifycallDeferredGroupjava async jarna at comstumbleuponasyncDeferreddoCallDeferredjava async jarna at comstumbleuponasyncDeferredrunCallbacksDeferredjava async jarna at comstumbleuponasyncDeferredcallbackDeferredjava async jarna at orghbaseasyncHBaseRpccallbackHBaseRpcjava asynchbase jarna at orghbaseasyncRegionClientdecodeRegionClientjava asynchbase jarna at orghbaseasyncRegionClientdecodeRegionClientjava asynchbase jarna at orgjbossnettyhandlercodecreplayReplayingDecodercallDecodeReplayingDecoderjava netty Finaljarna at orgjbossnettyhandlercodecreplayReplayingDecodermessageReceivedReplayingDecoderjava netty Finaljarna at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orghbaseasyncRegionClienthandleUpstreamRegionClientjava asynchbase jarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelSimpleChannelHandlermessageReceivedSimpleChannelHandlerjava netty Finaljarna at orgjbossnettychannelSimpleChannelHandlerhandleUpstreamSimpleChannelHandlerjava netty Finaljarna at orgjbossnettyhandlertimeoutIdleStateAwareChannelHandlerhandleUpstreamIdleStateAwareChannelHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettyhandlertimeoutIdleStateHandlermessageReceivedIdleStateHandlerjava netty Finaljarna at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orghbaseasyncHBaseClientRegionClientPipelinesendUpstreamHBaseClientjava asynchbase jarna common frames omitted Caused by comstumbleuponasyncDeferredGroupException At least one of the Deferreds failed first exception common frames omitted Caused by comstumbleuponasyncDeferredGroupException At least one of the Deferreds failed first exception common frames omitted Caused by netopentsdbuidNoSuchUniqueName No such name for tagv at netopentsdbuidUniqueId GetIdCBcallUniqueIdjava tsdb jar at netopentsdbuidUniqueId GetIdCBcallUniqueIdjava tsdb jar common frames omitted This patch reworks how FuzzyFilters are used in the case of ExplicitTags queries Use a list of FuzzyFilters on tag key and value instead of a single FuzzyFilter over tag keys No more need for a Rowkey Regex filter All filtering done by FuzzyFilters scanner startstop keys It brings noticeable performance improvement when filtering on tag value for metrics with high cardinality eg a query for metric for a single host with host tag cardinality of which took s is down to ms The list of fuzzy filters is constructed by a new method QueryUtilbuildFuzzyFiltersrowkeyliterals It is used for filtering all combinations of tags provided by the caller So for tags cluster service and vm with filtering values clusterdevqatest servicemysvc and vmwebdb a list of x x FuzzyFilters covering all combinations will be returned A few remarks New private version of QueryUtilgetRowKeyUIDRegexrowkeyliterals explicittags simplified variant stripped of everything related to FuzzyFilters QueryUtilgetRowKeyUIDRegexgroupbys rowkeyliterals and QueryUtilgetRowKeyUIDRegexgroupbys rowkeyliterals explicittags fuzzykey fuzzymask are left unchanged as these are public API but not used anymore Resolves The reason for updating the unit tests is that they previously passed with what I believe to be incorrect results In certain circumstances we see avg aggregation constantly shows exponential rise from the past to the present time Heres a graph thats trying to show xx responses per second per instance It looks like were in a crisis The number is rapidly climbing But this graph always looks like this Whats gone wrong This happens when a certain set of criteria hold Were using a rate calculation Were downsampling using the none fill option Over the period were looking at tag combinations come and go again eg were tagging by instance IP address and over time new IP addresses appear in and old ones disappear Our aggregation function is avg or count Heres what happens with count instead of avg This also looks fishy We start with time series days ago and fall to time series just now Heres the raw time series without the rate calculation or the aggregation across hosts This is a lot to take in Weve taken off the rate calculation and removed the aggregation across hosts so we can see each separately Thats our separate time series each counting up separately Over the course of a week each only exists for a little while before vanishing although some come back again later as the host is reused Heres one more graph Weve gone back to count our series again but this time without the rate calculation This looks much more like we expect at any given time we have somewhere between and active time series Over time this number doesnt change wildly because as we add new instances we remove old instances So what is happening when we add the rate calculation I think its the following When were trying to aggregate together series before some of them have started we try to fill in the missing series With none for downsampling each time series feeding into the aggregation has its own start and end time In AggregationIterator the current timestamp on each series is used to determine if it is currently active before weve reached the first point and after weve passed the last one it gets set to and it gets skipped over in hasNextValue whenever the timestamp is However when rate is enabled AggregationIterator deliberately skips over the first value in each time series during initialisation In so doing I believe it causes the timestamp to become nonzero and thus all time series in the aggregation begin contributing from the start potentially long before we have actually advanced to their start time This is why the average is so low in the past and climbs towards the present Its getting biased towards zero by hundreds of inactive time series What do you think does this look like a bug I wonder if AggregationIterator should reset the timestamp back to zero after removing the first spurious value from each time series interleaving big and small queries to minimize starvation When calling the query expression api without providing filters and expressions a null pointer exception is thrown from within Queryvalidate The null pointer arises from the following code as filters and expressions are not checked to not be null before iterating over them Nonworking example json time start mago aggregator sum end now downsampler interval m aggregator avg metrics id somemetric metric somemetric aggregator sum Working example json time start mago aggregator sum end now downsampler interval m aggregator avg filters metrics id somemetric metric somemetric aggregator sum expressions Error message json error code message An internal null pointer exception was thrown trace Versions OpenTSDB maprv OpenTSDB often hits javautilConcurrentModificationException when processing apistatsquery requests Eg OpenTSDB Old IO server boss id xb b b e INFO ConnectionManagerhandleUpstream id x b f OPEN OpenTSDB Old IO server boss id xb b b e INFO ConnectionManagerhandleUpstream id x b f BOUND OpenTSDB Old IO server worker parentId id xb b b e INFO ConnectionManagerhandleUpstream id x b f CONNECTED OpenTSDB Old IO server worker parentId id xb b b e ERROR HttpQuerylogError id x d Internal Server Error on apistatsquery netopentsdbutilsJSONException comfasterxmljacksondatabindJsonMappingException was javautilConcurrentModificationException through reference chain javautilTreeMap completed comgooglecommoncacheLocalCacheValues netopentsdbstatsQueryStats stats at netopentsdbutilsJSONserializeToBytesJSONjava tsdb jar f a at netopentsdbtsdHttpJsonSerializerserializeJSONHttpJsonSerializerjava tsdb jar f a at netopentsdbtsdHttpJsonSerializerformatQueryStatsV HttpJsonSerializerjava tsdb jar f a at netopentsdbtsdStatsRpcprintQueryStatsStatsRpcjava tsdb jar f a at netopentsdbtsdStatsRpcexecuteStatsRpcjava tsdb jar f a at netopentsdbtsdRpcHandlerhandleHttpQueryRpcHandlerjava tsdb jar f a at netopentsdbtsdRpcHandlermessageReceivedRpcHandlerjava tsdb jar f a at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettyhandlertimeoutIdleStateAwareChannelUpstreamHandlerhandleUpstreamIdleStateAwareChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettyhandlertimeoutIdleStateHandlermessageReceivedIdleStateHandlerjava netty Finaljarna at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettyhandlercodechttpHttpContentEncodermessageReceivedHttpContentEncoderjava netty Finaljarna at orgjbossnettychannelSimpleChannelHandlerhandleUpstreamSimpleChannelHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettyhandlercodechttpHttpContentDecodermessageReceivedHttpContentDecoderjava netty Finaljarna at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettyhandlercodechttpHttpChunkAggregatormessageReceivedHttpChunkAggregatorjava netty Finaljarna at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelChannelsfireMessageReceivedChannelsjava netty Finaljarna at orgjbossnettyhandlercodecframeFrameDecoderunfoldAndFireMessageReceivedFrameDecoderjava netty Finaljarna at orgjbossnettyhandlercodecreplayReplayingDecodercallDecodeReplayingDecoderjava netty Finaljarna at orgjbossnettyhandlercodecreplayReplayingDecodermessageReceivedReplayingDecoderjava netty Finaljarna at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelChannelsfireMessageReceivedChannelsjava netty Finaljarna at orgjbossnettyhandlercodecframeFrameDecoderunfoldAndFireMessageReceivedFrameDecoderjava netty Finaljarna at orgjbossnettyhandlercodecframeFrameDecodercallDecodeFrameDecoderjava netty Finaljarna at orgjbossnettyhandlercodecframeFrameDecodermessageReceivedFrameDecoderjava netty Finaljarna at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelSimpleChannelHandlermessageReceivedSimpleChannelHandlerjava netty Finaljarna at orgjbossnettychannelSimpleChannelHandlerhandleUpstreamSimpleChannelHandlerjava netty Finaljarna at netopentsdbtsdConnectionManagerhandleUpstreamConnectionManagerjava tsdb jar f a at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelChannelsfireMessageReceivedChannelsjava netty Finaljarna at orgjbossnettychannelChannelsfireMessageReceivedChannelsjava netty Finaljarna at orgjbossnettychannelsocketoioOioWorkerprocessOioWorkerjava netty Finaljarna at orgjbossnettychannelsocketoioAbstractOioWorkerrunAbstractOioWorkerjava netty Finaljarna at orgjbossnettychannelsocketoioOioWorkerrunOioWorkerjava netty Finaljarna at orgjbossnettyutilThreadRenamingRunnablerunThreadRenamingRunnablejava netty Finaljarna at orgjbossnettyutilinternalDeadLockProofWorker runDeadLockProofWorkerjava netty Finaljarna at javautilconcurrentThreadPoolExecutorrunWorkerThreadPoolExecutorjava na at javautilconcurrentThreadPoolExecutorWorkerrunThreadPoolExecutorjava na at javalangThreadrunThreadjava na Caused by comfasterxmljacksondatabindJsonMappingException was javautilConcurrentModificationException through reference chain javautilTreeMap completed comgooglecommoncacheLocalCacheValues netopentsdbstatsQueryStats stats at comfasterxmljacksondatabindJsonMappingExceptionwrapWithPathJsonMappingExceptionjava jacksondatabind jar at comfasterxmljacksondatabindJsonMappingExceptionwrapWithPathJsonMappingExceptionjava jacksondatabind jar at comfasterxmljacksondatabindserstdStdSerializerwrapAndThrowStdSerializerjava jacksondatabind jar at comfasterxmljacksondatabindserstdBeanSerializerBaseserializeFieldsBeanSerializerBasejava jacksondatabind jar at comfasterxmljacksondatabindserBeanSerializerserializeBeanSerializerjava jacksondatabind jar at comfasterxmljacksondatabindserstdCollectionSerializerserializeContentsCollectionSerializerjava jacksondatabind jar at comfasterxmljacksondatabindserstdCollectionSerializerserializeCollectionSerializerjava jacksondatabind jar at comfasterxmljacksondatabindserstdCollectionSerializerserializeCollectionSerializerjava jacksondatabind jar at comfasterxmljacksondatabindserstdMapSerializerserializeFieldsMapSerializerjava jacksondatabind jar at comfasterxmljacksondatabindserstdMapSerializerserializeMapSerializerjava jacksondatabind jar at comfasterxmljacksondatabindserstdMapSerializerserializeMapSerializerjava jacksondatabind jar at comfasterxmljacksondatabindserDefaultSerializerProviderserializeDefaultSerializerProviderjava jacksondatabind jar at comfasterxmljacksondatabindserDefaultSerializerProviderserializeValueDefaultSerializerProviderjava jacksondatabind jar at comfasterxmljacksondatabindObjectMapperconfigAndWriteValueObjectMapperjava jacksondatabind jar at comfasterxmljacksondatabindObjectMapperwriteValueAsBytesObjectMapperjava jacksondatabind jar at netopentsdbutilsJSONserializeToBytesJSONjava tsdb jar f a common frames omitted Caused by javautilConcurrentModificationException null at javautilHashMapHashIteratornextNodeHashMapjava na at javautilHashMapEntryIteratornextHashMapjava na at javautilHashMapEntryIteratornextHashMapjava na at netopentsdbstatsQueryStatsgetStatsQueryStatsjava tsdb jar f a at netopentsdbstatsQueryStatsgetStatsQueryStatsjava tsdb jar f a at sunreflectGeneratedMethodAccessor invokeUnknown Source nana at sunreflectDelegatingMethodAccessorImplinvokeDelegatingMethodAccessorImpljava na at javalangreflectMethodinvokeMethodjava na at comfasterxmljacksondatabindserBeanPropertyWriterserializeAsFieldBeanPropertyWriterjava jacksondatabind jar at comfasterxmljacksondatabindserstdBeanSerializerBaseserializeFieldsBeanSerializerBasejava jacksondatabind jar common frames omitted OpenTSDB Old IO server worker parentId id xb b b e INFO ConnectionManagerhandleUpstream id x d DISCONNECTED OpenTSDB Old IO server worker parentId id xb b b e INFO ConnectionManagerhandleUpstream id x d UNBOUND OpenTSDB Old IO server worker parentId id xb b b e INFO ConnectionManagerhandleUpstream id x d CLOSED This has been happening for a long time but I havent gotten around to reporting it until now It seems to be not a big deal apart from the log noise This is with OpenTSDB When I query some rolluped data opentsdb return BadRequestException I do not how to solve the problem insert data metric timestamp value tags deviceId interval h aggregator sum groupByAggregator SUM return success success failed errors but when query rolluped data start end showTSUIDstrue queries metric aggregator sum tags deviceId downsample hsum groupByAggregator SUM interval h rollupUsageROLLUPNOFALLBACK preAggregatetrue return BadRequestException error code message The offset for KeyValuekey family t qualifier x x value timestamp of is the last offset for RollupSeqkey basetime basetimeMon Nov CST datapoints counts n qualifier n values n countqualifier null n countvalues null details The offset for KeyValuekey family t qualifier x x value timestamp of is the last offset for RollupSeqkey basetime basetimeMon Nov CST datapoints counts n qualifier n values n countqualifier null n countvalues null trace netopentsdbtsdBadRequestException The offset for KeyValuekey family t qualifier x x value timestamp of is the last offset for RollupSeqkey basetime basetimeMon Nov CST datapoints counts n qualifier n values n countqualifier null n countvalues null n tat netopentsdbtsdQueryRpc ErrorCBcallQueryRpcjava tsdb jar n tat netopentsdbtsdQueryRpc ErrorCBcallQueryRpcjava tsdb jar n tat comstumbleuponasyncDeferreddoCallDeferredjava async jarna n tat comstumbleuponasyncDeferredrunCallbacksDeferredjava async jarna n tat comstumbleuponasyncDeferredaccess Deferredjava async jarna n tat comstumbleuponasyncDeferredContinuecallDeferredjava async jarna n tat comstumbleuponasyncDeferreddoCallDeferredjava async jarna n tat comstumbleuponasyncDeferredrunCallbacksDeferredjava async jarna n tat comstumbleuponasyncDeferredcallbackDeferredjava async jarna n tat comstumbleuponasyncDeferredGroupdoneDeferredGroupjava async jarna n tat comstumbleuponasyncDeferredGrouprecordCompletionDeferredGroupjava async jarna n tat comstumbleuponasyncDeferredGroupaccess DeferredGroupjava async jarna n tat comstumbleuponasyncDeferredGroup NotifyOrderedcallDeferredGroupjava async jarna n tat comstumbleuponasyncDeferreddoCallDeferredjava async jarna n tat comstumbleuponasyncDeferredrunCallbacksDeferredjava async jarna n tat comstumbleuponasyncDeferredcallbackDeferredjava async jarna n tat netopentsdbcoreSaltScannervalidateAndTriggerCallbackSaltScannerjava tsdb jar n tat netopentsdbcoreSaltScanneraccess SaltScannerjava tsdb jar n tat netopentsdbcoreSaltScannerScannerCBcloseSaltScannerjava tsdb jar n tat netopentsdbcoreSaltScannerScannerCBcallSaltScannerjava tsdb jar n tat netopentsdbcoreSaltScannerScannerCBcallSaltScannerjava tsdb jar n tat comstumbleuponasyncDeferreddoCallDeferredjava async jarna n tat comstumbleuponasyncDeferredaddCallbacksDeferredjava async jarna n tat comstumbleuponasyncDeferredaddCallbackDeferredjava async jarna n tat netopentsdbcoreSaltScannerScannerCBscanSaltScannerjava tsdb jar n tat netopentsdbcoreSaltScannerScannerCBcallSaltScannerjava tsdb jar n tat netopentsdbcoreSaltScannerScannerCBcallSaltScannerjava tsdb jar n tat comstumbleuponasyncDeferreddoCallDeferredjava async jarna n tat comstumbleuponasyncDeferredrunCallbacksDeferredjava async jarna n tat comstumbleuponasyncDeferredhandleContinuationDeferredjava async jarna n tat comstumbleuponasyncDeferreddoCallDeferredjava async jarna n tat comstumbleuponasyncDeferredrunCallbacksDeferredjava async jarna n tat comstumbleuponasyncDeferredcallbackDeferredjava async jarna n tat orghbaseasyncHBaseRpccallbackHBaseRpcjava asynchbase jarna n tat orghbaseasyncRegionClientdecodeRegionClientjava asynchbase jarna n tat orghbaseasyncRegionClientdecodeRegionClientjava asynchbase jarna n tat orgjbossnettyhandlercodecreplayReplayingDecodercallDecodeReplayingDecoderjava netty Finaljarna n tat orgjbossnettyhandlercodecreplayReplayingDecodermessageReceivedReplayingDecoderjava netty Finaljarna n tat orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna n tat orghbaseasyncRegionClienthandleUpstreamRegionClientjava asynchbase jarna n tat orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna n tat orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna n tat orgjbossnettychannelSimpleChannelHandlermessageReceivedSimpleChannelHandlerjava netty Finaljarna n tat orgjbossnettychannelSimpleChannelHandlerhandleUpstreamSimpleChannelHandlerjava netty Finaljarna n tat orgjbossnettyhandlertimeoutIdleStateAwareChannelHandlerhandleUpstreamIdleStateAwareChannelHandlerjava netty Finaljarna n tat orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna n tat orgjbossnettychannelDefaultChannelPipelineDefaultChannelHandlerContextsendUpstreamDefaultChannelPipelinejava netty Finaljarna n tat orgjbossnettyhandlertimeoutIdleStateHandlermessageReceivedIdleStateHandlerjava netty Finaljarna n tat orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna n tat orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna n tat orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna n tat orghbaseasyncHBaseClientRegionClientPipelinesendUpstreamHBaseClientjava asynchbase jarna n tat orgjbossnettychannelChannelsfireMessageReceivedChannelsjava netty Finaljarna n tat orgjbossnettychannelChannelsfireMessageReceivedChannelsjava netty Finaljarna n tat orgjbossnettychannelsocketnioNioWorkerreadNioWorkerjava netty Finaljarna n tat orgjbossnettychannelsocketnioAbstractNioWorkerprocessAbstractNioWorkerjava netty Finaljarna n tat orgjbossnettychannelsocketnioAbstractNioSelectorrunAbstractNioSelectorjava netty Finaljarna n tat orgjbossnettychannelsocketnioAbstractNioWorkerrunAbstractNioWorkerjava netty Finaljarna n tat orgjbossnettychannelsocketnioNioWorkerrunNioWorkerjava netty Finaljarna n tat orgjbossnettyutilThreadRenamingRunnablerunThreadRenamingRunnablejava netty Finaljarna n tat orgjbossnettyutilinternalDeadLockProofWorker runDeadLockProofWorkerjava netty Finaljarna n tat javautilconcurrentThreadPoolExecutorrunWorkerThreadPoolExecutorjava na n tat javautilconcurrentThreadPoolExecutorWorkerrunThreadPoolExecutorjava na n tat javalangThreadrunThreadjava na nCaused by netopentsdbcoreIllegalDataException The offset for KeyValuekey family t qualifier x x value timestamp of is the last offset for RollupSeqkey basetime basetimeMon Nov CST datapoints counts n qualifier n values n countqualifier null n countvalues null n tat netopentsdbrollupRollupSeqappendRollupSeqjava tsdb jar n tat netopentsdbrollupRollupSeqaddRowRollupSeqjava tsdb jar n tat netopentsdbrollupRollupSpanaddRowRollupSpanjava tsdb jar n tat netopentsdbcoreSaltScannermergeDataPointsSaltScannerjava tsdb jar n tat netopentsdbcoreSaltScannermergeAndReturnResultsSaltScannerjava tsdb jar n tat netopentsdbcoreSaltScannervalidateAndTriggerCallbackSaltScannerjava tsdb jar n t common frames omitted n the opentsdb log print ERROR AsyncHBase IO Worker SaltScanner Exception adding row to span values countqualifier null countvalues null at netopentsdbrollupRollupSeqappendRollupSeqjava tsdb jar at netopentsdbrollupRollupSeqaddRowRollupSeqjava tsdb jar at netopentsdbrollupRollupSpanaddRowRollupSpanjava tsdb jar at netopentsdbcoreSaltScannermergeDataPointsSaltScannerjava tsdb jar at netopentsdbcoreSaltScannermergeAndReturnResultsSaltScannerjava tsdb jar at netopentsdbcoreSaltScannervalidateAndTriggerCallbackSaltScannerjava tsdb jar at netopentsdbcoreSaltScanneraccess SaltScannerjava tsdb jar at netopentsdbcoreSaltScannerScannerCBcloseSaltScannerjava tsdb jar at netopentsdbcoreSaltScannerScannerCBcallSaltScannerjava tsdb jar at netopentsdbcoreSaltScannerScannerCBcallSaltScannerjava tsdb jar at comstumbleuponasyncDeferreddoCallDeferredjava async jarna at comstumbleuponasyncDeferredrunCallbacksDeferredjava async jarna at comstumbleuponasyncDeferredaccess Deferredjava async jarna at comstumbleuponasyncDeferredContinuecallDeferredjava async jarna at comstumbleuponasyncDeferreddoCallDeferredjava async jarna at comstumbleuponasyncDeferredrunCallbacksDeferredjava async jarna at comstumbleuponasyncDeferredcallbackDeferredjava async jarna at orghbaseasyncHBaseRpccallbackHBaseRpcjava asynchbase jarna at orghbaseasyncRegionClientdecodeRegionClientjava asynchbase jarna at orghbaseasyncRegionClientdecodeRegionClientjava asynchbase jarna at orgjbossnettyhandlercodecreplayReplayingDecodercallDecodeReplayingDecoderjava netty Finaljarna at orgjbossnettyhandlercodecreplayReplayingDecodermessageReceivedReplayingDecoderjava netty Finaljarna at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orghbaseasyncRegionClienthandleUpstreamRegionClientjava asynchbase jarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelSimpleChannelHandlermessageReceivedSimpleChannelHandlerjava netty Finaljarna at orgjbossnettychannelSimpleChannelHandlerhandleUpstreamSimpleChannelHandlerjava netty Finaljarna at orgjbossnettyhandlertimeoutIdleStateAwareChannelHandlerhandleUpstreamIdleStateAwareChannelHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettyhandlertimeoutIdleStateHandlermessageReceivedIdleStateHandlerjava netty Finaljarna at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orghbaseasyncHBaseClientRegionClientPipelinesendUpstreamHBaseClientjava asynchbase jarna at orgjbossnettychannelChannelsfireMessageReceivedChannelsjava netty Finaljarna at orgjbossnettychannelChannelsfireMessageReceivedChannelsjava netty Finaljarna at orgjbossnettychannelsocketnioNioWorkerreadNioWorkerjava netty Finaljarna at orgjbossnettychannelsocketnioAbstractNioWorkerprocessAbstractNioWorkerjava netty Finaljarna at orgjbossnettychannelsocketnioAbstractNioSelectorrunAbstractNioSelectorjava netty Finaljarna at orgjbossnettyutilThreadRenamingRunnablerunThreadRenamingRunnablejava netty Finaljarna at orgjbossnettyutilinternalDeadLockProofWorker runDeadLockProofWorkerjava netty Finaljarna at javautilconcurrentThreadPoolExecutorrunWorkerThreadPoolExecutorjava na at javautilconcurrentThreadPoolExecutorWorkerrunThreadPoolExecutorjava na comstumbleuponasyncDeferredGroupException At least one of the Deferreds failed first exception at comstumbleuponasyncDeferredGroupdoneDeferredGroupjava async jarna at comstumbleuponasyncDeferredGrouprecordCompletionDeferredGroupjava async jarna at comstumbleuponasyncDeferredGroupaccess DeferredGroupjava async jarna at comstumbleuponasyncDeferredGroup NotifyOrderedcallDeferredGroupjava async jarna at comstumbleuponasyncDeferreddoCallDeferredjava async jarna at comstumbleuponasyncDeferredrunCallbacksDeferredjava async jarna at comstumbleuponasyncDeferredcallbackDeferredjava async jarna at netopentsdbcoreSaltScannervalidateAndTriggerCallbackSaltScannerjava tsdb jar at netopentsdbcoreSaltScanneraccess SaltScannerjava tsdb jar at netopentsdbcoreSaltScannerScannerCBcloseSaltScannerjava tsdb jar at netopentsdbcoreSaltScannerScannerCBcallSaltScannerjava tsdb jar at netopentsdbcoreSaltScannerScannerCBcallSaltScannerjava tsdb jar at comstumbleuponasyncDeferreddoCallDeferredjava async jarna at comstumbleuponasyncDeferredrunCallbacksDeferredjava async jarna at comstumbleuponasyncDeferredaccess Deferredjava async jarna at comstumbleuponasyncDeferredContinuecallDeferredjava async jarna at orgjbossnettyhandlercodecreplayReplayingDecodercallDecodeReplayingDecoderjava netty Finaljarna at orgjbossnettyhandlercodecreplayReplayingDecodermessageReceivedReplayingDecoderjava netty Finaljarna at orgjbossnettychannelSimpleChannelUpstreamHandlerhandleUpstreamSimpleChannelUpstreamHandlerjava netty Finaljarna at orghbaseasyncRegionClienthandleUpstreamRegionClientjava asynchbase jarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orgjbossnettychannelSimpleChannelHandlermessageReceivedSimpleChannelHandlerjava netty Finaljarna at orgjbossnettychannelSimpleChannelHandlerhandleUpstreamSimpleChannelHandlerjava netty Finaljarna at orgjbossnettyhandlertimeoutIdleStateAwareChannelHandlerhandleUpstreamIdleStateAwareChannelHandlerjava netty Finaljarna at orgjbossnettychannelDefaultChannelPipelinesendUpstreamDefaultChannelPipelinejava netty Finaljarna at orghbaseasyncHBaseClientRegionClientPipelinesendUpstreamHBaseClientjava asynchbase jarna at orgjbossnettychannelChannelsfireMessageReceivedChannelsjava netty Finaljarna at orgjbossnettychannelChannelsfireMessageReceivedChannelsjava netty Finaljarna at orgjbossnettychannelsocketnioNioWorkerreadNioWorkerjava netty Finaljarna at orgjbossnettychannelsocketnioAbstractNioWorkerprocessAbstractNioWorkerjava netty Finaljarna at orgjbossnettychannelsocketnioAbstractNioSelectorrunAbstractNioSelectorjava netty Finaljarna at orgjbossnettychannelsocketnioAbstractNioWorkerrunAbstractNioWorkerjava netty Finaljarna at orgjbossnettychannelsocketnioNioWorkerrunNioWorkerjava netty Finaljarna at orgjbossnettyutilThreadRenamingRunnablerunThreadRenamingRunnablejava netty Finaljarna at orgjbossnettyutilinternalDeadLockProofWorker runDeadLockProofWorkerjava netty Finaljarna at javautilconcurrentThreadPoolExecutorrunWorkerThreadPoolExecutorjava na at javautilconcurrentThreadPoolExecutorWorkerrunThreadPoolExecutorjava na at javalangThreadrunThreadjava na my rollup config aggregationIds sum count min max intervals table tsdbdmaas preAggregationTable tsdbpreaggdmaas interval m rowSpan h defaultInterval true table tsdbrollup hdmaas preAggregationTable tsdbrolluppreagg hdmaas interval h rowSpan d 