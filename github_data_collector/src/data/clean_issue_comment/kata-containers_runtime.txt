DEBUG Fixes Signedoffby Jose Carlos Venegas Munoz josecarlosvenegasmunozintelcom Description of problem I run a centos container pod and generate a test file in it with the following dd command dd ifdevzero oftest bs M count sync I expect containerfswritesbytestotal should increase after dd but it doesnt change at all I test the command in docker and it works as expected I have set sandboxcgrouponly to true related issue The result of PromQL containerfswritesbytestotalpodnamecentos db d cp vpb containerfswritesbytestotalbetakubernetesioarchamd betakubernetesiooslinuxdevicedevdm idvckata b ea c d a e d c c cb da ab debbcf d e f dimagegcrazk scngooglecontainerspauseamd instancexxxxjobkubernetesnodescadvisorkatacontainersiokataruntimetruekubernetesiohostname name b ea c d a e d c c cb da ab debbcf d e f dnamespacedefault podnamecentos db d cp vpb containerfswritesbytestotalbetakubernetesioarchamd betakubernetesiooslinuxdevicedevsdaidvckata b ea c d a e d c c cb da ab debbcf d e f dimagegcrazk scngooglecontainerspauseamd instancexxxxjobkubernetesnodescadvisorkatacontainersiokataruntimetruekubernetesiohostname name b ea c d a e d c c cb da ab debbcf d e f dnamespacedefault podnamecentos db d cp vpb Further more the network metric containernetworktransmitbytestotal seems always return higher value than expected Kata version kataruntime alpha commit ae a d a d c fad e ef OCI specs dev Expected result The result of the PromQL sumcontainerfswritesbytestotalpodnamemypodname should increase about M after dd Actual result It doesnt change at all Ive found a few unit tests which were generating stale files under tmp Using defer in TestMain osExit will skip all deferred instructions So we should reconstruct TestMain to leave all setuprelated code in setup and all cleanuprelated code in shutdown Missing deleting what ioutilTempDir creates Normally ioutilTempDir will create a new temporary dir under tmp Missing deleting what ioutilTempFile creates ioutilTempFile creates a new temporary file in the directory tmp It is the callers responsibility to remove the file when no longer needed Ive found a few unit tests which were generating stale files under tmp Using defer in TestMain osExit will skip all deferred instructions So we should reconstruct TestMain to leave all setuprelated code in setup and all cleanuprelated code in shutdown Missing deleting what ioutilTempDir creates Normally ioutilTempDir will create a new temporary dir under tmp PR is on the fly These last days I have seen the Firecracker CI fail randomly specially at the CRIO tests here it is an example of that time bats jobs tap ctrbats ok ctr not found correct error message ok ctr termination reason Completed ok ctr termination reason Error not ok ulimits in test file ctrbats line status eq failed time T Z levelerror msgFile descriptor pipe leaked on pvdisplay invocation Parent PID tmpjenkinsworkspacekatacon nFile descriptor devmappercontrol leaked on pvdisplay invocation Parent PID tmpjenkinsworkspacekatacon n Failed to find physical volume devsdb n errorexit status time Z leveldebug msgfound valid runtime runc for runtimepath usrlocalbinkataruntime fileconfigconfiggo time Z levelinfo msgusing conmon executable usrlocalbinconmon fileconfigconfiggo time Z leveldebug msg graphdriver trying provided driver devicemapper filedriversdrivergo time Z leveldebug msgdevicemapper kernel dm driver version is filedevmapperdevicesetgo time Z leveldebug msgSetting dmthinpooldev to storagethinpool filedevmapperdevicesetgo storagedriverdevicemapper time Z leveldebug msgdevmapper Generated prefix container filedevmapperdevicesetgo time Z leveldebug msgdevmapper Checking for existence of the pool storagethinpool filedevmapperdevicesetgo time Z leveldebug msgdevmapper loadDeviceFilesOnStart filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadata d f ddfdf b fbb c a d e a f f f d filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadata be edf a d f b c d ccb ab d c e a e e filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadata a c dd fc b b f e d fee c a b f ba a b f c c filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadata a edaafa f f f dd d b f d dced a e fef c filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadata ba eeb a dcd f f a ec d ec c b c dd d filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadata fc c d d ff e f d f e e c ffe b eb filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadata e dbee b f a d f df e ec ca b a a f filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadata ca b d f c b eab d e cceb f d b bf b a filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadataad f bda d a c e dfe a af cff adb ba filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadatab e f e ffcdf dc cd c cf d c b e b filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadatabase filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadatac cd af ac b a c dcfc d a b f ac c ca c f ff e filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadatacd a a b cabd a f ae b a bd d e b filedevmapperdevicesetgo time Z leveldebug msgdevmapper Skipping file tmptmpt m gZy ctcriodevicemappermetadatadevicesetmetadata filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadatae f ebecadc bfb ff a a d bab be b c f filedevmapperdevicesetgo time Z leveldebug msgdevmapper Loading data for file tmptmpt m gZy ctcriodevicemappermetadatae b f bc d e df c e f e fcb ea fb fb f f d filedevmapperdevicesetgo time Z leveldebug msgdevmapper Skipping file tmptmpt m gZy ctcriodevicemappermetadatatransactionmetadata filedevmapperdevicesetgo time Z leveldebug msgdevmapper loadDeviceFilesOnStart END filedevmapperdevicesetgo time Z leveldebug msgdevmapper constructDeviceIDMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper Added deviceId to DeviceIdMap filedevmapperdevicesetgo time Z leveldebug msgdevmapper constructDeviceIDMap END filedevmapperdevicesetgo time Z leveldebug msgdevmapper activateDeviceIfNeeded filedevmapperdevicesetgo time Z leveldebug msgdevmapper UUID for device devmappercontainer base is c e d ace bf f filedevmapperdevicesetgo time Z levelwarning msgdevmapper Base device already exists and has filesystem xfs on it User specified filesystem will be ignored filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice START filedevmapperdevicesetgo time Z leveldebug msgdevmapper removeDevice STARTcontainer base filedevmapperdevicesetgo time Z leveldebug msgdevmapper removeDevice ENDcontainer base filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice END filedevmapperdevicesetgo time Z leveldebug msgreading hooks from tmptmpt m gZy cthooks filehooksreadgo time Z levelinfo msgFound CNI network crionet typebridge at tmptmpt m gZy ctcninetd crioconf fileocicniocicnigo time Z levelinfo msgno seccomp profile specified using the internal default fileserverservergo time Z levelinfo msginstalling default apparmor profile criodefault fileserverservergo time Z leveldebug msgGolangs threads limit set to fileserverservergo time Z levelinfo msgusing host IPs fileserverservergo time Z leveldebug msgsandboxes fileserverservergo time Z leveldebug msgregistered SIGHUP watcher for file tmptmpt m gZy ctcrioconf fileserverservergo time Z levelwarning msgunable to start config watcher for file etccontainersregistriesconf stat etccontainersregistriesconf no such file or directory fileserverservergo time Z leveldebug msgmonitoring tmptmpt m gZy cthooks for hooks filehooksmonitorgo time Z leveldebug msgrequest StatusRequestVerbosetrue filev alpha apipbgo id e aac d aa a d e cff time Z leveldebug msgresponse StatusResponseStatus RuntimeStatusConditions RuntimeCondition RuntimeConditionTypeRuntimeReadyStatustrueReasonMessage RuntimeConditionTypeNetworkReadyStatustrueReasonMessageInfomap string string filev alpha apipbgo id e aac d aa a d e cff time Z leveldebug msgrequest ImageStatusRequestImage ImageSpecImagequayiocrioredisalpineVerbosetrue filev alpha apipbgo ide b b a e ec f e time Z leveldebug msgparsed reference into devicemappertmptmpt m gZy ctcriotmptmpt m gZy ctcriorundmdirectlvmdeviceforcetruedmthinppercent dmthinpmetapercent dmthinpautoextendthreshold dmthinpautoextendpercent dmdirectlvmdevicedevsdb quayiocrioredisalpine filestoragestoragetransportgo time Z leveldebug msgresponse ImageStatusResponseImage ImageId bd cfc b ef ff e d c c f a a b cb d bed aRepoTags quayiocrioredisalpine RepoDigests quayiocrioredissha b a b eb d d a e beb ea a ed Size UidnilUsernameInfomap string string filev alpha apipbgo ide b b a e ec f e time Z leveldebug msgrequest ImageStatusRequestImage ImageSpecImagequayiocrioredisalpineVerbosetrue filev alpha apipbgo idc e c f c dc time Z leveldebug msgparsed reference into devicemappertmptmpt m gZy ctcriotmptmpt m gZy ctcriorundmdirectlvmdeviceforcetruedmthinppercent dmthinpmetapercent dmthinpautoextendthreshold dmthinpautoextendpercent dmdirectlvmdevicedevsdb quayiocrioredisalpine filestoragestoragetransportgo time Z leveldebug msgresponse ImageStatusResponseImage ImageId bd cfc b ef ff e d c c f a a b cb d bed aRepoTags quayiocrioredisalpine RepoDigests quayiocrioredissha b a b eb d d a e beb ea a ed Size UidnilUsernameInfomap string string filev alpha apipbgo idc e c f c dc time Z leveldebug msgrequest ImageStatusRequestImage ImageSpecImagequayiocrioredisalpineVerbosetrue filev alpha apipbgo id f b d f d d fd time Z leveldebug msgparsed reference into devicemappertmptmpt m gZy ctcriotmptmpt m gZy ctcriorundmdirectlvmdeviceforcetruedmthinppercent dmthinpmetapercent dmthinpautoextendthreshold dmthinpautoextendpercent dmdirectlvmdevicedevsdb quayiocrioredisalpine filestoragestoragetransportgo time Z leveldebug msgresponse ImageStatusResponseImage ImageId bd cfc b ef ff e d c c f a a b cb d bed aRepoTags quayiocrioredisalpine RepoDigests quayiocrioredissha b a b eb d d a e beb ea a ed Size UidnilUsernameInfomap string string filev alpha apipbgo id f b d f d d fd time Z leveldebug msgrequest ImageStatusRequestImage ImageSpecImagequayiocriooomVerbosetrue filev alpha apipbgo id e d b be a d a time Z leveldebug msgparsed reference into devicemappertmptmpt m gZy ctcriotmptmpt m gZy ctcriorundmdirectlvmdeviceforcetruedmthinppercent dmthinpmetapercent dmthinpautoextendthreshold dmthinpautoextendpercent dmdirectlvmdevicedevsdb quayiocriooomlatest filestoragestoragetransportgo time Z leveldebug msgresponse ImageStatusResponseImage ImageId cb ee ccba f ea dab b b e b fd bd b RepoTags quayiocriooomlatest RepoDigests quayiocriooomsha f a d c e f ab b f fa cbe a a e e eae Size UidnilUsernameInfomap string string filev alpha apipbgo id e d b be a d a time Z leveldebug msgrequest ImageStatusRequestImage ImageSpecImagequayiocriooomVerbosetrue filev alpha apipbgo id dee fbd fc a c cf time Z leveldebug msgparsed reference into devicemappertmptmpt m gZy ctcriotmptmpt m gZy ctcriorundmdirectlvmdeviceforcetruedmthinppercent dmthinpmetapercent dmthinpautoextendthreshold dmthinpautoextendpercent dmdirectlvmdevicedevsdb quayiocriooomlatest filestoragestoragetransportgo time Z leveldebug msgresponse ImageStatusResponseImage ImageId cb ee ccba f ea dab b b e b fd bd b RepoTags quayiocriooomlatest RepoDigests quayiocriooomsha f a d c e f ab b f fa cbe a a e e eae Size UidnilUsernameInfomap string string filev alpha apipbgo id dee fbd fc a c cf time Z leveldebug msgrequest ImageStatusRequestImage ImageSpecImagequayiocriostderrtestVerbosetrue filev alpha apipbgo id dcb a dec e f time Z leveldebug msgparsed reference into devicemappertmptmpt m gZy ctcriotmptmpt m gZy ctcriorundmdirectlvmdeviceforcetruedmthinppercent dmthinpmetapercent dmthinpautoextendthreshold dmthinpautoextendpercent dmdirectlvmdevicedevsdb quayiocriostderrtestlatest filestoragestoragetransportgo time Z leveldebug msgresponse ImageStatusResponseImage ImageId c f c b a dfbe e a deea e f eb a ab f ef RepoTags quayiocriostderrtestlatest RepoDigests quayiocriostderrtestsha d befc a e db e e d da bc d db f f f c Size UidnilUsernameInfomap string string filev alpha apipbgo id dcb a dec e f time Z leveldebug msgrequest ImageStatusRequestImage ImageSpecImagequayiocriostderrtestVerbosetrue filev alpha apipbgo idbea e ad dbeb ca d ce time Z leveldebug msgparsed reference into devicemappertmptmpt m gZy ctcriotmptmpt m gZy ctcriorundmdirectlvmdeviceforcetruedmthinppercent dmthinpmetapercent dmthinpautoextendthreshold dmthinpautoextendpercent dmdirectlvmdevicedevsdb quayiocriostderrtestlatest filestoragestoragetransportgo time Z leveldebug msgresponse ImageStatusResponseImage ImageId c f c b a dfbe e a deea e f eb a ab f ef RepoTags quayiocriostderrtestlatest RepoDigests quayiocriostderrtestsha d befc a e db e e d da bc d db f f f c Size UidnilUsernameInfomap string string filev alpha apipbgo idbea e ad dbeb ca d ce time Z leveldebug msgrequest ImageStatusRequestImage ImageSpecImagequayiocriobusyboxVerbosetrue filev alpha apipbgo id d a faada ccb e d dbd e time Z leveldebug msgparsed reference into devicemappertmptmpt m gZy ctcriotmptmpt m gZy ctcriorundmdirectlvmdeviceforcetruedmthinppercent dmthinpmetapercent dmthinpautoextendthreshold dmthinpautoextendpercent dmdirectlvmdevicedevsdb quayiocriobusyboxlatest filestoragestoragetransportgo time Z leveldebug msgresponse ImageStatusResponseImage ImageId ac a a b c d ceaa b aa fe ba ccc d c RepoTags quayiocriobusyboxlatest RepoDigests quayiocriobusyboxsha f fc ba d b b a e dfd d c b d dda a a d e d Size UidnilUsernameInfomap string string filev alpha apipbgo id d a faada ccb e d dbd e time Z leveldebug msgrequest ImageStatusRequestImage ImageSpecImagequayiocriobusyboxVerbosetrue filev alpha apipbgo idb cf fdae c f b b bb b ad time Z leveldebug msgparsed reference into devicemappertmptmpt m gZy ctcriotmptmpt m gZy ctcriorundmdirectlvmdeviceforcetruedmthinppercent dmthinpmetapercent dmthinpautoextendthreshold dmthinpautoextendpercent dmdirectlvmdevicedevsdb quayiocriobusyboxlatest filestoragestoragetransportgo time Z leveldebug msgresponse ImageStatusResponseImage ImageId ac a a b c d ceaa b aa fe ba ccc d c RepoTags quayiocriobusyboxlatest RepoDigests quayiocriobusyboxsha f fc ba d b b a e dfd d c b d dda a a d e d Size UidnilUsernameInfomap string string filev alpha apipbgo idb cf fdae c f b b bb b ad time Z leveldebug msgrequest ImageStatusRequestImage ImageSpecImagequayiocrioimagevolumetestVerbosetrue filev alpha apipbgo idad be f bee f fe dd c c time Z leveldebug msgparsed reference into devicemappertmptmpt m gZy ctcriotmptmpt m gZy ctcriorundmdirectlvmdeviceforcetruedmthinppercent dmthinpmetapercent dmthinpautoextendthreshold dmthinpautoextendpercent dmdirectlvmdevicedevsdb quayiocrioimagevolumetestlatest filestoragestoragetransportgo time Z leveldebug msgresponse ImageStatusResponseImage ImageId aa df b d ae fe a cbf c d d d fac e b e RepoTags quayiocrioimagevolumetestlatest RepoDigests quayiocrioimagevolumetestsha e f db a cbe c dcd a b f Size UidnilUsernameInfomap string string filev alpha apipbgo idad be f bee f fe dd c c time Z leveldebug msgrequest ImageStatusRequestImage ImageSpecImagequayiocrioimagevolumetestVerbosetrue filev alpha apipbgo id e cf a c f ce e time Z leveldebug msgparsed reference into devicemappertmptmpt m gZy ctcriotmptmpt m gZy ctcriorundmdirectlvmdeviceforcetruedmthinppercent dmthinpmetapercent dmthinpautoextendthreshold dmthinpautoextendpercent dmdirectlvmdevicedevsdb quayiocrioimagevolumetestlatest filestoragestoragetransportgo time Z leveldebug msgresponse ImageStatusResponseImage ImageId aa df b d ae fe a cbf c d d d fac e b e RepoTags quayiocrioimagevolumetestlatest RepoDigests quayiocrioimagevolumetestsha e f db a cbe c dcd a b f Size UidnilUsernameInfomap string string filev alpha apipbgo id e cf a c f ce e time Z leveldebug msgrequest RunPodSandboxRequestConfig PodSandboxConfigMetadata PodSandboxMetadataNamepodsandbox UidredhattestcrioNamespaceredhattestcrioAttempt HostnamecrictlhostLogDirectoryDnsConfig DNSConfigServers Searches Options PortMappings PortMappingLabelsmap string stringgroup testAnnotationsmap string stringowner hmengsecurityalphakubernetesioseccomppod unconfinedLinux LinuxPodSandboxConfigCgroupParentBurstablepod SecurityContext LinuxSandboxSecurityContextNamespaceOptions NamespaceOptionNetworkPODPidCONTAINERIpcPODSelinuxOptions SELinuxOptionUsersystemuRolesystemrTypesvirtlxcnettLevels c c RunAsUsernilReadonlyRootfsfalseSupplementalGroups PrivilegedfalseSeccompProfilePathRunAsGroupnilSysctlsmap string stringRuntimeHandler filev alpha apipbgo ide ff d d e b f b e f time Z levelinfo msgattempting to run pod sandbox with infra container POD fileserversandboxrunlinuxgo ide ff d d e b f b e f time Z leveldebug msgparsed reference into devicemappertmptmpt m gZy ctcriotmptmpt m gZy ctcriorundmdirectlvmdeviceforcetruedmthinppercent dmthinpmetapercent dmthinpautoextendthreshold dmthinpautoextendpercent dmdirectlvmdevicedevsdb k sgcriopause filestoragestoragetransportgo time Z leveldebug msgreference devicemappertmptmpt m gZy ctcriotmptmpt m gZy ctcriorundmdirectlvmdeviceforcetruedmthinppercent dmthinpmetapercent dmthinpautoextendthreshold dmthinpautoextendpercent dmdirectlvmdevicedevsdb k sgcriopause does not resolve to an image ID filestoragestoragereferencego time Z leveldebug msgcouldnt find image k sgcriopause retrieving it filestorageruntimego time Z leveldebug msgparsed reference into devicemappertmptmpt m gZy ctcriotmptmpt m gZy ctcriorundmdirectlvmdeviceforcetruedmthinppercent dmthinpmetapercent dmthinpautoextendthreshold dmthinpautoextendpercent dmdirectlvmdevicedevsdb k sgcriopause filestoragestoragetransportgo time Z leveldebug msgreference rewritten from k sgcriopause to k sgcriopause filesysregistriesv systemregistriesv go time Z leveldebug msgTrying to pull k sgcriopause filedockerdockerimagesrcgo time Z leveldebug msgCredentials not found fileconfigconfiggo time Z leveldebug msgUsing registriesd directory etccontainersregistriesd for sigstore configuration filedockerlookasidego time Z leveldebug msg No signature storage configuration found for k sgcriopause filedockerlookasidego time Z leveldebug msgLooking for TLS certificates and private keys in etcdockercertsdk sgcrio filetlsclientconfigtlsclientconfiggo time Z leveldebug msgGET filedockerdockerclientgo time Z leveldebug msgPing status filedockerdockerclientgo time Z leveldebug msgGET filedockerdockerclientgo time Z leveldebug msgGET filedockerdockerclientgo time Z leveldebug msgUsing blob info cache at varlibcontainerscacheblobinfocachev boltdb fileblobinfocachedefaultgo time Z leveldebug msgSource is a manifest list copying only instance sha eec a d cc a b c ea acc a c b ce b for current system filecopycopygo time Z leveldebug msgGET filedockerdockerclientgo time Z leveldebug msgIsRunningImageAllowed for image dockerk sgcriopause filesignaturepolicyevalgo time Z leveldebug msg Using default policy section filesignaturepolicyevalgo time Z leveldebug msg Requirement allowed filesignaturepolicyevalgo time Z leveldebug msgOverall allowed filesignaturepolicyevalgo time Z leveldebug msgDownloading v pauseblobssha da e ba ca bf bc e d febd b eaa e bed b fbe ed e filedockerdockerimagesrcgo time Z leveldebug msgGET filedockerdockerclientgo time Z leveldebug msgManifest has MIME type applicationvnddockerdistributionmanifestv json ordered candidate list applicationvnddockerdistributionmanifestv json applicationvnddockerdistributionmanifestv prettyjws applicationvndociimagemanifestv json applicationvnddockerdistributionmanifestv json filecopymanifestgo time Z leveldebug msg will first try using the original manifest unmodified filecopymanifestgo time Z leveldebug msgDownloading v pauseblobssha ddbfb a d c ea df e ffc d f ecfa e c eb filedockerdockerimagesrcgo time Z leveldebug msgGET filedockerdockerclientgo time Z leveldebug msgDetected compression format gzip filecompressioncompressiongo time Z leveldebug msgUsing original blob without modification filecopycopygo time Z leveldebug msgNo compression detected filecompressioncompressiongo time Z leveldebug msgUsing original blob without modification filecopycopygo time Z leveldebug msgdevmapper AddDevice STARThashe b ad f ae f badd c bad fc f cab b d fbaa c basehash filedevmapperdevicesetgo time Z leveldebug msgdevmapper Failed to read tmptmpt m gZy ctcriodevicemappermetadatae b ad f ae f badd c bad fc f cab b d fbaa c with err open tmptmpt m gZy ctcriodevicemappermetadatae b ad f ae f badd c bad fc f cab b d fbaa c no such file or directory filedevmapperdevicesetgo time Z leveldebug msgdevmapper registerDevice e b ad f ae f badd c bad fc f cab b d fbaa c filedevmapperdevicesetgo time Z leveldebug msgdevmapper AddDevice ENDhashe b ad f ae f badd c bad fc f cab b d fbaa c basehash filedevmapperdevicesetgo time Z leveldebug msgdevmapper activateDeviceIfNeedede b ad f ae f badd c bad fc f cab b d fbaa c filedevmapperdevicesetgo time Z leveldebug msgStart untar layer filedriversfsdiffgo time Z leveldebug msgUntar time s filedriversfsdiffgo time Z leveldebug msgdevmapper UnmountDevice STARThashe b ad f ae f badd c bad fc f cab b d fbaa c filedevmapperdevicesetgo time Z leveldebug msgdevmapper Unmounttmptmpt m gZy ctcriodevicemappermnte b ad f ae f badd c bad fc f cab b d fbaa c filedevmapperdevicesetgo time Z leveldebug msgdevmapper Unmount done filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice STARTe b ad f ae f badd c bad fc f cab b d fbaa c filedevmapperdevicesetgo time Z leveldebug msgdevmapper removeDevice STARTcontainer e b ad f ae f badd c bad fc f cab b d fbaa c filedevmapperdevicesetgo time Z leveldebug msgdevmapper removeDevice ENDcontainer e b ad f ae f badd c bad fc f cab b d fbaa c filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice ENDe b ad f ae f badd c bad fc f cab b d fbaa c filedevmapperdevicesetgo time Z leveldebug msgdevmapper UnmountDevice ENDhashe b ad f ae f badd c bad fc f cab b d fbaa c filedevmapperdevicesetgo time Z leveldebug msgsetting image creation date to UTC filestoragestorageimagego time Z leveldebug msgcreated new image ID da e ba ca bf bc e d febd b eaa e bed b fbe ed e filestoragestorageimagego time Z leveldebug msgset names of image da e ba ca bf bc e d febd b eaa e bed b fbe ed e to k sgcriopause filestoragestorageimagego time Z leveldebug msgsaved image metadata signaturessizes sha eec a d cc a b c ea acc a c b ce b filestoragestorageimagego time Z leveldebug msgsuccessfully pulled image k sgcriopause filestorageruntimego time Z leveldebug msgexporting opaque data as blob sha da e ba ca bf bc e d febd b eaa e bed b fbe ed e filestoragestorageimagego time Z leveldebug msgdevmapper AddDevice STARThashefec ad cbca cfb e fc b de bf fb b e a f e basehashe b ad f ae f badd c bad fc f cab b d fbaa c filedevmapperdevicesetgo time Z leveldebug msgdevmapper Failed to read tmptmpt m gZy ctcriodevicemappermetadataefec ad cbca cfb e fc b de bf fb b e a f e with err open tmptmpt m gZy ctcriodevicemappermetadataefec ad cbca cfb e fc b de bf fb b e a f e no such file or directory filedevmapperdevicesetgo time Z leveldebug msgdevmapper registerDevice efec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper AddDevice ENDhashefec ad cbca cfb e fc b de bf fb b e a f e basehashe b ad f ae f badd c bad fc f cab b d fbaa c filedevmapperdevicesetgo time Z leveldebug msgcreated pod sandbox aad e a ce b fd e d c b b e bcc d filestorageruntimego time Z leveldebug msgpod sandbox aad e a ce b fd e d c b b e bcc d has work directory tmptmpt m gZy ctcriodevicemappercontainers aad e a ce b fd e d c b b e bcc duserdata filestorageruntimego time Z leveldebug msgpod sandbox aad e a ce b fd e d c b b e bcc d has run directory tmptmpt m gZy ctcriorundevicemappercontainers aad e a ce b fd e d c b b e bcc duserdata filestorageruntimego time Z levelwarning msgsysctl not of the format sysctlnamevalue fileserversandboxrunlinuxgo ide ff d d e b f b e f time Z leveldebug msgdevmapper activateDeviceIfNeededefec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgmounted container aad e a ce b fd e d c b b e bcc d at tmptmpt m gZy ctcriodevicemappermntefec ad cbca cfb e fc b de bf fb b e a f erootfs filestorageruntimego time Z leveldebug msgrunning conmon usrlocalbinconmon args syslog c aad e a ce b fd e d c b b e bcc d n k sPODpodsandbox redhattestcrioredhattestcrio u aad e a ce b fd e d c b b e bcc d r usrlocalbinkataruntime b tmptmpt m gZy ctcriorundevicemappercontainers aad e a ce b fd e d c b b e bcc duserdata p tmptmpt m gZy ctcriorundevicemappercontainers aad e a ce b fd e d c b b e bcc duserdatapidfile l varlogcriopods aad e a ce b fd e d c b b e bcc d aad e a ce b fd e d c b b e bcc dlog exitdir tmptmpt m gZy ctcontainersexits socketdirpath tmptmpt m gZy ctcontainers loglevel debug runtimearg rootrunrunc fileociruntimeocigo time Z levelwarning msgFailed to add conmon to cgroupfs sandbox cgroup write sysfscgroupunifiedBurstablepod crioconmon aad e a ce b fd e d c b b e bcc dtasks open sysfscgroupunifiedBurstablepod crioconmon aad e a ce b fd e d c b b e bcc dtasks permission denied fileociocilinuxgo time Z leveldebug msgReceived container pid fileociruntimeocigo time Z levelerror msgContainer creation error Failed to check if grpc server is working context deadline exceeded n fileociruntimeocigo time Z leveldebug msgdevmapper UnmountDevice STARThashefec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper Unmounttmptmpt m gZy ctcriodevicemappermntefec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper Unmount done filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice STARTefec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper removeDevice STARTcontainer efec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper removeDevice ENDcontainer efec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice ENDefec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper UnmountDevice ENDhashefec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper DeleteDevice STARThashefec ad cbca cfb e fc b de bf fb b e a f e syncDeletefalse filedevmapperdevicesetgo time Z leveldebug msgdevmapper issueDiscard STARTdevice efec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper activateDeviceIfNeededefec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper issueDiscard ENDdevice efec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice STARTefec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper removeDevice STARTcontainer efec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper removeDevice ENDcontainer efec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice ENDefec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper unregisterDeviceefec ad cbca cfb e fc b de bf fb b e a f e filedevmapperdevicesetgo time Z leveldebug msgdevmapper DeleteDevice ENDhashefec ad cbca cfb e fc b de bf fb b e a f e syncDeletefalse filedevmapperdevicesetgo time Z leveldebug msgresponse error container create failed Failed to check if grpc server is working context deadline exceeded n filev alpha apipbgo ide ff d d e b f b e f time T Z levelfatal msgrun pod sandbox failed rpc error code Unknown desc container create failed Failed to check if grpc server is working context deadline exceeded n time Z leveldebug msgrequest ListContainersRequestFilter ContainerFilterIdState ContainerStateValueStateCONTAINERRUNNINGPodSandboxIdLabelSelectormap string string filev alpha apipbgo idc f b b b c e time Z leveldebug msgno filters were applied returning full container list fileservercontainerlistgo idc f b b b c e time Z leveldebug msgresponse ListContainersResponseContainers Container filev alpha apipbgo idc f b b b c e time Z leveldebug msgrequest ListPodSandboxRequestFilter PodSandboxFilterIdStatenilLabelSelectormap string string filev alpha apipbgo idc d b f db bb d a f ee time Z leveldebug msgresponse ListPodSandboxResponseItems PodSandbox filev alpha apipbgo idc d b f db bb d a f ee time Z leveldebug msgreceived signal filecriomaingo signalterminated time Z leveldebug msgCaught SIGTERM filecriomaingo time Z leveldebug msgdevmapper deviceset container Shutdown filedevmapperdevicesetgo time Z leveldebug msgdevmapper Shutting down DeviceSet tmptmpt m gZy ctcriodevicemapper filedevmapperdevicesetgo time Z leveldebug msghook monitoring canceled context canceled filehooksmonitorgo time Z leveldebug msgclosed http server filecriomaingo time Z leveldebug msgclosing exit monitor fileserverservergo time Z leveldebug msgdevmapper Failed to read tmptmpt m gZy ctcriodevicemappermetadatamnt with err open tmptmpt m gZy ctcriodevicemappermetadatamnt no such file or directory filedevmapperdevicesetgo time Z leveldebug msgdevmapper Shutdown lookup device mnt error devmapper Unknown device mnt filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice START d f ddfdf b fbb c a d e a f f f d filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice END d f ddfdf b fbb c a d e a f f f d filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice START be edf a d f b c d ccb ab d c e a e e filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice END be edf a d f b c d ccb ab d c e a e e filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice START a c dd fc b b f e d fee c a b f ba a b f c c filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice END a c dd fc b b f e d fee c a b f ba a b f c c filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice START a edaafa f f f dd d b f d dced a e fef c filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice END a edaafa f f f dd d b f d dced a e fef c filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice START ba eeb a dcd f f a ec d ec c b c dd d filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice END ba eeb a dcd f f a ec d ec c b c dd d filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice START fc c d d ff e f d f e e c ffe b eb filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice END fc c d d ff e f d f e e c ffe b eb filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice START e dbee b f a d f df e ec ca b a a f filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice END e dbee b f a d f df e ec ca b a a f filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice START ca b d f c b eab d e cceb f d b bf b a filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice END ca b d f c b eab d e cceb f d b bf b a filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice STARTad f bda d a c e dfe a af cff adb ba filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice ENDad f bda d a c e dfe a af cff adb ba filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice STARTb e f e ffcdf dc cd c cf d c b e b filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice ENDb e f e ffcdf dc cd c cf d c b e b filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice STARTc cd af ac b a c dcfc d a b f ac c ca c f ff e filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice ENDc cd af ac b a c dcfc d a b f ac c ca c f ff e filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice STARTcd a a b cabd a f ae b a bd d e b filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice ENDcd a a b cabd a f ae b a bd d e b filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice STARTe f ebecadc bfb ff a a d bab be b c f filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice ENDe f ebecadc bfb ff a a d bab be b c f filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice STARTe b ad f ae f badd c bad fc f cab b d fbaa c filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice ENDe b ad f ae f badd c bad fc f cab b d fbaa c filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice STARTe b f bc d e df c e f e fcb ea fb fb f f d filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice ENDe b f bc d e df c e f e fcb ea fb fb f f d filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice START filedevmapperdevicesetgo time Z leveldebug msgdevmapper deactivateDevice END filedevmapperdevicesetgo time Z leveldebug msgdevmapper deviceset container Shutdown END filedevmapperdevicesetgo time Z leveldebug msgclosed stream server filecriomaingo time Z leveldebug msgclosed monitors filecriomaingo time Z leveldebug msgclosed hook monitor filecriomaingo time Z leveldebug msgclosed main server filecriomaingo File descriptor pipe leaked on lvm invocation Parent PID bash Logical volume thinpool successfully removed File descriptor pipe leaked on lvm invocation Parent PID bash Volume group storage successfully removed File descriptor pipe leaked on lvm invocation Parent PID bash Labels on physical volume devsdb successfully wiped ok additional devices support ok additional devices permissions skip This is not working Issue ok ctr remove ok ctr lifecycle ok ctr logging ok ctr journald logging ok ctr logging ttytrue ok ctr log max ok ctr log max with default value See Here it is another failure in another CRIO test However I also have seen errors in docker tests random for example Failure seconds docker kill tmpjenkinsworkspacekatacontainerstestsubuntu PRfirecrackergosrcgithubcomkatacontainerstestsintegrationdockerkilltestgo killing container tmpjenkinsworkspacekatacontainerstestsubuntu PRfirecrackergosrcgithubcomkatacontainerstestsvendorgithubcomonsiginkgoextensionstabletablego with window changed signal It tmpjenkinsworkspacekatacontainerstestsubuntu PRfirecrackergosrcgithubcomkatacontainerstestsvendorgithubcomonsiginkgoextensionstabletableentrygo Expected error errorserrorString xc c d s Timeout reached after s Timeout reached after s not to have occurred See With this patch set kata container can run with vhostusreblk device provided by SPDK Fixes Description of problem The error appears in dockerd dockerd time T levelwarning msgfailed to parse usrbinkataruntime version unknown output format kataruntime rc n commit d c e acb d e bedba n OCI specs dev n Expected result According to moby parseRuntimeVersion function kataruntime version output should like this kataruntime version rc commit d c e acb d e bedba OCI specs dev Actual result kataruntime rc commit d c e acb d e bedba OCI specs dev I see this error in dockerd dockerd time T levelwarning msgfailed to parse usrbinkataruntime version unknown output format kataruntime rc n commit d c e acb d e bedba n OCI specs dev n Then I changed kataruntime version command output format to fit dockerd On s x we need to set the devno thats why we need a custom appendBlkDevice function Fixes Signedoffby Alice Frosi afrosideibmcom