 What changes were proposed in this pull request Currently the downstream stage cannot start until all its depended stages all have finished Therefore we propose to remove the barrier and prestart the reduce stage once therere free cpu resource in some situations This can get better resource utilization and improve the overall job performance DAGScheduler All parent stages finish default could run the Child Stage BlockStoreShuffleReader when RSB is on there are null in Mapoutput statuses we need read partital Status from the MapOutput statuses PartialBlockFetcherIterator Thread sleep if there is noting to read Build a Set to record FetchedStatuses get Partial contains null Statuses How was this patch tested Same sql in tpcds set RSBthreshold RSB is on Time RSB is off Time Bumps jettyversion from v to v Updates jettyhttp from v to v details summaryCommitssummary d f Updating to version v ba fe Merge pull request from eclipsejetty ximproveerrorhandleroutput cf df e Issue Improve testing of ErrorHandler behavior cba d Fixing typo in stalebot message eefa Fixes Aligning default in ini to XML default e fc Issue Improve testing of ErrorHandler behavior dc Merge branch release into jetty x cff bb Issue test the decoding of OpenId Credentials d a Issue Improve handling of HttpOutputclose for pending writes ab a we do not need those repositories now Additional commits viewable in compare view details br Updates jettycontinuation from v to v details summaryCommitssummary d f Updating to version v ba fe Merge pull request from eclipsejetty ximproveerrorhandleroutput cf df e Issue Improve testing of ErrorHandler behavior cba d Fixing typo in stalebot message eefa Fixes Aligning default in ini to XML default e fc Issue Improve testing of ErrorHandler behavior dc Merge branch release into jetty x cff bb Issue test the decoding of OpenId Credentials d a Issue Improve handling of HttpOutputclose for pending writes ab a we do not need those repositories now Additional commits viewable in compare view details br Updates jettyservlet from v to v details summaryCommitssummary d f Updating to version v ba fe Merge pull request from eclipsejetty ximproveerrorhandleroutput cf df e Issue Improve testing of ErrorHandler behavior cba d Fixing typo in stalebot message eefa Fixes Aligning default in ini to XML default e fc Issue Improve testing of ErrorHandler behavior dc Merge branch release into jetty x cff bb Issue test the decoding of OpenId Credentials d a Issue Improve handling of HttpOutputclose for pending writes ab a we do not need those repositories now Additional commits viewable in compare view details br Updates jettyservlets from v to v details summaryCommitssummary d f Updating to version v ba fe Merge pull request from eclipsejetty ximproveerrorhandleroutput cf df e Issue Improve testing of ErrorHandler behavior cba d Fixing typo in stalebot message eefa Fixes Aligning default in ini to XML default e fc Issue Improve testing of ErrorHandler behavior dc Merge branch release into jetty x cff bb Issue test the decoding of OpenId Credentials d a Issue Improve handling of HttpOutputclose for pending writes ab a we do not need those repositories now Additional commits viewable in compare view details br Updates jettyproxy from v to v details summaryCommitssummary d f Updating to version v ba fe Merge pull request from eclipsejetty ximproveerrorhandleroutput cf df e Issue Improve testing of ErrorHandler behavior cba d Fixing typo in stalebot message eefa Fixes Aligning default in ini to XML default e fc Issue Improve testing of ErrorHandler behavior dc Merge branch release into jetty x cff bb Issue test the decoding of OpenId Credentials d a Issue Improve handling of HttpOutputclose for pending writes ab a we do not need those repositories now Additional commits viewable in compare view details br Updates jettyclient from v to v details summaryCommitssummary d f Updating to version v ba fe Merge pull request from eclipsejetty ximproveerrorhandleroutput cf df e Issue Improve testing of ErrorHandler behavior cba d Fixing typo in stalebot message eefa Fixes Aligning default in ini to XML default e fc Issue Improve testing of ErrorHandler behavior dc Merge branch release into jetty x cff bb Issue test the decoding of OpenId Credentials d a Issue Improve handling of HttpOutputclose for pending writes ab a we do not need those repositories now Additional commits viewable in compare view details br Updates jettyutil from v to v details summaryCommitssummary d f Updating to version v ba fe Merge pull request from eclipsejetty ximproveerrorhandleroutput cf df e Issue Improve testing of ErrorHandler behavior cba d Fixing typo in stalebot message eefa Fixes Aligning default in ini to XML default e fc Issue Improve testing of ErrorHandler behavior dc Merge branch release into jetty x cff bb Issue test the decoding of OpenId Credentials d a Issue Improve handling of HttpOutputclose for pending writes ab a we do not need those repositories now Additional commits viewable in compare view details br Updates jettysecurity from v to v details summaryCommitssummary d f Updating to version v ba fe Merge pull request from eclipsejetty ximproveerrorhandleroutput cf df e Issue Improve testing of ErrorHandler behavior cba d Fixing typo in stalebot message eefa Fixes Aligning default in ini to XML default e fc Issue Improve testing of ErrorHandler behavior dc Merge branch release into jetty x cff bb Issue test the decoding of OpenId Credentials d a Issue Improve handling of HttpOutputclose for pending writes ab a we do not need those repositories now Additional commits viewable in compare view details br Updates jettyplus from v to v details summaryCommitssummary d f Updating to version v ba fe Merge pull request from eclipsejetty ximproveerrorhandleroutput cf df e Issue Improve testing of ErrorHandler behavior cba d Fixing typo in stalebot message eefa Fixes Aligning default in ini to XML default e fc Issue Improve testing of ErrorHandler behavior dc Merge branch release into jetty x cff bb Issue test the decoding of OpenId Credentials d a Issue Improve handling of HttpOutputclose for pending writes ab a we do not need those repositories now Additional commits viewable in compare view details br Updates jettyserver from v to v details summaryCommitssummary d f Updating to version v ba fe Merge pull request from eclipsejetty ximproveerrorhandleroutput cf df e Issue Improve testing of ErrorHandler behavior cba d Fixing typo in stalebot message eefa Fixes Aligning default in ini to XML default e fc Issue Improve testing of ErrorHandler behavior dc Merge branch release into jetty x cff bb Issue test the decoding of OpenId Credentials d a Issue Improve handling of HttpOutputclose for pending writes ab a we do not need those repositories now Additional commits viewable in compare view details br Dependabot will resolve any conflicts with this PR as long as you dont alter it yourself You can also trigger a rebase manually by commenting dependabot rebase dependabotautomergestart dependabotautomergeend details summaryDependabot commands and optionssummary br You can trigger Dependabot actions by commenting on this PR dependabot rebase will rebase this PR dependabot recreate will recreate this PR overwriting any edits that have been made to it dependabot merge will merge this PR after your CI passes on it dependabot squash and merge will squash and merge this PR after your CI passes on it dependabot cancel merge will cancel a previously requested merge and block automerging dependabot reopen will reopen this PR if it is closed dependabot ignore this patchminormajor version will close this PR and stop Dependabot creating any more for this minormajor version unless you reopen the PR or upgrade to it yourself dependabot ignore this dependency will close this PR and stop Dependabot creating any more for this dependency unless you reopen the PR or upgrade to it yourself dependabot use these labels will set the current labels as the default for future PRs for this repo and language dependabot use these reviewers will set the current reviewers as the default for future PRs for this repo and language dependabot use these assignees will set the current assignees as the default for future PRs for this repo and language dependabot use this milestone will set the current milestone as the default for future PRs for this repo and language You can disable automated security fix PRs for this repo from the Security Alerts page details Bumps fasterxmljacksondatabindversion from to Updates jacksondatabind from to details summaryCommitssummary See full diff in compare view details br Updates jacksonmodulescala from to details summaryCommitssummary abae d Setting version to f jackson ac make test more robust by not relying on order of json elements d add basic test for try f set version to SNAPSHOT deb back to SNAPSHOT builds a c d c use scalatest in guava test bdfdb prepare release c test with jackson SNAPSHOT f publish SNAPSHOT Additional commits viewable in compare view details br Dependabot will resolve any conflicts with this PR as long as you dont alter it yourself You can also trigger a rebase manually by commenting dependabot rebase dependabotautomergestart dependabotautomergeend details summaryDependabot commands and optionssummary br You can trigger Dependabot actions by commenting on this PR dependabot rebase will rebase this PR dependabot recreate will recreate this PR overwriting any edits that have been made to it dependabot merge will merge this PR after your CI passes on it dependabot squash and merge will squash and merge this PR after your CI passes on it dependabot cancel merge will cancel a previously requested merge and block automerging dependabot reopen will reopen this PR if it is closed dependabot ignore this patchminormajor version will close this PR and stop Dependabot creating any more for this minormajor version unless you reopen the PR or upgrade to it yourself dependabot ignore this dependency will close this PR and stop Dependabot creating any more for this dependency unless you reopen the PR or upgrade to it yourself dependabot use these labels will set the current labels as the default for future PRs for this repo and language dependabot use these reviewers will set the current reviewers as the default for future PRs for this repo and language dependabot use these assignees will set the current assignees as the default for future PRs for this repo and language dependabot use this milestone will set the current milestone as the default for future PRs for this repo and language You can disable automated security fix PRs for this repo from the Security Alerts page details Bumps nettyall from Final to Final details summaryCommitssummary bd c mavenreleaseplugin prepare release netty Final f f Avoid use of global AtomicLong for ScheduledFutureTask ids ff a Fix incorrect comment e a Cleanup JNI code to always correctly free memory when loading fails and also eb c bd ChunkedNioFile can use absolute FileChannelread to read chunks db Close eventfd shutdownwakeup race by closely tracking epoll edges a d f Fix GraalVM native image build error dc de f We need to use NewGloblRef when caching jclass instances Update to nettytcnative Final Fix SslEngineTest to not throw ClassCastException and pass in all cases Additional commits viewable in compare view details br Dependabot compatibility score Dependabot will resolve any conflicts with this PR as long as you dont alter it yourself You can also trigger a rebase manually by commenting dependabot rebase dependabotautomergestart dependabotautomergeend details summaryDependabot commands and optionssummary br You can trigger Dependabot actions by commenting on this PR dependabot rebase will rebase this PR dependabot recreate will recreate this PR overwriting any edits that have been made to it dependabot merge will merge this PR after your CI passes on it dependabot squash and merge will squash and merge this PR after your CI passes on it dependabot cancel merge will cancel a previously requested merge and block automerging dependabot reopen will reopen this PR if it is closed dependabot ignore this patchminormajor version will close this PR and stop Dependabot creating any more for this minormajor version unless you reopen the PR or upgrade to it yourself dependabot ignore this dependency will close this PR and stop Dependabot creating any more for this dependency unless you reopen the PR or upgrade to it yourself dependabot use these labels will set the current labels as the default for future PRs for this repo and language dependabot use these reviewers will set the current reviewers as the default for future PRs for this repo and language dependabot use these assignees will set the current assignees as the default for future PRs for this repo and language dependabot use this milestone will set the current milestone as the default for future PRs for this repo and language You can disable automated security fix PRs for this repo from the Security Alerts page details Bumps checkstyle from to details summaryRelease notessummary Sourced from checkstyles releases checkstyle checkstyle checkstyle checkstyle checkstyle checkstyle checkstyle checkstyle checkstyle checkstyle checkstyle checkstyle Maven artifacts checkstyle checkstyle checkstyle checkstyle trtable truncated details details summaryCommitssummary d b mavenreleaseplugin prepare release checkstyle b a minor fix typo in comment e ec c doc add releasenotes b fe Issue disable external dtd load by default ca minor changed powermock tests to normal tests for TranslationCheck adae Issue added trycatch to setting up TreeWalker children b e minor changed powermock tests to normal tests dcb Issue move powermock tests away from the normal tests e Issue AnnotationLocation named parameters must be considered parameters c Issue ArrayTypeStyle support for method definitions Additional commits viewable in compare view details br Dependabot compatibility score Dependabot will resolve any conflicts with this PR as long as you dont alter it yourself You can also trigger a rebase manually by commenting dependabot rebase dependabotautomergestart dependabotautomergeend details summaryDependabot commands and optionssummary br You can trigger Dependabot actions by commenting on this PR dependabot rebase will rebase this PR dependabot recreate will recreate this PR overwriting any edits that have been made to it dependabot merge will merge this PR after your CI passes on it dependabot squash and merge will squash and merge this PR after your CI passes on it dependabot cancel merge will cancel a previously requested merge and block automerging dependabot reopen will reopen this PR if it is closed dependabot ignore this patchminormajor version will close this PR and stop Dependabot creating any more for this minormajor version unless you reopen the PR or upgrade to it yourself dependabot ignore this dependency will close this PR and stop Dependabot creating any more for this dependency unless you reopen the PR or upgrade to it yourself dependabot use these labels will set the current labels as the default for future PRs for this repo and language dependabot use these reviewers will set the current reviewers as the default for future PRs for this repo and language dependabot use these assignees will set the current assignees as the default for future PRs for this repo and language dependabot use this milestone will set the current milestone as the default for future PRs for this repo and language You can disable automated security fix PRs for this repo from the Security Alerts page details Bumps pmmlmodel from to details summaryCommitssummary c c c mavenreleaseplugin prepare release c Imported Java code from the JPMMLEvaluator project a adb Added field OutputFieldvalues a d Activated the skipping of whitespace strings da Added field SegmentationmissingThreshold be a Added field SegmentationmissingPredictionTreatment f Activated defense against XML eXternal Entity XXE attacks a Added utility method SAXUtilcreateFilteredSourceInputStream XMLFilter dcdb Removed utility methods ExportFilterapplyInputSource Version and ImportFi bd Extracted SAXUtil utility class Additional commits viewable in compare view details br Dependabot compatibility score Dependabot will resolve any conflicts with this PR as long as you dont alter it yourself You can also trigger a rebase manually by commenting dependabot rebase dependabotautomergestart dependabotautomergeend details summaryDependabot commands and optionssummary br You can trigger Dependabot actions by commenting on this PR dependabot rebase will rebase this PR dependabot recreate will recreate this PR overwriting any edits that have been made to it dependabot merge will merge this PR after your CI passes on it dependabot squash and merge will squash and merge this PR after your CI passes on it dependabot cancel merge will cancel a previously requested merge and block automerging dependabot reopen will reopen this PR if it is closed dependabot ignore this patchminormajor version will close this PR and stop Dependabot creating any more for this minormajor version unless you reopen the PR or upgrade to it yourself dependabot ignore this dependency will close this PR and stop Dependabot creating any more for this dependency unless you reopen the PR or upgrade to it yourself dependabot use these labels will set the current labels as the default for future PRs for this repo and language dependabot use these reviewers will set the current reviewers as the default for future PRs for this repo and language dependabot use these assignees will set the current assignees as the default for future PRs for this repo and language dependabot use this milestone will set the current milestone as the default for future PRs for this repo and language You can disable automated security fix PRs for this repo from the Security Alerts page details What changes were proposed in this pull request Add a new rule to change the sort merge join to shuffle hash join when sort merge join can not be converted to broad cast hash join How was this patch tested Add unit test I run a count sql use AE select countdistinct uid from onlineuserlog where datahour and datahour and fromunixtimeitimeyyyyMMdd The AE config I set sparksqladaptiveenabled true sparkshufflestatisticsverbose true sparksqladaptiveallowAdditionalShuffle true sparksqladaptiveskewedJoinenabled true the partition num is but the task num is and the shuffle read rows is not right When I add a config sparksqladaptiveautoCalculateInitialPartitionNum true The result is right the partition num is but the task num is and the shuffle read rows is right spark sql read orc hive table output to hdfs But the output file size is not the set parameter size why nt will be wrong with adaptive when smj bhj and bhj s numPartitions by autoCalculateInitialPartitionNum and bhj s reducenum it s same to the number of the parent partitions of the map output What changes were proposed in this pull request The result of Aggregate Expression eg sum count will be wrong with adaptive when smj bhj and bhj s numPartitions made to be by autoCalculateInitialPartitionNum and bhj s reducenum it s same to the number of the parent partitions of the map output So we should change the conditions to add ShuffleExchangeExec to solve that but its not need when bhj s reducenum is How was this patch tested UT 